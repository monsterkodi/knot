// koffee 1.4.0

/*
000000000  00000000  00000000   00     00  
   000     000       000   000  000   000  
   000     0000000   0000000    000000000  
   000     000       000   000  000 0 000  
   000     00000000  000   000  000   000
 */
var $, BaseEditor, History, Shell, Term, TextEditor, elem, kerror, klog, kpos, post, ref, render, slash,
    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

ref = require('kxk'), post = ref.post, slash = ref.slash, elem = ref.elem, kpos = ref.kpos, kerror = ref.kerror, klog = ref.klog, $ = ref.$;

BaseEditor = require('./editor/editor');

TextEditor = require('./editor/texteditor');

render = require('./editor/render');

History = require('./history');

Shell = require('./shell');

Term = (function() {
    function Term() {
        this.scrollBy = bind(this.scrollBy, this);
        this.resized = bind(this.resized, this);
        this.onFontSize = bind(this.onFontSize, this);
        var main;
        main = $('#main');
        this.div = elem({
            "class": 'term'
        });
        main.appendChild(this.div);
        this.num = 0;
        this.rows = 0;
        this.cols = 0;
        this.size = {
            charWidth: 0,
            lineHeight: 0
        };
        this.editor = new TextEditor(this, {
            features: ['Scrollbar', 'Minimap', 'Meta', 'Numbers', 'Autocomplete', 'Brackets', 'Strings', 'CursorLine']
        });
        this.editor.setText('');
        this.shell = new Shell(this);
        this.history = new History(this);
        this.autocomplete = this.editor.autocomplete;
        post.on('fontSize', this.onFontSize);
    }

    Term.prototype.failMeta = function(meta) {
        meta[2].number = {
            text: '✖',
            clss: 'fail'
        };
        meta[2].clss = 'fail';
        this.editor.minimap.drawLines(meta[0], meta[0]);
        return this.editor.meta.update(meta);
    };

    Term.prototype.succMeta = function(meta) {
        meta[2].number = {
            text: '▶',
            clss: 'succ'
        };
        meta[2].clss = 'succ';
        this.editor.minimap.drawLines(meta[0], meta[0]);
        return this.editor.meta.update(meta);
    };

    Term.prototype.insertCmdMeta = function(li, cmd) {
        return this.editor.meta.add({
            line: li,
            clss: 'cmd',
            number: {
                text: '▶',
                clss: 'cmd'
            },
            end: cmd.length + 1,
            click: (function(_this) {
                return function(meta, event) {
                    _this.editor.singleCursorAtEnd();
                    _this.editor.setInputText(_this.editor.line(meta[0]));
                    return _this.shell.execute({
                        cmd: _this.editor.line(meta[0])
                    });
                };
            })(this)
        });
    };

    Term.prototype.moveInputMeta = function() {
        if (this.editor.numLines() - 1 > this.inputMeta[0]) {
            return this.editor.meta.moveLineMeta(this.inputMeta, this.editor.numLines() - 1 - this.inputMeta[0]);
        } else {
            if (this.inputMeta[0] !== this.editor.numLines() - 1) {
                return kerror('input meta not at end?', this.inputMeta[0], this.editor.numLines() - 1);
            }
        }
    };

    Term.prototype.clear = function() {
        var ref1;
        if ((ref1 = this.shell.last) != null) {
            delete ref1.meta;
        }
        this.editor.clear();
        this.inputMeta = this.editor.meta.add({
            line: 0,
            clss: 'input',
            number: {
                text: '▶'
            },
            click: (function(_this) {
                return function(meta, event) {
                    var pos;
                    pos = kpos(event);
                    if (pos.x < 40) {
                        return klog('input number');
                    } else {
                        return klog('input text?');
                    }
                };
            })(this)
        });
        return true;
    };

    Term.prototype.onFontSize = function(size) {
        this.editor.setFontSize(size);
        return this.editor.singleCursorAtEnd();
    };

    Term.prototype.resized = function() {
        return this.editor.resized();
    };

    Term.prototype.scrollBy = function(delta) {
        var ref1;
        if (this.autocomplete.list) {
            this.autocomplete.close();
        }
        this.editor.scroll.by(delta);
        if (!((0 < (ref1 = this.editor.scroll.scroll) && ref1 < this.editor.scroll.scrollMax - 1))) {
            return post.emit('stopWheel');
        }
    };

    Term.prototype.pwd = function() {
        var dir;
        dir = slash.tilde(process.cwd());
        this.editor.appendOutput(dir);
        this.editor.meta.add({
            line: Math.max(0, this.editor.numLines() - 2),
            clss: 'pwd',
            number: {
                text: ' ',
                clss: 'pwd'
            },
            end: dir.length + 1,
            click: (function(_this) {
                return function(meta, event) {
                    var i, index, j, next, pos, ref1, ref2;
                    pos = kpos(event);
                    if (pos.x < 40) {
                        index = _this.editor.meta.metas.indexOf(meta);
                        if (index < _this.editor.meta.metas.length - 1) {
                            _this.editor.singleCursorAtPos([0, meta[0]]);
                            if (next = _this.editor.meta.nextMetaOfSameClass(meta)) {
                                for (i = j = ref1 = meta[0], ref2 = next[0]; ref1 <= ref2 ? j < ref2 : j > ref2; i = ref1 <= ref2 ? ++j : --j) {
                                    _this.editor.deleteSelectionOrCursorLines();
                                }
                            }
                            return _this.editor.moveCursorsDown();
                        }
                    } else {
                        _this.editor.singleCursorAtEnd();
                        return _this.shell.cd(_this.editor.line(meta[0]));
                    }
                };
            })(this)
        });
        return true;
    };

    Term.prototype.onEnter = function() {
        if (this.editor.isInputCursor()) {
            if (this.shell.child && this.shell.last.cmd === 'koffee') {
                this.shell.child.stdin.write('\n');
                this.editor.setInputText('');
                return;
            }
            if (this.autocomplete.isListItemSelected()) {
                this.autocomplete.complete({});
            } else if (this.autocomplete.selectedCompletion()) {
                return this.shell.execute({
                    fallback: this.editor.lastLine() + this.autocomplete.selectedCompletion()
                });
            }
            return this.shell.execute({});
        } else {
            return this.editor.singleCursorAtEnd();
        }
    };

    Term.prototype.handleKey = function(mod, key, combo, char, event) {
        switch (combo) {
            case 'enter':
                return this.onEnter();
        }
        if (this.shell.child && this.shell.last.cmd === 'koffee') {
            if (char) {
                switch (key) {
                    case 'backspace':
                        this.shell.child.stdin.write('\x08');
                        break;
                    default:
                        this.shell.child.stdin.write(char);
                }
            } else {
                klog('pipe key', key, combo);
            }
        } else {
            if ('unhandled' !== this.autocomplete.handleModKeyComboEvent(mod, key, combo, event)) {
                return;
            }
            if (this.editor.isInputCursor()) {
                switch (combo) {
                    case 'alt+up':
                        return this.editor.moveCursorsUp();
                    case 'up':
                        return this.history.prev();
                    case 'down':
                        return this.history.next();
                    case 'ctrl+c':
                        return this.shell.handleCancel();
                }
            }
        }
        return 'unhandled';
    };

    return Term;

})();

module.exports = Term;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGVybS5qcyIsInNvdXJjZVJvb3QiOiIuIiwic291cmNlcyI6WyIiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQTs7Ozs7OztBQUFBLElBQUEsbUdBQUE7SUFBQTs7QUFRQSxNQUErQyxPQUFBLENBQVEsS0FBUixDQUEvQyxFQUFFLGVBQUYsRUFBUSxpQkFBUixFQUFlLGVBQWYsRUFBcUIsZUFBckIsRUFBMkIsbUJBQTNCLEVBQW1DLGVBQW5DLEVBQXlDOztBQUV6QyxVQUFBLEdBQWEsT0FBQSxDQUFRLGlCQUFSOztBQUNiLFVBQUEsR0FBYSxPQUFBLENBQVEscUJBQVI7O0FBQ2IsTUFBQSxHQUFhLE9BQUEsQ0FBUSxpQkFBUjs7QUFDYixPQUFBLEdBQWEsT0FBQSxDQUFRLFdBQVI7O0FBQ2IsS0FBQSxHQUFhLE9BQUEsQ0FBUSxTQUFSOztBQUVQO0lBRUMsY0FBQTs7OztBQUVDLFlBQUE7UUFBQSxJQUFBLEdBQU0sQ0FBQSxDQUFFLE9BQUY7UUFDTixJQUFDLENBQUEsR0FBRCxHQUFPLElBQUEsQ0FBSztZQUFBLENBQUEsS0FBQSxDQUFBLEVBQU0sTUFBTjtTQUFMO1FBQ1AsSUFBSSxDQUFDLFdBQUwsQ0FBaUIsSUFBQyxDQUFBLEdBQWxCO1FBRUEsSUFBQyxDQUFBLEdBQUQsR0FBUTtRQUNSLElBQUMsQ0FBQSxJQUFELEdBQVE7UUFDUixJQUFDLENBQUEsSUFBRCxHQUFRO1FBQ1IsSUFBQyxDQUFBLElBQUQsR0FDSTtZQUFBLFNBQUEsRUFBWSxDQUFaO1lBQ0EsVUFBQSxFQUFZLENBRFo7O1FBR0osSUFBQyxDQUFBLE1BQUQsR0FBVSxJQUFJLFVBQUosQ0FBZSxJQUFmLEVBQWtCO1lBQUEsUUFBQSxFQUFTLENBQ2pDLFdBRGlDLEVBRWpDLFNBRmlDLEVBR2pDLE1BSGlDLEVBSWpDLFNBSmlDLEVBS2pDLGNBTGlDLEVBTWpDLFVBTmlDLEVBT2pDLFNBUGlDLEVBUWpDLFlBUmlDLENBQVQ7U0FBbEI7UUFXVixJQUFDLENBQUEsTUFBTSxDQUFDLE9BQVIs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RFQ7QUFDdUIsK0JBQU8sSUFBQyxDQUFBLE1BQU0sQ0FBQyxhQUFSLENBQUE7QUFEOUIseUJBRVMsSUFGVDtBQUV1QiwrQkFBTyxJQUFDLENBQUEsT0FBTyxDQUFDLElBQVQsQ0FBQTtBQUY5Qix5QkFHUyxNQUhUO0FBR3VCLCtCQUFPLElBQUMsQ0FBQSxPQUFPLENBQUMsSUFBVCxDQUFBO0FBSDlCLHlCQUlTLFFBSlQ7QUFJdUIsK0JBQU8sSUFBQyxDQUFBLEtBQUssQ0FBQyxZQUFQLENBQUE7QUFKOUIsaUJBREo7YUFaSjs7ZUFtQkE7SUExQk87Ozs7OztBQTRCZixNQUFNLENBQUMsT0FBUCxHQUFpQiIsInNvdXJjZXNDb250ZW50IjpbIiMjI1xuMDAwMDAwMDAwICAwMDAwMDAwMCAgMDAwMDAwMDAgICAwMCAgICAgMDAgIFxuICAgMDAwICAgICAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgIFxuICAgMDAwICAgICAwMDAwMDAwICAgMDAwMDAwMCAgICAwMDAwMDAwMDAgIFxuICAgMDAwICAgICAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgMCAwMDAgIFxuICAgMDAwICAgICAwMDAwMDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgIFxuIyMjXG5cbnsgcG9zdCwgc2xhc2gsIGVsZW0sIGtwb3MsIGtlcnJvciwga2xvZywgJCB9ID0gcmVxdWlyZSAna3hrJ1xuXG5CYXNlRWRpdG9yID0gcmVxdWlyZSAnLi9lZGl0b3IvZWRpdG9yJ1xuVGV4dEVkaXRvciA9IHJlcXVpcmUgJy4vZWRpdG9yL3RleHRlZGl0b3InXG5yZW5kZXIgICAgID0gcmVxdWlyZSAnLi9lZGl0b3IvcmVuZGVyJ1xuSGlzdG9yeSAgICA9IHJlcXVpcmUgJy4vaGlzdG9yeSdcblNoZWxsICAgICAgPSByZXF1aXJlICcuL3NoZWxsJ1xuXG5jbGFzcyBUZXJtXG5cbiAgICBAOiAtPlxuICAgICAgICBcbiAgICAgICAgbWFpbiA9JCAnI21haW4nXG4gICAgICAgIEBkaXYgPSBlbGVtIGNsYXNzOid0ZXJtJyBcbiAgICAgICAgbWFpbi5hcHBlbmRDaGlsZCBAZGl2XG5cbiAgICAgICAgQG51bSAgPSAwICAgXG4gICAgICAgIEByb3dzID0gMFxuICAgICAgICBAY29scyA9IDBcbiAgICAgICAgQHNpemUgPVxuICAgICAgICAgICAgY2hhcldpZHRoOiAgMFxuICAgICAgICAgICAgbGluZUhlaWdodDogMFxuICAgICAgICAgICAgICAgIFxuICAgICAgICBAZWRpdG9yID0gbmV3IFRleHRFZGl0b3IgQCwgZmVhdHVyZXM6W1xuICAgICAgICAgICAgJ1Njcm9sbGJhcidcbiAgICAgICAgICAgICdNaW5pbWFwJ1xuICAgICAgICAgICAgJ01ldGEnXG4gICAgICAgICAgICAnTnVtYmVycydcbiAgICAgICAgICAgICdBdXRvY29tcGxldGUnXG4gICAgICAgICAgICAnQnJhY2tldHMnXG4gICAgICAgICAgICAnU3RyaW5ncydcbiAgICAgICAgICAgICdDdXJzb3JMaW5lJ1xuICAgICAgICBdXG4gICAgICAgICAgICAgICAgXG4gICAgICAgIEBlZGl0b3Iuc2V0VGV4dCAnJ1xuICAgICAgICBcbiAgICAgICAgQHNoZWxsICAgPSBuZXcgU2hlbGwgQFxuICAgICAgICBAaGlzdG9yeSA9IG5ldyBIaXN0b3J5IEBcbiAgICAgICAgQGF1dG9jb21wbGV0ZSA9IEBlZGl0b3IuYXV0b2NvbXBsZXRlXG4gICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgcG9zdC5vbiAnZm9udFNpemUnIEBvbkZvbnRTaXplXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICMgMDAgICAgIDAwICAwMDAwMDAwMCAgMDAwMDAwMDAwICAgMDAwMDAwMCAgIFxuICAgICMgMDAwICAgMDAwICAwMDAgICAgICAgICAgMDAwICAgICAwMDAgICAwMDAgIFxuICAgICMgMDAwMDAwMDAwICAwMDAwMDAwICAgICAgMDAwICAgICAwMDAwMDAwMDAgIFxuICAgICMgMDAwIDAgMDAwICAwMDAgICAgICAgICAgMDAwICAgICAwMDAgICAwMDAgIFxuICAgICMgMDAwICAgMDAwICAwMDAwMDAwMCAgICAgMDAwICAgICAwMDAgICAwMDAgIFxuICAgIFxuICAgIGZhaWxNZXRhOiAobWV0YSkgLT5cblxuICAgICAgICBtZXRhWzJdLm51bWJlciA9IHRleHQ6J+KclicgY2xzczonZmFpbCdcbiAgICAgICAgbWV0YVsyXS5jbHNzID0gJ2ZhaWwnXG4gICAgICAgIEBlZGl0b3IubWluaW1hcC5kcmF3TGluZXMgbWV0YVswXSwgbWV0YVswXVxuICAgICAgICBAZWRpdG9yLm1ldGEudXBkYXRlIG1ldGFcbiAgICAgICAgXG4gICAgc3VjY01ldGE6IChtZXRhKSAtPlxuXG4gICAgICAgIG1ldGFbMl0ubnVtYmVyID0gdGV4dDon4pa2JyBjbHNzOidzdWNjJ1xuICAgICAgICBtZXRhWzJdLmNsc3MgPSAnc3VjYydcbiAgICAgICAgQGVkaXRvci5taW5pbWFwLmRyYXdMaW5lcyBtZXRhWzBdLCBtZXRhWzBdXG4gICAgICAgIEBlZGl0b3IubWV0YS51cGRhdGUgbWV0YVxuICAgICAgICBcbiAgICBpbnNlcnRDbWRNZXRhOiAobGksIGNtZCkgLT5cbiAgICAgICAgXG4gICAgICAgIEBlZGl0b3IubWV0YS5hZGQgXG4gICAgICAgICAgICBsaW5lOiBsaVxuICAgICAgICAgICAgY2xzczogJ2NtZCdcbiAgICAgICAgICAgIG51bWJlcjogXG4gICAgICAgICAgICAgICAgdGV4dDogJ+KWtidcbiAgICAgICAgICAgICAgICBjbHNzOiAnY21kJ1xuICAgICAgICAgICAgZW5kOiBjbWQubGVuZ3RoKzFcbiAgICAgICAgICAgIGNsaWNrOiAobWV0YSwgZXZlbnQpID0+XG4gICAgICAgICAgICAgICAgQGVkaXRvci5zaW5nbGVDdXJzb3JBdEVuZCgpXG4gICAgICAgICAgICAgICAgQGVkaXRvci5zZXRJbnB1dFRleHQgQGVkaXRvci5saW5lIG1ldGFbMF1cbiAgICAgICAgICAgICAgICBAc2hlbGwuZXhlY3V0ZSBjbWQ6QGVkaXRvci5saW5lIG1ldGFbMF1cbiAgICBcbiAgICBtb3ZlSW5wdXRNZXRhOiAtPlxuICAgICAgICBcbiAgICAgICAgaWYgQGVkaXRvci5udW1MaW5lcygpLTEgPiBAaW5wdXRNZXRhWzBdXG4gICAgICAgICAgICBAZWRpdG9yLm1ldGEubW92ZUxpbmVNZXRhIEBpbnB1dE1ldGEsIEBlZGl0b3IubnVtTGluZXMoKS0xLUBpbnB1dE1ldGFbMF1cbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgaWYgQGlucHV0TWV0YVswXSAhPSBAZWRpdG9yLm51bUxpbmVzKCktMVxuICAgICAgICAgICAgICAgIGtlcnJvciAnaW5wdXQgbWV0YSBub3QgYXQgZW5kPycgQGlucHV0TWV0YVswXSwgQGVkaXRvci5udW1MaW5lcygpLTFcblxuICAgICMgb3V0cHV0OiAocykgLT5cbiAgICAgICAgIyBmb3IgbCBpbiBzLnNwbGl0ICdcXG4nXG4gICAgICAgICAgICAjIHQgPSBsLnRyaW0oKVxuICAgICAgICAgICAgIyBpZiAva29fdGVybV9kb25lLy50ZXN0IHRcbiAgICAgICAgICAgICAgICAjIGlmIC9ea29fdGVybV9kb25lXFxzXFxkKyQvLnRlc3QgdFxuICAgICAgICAgICAgICAgICAgICAjIGNpZCA9IHBhcnNlSW50IF8ubGFzdCB0LnNwbGl0ICcgJ1xuICAgICAgICAgICAgICAgICAgICAjIGZvciBtZXRhIGluIHJldmVyc2VkIEBtZXRhLm1ldGFzXG4gICAgICAgICAgICAgICAgICAgICAgICAjIGlmIG1ldGFbMl0uY21kSUQgPT0gY2lkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBtZXRhWzJdLnNwYW4/LmlubmVySFRNTCA9IFwi4pagXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIGJyZWFrXG4gICAgICAgICAgICAgICAgIyBjb250aW51ZVxuICAgICAgICAgICAgIyBza2lwID0gZmFsc2VcbiAgICAgICAgICAgICMgZm9yIG1ldGEgaW4gcmV2ZXJzZWQgQG1ldGEubWV0YXNcbiAgICAgICAgICAgICAgICAjIGlmIG1ldGFbMl0uY29tbWFuZCA9PSB0IFxuICAgICAgICAgICAgICAgICAgICAjIGlmIHQgIT0gJ3B3ZCdcbiAgICAgICAgICAgICAgICAgICAgICAgICMgc3Bpbm5pbmdDb2cgPSAnPGkgY2xhc3M9XCJmYSBmYS1jb2cgZmEtc3BpbiBmYS0xeCBmYS1md1wiPjwvaT4nXG4gICAgICAgICAgICAgICAgICAgICAgICAjIG1ldGFbMl0uc3Bhbj8uaW5uZXJIVE1MID0gc3Bpbm5pbmdDb2dcbiAgICAgICAgICAgICAgICAgICAgICAgICMgc3RvcFNwaW4gPSAtPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgaWYgbWV0YVsyXS5zcGFuPy5pbm5lckhUTUwgPT0gc3Bpbm5pbmdDb2dcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBtZXRhWzJdLnNwYW4/LmlubmVySFRNTCA9ICc8aSBjbGFzcz1cImZhIGZhLWNvZyBmYS0xeCBmYS1md1wiPjwvaT4nXG4gICAgICAgICAgICAgICAgICAgICAgICAjIHNldFRpbWVvdXQgc3RvcFNwaW4sIDMwMDBcbiAgICAgICAgICAgICAgICAgICAgIyBza2lwID0gdHJ1ZVxuICAgICAgICAgICAgICAgICAgICAjIGJyZWFrXG4gICAgICAgICAgICAjIGNvbnRpbnVlIGlmIHNraXBcbiAgICAgICAgICAgICMgW3RleHQsZGlzc10gPSBAYW5zaWRpc3MuZGlzc2VjdCBsXG4gICAgICAgICAgICAjIEBzeW50YXguc2V0RGlzcyBAbnVtTGluZXMoKSwgZGlzcyBpZiBkaXNzPy5sZW5ndGhcbiAgICAgICAgICAgICMgQGFwcGVuZFRleHQgdGV4dFxuICAgICAgICAgICAgICAgIFxuICAgICMgIDAwMDAwMDAgIDAwMCAgICAgIDAwMDAwMDAwICAgMDAwMDAwMCAgIDAwMDAwMDAwICAgXG4gICAgIyAwMDAgICAgICAgMDAwICAgICAgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICBcbiAgICAjIDAwMCAgICAgICAwMDAgICAgICAwMDAwMDAwICAgMDAwMDAwMDAwICAwMDAwMDAwICAgIFxuICAgICMgMDAwICAgICAgIDAwMCAgICAgIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgXG4gICAgIyAgMDAwMDAwMCAgMDAwMDAwMCAgMDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICBcbiAgICBcbiAgICBjbGVhcjogLT4gXG4gICAgXG4gICAgICAgIGRlbGV0ZSBAc2hlbGwubGFzdD8ubWV0YVxuICAgICAgICBAZWRpdG9yLmNsZWFyKClcbiAgICAgICAgQGlucHV0TWV0YSA9IEBlZGl0b3IubWV0YS5hZGRcbiAgICAgICAgICAgIGxpbmU6IDBcbiAgICAgICAgICAgIGNsc3M6ICdpbnB1dCdcbiAgICAgICAgICAgIG51bWJlcjogdGV4dDogJ+KWtidcbiAgICAgICAgICAgIGNsaWNrOiAobWV0YSwgZXZlbnQpID0+XG4gICAgICAgICAgICAgICAgcG9zID0ga3BvcyBldmVudFxuICAgICAgICAgICAgICAgIGlmIHBvcy54IDwgNDBcbiAgICAgICAgICAgICAgICAgICAga2xvZyAnaW5wdXQgbnVtYmVyJ1xuICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAga2xvZyAnaW5wdXQgdGV4dD8nXG4gICAgICAgIHRydWVcbiAgICAgICAgICAgICAgICBcbiAgICAjIDAwMDAwMDAwICAgMDAwMDAwMCAgIDAwMCAgIDAwMCAgMDAwMDAwMDAwICAgICAgIDAwMDAwMDAgIDAwMCAgMDAwMDAwMCAgMDAwMDAwMDAgIFxuICAgICMgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwMCAgMDAwICAgICAwMDAgICAgICAgICAwMDAgICAgICAgMDAwICAgICAwMDAgICAwMDAgICAgICAgXG4gICAgIyAwMDAwMDAgICAgMDAwICAgMDAwICAwMDAgMCAwMDAgICAgIDAwMCAgICAgICAgIDAwMDAwMDAgICAwMDAgICAgMDAwICAgIDAwMDAwMDAgICBcbiAgICAjIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgMDAwMCAgICAgMDAwICAgICAgICAgICAgICAwMDAgIDAwMCAgIDAwMCAgICAgMDAwICAgICAgIFxuICAgICMgMDAwICAgICAgICAwMDAwMDAwICAgMDAwICAgMDAwICAgICAwMDAgICAgICAgICAwMDAwMDAwICAgMDAwICAwMDAwMDAwICAwMDAwMDAwMCAgXG5cbiAgICBvbkZvbnRTaXplOiAoc2l6ZSkgPT5cbiAgICAgICAgXG4gICAgICAgIEBlZGl0b3Iuc2V0Rm9udFNpemUgc2l6ZVxuICAgICAgICBAZWRpdG9yLnNpbmdsZUN1cnNvckF0RW5kKClcbiAgICAgICAgXG4gICAgcmVzaXplZDogPT4gQGVkaXRvci5yZXNpemVkKClcbiAgICBcbiAgICBzY3JvbGxCeTogKGRlbHRhKSA9PlxuICAgICAgICBcbiAgICAgICAgaWYgQGF1dG9jb21wbGV0ZS5saXN0XG4gICAgICAgICAgICBAYXV0b2NvbXBsZXRlLmNsb3NlKClcbiAgICAgICAgQGVkaXRvci5zY3JvbGwuYnkgZGVsdGFcbiAgICAgICAgaWYgbm90ICgwIDwgQGVkaXRvci5zY3JvbGwuc2Nyb2xsIDwgQGVkaXRvci5zY3JvbGwuc2Nyb2xsTWF4LTEpXG4gICAgICAgICAgICBwb3N0LmVtaXQgJ3N0b3BXaGVlbCdcbiAgICBcbiAgICAjIDAwMDAwMDAwICAgMDAwICAgMDAwICAwMDAwMDAwICAgIFxuICAgICMgMDAwICAgMDAwICAwMDAgMCAwMDAgIDAwMCAgIDAwMCAgXG4gICAgIyAwMDAwMDAwMCAgIDAwMDAwMDAwMCAgMDAwICAgMDAwICBcbiAgICAjIDAwMCAgICAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgIFxuICAgICMgMDAwICAgICAgICAwMCAgICAgMDAgIDAwMDAwMDAgICAgXG4gICAgXG4gICAgcHdkOiAtPlxuICAgICAgICBcbiAgICAgICAgZGlyID0gc2xhc2gudGlsZGUgcHJvY2Vzcy5jd2QoKVxuICAgICAgICAgICAgICAgIFxuICAgICAgICBAZWRpdG9yLmFwcGVuZE91dHB1dCBkaXJcbiAgICAgICAgQGVkaXRvci5tZXRhLmFkZFxuICAgICAgICAgICAgbGluZTogTWF0aC5tYXggMCwgQGVkaXRvci5udW1MaW5lcygpLTJcbiAgICAgICAgICAgIGNsc3M6ICdwd2QnXG4gICAgICAgICAgICBudW1iZXI6IFxuICAgICAgICAgICAgICAgIHRleHQ6ICcgJ1xuICAgICAgICAgICAgICAgIGNsc3M6ICdwd2QnXG4gICAgICAgICAgICBlbmQ6IGRpci5sZW5ndGgrMVxuICAgICAgICAgICAgY2xpY2s6IChtZXRhLCBldmVudCkgPT5cbiAgICAgICAgICAgICAgICBwb3MgPSBrcG9zIGV2ZW50XG4gICAgICAgICAgICAgICAgaWYgcG9zLnggPCA0MFxuICAgICAgICAgICAgICAgICAgICBpbmRleCA9IEBlZGl0b3IubWV0YS5tZXRhcy5pbmRleE9mIG1ldGFcbiAgICAgICAgICAgICAgICAgICAgaWYgaW5kZXggPCBAZWRpdG9yLm1ldGEubWV0YXMubGVuZ3RoLTFcbiAgICAgICAgICAgICAgICAgICAgICAgIEBlZGl0b3Iuc2luZ2xlQ3Vyc29yQXRQb3MgWzAsbWV0YVswXV1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5leHQgPSBAZWRpdG9yLm1ldGEubmV4dE1ldGFPZlNhbWVDbGFzcyBtZXRhXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGkgaW4gW21ldGFbMF0uLi5uZXh0WzBdXVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBAZWRpdG9yLmRlbGV0ZVNlbGVjdGlvbk9yQ3Vyc29yTGluZXMoKVxuICAgICAgICAgICAgICAgICAgICAgICAgQGVkaXRvci5tb3ZlQ3Vyc29yc0Rvd24oKVxuICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgQGVkaXRvci5zaW5nbGVDdXJzb3JBdEVuZCgpXG4gICAgICAgICAgICAgICAgICAgIEBzaGVsbC5jZCBAZWRpdG9yLmxpbmUgbWV0YVswXVxuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgdHJ1ZVxuICAgICAgICAgICAgICAgXG4gICAgIyAwMDAwMDAwMCAgMDAwICAgMDAwICAwMDAwMDAwMDAgIDAwMDAwMDAwICAwMDAwMDAwMCAgIFxuICAgICMgMDAwICAgICAgIDAwMDAgIDAwMCAgICAgMDAwICAgICAwMDAgICAgICAgMDAwICAgMDAwICBcbiAgICAjIDAwMDAwMDAgICAwMDAgMCAwMDAgICAgIDAwMCAgICAgMDAwMDAwMCAgIDAwMDAwMDAgICAgXG4gICAgIyAwMDAgICAgICAgMDAwICAwMDAwICAgICAwMDAgICAgIDAwMCAgICAgICAwMDAgICAwMDAgIFxuICAgICMgMDAwMDAwMDAgIDAwMCAgIDAwMCAgICAgMDAwICAgICAwMDAwMDAwMCAgMDAwICAgMDAwICBcbiAgICBcbiAgICBvbkVudGVyOiAtPlxuICAgICAgICBcbiAgICAgICAgaWYgQGVkaXRvci5pc0lucHV0Q3Vyc29yKClcbiAgICAgICAgICAgIGlmIEBzaGVsbC5jaGlsZCBhbmQgQHNoZWxsLmxhc3QuY21kID09ICdrb2ZmZWUnXG4gICAgICAgICAgICAgICAgQHNoZWxsLmNoaWxkLnN0ZGluLndyaXRlICdcXG4nXG4gICAgICAgICAgICAgICAgQGVkaXRvci5zZXRJbnB1dFRleHQgJydcbiAgICAgICAgICAgICAgICByZXR1cm5cbiAgICAgICAgICAgIGlmIEBhdXRvY29tcGxldGUuaXNMaXN0SXRlbVNlbGVjdGVkKClcbiAgICAgICAgICAgICAgICBAYXV0b2NvbXBsZXRlLmNvbXBsZXRlIHt9XG4gICAgICAgICAgICBlbHNlIGlmIEBhdXRvY29tcGxldGUuc2VsZWN0ZWRDb21wbGV0aW9uKClcbiAgICAgICAgICAgICAgICByZXR1cm4gQHNoZWxsLmV4ZWN1dGUgZmFsbGJhY2s6QGVkaXRvci5sYXN0TGluZSgpICsgQGF1dG9jb21wbGV0ZS5zZWxlY3RlZENvbXBsZXRpb24oKVxuICAgICAgICAgICAgQHNoZWxsLmV4ZWN1dGUge31cbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgQGVkaXRvci5zaW5nbGVDdXJzb3JBdEVuZCgpXG4gICAgICAgIFxuICAgICMgMDAwICAgMDAwICAwMDAwMDAwMCAgMDAwICAgMDAwICBcbiAgICAjIDAwMCAgMDAwICAgMDAwICAgICAgICAwMDAgMDAwICAgXG4gICAgIyAwMDAwMDAwICAgIDAwMDAwMDAgICAgIDAwMDAwICAgIFxuICAgICMgMDAwICAwMDAgICAwMDAgICAgICAgICAgMDAwICAgICBcbiAgICAjIDAwMCAgIDAwMCAgMDAwMDAwMDAgICAgIDAwMCAgICAgXG4gICAgXG4gICAgaGFuZGxlS2V5OiAobW9kLCBrZXksIGNvbWJvLCBjaGFyLCBldmVudCkgLT4gICAgICAgIFxuICAgICAgICBcbiAgICAgICAgIyBrbG9nICd0ZXJtLmhhbmRsZUtleScgbW9kLCBrZXksIGNvbWJvXG4gICAgICAgICAgICAgICAgXG4gICAgICAgIHN3aXRjaCBjb21ib1xuICAgICAgICAgICAgd2hlbiAnZW50ZXInIHRoZW4gcmV0dXJuIEBvbkVudGVyKClcbiAgICAgICAgXG4gICAgICAgIGlmIEBzaGVsbC5jaGlsZCBhbmQgQHNoZWxsLmxhc3QuY21kID09ICdrb2ZmZWUnXG4gICAgICAgICAgICBpZiBjaGFyXG4gICAgICAgICAgICAgICAgc3dpdGNoIGtleVxuICAgICAgICAgICAgICAgICAgICB3aGVuICdiYWNrc3BhY2UnXG4gICAgICAgICAgICAgICAgICAgICAgICBAc2hlbGwuY2hpbGQuc3RkaW4ud3JpdGUgJ1xceDA4J1xuICAgICAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgICAgICBAc2hlbGwuY2hpbGQuc3RkaW4ud3JpdGUgY2hhclxuICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgIGtsb2cgJ3BpcGUga2V5JyBrZXksIGNvbWJvXG4gICAgICAgIGVsc2UgICAgICAgICAgICBcbiAgICAgICAgICAgIHJldHVybiBpZiAndW5oYW5kbGVkJyAhPSBAYXV0b2NvbXBsZXRlLmhhbmRsZU1vZEtleUNvbWJvRXZlbnQgbW9kLCBrZXksIGNvbWJvLCBldmVudFxuICAgICAgICAgICAgXG4gICAgICAgICAgICBpZiBAZWRpdG9yLmlzSW5wdXRDdXJzb3IoKVxuICAgICAgICAgICAgICAgIHN3aXRjaCBjb21ib1xuICAgICAgICAgICAgICAgICAgICB3aGVuICdhbHQrdXAnIHRoZW4gcmV0dXJuIEBlZGl0b3IubW92ZUN1cnNvcnNVcCgpXG4gICAgICAgICAgICAgICAgICAgIHdoZW4gJ3VwJyAgICAgdGhlbiByZXR1cm4gQGhpc3RvcnkucHJldigpXG4gICAgICAgICAgICAgICAgICAgIHdoZW4gJ2Rvd24nICAgdGhlbiByZXR1cm4gQGhpc3RvcnkubmV4dCgpXG4gICAgICAgICAgICAgICAgICAgIHdoZW4gJ2N0cmwrYycgdGhlbiByZXR1cm4gQHNoZWxsLmhhbmRsZUNhbmNlbCgpXG4gICAgICAgIFxuICAgICAgICAndW5oYW5kbGVkJ1xuICAgICAgICBcbm1vZHVsZS5leHBvcnRzID0gVGVybVxuIl19
//# sourceURL=../coffee/term.coffee