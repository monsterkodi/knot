// koffee 1.4.0

/*
000000000  00000000  00000000   00     00  
   000     000       000   000  000   000  
   000     0000000   0000000    000000000  
   000     000       000   000  000 0 000  
   000     00000000  000   000  000   000
 */
var $, BaseEditor, History, Shell, Term, TextEditor, elem, kerror, klog, kpos, post, ref, render, slash,
    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

ref = require('kxk'), post = ref.post, kerror = ref.kerror, slash = ref.slash, elem = ref.elem, klog = ref.klog, kpos = ref.kpos, $ = ref.$;

BaseEditor = require('./editor/editor');

TextEditor = require('./editor/texteditor');

render = require('./editor/render');

History = require('./history');

Shell = require('./shell');

Term = (function() {
    function Term() {
        this.scrollBy = bind(this.scrollBy, this);
        this.resized = bind(this.resized, this);
        this.onFontSize = bind(this.onFontSize, this);
        var main;
        main = $('#main');
        this.div = elem({
            "class": 'term'
        });
        main.appendChild(this.div);
        this.num = 0;
        this.rows = 0;
        this.cols = 0;
        this.size = {
            charWidth: 0,
            lineHeight: 0
        };
        this.editor = new TextEditor(this, {
            features: ['Scrollbar', 'Minimap', 'Meta', 'Numbers', 'Autocomplete', 'Brackets', 'Strings', 'CursorLine']
        });
        this.editor.setText('');
        this.shell = new Shell(this);
        this.history = new History(this);
        this.autocomplete = this.editor.autocomplete;
        post.on('fontSize', this.onFontSize);
    }

    Term.prototype.failMeta = function(meta) {
        klog('fail', this.editor.line(meta[0]));
        meta[2].number = {
            text: '✖',
            clss: 'fail'
        };
        meta[2].clss = 'fail';
        this.editor.minimap.drawLines(meta[0], meta[0]);
        return this.editor.meta.update(meta);
    };

    Term.prototype.succMeta = function(meta) {
        meta[2].number = {
            text: '▶',
            clss: 'succ'
        };
        meta[2].clss = 'succ';
        this.editor.minimap.drawLines(meta[0], meta[0]);
        return this.editor.meta.update(meta);
    };

    Term.prototype.insertCmdMeta = function(li, cmd) {
        return this.editor.meta.add({
            line: li,
            clss: 'cmd',
            number: {
                text: '▶',
                clss: 'cmd'
            },
            end: cmd.length + 1,
            click: (function(_this) {
                return function(meta, event) {
                    _this.editor.singleCursorAtEnd();
                    _this.editor.setInputText(_this.editor.line(meta[0]));
                    return _this.shell.execute({
                        cmd: _this.editor.line(meta[0])
                    });
                };
            })(this)
        });
    };

    Term.prototype.moveInputMeta = function() {
        if (this.editor.numLines() - 1 > this.inputMeta[0]) {
            return this.editor.meta.moveLineMeta(this.inputMeta, this.editor.numLines() - 1 - this.inputMeta[0]);
        } else {
            if (this.inputMeta[0] !== this.editor.numLines() - 1) {
                return kerror('input meta not at end?', this.inputMeta[0], this.editor.numLines() - 1);
            }
        }
    };

    Term.prototype.clear = function() {
        var ref1;
        if ((ref1 = this.shell.last) != null) {
            delete ref1.meta;
        }
        this.editor.clear();
        this.inputMeta = this.editor.meta.add({
            line: 0,
            clss: 'input',
            number: {
                text: '▶'
            },
            click: (function(_this) {
                return function(meta, event) {
                    var pos;
                    pos = kpos(event);
                    if (pos.x < 40) {
                        return klog('input number');
                    } else {
                        return klog('input text?');
                    }
                };
            })(this)
        });
        return true;
    };

    Term.prototype.onFontSize = function(size) {
        this.editor.setFontSize(size);
        return this.editor.singleCursorAtEnd();
    };

    Term.prototype.resized = function() {
        return this.editor.resized();
    };

    Term.prototype.scrollBy = function(delta) {
        var ref1;
        if (this.autocomplete.list) {
            this.autocomplete.close();
        }
        this.editor.scroll.by(delta);
        if (!((0 < (ref1 = this.editor.scroll.scroll) && ref1 < this.editor.scroll.scrollMax - 1))) {
            return post.emit('stopWheel');
        }
    };

    Term.prototype.pwd = function() {
        var dir;
        dir = slash.tilde(process.cwd());
        this.editor.appendOutput(dir);
        this.editor.meta.add({
            line: Math.max(0, this.editor.numLines() - 2),
            clss: 'pwd',
            number: {
                text: ' ',
                clss: 'pwd'
            },
            end: dir.length + 1,
            click: (function(_this) {
                return function(meta, event) {
                    var i, index, j, next, pos, ref1, ref2;
                    pos = kpos(event);
                    if (pos.x < 40) {
                        index = _this.editor.meta.metas.indexOf(meta);
                        if (index < _this.editor.meta.metas.length - 1) {
                            _this.editor.singleCursorAtPos([0, meta[0]]);
                            if (next = _this.editor.meta.nextMetaOfSameClass(meta)) {
                                for (i = j = ref1 = meta[0], ref2 = next[0]; ref1 <= ref2 ? j < ref2 : j > ref2; i = ref1 <= ref2 ? ++j : --j) {
                                    _this.editor.deleteSelectionOrCursorLines();
                                }
                            }
                            return _this.editor.moveCursorsDown();
                        }
                    } else {
                        _this.editor.singleCursorAtEnd();
                        return _this.shell.cd(_this.editor.line(meta[0]));
                    }
                };
            })(this)
        });
        return true;
    };

    Term.prototype.onEnter = function() {
        if (this.editor.isInputCursor()) {
            if (this.shell.child && this.shell.last.cmd === 'koffee') {
                this.shell.child.stdin.write('\n');
                this.editor.setInputText('');
                return;
            }
            if (this.autocomplete.isListItemSelected()) {
                this.autocomplete.complete({});
            } else if (this.autocomplete.selectedCompletion()) {
                return this.shell.execute({
                    fallback: this.editor.lastLine() + this.autocomplete.selectedCompletion()
                });
            }
            return this.shell.execute({});
        } else {
            return this.editor.singleCursorAtEnd();
        }
    };

    Term.prototype.handleKey = function(mod, key, combo, char, event) {
        switch (combo) {
            case 'enter':
                return this.onEnter();
        }
        if (this.shell.child && this.shell.last.cmd === 'koffee') {
            if (char) {
                switch (key) {
                    case 'backspace':
                        this.shell.child.stdin.write('\x08');
                        break;
                    default:
                        this.shell.child.stdin.write(char);
                }
            } else {
                klog('pipe key', key, combo);
            }
        } else {
            if ('unhandled' !== this.autocomplete.handleModKeyComboEvent(mod, key, combo, event)) {
                return;
            }
            if (this.editor.isInputCursor()) {
                switch (combo) {
                    case 'alt+up':
                        return this.editor.moveCursorsUp();
                    case 'up':
                        return this.history.prev();
                    case 'down':
                        return this.history.next();
                    case 'ctrl+c':
                        return this.shell.handleCancel();
                }
            }
        }
        return 'unhandled';
    };

    return Term;

})();

module.exports = Term;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGVybS5qcyIsInNvdXJjZVJvb3QiOiIuIiwic291cmNlcyI6WyIiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQTs7Ozs7OztBQUFBLElBQUEsbUdBQUE7SUFBQTs7QUFRQSxNQUErQyxPQUFBLENBQVEsS0FBUixDQUEvQyxFQUFFLGVBQUYsRUFBUSxtQkFBUixFQUFnQixpQkFBaEIsRUFBdUIsZUFBdkIsRUFBNkIsZUFBN0IsRUFBbUMsZUFBbkMsRUFBeUM7O0FBRXpDLFVBQUEsR0FBYSxPQUFBLENBQVEsaUJBQVI7O0FBQ2IsVUFBQSxHQUFhLE9BQUEsQ0FBUSxxQkFBUjs7QUFDYixNQUFBLEdBQWEsT0FBQSxDQUFRLGlCQUFSOztBQUNiLE9BQUEsR0FBYSxPQUFBLENBQVEsV0FBUjs7QUFDYixLQUFBLEdBQWEsT0FBQSxDQUFRLFNBQVI7O0FBRVA7SUFFQyxjQUFBOzs7O0FBRUMsWUFBQTtRQUFBLElBQUEsR0FBTSxDQUFBLENBQUUsT0FBRjtRQUNOLElBQUMsQ0FBQSxHQUFELEdBQU8sSUFBQSxDQUFLO1lBQUEsQ0FBQSxLQUFBLENBQUEsRUFBTSxNQUFOO1NBQUw7UUFDUCxJQUFJLENBQUMsV0FBTCxDQUFpQixJQUFDLENBQUEsR0FBbEI7UUFFQSxJQUFDLENBQUEsR0FBRCxHQUFRO1FBQ1IsSUFBQyxDQUFBLElBQUQsR0FBUTtRQUNSLElBQUMsQ0FBQSxJQUFELEdBQVE7UUFDUixJQUFDLENBQUEsSUFBRCxHQUNJO1lBQUEsU0FBQSxFQUFZLENBQVo7WUFDQSxVQUFBLEVBQVksQ0FEWjs7UUFHSixJQUFDLENBQUEsTUFBRCxHQUFVLElBQUksVUFBSixDQUFlLElBQWYsRUFBa0I7WUFBQSxRQUFBLEVBQVMsQ0FDakMsV0FEaUMsRUFFakMsU0FGaUMsRUFHakMsTUFIaUMsRUFJakMsU0FKaUMsRUFLakMsY0FMaUMsRUFNakMsVUFOaUMsRUFPakMsU0FQaUMsRUFRakMsWUFSaUMsQ0FBVDtTQUFsQjtRQVdWLElBQUMsQ0FBQSxNQUFNLENBQUMsT0FB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QSx1QkFBQTs7WUFFQSxJQUFHLElBQUMsQ0FBQSxNQUFNLENBQUMsYUFBUixDQUFBLENBQUg7QUFDSSx3QkFBTyxLQUFQO0FBQUEseUJBQ1MsUUFEVDtBQUN1QiwrQkFBTyxJQUFDLENBQUEsTUFBTSxDQUFDLGFBQVIsQ0FBQTtBQUQ5Qix5QkFFUyxJQUZUO0FBRXVCLCtCQUFPLElBQUMsQ0FBQSxPQUFPLENBQUMsSUFBVCxDQUFBO0FBRjlCLHlCQUdTLE1BSFQ7QUFHdUIsK0JBQU8sSUFBQyxDQUFBLE9BQU8sQ0FBQyxJQUFULENBQUE7QUFIOUIseUJBSVMsUUFKVDtBQUl1QiwrQkFBTyxJQUFDLENBQUEsS0FBSyxDQUFDLFlBQVAsQ0FBQTtBQUo5QixpQkFESjthQVpKOztlQW1CQTtJQTFCTzs7Ozs7O0FBNEJmLE1BQU0sQ0FBQyxPQUFQLEdBQWlCIiwic291cmNlc0NvbnRlbnQiOlsiIyMjXG4wMDAwMDAwMDAgIDAwMDAwMDAwICAwMDAwMDAwMCAgIDAwICAgICAwMCAgXG4gICAwMDAgICAgIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgXG4gICAwMDAgICAgIDAwMDAwMDAgICAwMDAwMDAwICAgIDAwMDAwMDAwMCAgXG4gICAwMDAgICAgIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAwIDAwMCAgXG4gICAwMDAgICAgIDAwMDAwMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgXG4jIyNcblxueyBwb3N0LCBrZXJyb3IsIHNsYXNoLCBlbGVtLCBrbG9nLCBrcG9zLCAkIH0gPSByZXF1aXJlICdreGsnXG5cbkJhc2VFZGl0b3IgPSByZXF1aXJlICcuL2VkaXRvci9lZGl0b3InXG5UZXh0RWRpdG9yID0gcmVxdWlyZSAnLi9lZGl0b3IvdGV4dGVkaXRvcidcbnJlbmRlciAgICAgPSByZXF1aXJlICcuL2VkaXRvci9yZW5kZXInXG5IaXN0b3J5ICAgID0gcmVxdWlyZSAnLi9oaXN0b3J5J1xuU2hlbGwgICAgICA9IHJlcXVpcmUgJy4vc2hlbGwnXG5cbmNsYXNzIFRlcm1cblxuICAgIEA6IC0+XG4gICAgICAgIFxuICAgICAgICBtYWluID0kICcjbWFpbidcbiAgICAgICAgQGRpdiA9IGVsZW0gY2xhc3M6J3Rlcm0nIFxuICAgICAgICBtYWluLmFwcGVuZENoaWxkIEBkaXZcblxuICAgICAgICBAbnVtICA9IDAgICBcbiAgICAgICAgQHJvd3MgPSAwXG4gICAgICAgIEBjb2xzID0gMFxuICAgICAgICBAc2l6ZSA9XG4gICAgICAgICAgICBjaGFyV2lkdGg6ICAwXG4gICAgICAgICAgICBsaW5lSGVpZ2h0OiAwXG4gICAgICAgICAgICAgICAgXG4gICAgICAgIEBlZGl0b3IgPSBuZXcgVGV4dEVkaXRvciBALCBmZWF0dXJlczpbXG4gICAgICAgICAgICAnU2Nyb2xsYmFyJ1xuICAgICAgICAgICAgJ01pbmltYXAnXG4gICAgICAgICAgICAnTWV0YSdcbiAgICAgICAgICAgICdOdW1iZXJzJ1xuICAgICAgICAgICAgJ0F1dG9jb21wbGV0ZSdcbiAgICAgICAgICAgICdCcmFja2V0cydcbiAgICAgICAgICAgICdTdHJpbmdzJ1xuICAgICAgICAgICAgJ0N1cnNvckxpbmUnXG4gICAgICAgIF1cbiAgICAgICAgICAgICAgICBcbiAgICAgICAgQGVkaXRvci5zZXRUZXh0ICcnXG4gICAgICAgIFxuICAgICAgICBAc2hlbGwgICA9IG5ldyBTaGVsbCBAXG4gICAgICAgIEBoaXN0b3J5ID0gbmV3IEhpc3RvcnkgQFxuICAgICAgICBAYXV0b2NvbXBsZXRlID0gQGVkaXRvci5hdXRvY29tcGxldGVcbiAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICBwb3N0Lm9uICdmb250U2l6ZScgQG9uRm9udFNpemVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgIyAwMCAgICAgMDAgIDAwMDAwMDAwICAwMDAwMDAwMDAgICAwMDAwMDAwICAgXG4gICAgIyAwMDAgICAwMDAgIDAwMCAgICAgICAgICAwMDAgICAgIDAwMCAgIDAwMCAgXG4gICAgIyAwMDAwMDAwMDAgIDAwMDAwMDAgICAgICAwMDAgICAgIDAwMDAwMDAwMCAgXG4gICAgIyAwMDAgMCAwMDAgIDAwMCAgICAgICAgICAwMDAgICAgIDAwMCAgIDAwMCAgXG4gICAgIyAwMDAgICAwMDAgIDAwMDAwMDAwICAgICAwMDAgICAgIDAwMCAgIDAwMCAgXG4gICAgXG4gICAgZmFpbE1ldGE6IChtZXRhKSAtPlxuXG4gICAgICAgIGtsb2cgJ2ZhaWwnIEBlZGl0b3IubGluZSBtZXRhWzBdXG4gICAgICAgIG1ldGFbMl0ubnVtYmVyID0gdGV4dDon4pyWJyBjbHNzOidmYWlsJ1xuICAgICAgICBtZXRhWzJdLmNsc3MgPSAnZmFpbCdcbiAgICAgICAgQGVkaXRvci5taW5pbWFwLmRyYXdMaW5lcyBtZXRhWzBdLCBtZXRhWzBdXG4gICAgICAgIEBlZGl0b3IubWV0YS51cGRhdGUgbWV0YVxuICAgICAgICBcbiAgICBzdWNjTWV0YTogKG1ldGEpIC0+XG5cbiAgICAgICAgIyBrbG9nICdzdWNjJyBAZWRpdG9yLmxpbmUgbWV0YVswXVxuICAgICAgICBtZXRhWzJdLm51bWJlciA9IHRleHQ6J+KWticgY2xzczonc3VjYydcbiAgICAgICAgbWV0YVsyXS5jbHNzID0gJ3N1Y2MnXG4gICAgICAgIEBlZGl0b3IubWluaW1hcC5kcmF3TGluZXMgbWV0YVswXSwgbWV0YVswXVxuICAgICAgICBAZWRpdG9yLm1ldGEudXBkYXRlIG1ldGFcbiAgICAgICAgXG4gICAgaW5zZXJ0Q21kTWV0YTogKGxpLCBjbWQpIC0+XG4gICAgICAgIFxuICAgICAgICBAZWRpdG9yLm1ldGEuYWRkIFxuICAgICAgICAgICAgbGluZTogbGlcbiAgICAgICAgICAgIGNsc3M6ICdjbWQnXG4gICAgICAgICAgICBudW1iZXI6IFxuICAgICAgICAgICAgICAgIHRleHQ6ICfilrYnXG4gICAgICAgICAgICAgICAgY2xzczogJ2NtZCdcbiAgICAgICAgICAgIGVuZDogY21kLmxlbmd0aCsxXG4gICAgICAgICAgICBjbGljazogKG1ldGEsIGV2ZW50KSA9PlxuICAgICAgICAgICAgICAgIEBlZGl0b3Iuc2luZ2xlQ3Vyc29yQXRFbmQoKVxuICAgICAgICAgICAgICAgIEBlZGl0b3Iuc2V0SW5wdXRUZXh0IEBlZGl0b3IubGluZSBtZXRhWzBdXG4gICAgICAgICAgICAgICAgQHNoZWxsLmV4ZWN1dGUgY21kOkBlZGl0b3IubGluZSBtZXRhWzBdXG4gICAgXG4gICAgbW92ZUlucHV0TWV0YTogLT5cbiAgICAgICAgXG4gICAgICAgIGlmIEBlZGl0b3IubnVtTGluZXMoKS0xID4gQGlucHV0TWV0YVswXVxuICAgICAgICAgICAgQGVkaXRvci5tZXRhLm1vdmVMaW5lTWV0YSBAaW5wdXRNZXRhLCBAZWRpdG9yLm51bUxpbmVzKCktMS1AaW5wdXRNZXRhWzBdXG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIGlmIEBpbnB1dE1ldGFbMF0gIT0gQGVkaXRvci5udW1MaW5lcygpLTFcbiAgICAgICAgICAgICAgICBrZXJyb3IgJ2lucHV0IG1ldGEgbm90IGF0IGVuZD8nIEBpbnB1dE1ldGFbMF0sIEBlZGl0b3IubnVtTGluZXMoKS0xXG5cbiAgICAjIG91dHB1dDogKHMpIC0+XG4gICAgICAgICMgZm9yIGwgaW4gcy5zcGxpdCAnXFxuJ1xuICAgICAgICAgICAgIyB0ID0gbC50cmltKClcbiAgICAgICAgICAgICMgaWYgL2tvX3Rlcm1fZG9uZS8udGVzdCB0XG4gICAgICAgICAgICAgICAgIyBpZiAvXmtvX3Rlcm1fZG9uZVxcc1xcZCskLy50ZXN0IHRcbiAgICAgICAgICAgICAgICAgICAgIyBjaWQgPSBwYXJzZUludCBfLmxhc3QgdC5zcGxpdCAnICdcbiAgICAgICAgICAgICAgICAgICAgIyBmb3IgbWV0YSBpbiByZXZlcnNlZCBAbWV0YS5tZXRhc1xuICAgICAgICAgICAgICAgICAgICAgICAgIyBpZiBtZXRhWzJdLmNtZElEID09IGNpZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgbWV0YVsyXS5zcGFuPy5pbm5lckhUTUwgPSBcIuKWoFwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBicmVha1xuICAgICAgICAgICAgICAgICMgY29udGludWVcbiAgICAgICAgICAgICMgc2tpcCA9IGZhbHNlXG4gICAgICAgICAgICAjIGZvciBtZXRhIGluIHJldmVyc2VkIEBtZXRhLm1ldGFzXG4gICAgICAgICAgICAgICAgIyBpZiBtZXRhWzJdLmNvbW1hbmQgPT0gdCBcbiAgICAgICAgICAgICAgICAgICAgIyBpZiB0ICE9ICdwd2QnXG4gICAgICAgICAgICAgICAgICAgICAgICAjIHNwaW5uaW5nQ29nID0gJzxpIGNsYXNzPVwiZmEgZmEtY29nIGZhLXNwaW4gZmEtMXggZmEtZndcIj48L2k+J1xuICAgICAgICAgICAgICAgICAgICAgICAgIyBtZXRhWzJdLnNwYW4/LmlubmVySFRNTCA9IHNwaW5uaW5nQ29nXG4gICAgICAgICAgICAgICAgICAgICAgICAjIHN0b3BTcGluID0gLT5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIGlmIG1ldGFbMl0uc3Bhbj8uaW5uZXJIVE1MID09IHNwaW5uaW5nQ29nXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgbWV0YVsyXS5zcGFuPy5pbm5lckhUTUwgPSAnPGkgY2xhc3M9XCJmYSBmYS1jb2cgZmEtMXggZmEtZndcIj48L2k+J1xuICAgICAgICAgICAgICAgICAgICAgICAgIyBzZXRUaW1lb3V0IHN0b3BTcGluLCAzMDAwXG4gICAgICAgICAgICAgICAgICAgICMgc2tpcCA9IHRydWVcbiAgICAgICAgICAgICAgICAgICAgIyBicmVha1xuICAgICAgICAgICAgIyBjb250aW51ZSBpZiBza2lwXG4gICAgICAgICAgICAjIFt0ZXh0LGRpc3NdID0gQGFuc2lkaXNzLmRpc3NlY3QgbFxuICAgICAgICAgICAgIyBAc3ludGF4LnNldERpc3MgQG51bUxpbmVzKCksIGRpc3MgaWYgZGlzcz8ubGVuZ3RoXG4gICAgICAgICAgICAjIEBhcHBlbmRUZXh0IHRleHRcbiAgICAgICAgICAgICAgICBcbiAgICAjICAwMDAwMDAwICAwMDAgICAgICAwMDAwMDAwMCAgIDAwMDAwMDAgICAwMDAwMDAwMCAgIFxuICAgICMgMDAwICAgICAgIDAwMCAgICAgIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgXG4gICAgIyAwMDAgICAgICAgMDAwICAgICAgMDAwMDAwMCAgIDAwMDAwMDAwMCAgMDAwMDAwMCAgICBcbiAgICAjIDAwMCAgICAgICAwMDAgICAgICAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgIFxuICAgICMgIDAwMDAwMDAgIDAwMDAwMDAgIDAwMDAwMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgXG4gICAgXG4gICAgY2xlYXI6IC0+IFxuICAgIFxuICAgICAgICBkZWxldGUgQHNoZWxsLmxhc3Q/Lm1ldGFcbiAgICAgICAgQGVkaXRvci5jbGVhcigpXG4gICAgICAgIEBpbnB1dE1ldGEgPSBAZWRpdG9yLm1ldGEuYWRkXG4gICAgICAgICAgICBsaW5lOiAwXG4gICAgICAgICAgICBjbHNzOiAnaW5wdXQnXG4gICAgICAgICAgICBudW1iZXI6IHRleHQ6ICfilrYnXG4gICAgICAgICAgICBjbGljazogKG1ldGEsIGV2ZW50KSA9PlxuICAgICAgICAgICAgICAgIHBvcyA9IGtwb3MgZXZlbnRcbiAgICAgICAgICAgICAgICBpZiBwb3MueCA8IDQwXG4gICAgICAgICAgICAgICAgICAgIGtsb2cgJ2lucHV0IG51bWJlcidcbiAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgIGtsb2cgJ2lucHV0IHRleHQ/J1xuICAgICAgICB0cnVlXG4gICAgICAgICAgICAgICAgXG4gICAgIyAwMDAwMDAwMCAgIDAwMDAwMDAgICAwMDAgICAwMDAgIDAwMDAwMDAwMCAgICAgICAwMDAwMDAwICAwMDAgIDAwMDAwMDAgIDAwMDAwMDAwICBcbiAgICAjIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMDAgIDAwMCAgICAgMDAwICAgICAgICAgMDAwICAgICAgIDAwMCAgICAgMDAwICAgMDAwICAgICAgIFxuICAgICMgMDAwMDAwICAgIDAwMCAgIDAwMCAgMDAwIDAgMDAwICAgICAwMDAgICAgICAgICAwMDAwMDAwICAgMDAwICAgIDAwMCAgICAwMDAwMDAwICAgXG4gICAgIyAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgIDAwMDAgICAgIDAwMCAgICAgICAgICAgICAgMDAwICAwMDAgICAwMDAgICAgIDAwMCAgICAgICBcbiAgICAjIDAwMCAgICAgICAgMDAwMDAwMCAgIDAwMCAgIDAwMCAgICAgMDAwICAgICAgICAgMDAwMDAwMCAgIDAwMCAgMDAwMDAwMCAgMDAwMDAwMDAgIFxuXG4gICAgb25Gb250U2l6ZTogKHNpemUpID0+XG4gICAgICAgIFxuICAgICAgICBAZWRpdG9yLnNldEZvbnRTaXplIHNpemVcbiAgICAgICAgQGVkaXRvci5zaW5nbGVDdXJzb3JBdEVuZCgpXG4gICAgICAgIFxuICAgIHJlc2l6ZWQ6ID0+IEBlZGl0b3IucmVzaXplZCgpXG4gICAgXG4gICAgc2Nyb2xsQnk6IChkZWx0YSkgPT5cbiAgICAgICAgXG4gICAgICAgIGlmIEBhdXRvY29tcGxldGUubGlzdFxuICAgICAgICAgICAgQGF1dG9jb21wbGV0ZS5jbG9zZSgpXG4gICAgICAgIEBlZGl0b3Iuc2Nyb2xsLmJ5IGRlbHRhXG4gICAgICAgIGlmIG5vdCAoMCA8IEBlZGl0b3Iuc2Nyb2xsLnNjcm9sbCA8IEBlZGl0b3Iuc2Nyb2xsLnNjcm9sbE1heC0xKVxuICAgICAgICAgICAgcG9zdC5lbWl0ICdzdG9wV2hlZWwnXG4gICAgXG4gICAgIyAwMDAwMDAwMCAgIDAwMCAgIDAwMCAgMDAwMDAwMCAgICBcbiAgICAjIDAwMCAgIDAwMCAgMDAwIDAgMDAwICAwMDAgICAwMDAgIFxuICAgICMgMDAwMDAwMDAgICAwMDAwMDAwMDAgIDAwMCAgIDAwMCAgXG4gICAgIyAwMDAgICAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICBcbiAgICAjIDAwMCAgICAgICAgMDAgICAgIDAwICAwMDAwMDAwICAgIFxuICAgIFxuICAgIHB3ZDogLT5cbiAgICAgICAgXG4gICAgICAgIGRpciA9IHNsYXNoLnRpbGRlIHByb2Nlc3MuY3dkKClcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgQGVkaXRvci5hcHBlbmRPdXRwdXQgZGlyXG4gICAgICAgIEBlZGl0b3IubWV0YS5hZGRcbiAgICAgICAgICAgIGxpbmU6IE1hdGgubWF4IDAsIEBlZGl0b3IubnVtTGluZXMoKS0yXG4gICAgICAgICAgICBjbHNzOiAncHdkJ1xuICAgICAgICAgICAgbnVtYmVyOiBcbiAgICAgICAgICAgICAgICB0ZXh0OiAnICdcbiAgICAgICAgICAgICAgICBjbHNzOiAncHdkJ1xuICAgICAgICAgICAgZW5kOiBkaXIubGVuZ3RoKzFcbiAgICAgICAgICAgIGNsaWNrOiAobWV0YSwgZXZlbnQpID0+XG4gICAgICAgICAgICAgICAgcG9zID0ga3BvcyBldmVudFxuICAgICAgICAgICAgICAgIGlmIHBvcy54IDwgNDBcbiAgICAgICAgICAgICAgICAgICAgaW5kZXggPSBAZWRpdG9yLm1ldGEubWV0YXMuaW5kZXhPZiBtZXRhXG4gICAgICAgICAgICAgICAgICAgIGlmIGluZGV4IDwgQGVkaXRvci5tZXRhLm1ldGFzLmxlbmd0aC0xXG4gICAgICAgICAgICAgICAgICAgICAgICBAZWRpdG9yLnNpbmdsZUN1cnNvckF0UG9zIFswLG1ldGFbMF1dXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiBuZXh0ID0gQGVkaXRvci5tZXRhLm5leHRNZXRhT2ZTYW1lQ2xhc3MgbWV0YVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBpIGluIFttZXRhWzBdLi4ubmV4dFswXV1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQGVkaXRvci5kZWxldGVTZWxlY3Rpb25PckN1cnNvckxpbmVzKClcbiAgICAgICAgICAgICAgICAgICAgICAgIEBlZGl0b3IubW92ZUN1cnNvcnNEb3duKClcbiAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgIEBlZGl0b3Iuc2luZ2xlQ3Vyc29yQXRFbmQoKVxuICAgICAgICAgICAgICAgICAgICBAc2hlbGwuY2QgQGVkaXRvci5saW5lIG1ldGFbMF1cbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgIHRydWVcbiAgICAgICAgICAgICAgIFxuICAgICMgMDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwMDAwMDAwICAwMDAwMDAwMCAgMDAwMDAwMDAgICBcbiAgICAjIDAwMCAgICAgICAwMDAwICAwMDAgICAgIDAwMCAgICAgMDAwICAgICAgIDAwMCAgIDAwMCAgXG4gICAgIyAwMDAwMDAwICAgMDAwIDAgMDAwICAgICAwMDAgICAgIDAwMDAwMDAgICAwMDAwMDAwICAgIFxuICAgICMgMDAwICAgICAgIDAwMCAgMDAwMCAgICAgMDAwICAgICAwMDAgICAgICAgMDAwICAgMDAwICBcbiAgICAjIDAwMDAwMDAwICAwMDAgICAwMDAgICAgIDAwMCAgICAgMDAwMDAwMDAgIDAwMCAgIDAwMCAgXG4gICAgXG4gICAgb25FbnRlcjogLT5cbiAgICAgICAgXG4gICAgICAgIGlmIEBlZGl0b3IuaXNJbnB1dEN1cnNvcigpXG4gICAgICAgICAgICBpZiBAc2hlbGwuY2hpbGQgYW5kIEBzaGVsbC5sYXN0LmNtZCA9PSAna29mZmVlJ1xuICAgICAgICAgICAgICAgIEBzaGVsbC5jaGlsZC5zdGRpbi53cml0ZSAnXFxuJ1xuICAgICAgICAgICAgICAgIEBlZGl0b3Iuc2V0SW5wdXRUZXh0ICcnXG4gICAgICAgICAgICAgICAgcmV0dXJuXG4gICAgICAgICAgICBpZiBAYXV0b2NvbXBsZXRlLmlzTGlzdEl0ZW1TZWxlY3RlZCgpXG4gICAgICAgICAgICAgICAgQGF1dG9jb21wbGV0ZS5jb21wbGV0ZSB7fVxuICAgICAgICAgICAgZWxzZSBpZiBAYXV0b2NvbXBsZXRlLnNlbGVjdGVkQ29tcGxldGlvbigpXG4gICAgICAgICAgICAgICAgcmV0dXJuIEBzaGVsbC5leGVjdXRlIGZhbGxiYWNrOkBlZGl0b3IubGFzdExpbmUoKSArIEBhdXRvY29tcGxldGUuc2VsZWN0ZWRDb21wbGV0aW9uKClcbiAgICAgICAgICAgIEBzaGVsbC5leGVjdXRlIHt9XG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIEBlZGl0b3Iuc2luZ2xlQ3Vyc29yQXRFbmQoKVxuICAgICAgICBcbiAgICAjIDAwMCAgIDAwMCAgMDAwMDAwMDAgIDAwMCAgIDAwMCAgXG4gICAgIyAwMDAgIDAwMCAgIDAwMCAgICAgICAgMDAwIDAwMCAgIFxuICAgICMgMDAwMDAwMCAgICAwMDAwMDAwICAgICAwMDAwMCAgICBcbiAgICAjIDAwMCAgMDAwICAgMDAwICAgICAgICAgIDAwMCAgICAgXG4gICAgIyAwMDAgICAwMDAgIDAwMDAwMDAwICAgICAwMDAgICAgIFxuICAgIFxuICAgIGhhbmRsZUtleTogKG1vZCwga2V5LCBjb21ibywgY2hhciwgZXZlbnQpIC0+ICAgICAgICBcbiAgICAgICAgXG4gICAgICAgICMga2xvZyAndGVybS5oYW5kbGVLZXknIG1vZCwga2V5LCBjb21ib1xuICAgICAgICAgICAgICAgIFxuICAgICAgICBzd2l0Y2ggY29tYm9cbiAgICAgICAgICAgIHdoZW4gJ2VudGVyJyB0aGVuIHJldHVybiBAb25FbnRlcigpXG4gICAgICAgIFxuICAgICAgICBpZiBAc2hlbGwuY2hpbGQgYW5kIEBzaGVsbC5sYXN0LmNtZCA9PSAna29mZmVlJ1xuICAgICAgICAgICAgaWYgY2hhclxuICAgICAgICAgICAgICAgIHN3aXRjaCBrZXlcbiAgICAgICAgICAgICAgICAgICAgd2hlbiAnYmFja3NwYWNlJ1xuICAgICAgICAgICAgICAgICAgICAgICAgQHNoZWxsLmNoaWxkLnN0ZGluLndyaXRlICdcXHgwOCdcbiAgICAgICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICAgICAgQHNoZWxsLmNoaWxkLnN0ZGluLndyaXRlIGNoYXJcbiAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICBrbG9nICdwaXBlIGtleScga2V5LCBjb21ib1xuICAgICAgICBlbHNlICAgICAgICAgICAgXG4gICAgICAgICAgICByZXR1cm4gaWYgJ3VuaGFuZGxlZCcgIT0gQGF1dG9jb21wbGV0ZS5oYW5kbGVNb2RLZXlDb21ib0V2ZW50IG1vZCwga2V5LCBjb21ibywgZXZlbnRcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYgQGVkaXRvci5pc0lucHV0Q3Vyc29yKClcbiAgICAgICAgICAgICAgICBzd2l0Y2ggY29tYm9cbiAgICAgICAgICAgICAgICAgICAgd2hlbiAnYWx0K3VwJyB0aGVuIHJldHVybiBAZWRpdG9yLm1vdmVDdXJzb3JzVXAoKVxuICAgICAgICAgICAgICAgICAgICB3aGVuICd1cCcgICAgIHRoZW4gcmV0dXJuIEBoaXN0b3J5LnByZXYoKVxuICAgICAgICAgICAgICAgICAgICB3aGVuICdkb3duJyAgIHRoZW4gcmV0dXJuIEBoaXN0b3J5Lm5leHQoKVxuICAgICAgICAgICAgICAgICAgICB3aGVuICdjdHJsK2MnIHRoZW4gcmV0dXJuIEBzaGVsbC5oYW5kbGVDYW5jZWwoKVxuICAgICAgICBcbiAgICAgICAgJ3VuaGFuZGxlZCdcbiAgICAgICAgXG5tb2R1bGUuZXhwb3J0cyA9IFRlcm1cbiJdfQ==
//# sourceURL=../coffee/term.coffee