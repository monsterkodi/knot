// koffee 1.4.0

/*
000000000  00000000  00000000   00     00  
   000     000       000   000  000   000  
   000     0000000   0000000    000000000  
   000     000       000   000  000 0 000  
   000     00000000  000   000  000   000
 */
var $, BaseEditor, History, Shell, Term, TextEditor, elem, klog, kpos, post, ref, render, slash,
    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

ref = require('kxk'), $ = ref.$, elem = ref.elem, klog = ref.klog, kpos = ref.kpos, post = ref.post, slash = ref.slash;

BaseEditor = require('./editor/editor');

TextEditor = require('./editor/texteditor');

render = require('./editor/render');

History = require('./history');

Shell = require('./shell');

Term = (function() {
    function Term() {
        this.scrollBy = bind(this.scrollBy, this);
        this.resized = bind(this.resized, this);
        this.onFontSize = bind(this.onFontSize, this);
        this.onChanged = bind(this.onChanged, this);
        var main;
        main = $('#main');
        this.div = elem({
            "class": 'term'
        });
        main.appendChild(this.div);
        this.num = 0;
        this.rows = 0;
        this.cols = 0;
        this.size = {
            charWidth: 0,
            lineHeight: 0
        };
        this.editor = new TextEditor(this, {
            features: ['Scrollbar', 'Hrzntlbar', 'Minimap', 'Meta', 'Numbers', 'Autocomplete', 'Brackets', 'Strings', 'CursorLine']
        });
        this.editor.setText('');
        this.shell = new Shell(this);
        this.history = new History(this);
        this.autocomplete = this.editor.autocomplete;
        this.editor.on('changed', this.onChanged);
        post.on('fontSize', this.onFontSize);
    }

    Term.prototype.cursorToPrevPwd = function() {
        var meta;
        if (meta = this.editor.meta.prevMetaOfClass('pwd', this.editor.mainCursor()[1])) {
            return this.editor.singleCursorAtPos([0, meta[0]]);
        }
    };

    Term.prototype.cursorToNextPwd = function() {
        var meta;
        if (meta = this.editor.meta.nextMetaOfClass('pwd', this.editor.mainCursor()[1])) {
            return this.editor.singleCursorAtPos([0, meta[0]]);
        }
    };

    Term.prototype.deleteOutputOfPwdMeta = function(meta) {
        var i, index, j, next, ref1, ref2;
        if (meta != null) {
            meta;
        } else {
            meta = this.editor.meta.metaOfClassAtLine('pwd', this.editor.mainCursor()[1]);
        }
        if (!meta) {
            return;
        }
        index = this.editor.meta.metas.indexOf(meta);
        if (index < this.editor.meta.metas.length - 1) {
            this.editor.singleCursorAtPos([0, meta[0]]);
            if (next = this.editor.meta.nextMetaOfSameClass(meta)) {
                for (i = j = ref1 = meta[0], ref2 = next[0]; ref1 <= ref2 ? j < ref2 : j > ref2; i = ref1 <= ref2 ? ++j : --j) {
                    this.editor.deleteSelectionOrCursorLines();
                }
            }
            return this.editor.moveCursorsDown();
        }
    };

    Term.prototype.addDirMeta = function(dir) {
        return this.editor.meta.add({
            line: Math.max(0, this.editor.numLines() - 2),
            clss: 'pwd',
            number: {
                text: ' ',
                clss: 'pwd'
            },
            end: dir.length + 1,
            click: (function(_this) {
                return function(meta, event) {
                    var pos;
                    pos = kpos(event);
                    if (pos.x < 40) {
                        return _this.deleteOutputOfPwdMeta(meta);
                    } else {
                        _this.editor.singleCursorAtEnd();
                        return _this.shell.cd(_this.editor.line(meta[0]));
                    }
                };
            })(this)
        });
    };

    Term.prototype.addInputMeta = function() {
        this.inputMeta = this.editor.meta.add({
            line: 0,
            clss: 'input',
            number: {
                text: '▶',
                clss: 'input'
            },
            click: (function(_this) {
                return function(meta, event) {
                    if (meta[2].number.clss === 'input busy') {
                        return _this.shell.handleCancel();
                    }
                };
            })(this)
        });
        if (this.shell.child) {
            return this.busyInput();
        }
    };

    Term.prototype.busyInput = function() {
        var ref1, ref2;
        if ((ref1 = this.inputMeta[2]) != null) {
            ref1.number.text = '\uf013';
        }
        if ((ref2 = this.inputMeta[2]) != null) {
            ref2.number.clss = 'input busy';
        }
        return this.editor.meta.update(this.inputMeta);
    };

    Term.prototype.resetInput = function() {
        var ref1, ref2;
        if ((ref1 = this.inputMeta[2]) != null) {
            ref1.number.text = '▶';
        }
        if ((ref2 = this.inputMeta[2]) != null) {
            ref2.number.clss = 'input';
        }
        return this.editor.meta.update(this.inputMeta);
    };

    Term.prototype.failMeta = function(meta) {
        if (!meta) {
            return;
        }
        this.resetInput();
        meta[2].number = {
            text: '✖',
            clss: 'fail'
        };
        meta[2].clss = 'fail';
        this.editor.minimap.drawLines(meta[0], meta[0]);
        return this.editor.meta.update(meta);
    };

    Term.prototype.succMeta = function(meta, lastCode) {
        if (!meta) {
            return;
        }
        this.resetInput();
        if (lastCode === 'busy') {
            meta[2].number = {
                text: '\uf013',
                clss: 'succ busy'
            };
        } else {
            meta[2].number = {
                text: '▶',
                clss: 'succ'
            };
        }
        meta[2].clss = 'succ';
        meta[2].click = (function(_this) {
            return function(meta, event) {
                _this.editor.singleCursorAtEnd();
                _this.editor.setInputText(_this.editor.line(meta[0]));
                return _this.shell.execute({
                    cmd: _this.editor.line(meta[0])
                });
            };
        })(this);
        this.editor.minimap.drawLines(meta[0], meta[0]);
        return this.editor.meta.update(meta);
    };

    Term.prototype.insertCmdMeta = function(li, cmd) {
        this.busyInput();
        return this.editor.meta.add({
            line: li,
            clss: 'cmd',
            number: {
                text: '\uf013',
                clss: 'cmd'
            },
            end: cmd.length + 1,
            click: (function(_this) {
                return function(meta, event) {
                    var pos;
                    pos = kpos(event);
                    if (pos.x < 40) {
                        return _this.shell.handleCancel();
                    } else {
                        return klog('cmd text?');
                    }
                };
            })(this)
        });
    };

    Term.prototype.moveInputMeta = function() {
        var oldLine;
        if (this.editor.numLines() - 1 !== this.inputMeta[0]) {
            oldLine = this.inputMeta[0];
            this.editor.meta.moveLineMeta(this.inputMeta, this.editor.numLines() - 1 - this.inputMeta[0]);
            return this.editor.numbers.updateColor(oldLine);
        }
    };

    Term.prototype.onChanged = function(changeInfo) {
        if (changeInfo.changes.length) {
            return this.moveInputMeta();
        }
    };

    Term.prototype.clear = function() {
        var ref1;
        if ((ref1 = this.shell.last) != null) {
            delete ref1.meta;
        }
        this.editor.clear();
        this.addInputMeta();
        return true;
    };

    Term.prototype.onFontSize = function(size) {
        this.editor.setFontSize(size);
        return this.editor.singleCursorAtEnd();
    };

    Term.prototype.resized = function() {
        return this.editor.resized();
    };

    Term.prototype.scrollBy = function(delta) {
        var ref1;
        if (this.autocomplete.list) {
            this.autocomplete.close();
        }
        this.editor.scroll.by(delta);
        if (!((0 < (ref1 = this.editor.scroll.scroll) && ref1 < this.editor.scroll.scrollMax - 1))) {
            return post.emit('stopWheel');
        }
    };

    Term.prototype.pwd = function() {
        var dir;
        dir = slash.tilde(process.cwd());
        this.editor.appendOutput(dir);
        this.addDirMeta(dir);
        return true;
    };

    Term.prototype.isShell = function() {
        var ref1, ref2, ref3;
        return ((ref1 = this.shell) != null ? ref1.child : void 0) && ((ref2 = (ref3 = this.shell) != null ? ref3.last.cmd.split(' ')[0] : void 0) === 'bash' || ref2 === 'cmd' || ref2 === 'powershell' || ref2 === 'fish');
    };

    Term.prototype.onEnter = function() {
        if (this.editor.isInputCursor()) {
            if (this.isShell()) {
                klog('enter');
                this.shell.child.stdin.write('\n');
                this.editor.setInputText('');
                return;
            }
            if (this.autocomplete.isListItemSelected()) {
                this.autocomplete.complete({});
            } else if (this.autocomplete.selectedCompletion()) {
                return this.shell.execute({
                    fallback: this.editor.lastLine() + this.autocomplete.selectedCompletion()
                });
            }
            return this.shell.execute({});
        } else {
            return this.editor.singleCursorAtEnd();
        }
    };

    Term.prototype.handleKey = function(mod, key, combo, char, event) {
        switch (combo) {
            case 'enter':
                return this.onEnter();
            case 'alt+up':
                return this.cursorToPrevPwd();
            case 'alt+down':
                return this.cursorToNextPwd();
            case 'alt+delete':
                return this.deleteOutputOfPwdMeta();
            case 'ctrl+c':
                return this.shell.handleCancel();
        }
        if (this.isShell()) {
            if (char) {
                if (key !== 'backspace') {
                    this.shell.child.stdin.write(char);
                } else {
                    this.shell.child.stdin.write('\x08');
                }
            } else {
                klog('pipe key', key, combo);
            }
        } else {
            if ('unhandled' !== this.autocomplete.handleModKeyComboEvent(mod, key, combo, event)) {
                return;
            }
            if (this.editor.isInputCursor()) {
                switch (combo) {
                    case 'up':
                        return this.history.prev();
                    case 'down':
                        return this.history.next();
                    case 'ctrl+e':
                        return this.editor.moveCursorsAtBoundaryRight();
                }
            }
        }
        return 'unhandled';
    };

    return Term;

})();

module.exports = Term;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGVybS5qcyIsInNvdXJjZVJvb3QiOiIuIiwic291cmNlcyI6WyIiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQTs7Ozs7OztBQUFBLElBQUEsMkZBQUE7SUFBQTs7QUFRQSxNQUF1QyxPQUFBLENBQVEsS0FBUixDQUF2QyxFQUFFLFNBQUYsRUFBSyxlQUFMLEVBQVcsZUFBWCxFQUFpQixlQUFqQixFQUF1QixlQUF2QixFQUE2Qjs7QUFFN0IsVUFBQSxHQUFhLE9BQUEsQ0FBUSxpQkFBUjs7QUFDYixVQUFBLEdBQWEsT0FBQSxDQUFRLHFCQUFSOztBQUNiLE1BQUEsR0FBYSxPQUFBLENBQVEsaUJBQVI7O0FBQ2IsT0FBQSxHQUFhLE9BQUEsQ0FBUSxXQUFSOztBQUNiLEtBQUEsR0FBYSxPQUFBLENBQVEsU0FBUjs7QUFHUDtJQUVDLGNBQUE7Ozs7O0FBRUMsWUFBQTtRQUFBLElBQUEsR0FBTSxDQUFBLENBQUUsT0FBRjtRQUNOLElBQUMsQ0FBQSxHQUFELEdBQU8sSUFBQSxDQUFLO1lBQUEsQ0FBQSxLQUFBLENBQUEsRUFBTSxNQUFOO1NBQUw7UUFDUCxJQUFJLENBQUMsV0FBTCxDQUFpQixJQUFDLENBQUEsR0FBbEI7UUFFQSxJQUFDLENBQUEsR0FBRCxHQUFRO1FBQ1IsSUFBQyxDQUFBLElBQUQsR0FBUTtRQUNSLElBQUMsQ0FBQSxJQUFELEdBQVE7UUFDUixJQUFDLENBQUEsSUFBRCxHQUNJO1lBQUEsU0FBQSxFQUFZLENBQVo7WUFDQSxVQUFBLEVBQVksQ0FEWjs7UUFHSixJQUFDLENBQUEsTUFBRCxHQUFVLElBQUksVUFBSixDQUFlLElBQWYsRUFBa0I7WUFBQSxRQUFBLEVBQVMsQ0FDakMsV0FEaUMsRUFFakMsV0FGaUMsRUFHakMsU0FIaUMsRUFJakMsTUFKaUMsRUFLakMsU0FMaUMsRUFNakMsY0FOaUMsRUFPakMsVUFQaUMsRUFRakMsU0FSaUMsRUFTakMsWUFUaUMsQ0FBVDtTQUFsQjtRQVlWLElBQUMsQ0FBQSxNQUFNLENBQUMsT0FBUixD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QixDQUF5QixJQUF6QixFQURKO2lCQUFBLE1BQUE7b0JBR0ksSUFBQyxDQUFBLEtBQUssQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLEtBQW5CLENBQXlCLE1BQXpCLEVBSEo7aUJBREo7YUFBQSxNQUFBO2dCQU1JLElBQUEsQ0FBSyxVQUFMLEVBQWdCLEdBQWhCLEVBQXFCLEtBQXJCLEVBTko7YUFEUjtTQUFBLE1BQUE7WUFVSSxJQUFVLFdBQUEsS0FBZSxJQUFDLENBQUEsWUFBWSxDQUFDLHNCQUFkLENBQXFDLEdBQXJDLEVBQTBDLEdBQTFDLEVBQStDLEtBQS9DLEVBQXNELEtBQXRELENBQXpCO0FBQUEsdUJBQUE7O1lBRUEsSUFBRyxJQUFDLENBQUEsTUFBTSxDQUFDLGFBQVIsQ0FBQSxDQUFIO0FBQ0ksd0JBQU8sS0FBUDtBQUFBLHlCQUNTLElBRFQ7QUFDdUIsK0JBQU8sSUFBQyxDQUFBLE9BQU8sQ0FBQyxJQUFULENBQUE7QUFEOUIseUJBRVMsTUFGVDtBQUV1QiwrQkFBTyxJQUFDLENBQUEsT0FBTyxDQUFDLElBQVQsQ0FBQTtBQUY5Qix5QkFHUyxRQUhUO0FBR3VCLCtCQUFPLElBQUMsQ0FBQSxNQUFNLENBQUMsMEJBQVIsQ0FBQTtBQUg5QixpQkFESjthQVpKOztlQWtCQTtJQWhDTzs7Ozs7O0FBa0NmLE1BQU0sQ0FBQyxPQUFQLEdBQWlCIiwic291cmNlc0NvbnRlbnQiOlsiIyMjXG4wMDAwMDAwMDAgIDAwMDAwMDAwICAwMDAwMDAwMCAgIDAwICAgICAwMCAgXG4gICAwMDAgICAgIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgXG4gICAwMDAgICAgIDAwMDAwMDAgICAwMDAwMDAwICAgIDAwMDAwMDAwMCAgXG4gICAwMDAgICAgIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAwIDAwMCAgXG4gICAwMDAgICAgIDAwMDAwMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgXG4jIyNcblxueyAkLCBlbGVtLCBrbG9nLCBrcG9zLCBwb3N0LCBzbGFzaCB9ID0gcmVxdWlyZSAna3hrJ1xuXG5CYXNlRWRpdG9yID0gcmVxdWlyZSAnLi9lZGl0b3IvZWRpdG9yJ1xuVGV4dEVkaXRvciA9IHJlcXVpcmUgJy4vZWRpdG9yL3RleHRlZGl0b3InXG5yZW5kZXIgICAgID0gcmVxdWlyZSAnLi9lZGl0b3IvcmVuZGVyJ1xuSGlzdG9yeSAgICA9IHJlcXVpcmUgJy4vaGlzdG9yeSdcblNoZWxsICAgICAgPSByZXF1aXJlICcuL3NoZWxsJ1xuIyBQVFkgICAgICAgID0gcmVxdWlyZSAnLi9wdHknXG5cbmNsYXNzIFRlcm1cblxuICAgIEA6IC0+XG4gICAgICAgIFxuICAgICAgICBtYWluID0kICcjbWFpbidcbiAgICAgICAgQGRpdiA9IGVsZW0gY2xhc3M6J3Rlcm0nIFxuICAgICAgICBtYWluLmFwcGVuZENoaWxkIEBkaXZcblxuICAgICAgICBAbnVtICA9IDAgICBcbiAgICAgICAgQHJvd3MgPSAwXG4gICAgICAgIEBjb2xzID0gMFxuICAgICAgICBAc2l6ZSA9XG4gICAgICAgICAgICBjaGFyV2lkdGg6ICAwXG4gICAgICAgICAgICBsaW5lSGVpZ2h0OiAwXG4gICAgICAgICAgICAgICAgXG4gICAgICAgIEBlZGl0b3IgPSBuZXcgVGV4dEVkaXRvciBALCBmZWF0dXJlczpbXG4gICAgICAgICAgICAnU2Nyb2xsYmFyJ1xuICAgICAgICAgICAgJ0hyem50bGJhcidcbiAgICAgICAgICAgICdNaW5pbWFwJ1xuICAgICAgICAgICAgJ01ldGEnXG4gICAgICAgICAgICAnTnVtYmVycydcbiAgICAgICAgICAgICdBdXRvY29tcGxldGUnXG4gICAgICAgICAgICAnQnJhY2tldHMnXG4gICAgICAgICAgICAnU3RyaW5ncydcbiAgICAgICAgICAgICdDdXJzb3JMaW5lJ1xuICAgICAgICBdXG4gICAgICAgICAgICAgICAgXG4gICAgICAgIEBlZGl0b3Iuc2V0VGV4dCAnJ1xuXG4gICAgICAgIEBzaGVsbCAgID0gbmV3IFNoZWxsIEBcbiAgICAgICAgIyBAcHR5ICAgICA9IG5ldyBQVFkgQFxuICAgICAgICBAaGlzdG9yeSA9IG5ldyBIaXN0b3J5IEBcbiAgICAgICAgQGF1dG9jb21wbGV0ZSA9IEBlZGl0b3IuYXV0b2NvbXBsZXRlXG4gICAgICAgIFxuICAgICAgICBAZWRpdG9yLm9uICdjaGFuZ2VkJyBAb25DaGFuZ2VkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICBwb3N0Lm9uICdmb250U2l6ZScgQG9uRm9udFNpemVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgIyAwMCAgICAgMDAgIDAwMDAwMDAwICAwMDAwMDAwMDAgICAwMDAwMDAwICAgXG4gICAgIyAwMDAgICAwMDAgIDAwMCAgICAgICAgICAwMDAgICAgIDAwMCAgIDAwMCAgXG4gICAgIyAwMDAwMDAwMDAgIDAwMDAwMDAgICAgICAwMDAgICAgIDAwMDAwMDAwMCAgXG4gICAgIyAwMDAgMCAwMDAgIDAwMCAgICAgICAgICAwMDAgICAgIDAwMCAgIDAwMCAgXG4gICAgIyAwMDAgICAwMDAgIDAwMDAwMDAwICAgICAwMDAgICAgIDAwMCAgIDAwMCAgXG5cbiAgICBjdXJzb3JUb1ByZXZQd2Q6IC0+XG4gICAgICAgIFxuICAgICAgICBpZiBtZXRhID0gQGVkaXRvci5tZXRhLnByZXZNZXRhT2ZDbGFzcyAncHdkJyBAZWRpdG9yLm1haW5DdXJzb3IoKVsxXVxuICAgICAgICAgICAgQGVkaXRvci5zaW5nbGVDdXJzb3JBdFBvcyBbMCxtZXRhWzBdXVxuXG4gICAgY3Vyc29yVG9OZXh0UHdkOiAtPlxuICAgICAgICBcbiAgICAgICAgaWYgbWV0YSA9IEBlZGl0b3IubWV0YS5uZXh0TWV0YU9mQ2xhc3MgJ3B3ZCcgQGVkaXRvci5tYWluQ3Vyc29yKClbMV1cbiAgICAgICAgICAgIEBlZGl0b3Iuc2luZ2xlQ3Vyc29yQXRQb3MgWzAsbWV0YVswXV1cbiAgICAgICAgICAgIFxuICAgIGRlbGV0ZU91dHB1dE9mUHdkTWV0YTogKG1ldGEpIC0+XG4gICAgICAgIFxuICAgICAgICBtZXRhID89IEBlZGl0b3IubWV0YS5tZXRhT2ZDbGFzc0F0TGluZSAncHdkJyBAZWRpdG9yLm1haW5DdXJzb3IoKVsxXVxuICAgICAgICByZXR1cm4gaWYgbm90IG1ldGFcbiAgICAgICAgXG4gICAgICAgIGluZGV4ID0gQGVkaXRvci5tZXRhLm1ldGFzLmluZGV4T2YgbWV0YVxuICAgICAgICBpZiBpbmRleCA8IEBlZGl0b3IubWV0YS5tZXRhcy5sZW5ndGgtMVxuICAgICAgICAgICAgQGVkaXRvci5zaW5nbGVDdXJzb3JBdFBvcyBbMCxtZXRhWzBdXVxuICAgICAgICAgICAgaWYgbmV4dCA9IEBlZGl0b3IubWV0YS5uZXh0TWV0YU9mU2FtZUNsYXNzIG1ldGFcbiAgICAgICAgICAgICAgICBmb3IgaSBpbiBbbWV0YVswXS4uLm5leHRbMF1dXG4gICAgICAgICAgICAgICAgICAgIEBlZGl0b3IuZGVsZXRlU2VsZWN0aW9uT3JDdXJzb3JMaW5lcygpXG4gICAgICAgICAgICBAZWRpdG9yLm1vdmVDdXJzb3JzRG93bigpXG4gICAgICAgICAgICBcbiAgICBhZGREaXJNZXRhOiAoZGlyKSAtPlxuICAgICAgICBcbiAgICAgICAgQGVkaXRvci5tZXRhLmFkZFxuICAgICAgICAgICAgbGluZTogTWF0aC5tYXggMCwgQGVkaXRvci5udW1MaW5lcygpLTJcbiAgICAgICAgICAgIGNsc3M6ICdwd2QnXG4gICAgICAgICAgICBudW1iZXI6IFxuICAgICAgICAgICAgICAgIHRleHQ6ICcgJ1xuICAgICAgICAgICAgICAgIGNsc3M6ICdwd2QnXG4gICAgICAgICAgICBlbmQ6IGRpci5sZW5ndGgrMVxuICAgICAgICAgICAgY2xpY2s6IChtZXRhLCBldmVudCkgPT5cbiAgICAgICAgICAgICAgICBwb3MgPSBrcG9zIGV2ZW50XG4gICAgICAgICAgICAgICAgaWYgcG9zLnggPCA0MFxuICAgICAgICAgICAgICAgICAgICBAZGVsZXRlT3V0cHV0T2ZQd2RNZXRhIG1ldGFcbiAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgIEBlZGl0b3Iuc2luZ2xlQ3Vyc29yQXRFbmQoKVxuICAgICAgICAgICAgICAgICAgICBAc2hlbGwuY2QgQGVkaXRvci5saW5lIG1ldGFbMF1cblxuICAgIGFkZElucHV0TWV0YTogLT5cbiAgICAgICAgXG4gICAgICAgIEBpbnB1dE1ldGEgPSBAZWRpdG9yLm1ldGEuYWRkXG4gICAgICAgICAgICBsaW5lOiAwXG4gICAgICAgICAgICBjbHNzOiAnaW5wdXQnXG4gICAgICAgICAgICBudW1iZXI6IFxuICAgICAgICAgICAgICAgIHRleHQ6ICfilrYnXG4gICAgICAgICAgICAgICAgY2xzczogJ2lucHV0J1xuICAgICAgICAgICAgY2xpY2s6IChtZXRhLCBldmVudCkgPT5cbiAgICAgICAgICAgICAgICBpZiBtZXRhWzJdLm51bWJlci5jbHNzID09ICdpbnB1dCBidXN5J1xuICAgICAgICAgICAgICAgICAgICBAc2hlbGwuaGFuZGxlQ2FuY2VsKClcbiAgXG4gICAgICAgIGlmIEBzaGVsbC5jaGlsZFxuICAgICAgICAgICAgQGJ1c3lJbnB1dCgpXG4gICAgICAgICAgICAgICAgICAgIFxuICAgIGJ1c3lJbnB1dDogLT5cblxuICAgICAgICBAaW5wdXRNZXRhWzJdPy5udW1iZXIudGV4dCA9ICdcXHVmMDEzJ1xuICAgICAgICBAaW5wdXRNZXRhWzJdPy5udW1iZXIuY2xzcyA9ICdpbnB1dCBidXN5J1xuICAgICAgICBAZWRpdG9yLm1ldGEudXBkYXRlIEBpbnB1dE1ldGFcbiAgICAgICAgXG4gICAgcmVzZXRJbnB1dDogLT5cbiAgICAgICAgXG4gICAgICAgIEBpbnB1dE1ldGFbMl0/Lm51bWJlci50ZXh0ID0gJ+KWtidcbiAgICAgICAgQGlucHV0TWV0YVsyXT8ubnVtYmVyLmNsc3MgPSAnaW5wdXQnXG4gICAgICAgIEBlZGl0b3IubWV0YS51cGRhdGUgQGlucHV0TWV0YVxuICAgIFxuICAgIGZhaWxNZXRhOiAobWV0YSkgLT5cblxuICAgICAgICByZXR1cm4gaWYgbm90IG1ldGFcbiAgICAgICAgXG4gICAgICAgIEByZXNldElucHV0KClcbiAgICAgICAgXG4gICAgICAgIG1ldGFbMl0ubnVtYmVyID0gdGV4dDon4pyWJyBjbHNzOidmYWlsJ1xuICAgICAgICBtZXRhWzJdLmNsc3MgPSAnZmFpbCdcbiAgICAgICAgQGVkaXRvci5taW5pbWFwLmRyYXdMaW5lcyBtZXRhWzBdLCBtZXRhWzBdXG4gICAgICAgIEBlZGl0b3IubWV0YS51cGRhdGUgbWV0YVxuICAgICAgICBcbiAgICBzdWNjTWV0YTogKG1ldGEsIGxhc3RDb2RlKSAtPlxuXG4gICAgICAgIHJldHVybiBpZiBub3QgbWV0YVxuXG4gICAgICAgIEByZXNldElucHV0KClcbiAgICAgICAgXG4gICAgICAgIGlmIGxhc3RDb2RlID09ICdidXN5J1xuICAgICAgICAgICAgbWV0YVsyXS5udW1iZXIgPSBcbiAgICAgICAgICAgICAgICB0ZXh0OiAnXFx1ZjAxMydcbiAgICAgICAgICAgICAgICBjbHNzOiAnc3VjYyBidXN5J1xuICAgICAgICBlbHNlXG4gICAgICAgICAgICBtZXRhWzJdLm51bWJlciA9IHRleHQ6J+KWticgY2xzczonc3VjYydcbiAgICAgICAgbWV0YVsyXS5jbHNzID0gJ3N1Y2MnXG4gICAgICAgIFxuICAgICAgICBtZXRhWzJdLmNsaWNrID0gKG1ldGEsIGV2ZW50KSA9PlxuICAgICAgICAgICAgQGVkaXRvci5zaW5nbGVDdXJzb3JBdEVuZCgpXG4gICAgICAgICAgICBAZWRpdG9yLnNldElucHV0VGV4dCBAZWRpdG9yLmxpbmUgbWV0YVswXVxuICAgICAgICAgICAgQHNoZWxsLmV4ZWN1dGUgY21kOkBlZGl0b3IubGluZSBtZXRhWzBdXG4gICAgICAgIFxuICAgICAgICBAZWRpdG9yLm1pbmltYXAuZHJhd0xpbmVzIG1ldGFbMF0sIG1ldGFbMF1cbiAgICAgICAgQGVkaXRvci5tZXRhLnVwZGF0ZSBtZXRhXG4gICAgICAgIFxuICAgIGluc2VydENtZE1ldGE6IChsaSwgY21kKSAtPlxuXG4gICAgICAgIEBidXN5SW5wdXQoKVxuICAgICAgICBcbiAgICAgICAgQGVkaXRvci5tZXRhLmFkZCBcbiAgICAgICAgICAgIGxpbmU6IGxpXG4gICAgICAgICAgICBjbHNzOiAnY21kJ1xuICAgICAgICAgICAgbnVtYmVyOiBcbiAgICAgICAgICAgICAgICB0ZXh0OiAnXFx1ZjAxMydcbiAgICAgICAgICAgICAgICBjbHNzOiAnY21kJ1xuICAgICAgICAgICAgZW5kOiBjbWQubGVuZ3RoKzFcbiAgICAgICAgICAgIGNsaWNrOiAobWV0YSwgZXZlbnQpID0+XG4gICAgICAgICAgICAgICAgcG9zID0ga3BvcyBldmVudFxuICAgICAgICAgICAgICAgIGlmIHBvcy54IDwgNDBcbiAgICAgICAgICAgICAgICAgICAgQHNoZWxsLmhhbmRsZUNhbmNlbCgpXG4gICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICBrbG9nICdjbWQgdGV4dD8nICAgICAgICAgICAgICAgIFxuICAgIFxuICAgIG1vdmVJbnB1dE1ldGE6IC0+XG4gICAgICAgIFxuICAgICAgICBpZiBAZWRpdG9yLm51bUxpbmVzKCktMSAhPSBAaW5wdXRNZXRhWzBdXG4gICAgICAgICAgICBvbGRMaW5lID0gQGlucHV0TWV0YVswXVxuICAgICAgICAgICAgQGVkaXRvci5tZXRhLm1vdmVMaW5lTWV0YSBAaW5wdXRNZXRhLCBAZWRpdG9yLm51bUxpbmVzKCktMS1AaW5wdXRNZXRhWzBdICAgICAgICAgICAgXG4gICAgICAgICAgICBAZWRpdG9yLm51bWJlcnMudXBkYXRlQ29sb3Igb2xkTGluZVxuICAgICAgICAgICAgXG4gICAgb25DaGFuZ2VkOiAoY2hhbmdlSW5mbykgPT5cbiAgICAgICAgXG4gICAgICAgIGlmIGNoYW5nZUluZm8uY2hhbmdlcy5sZW5ndGhcbiAgICAgICAgICAgIEBtb3ZlSW5wdXRNZXRhKClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgIyAgMDAwMDAwMCAgMDAwICAgICAgMDAwMDAwMDAgICAwMDAwMDAwICAgMDAwMDAwMDAgICBcbiAgICAjIDAwMCAgICAgICAwMDAgICAgICAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgIFxuICAgICMgMDAwICAgICAgIDAwMCAgICAgIDAwMDAwMDAgICAwMDAwMDAwMDAgIDAwMDAwMDAgICAgXG4gICAgIyAwMDAgICAgICAgMDAwICAgICAgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICBcbiAgICAjICAwMDAwMDAwICAwMDAwMDAwICAwMDAwMDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgIFxuICAgIFxuICAgIGNsZWFyOiAtPiBcbiAgICBcbiAgICAgICAgZGVsZXRlIEBzaGVsbC5sYXN0Py5tZXRhXG4gICAgICAgIEBlZGl0b3IuY2xlYXIoKVxuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgQGFkZElucHV0TWV0YSgpXG4gICAgICAgIHRydWVcbiAgICAgICAgICAgICAgICBcbiAgICAjIDAwMDAwMDAwICAgMDAwMDAwMCAgIDAwMCAgIDAwMCAgMDAwMDAwMDAwICAgICAgIDAwMDAwMDAgIDAwMCAgMDAwMDAwMCAgMDAwMDAwMDAgIFxuICAgICMgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwMCAgMDAwICAgICAwMDAgICAgICAgICAwMDAgICAgICAgMDAwICAgICAwMDAgICAwMDAgICAgICAgXG4gICAgIyAwMDAwMDAgICAgMDAwICAgMDAwICAwMDAgMCAwMDAgICAgIDAwMCAgICAgICAgIDAwMDAwMDAgICAwMDAgICAgMDAwICAgIDAwMDAwMDAgICBcbiAgICAjIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgMDAwMCAgICAgMDAwICAgICAgICAgICAgICAwMDAgIDAwMCAgIDAwMCAgICAgMDAwICAgICAgIFxuICAgICMgMDAwICAgICAgICAwMDAwMDAwICAgMDAwICAgMDAwICAgICAwMDAgICAgICAgICAwMDAwMDAwICAgMDAwICAwMDAwMDAwICAwMDAwMDAwMCAgXG5cbiAgICBvbkZvbnRTaXplOiAoc2l6ZSkgPT5cbiAgICAgICAgXG4gICAgICAgIEBlZGl0b3Iuc2V0Rm9udFNpemUgc2l6ZVxuICAgICAgICBAZWRpdG9yLnNpbmdsZUN1cnNvckF0RW5kKClcbiAgICAgICAgXG4gICAgcmVzaXplZDogPT4gQGVkaXRvci5yZXNpemVkKClcbiAgICBcbiAgICBzY3JvbGxCeTogKGRlbHRhKSA9PlxuICAgICAgICBcbiAgICAgICAgaWYgQGF1dG9jb21wbGV0ZS5saXN0XG4gICAgICAgICAgICBAYXV0b2NvbXBsZXRlLmNsb3NlKClcbiAgICAgICAgQGVkaXRvci5zY3JvbGwuYnkgZGVsdGFcbiAgICAgICAgaWYgbm90ICgwIDwgQGVkaXRvci5zY3JvbGwuc2Nyb2xsIDwgQGVkaXRvci5zY3JvbGwuc2Nyb2xsTWF4LTEpXG4gICAgICAgICAgICBwb3N0LmVtaXQgJ3N0b3BXaGVlbCdcbiAgICBcbiAgICAjIDAwMDAwMDAwICAgMDAwICAgMDAwICAwMDAwMDAwICAgIFxuICAgICMgMDAwICAgMDAwICAwMDAgMCAwMDAgIDAwMCAgIDAwMCAgXG4gICAgIyAwMDAwMDAwMCAgIDAwMDAwMDAwMCAgMDAwICAgMDAwICBcbiAgICAjIDAwMCAgICAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgIFxuICAgICMgMDAwICAgICAgICAwMCAgICAgMDAgIDAwMDAwMDAgICAgXG4gICAgXG4gICAgcHdkOiAtPlxuICAgICAgICBcbiAgICAgICAgZGlyID0gc2xhc2gudGlsZGUgcHJvY2Vzcy5jd2QoKVxuICAgICAgICAgICAgICAgIFxuICAgICAgICBAZWRpdG9yLmFwcGVuZE91dHB1dCBkaXJcbiAgICAgICAgQGFkZERpck1ldGEgZGlyXG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICB0cnVlXG4gICAgICAgICAgICAgICBcbiAgICAjIDAwMDAwMDAwICAwMDAgICAwMDAgIDAwMDAwMDAwMCAgMDAwMDAwMDAgIDAwMDAwMDAwICAgXG4gICAgIyAwMDAgICAgICAgMDAwMCAgMDAwICAgICAwMDAgICAgIDAwMCAgICAgICAwMDAgICAwMDAgIFxuICAgICMgMDAwMDAwMCAgIDAwMCAwIDAwMCAgICAgMDAwICAgICAwMDAwMDAwICAgMDAwMDAwMCAgICBcbiAgICAjIDAwMCAgICAgICAwMDAgIDAwMDAgICAgIDAwMCAgICAgMDAwICAgICAgIDAwMCAgIDAwMCAgXG4gICAgIyAwMDAwMDAwMCAgMDAwICAgMDAwICAgICAwMDAgICAgIDAwMDAwMDAwICAwMDAgICAwMDAgIFxuICAgIFxuICAgIGlzU2hlbGw6IC0+IEBzaGVsbD8uY2hpbGQgYW5kIEBzaGVsbD8ubGFzdC5jbWQuc3BsaXQoJyAnKVswXSBpbiBbJ2Jhc2gnICdjbWQnICdwb3dlcnNoZWxsJyAnZmlzaCddXG4gICAgXG4gICAgb25FbnRlcjogLT5cbiAgICAgICAgXG4gICAgICAgIGlmIEBlZGl0b3IuaXNJbnB1dEN1cnNvcigpXG4gICAgICAgICAgICBpZiBAaXNTaGVsbCgpXG4gICAgICAgICAgICAgICAga2xvZyAnZW50ZXInXG4gICAgICAgICAgICAgICAgQHNoZWxsLmNoaWxkLnN0ZGluLndyaXRlICdcXG4nXG4gICAgICAgICAgICAgICAgQGVkaXRvci5zZXRJbnB1dFRleHQgJydcbiAgICAgICAgICAgICAgICByZXR1cm5cbiAgICAgICAgICAgIGlmIEBhdXRvY29tcGxldGUuaXNMaXN0SXRlbVNlbGVjdGVkKClcbiAgICAgICAgICAgICAgICBAYXV0b2NvbXBsZXRlLmNvbXBsZXRlIHt9XG4gICAgICAgICAgICBlbHNlIGlmIEBhdXRvY29tcGxldGUuc2VsZWN0ZWRDb21wbGV0aW9uKClcbiAgICAgICAgICAgICAgICByZXR1cm4gQHNoZWxsLmV4ZWN1dGUgZmFsbGJhY2s6QGVkaXRvci5sYXN0TGluZSgpICsgQGF1dG9jb21wbGV0ZS5zZWxlY3RlZENvbXBsZXRpb24oKVxuICAgICAgICAgICAgQHNoZWxsLmV4ZWN1dGUge31cbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgQGVkaXRvci5zaW5nbGVDdXJzb3JBdEVuZCgpXG4gICAgICAgIFxuICAgICMgMDAwICAgMDAwICAwMDAwMDAwMCAgMDAwICAgMDAwICBcbiAgICAjIDAwMCAgMDAwICAgMDAwICAgICAgICAwMDAgMDAwICAgXG4gICAgIyAwMDAwMDAwICAgIDAwMDAwMDAgICAgIDAwMDAwICAgIFxuICAgICMgMDAwICAwMDAgICAwMDAgICAgICAgICAgMDAwICAgICBcbiAgICAjIDAwMCAgIDAwMCAgMDAwMDAwMDAgICAgIDAwMCAgICAgXG4gICAgXG4gICAgaGFuZGxlS2V5OiAobW9kLCBrZXksIGNvbWJvLCBjaGFyLCBldmVudCkgLT4gICAgICAgIFxuICAgICAgICBcbiAgICAgICAgIyBrbG9nICd0ZXJtLmhhbmRsZUtleScgbW9kLCBrZXksIGNvbWJvXG4gICAgICAgIFxuICAgICAgICAjIEBwdHkuaGFuZGxlS2V5IG1vZCwga2V5LCBjb21ibywgY2hhciwgZXZlbnRcbiAgICAgICAgIyByZXR1cm5cbiAgICAgICAgICAgICAgICBcbiAgICAgICAgc3dpdGNoIGNvbWJvXG4gICAgICAgICAgICB3aGVuICdlbnRlcicgICAgICB0aGVuIHJldHVybiBAb25FbnRlcigpXG4gICAgICAgICAgICB3aGVuICdhbHQrdXAnICAgICB0aGVuIHJldHVybiBAY3Vyc29yVG9QcmV2UHdkKClcbiAgICAgICAgICAgIHdoZW4gJ2FsdCtkb3duJyAgIHRoZW4gcmV0dXJuIEBjdXJzb3JUb05leHRQd2QoKVxuICAgICAgICAgICAgd2hlbiAnYWx0K2RlbGV0ZScgdGhlbiByZXR1cm4gQGRlbGV0ZU91dHB1dE9mUHdkTWV0YSgpXG4gICAgICAgICAgICB3aGVuICdjdHJsK2MnICAgICB0aGVuIHJldHVybiBAc2hlbGwuaGFuZGxlQ2FuY2VsKClcbiAgICAgICAgXG4gICAgICAgIGlmIEBpc1NoZWxsKClcbiAgICAgICAgICAgICAgICBpZiBjaGFyXG4gICAgICAgICAgICAgICAgICAgIGlmIGtleSBub3QgaW4gWydiYWNrc3BhY2UnXVxuICAgICAgICAgICAgICAgICAgICAgICAgQHNoZWxsLmNoaWxkLnN0ZGluLndyaXRlIGNoYXJcbiAgICAgICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICAgICAgQHNoZWxsLmNoaWxkLnN0ZGluLndyaXRlICdcXHgwOCdcbiAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgIGtsb2cgJ3BpcGUga2V5JyBrZXksIGNvbWJvXG4gICAgICAgICAgICAgICAgICAgICMgcmV0dXJuXG4gICAgICAgIGVsc2UgICAgICAgICAgICBcbiAgICAgICAgICAgIHJldHVybiBpZiAndW5oYW5kbGVkJyAhPSBAYXV0b2NvbXBsZXRlLmhhbmRsZU1vZEtleUNvbWJvRXZlbnQgbW9kLCBrZXksIGNvbWJvLCBldmVudFxuICAgICAgICAgICAgXG4gICAgICAgICAgICBpZiBAZWRpdG9yLmlzSW5wdXRDdXJzb3IoKVxuICAgICAgICAgICAgICAgIHN3aXRjaCBjb21ib1xuICAgICAgICAgICAgICAgICAgICB3aGVuICd1cCcgICAgIHRoZW4gcmV0dXJuIEBoaXN0b3J5LnByZXYoKVxuICAgICAgICAgICAgICAgICAgICB3aGVuICdkb3duJyAgIHRoZW4gcmV0dXJuIEBoaXN0b3J5Lm5leHQoKVxuICAgICAgICAgICAgICAgICAgICB3aGVuICdjdHJsK2UnIHRoZW4gcmV0dXJuIEBlZGl0b3IubW92ZUN1cnNvcnNBdEJvdW5kYXJ5UmlnaHQoKVxuICAgICAgICBcbiAgICAgICAgJ3VuaGFuZGxlZCdcbiAgICAgICAgXG5tb2R1bGUuZXhwb3J0cyA9IFRlcm1cbiJdfQ==
//# sourceURL=../coffee/term.coffee