// koffee 1.4.0

/*
 0000000  000   000  00000000  000      000    
000       000   000  000       000      000    
0000000   000000000  0000000   000      000    
     000  000   000  000       000      000    
0000000   000   000  00000000  0000000  0000000
 */
var Alias, Chdir, History, Shell, _, args, childp, empty, history, klog, os, post, psTree, pty, ref, slash, valid, wxw,
    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
    indexOf = [].indexOf;

ref = require('kxk'), post = ref.post, history = ref.history, childp = ref.childp, slash = ref.slash, valid = ref.valid, empty = ref.empty, args = ref.args, os = ref.os, klog = ref.klog, _ = ref._;

History = require('./history');

Alias = require('./alias');

Chdir = require('./chdir');

psTree = require('ps-tree');

pty = require('node-pty');

wxw = require('wxw');

Shell = (function() {
    function Shell(term) {
        this.term = term;
        this.onStdErr = bind(this.onStdErr, this);
        this.onStdOut = bind(this.onStdOut, this);
        this.dequeue = bind(this.dequeue, this);
        this.onDone = bind(this.onDone, this);
        this.onExit = bind(this.onExit, this);
        this.shellCmd = bind(this.shellCmd, this);
        this.executeCmd = bind(this.executeCmd, this);
        this.execute = bind(this.execute, this);
        this.cd = bind(this.cd, this);
        this.editor = this.term.editor;
        this.alias = new Alias(this);
        this.chdir = new Chdir(this);
        this.queue = [];
        this.inputQueue = [];
        this.initPath();
    }

    Shell.prototype.initPath = function() {
        var a, binDir, exeDir, f, j, k, len, len1, pth, ref1, ref2, sep;
        sep = ';';
        klog('SHELL', process.env.SHELL);
        if (os.platform() !== 'win32') {
            sep = ':';
        }
        pth = process.env.PATH.split(sep).map(function(s) {
            return slash.path(s);
        });
        ref1 = ['node_modules/.bin', 'bin', '.'];
        for (j = 0, len = ref1.length; j < len; j++) {
            a = ref1[j];
            if (indexOf.call(pth, a) < 0) {
                pth.unshift(a);
            }
        }
        if (slash.isDir('~/s')) {
            ref2 = slash.list('~/s');
            for (k = 0, len1 = ref2.length; k < len1; k++) {
                f = ref2[k];
                if (f.type === 'dir') {
                    exeDir = slash.join(f.file, f.name + "-" + process.platform + "-" + process.arch);
                    if (slash.isDir(exeDir)) {
                        pth.unshift(exeDir);
                        continue;
                    }
                    binDir = slash.join(f.file, "bin");
                    if (slash.isDir(binDir)) {
                        pth.unshift(binDir);
                    }
                }
            }
        }
        process.env.PATH = pth.map(function(s) {
            return slash.unslash(s);
        }).join(sep);
        return klog('PATH', process.env.PATH);
    };

    Shell.prototype.cd = function(dir) {
        if (!slash.samePath(dir, process.cwd())) {
            this.executeCmd('cd ' + dir);
            return this.editor.focus();
        }
    };

    Shell.prototype.substitute = function(cmd) {
        cmd = this.alias.substitute(cmd);
        cmd = cmd.replace(/\~/g, slash.home());
        return cmd;
    };

    Shell.prototype.execute = function(arg1) {
        var fallback, hsub, ref1, ref2;
        this.cmd = (ref1 = arg1.cmd) != null ? ref1 : null, fallback = (ref2 = arg1.fallback) != null ? ref2 : null;
        if (this.cmd != null) {
            this.cmd;
        } else {
            this.cmd = this.editor.lastLine();
        }
        this.cmd = this.cmd.trim();
        if (this.cmd === '.' && valid(fallback)) {
            this.cmd = fallback;
        }
        if (this.child) {
            this.inputQueue.push(this.cmd);
            this.editor.setInputText('');
            return;
        }
        this.errorText = '';
        if (this.cmd !== (hsub = History.substitute(this.cmd))) {
            this.cmd = hsub;
            this.editor.setInputText(this.cmd);
        }
        this.editor.appendText('');
        this.editor.singleCursorAtEnd();
        if (empty(this.cmd)) {
            this.term.moveInputMeta();
            return;
        }
        this.term.history.shellCmd(this.cmd);
        this.last = {
            cmd: this.cmd,
            cwd: slash.tilde(process.cwd()),
            meta: this.term.insertCmdMeta(this.editor.numLines() - 2, this.cmd)
        };
        if (fallback) {
            this.last.fallback = fallback;
        }
        return this.executeCmd(this.substitute(this.cmd));
    };

    Shell.prototype.executeCmd = function(cmd1) {
        var split;
        this.cmd = cmd1;
        split = this.cmd.split('&&');
        if (split.length > 1) {
            this.cmd = split[0].trim();
            this.queue = this.queue.concat(split.slice(1));
        } else {
            this.cmd = this.cmd.trim();
        }
        if (empty(this.cmd)) {
            this.dequeue();
            return true;
        }
        if (this.alias.onCommand(this.cmd)) {
            this.dequeue();
            return true;
        }
        if (this.chdir.onCommand(this.cmd)) {
            this.dequeue();
            return true;
        }
        return this.shellCmd(this.cmd);
    };

    Shell.prototype.shellCmd = function(cmd1) {
        var cmd, currentCommand, firstChild, i, j, opt, pipe, previousChild, ref1, shell, split;
        this.cmd = cmd1;
        split = this.cmd.split('|');
        if (split.length > 1) {
            pipe = function(child, stdout, stderr) {
                child.stdin.on('error', function(err) {
                    return stderr.write('stdin error' + err + '\n');
                });
                child.stderr.on('data', function(data) {
                    if (!/^execvp\(\)/.test(data)) {
                        return stderr.write(data);
                    }
                });
                child.stdout.pipe(stdout);
                return child.on('error', function(err) {
                    process.stderr.write('Failed to execute ' + err + '\n');
                    return firstChild.kill();
                });
            };
            currentCommand = split[0];
            args = currentCommand.split(' ');
            cmd = args.shift();
            opt = {
                encoding: 'utf8',
                shell: true
            };
            firstChild = previousChild = this.child = childp.spawn(cmd, args, opt);
            for (i = j = 1, ref1 = split.length; 1 <= ref1 ? j < ref1 : j > ref1; i = 1 <= ref1 ? ++j : --j) {
                currentCommand = split[i].trim();
                args = currentCommand.split(' ');
                cmd = args.shift();
                this.child = childp.spawn(cmd, args, opt);
                pipe(previousChild, this.child.stdin, process.stderr);
                previousChild = this.child;
            }
            this.child.stdout.on('data', this.onStdOut);
            this.child.stderr.on('data', this.onStdErr);
            this.child.on('close', (function(_this) {
                return function(code) {
                    firstChild.kill();
                    return _this.onExit(code);
                };
            })(this));
        } else {
            shell = os.platform() === 'win32' && 'cmd' || 'bash';
            this.child = pty.spawn(shell, [], {
                useConpty: true,
                name: 'xterm-color',
                cols: 80,
                rows: 30,
                cwd: process.cwd(),
                env: process.env
            });
            this.child.onData(this.onStdOut);
            this.child.write(cmd + "\r");
        }
        return true;
    };

    Shell.prototype.handleCancel = function() {
        this.queue = [];
        this.inputQueue = [];
        if (!this.child) {
            return 'unhandled';
        }
        psTree(this.child.pid, (function(_this) {
            return function(err, children) {
                var arg, j, len, results;
                args = children.map(function(p) {
                    return p.PID;
                });
                args.unshift(_this.child.pid);
                args.reverse();
                _this.child.kill();
                results = [];
                for (j = 0, len = args.length; j < len; j++) {
                    arg = args[j];
                    results.push(klog(arg, wxw('terminate', arg)));
                }
                return results;
            };
        })(this));
        return true;
    };

    Shell.prototype.onExit = function(code) {
        var killed;
        killed = this.child.killed;
        delete this.child;
        if (code === 0 || killed) {
            return setImmediate(this.onDone);
        } else if (this.fallback()) {
            return this.dequeue();
        } else {
            this.term.failMeta(this.last.meta);
            if (!/is not recognized/.test(this.errorText)) {
                this.editor.appendOutput('\n' + this.errorText);
            }
            return this.dequeue('fail');
        }
    };

    Shell.prototype.fallback = function() {
        if (this.last.fallback) {
            klog('fallback', this.last.fallback);
            this.enqueue({
                cmd: this.last.fallback,
                update: true
            });
            delete this.last.fallback;
            return true;
        }
    };

    Shell.prototype.onDone = function(lastCode) {
        var info, ref1;
        if (lastCode !== 'fail') {
            if (((ref1 = this.last) != null ? ref1.meta : void 0) != null) {
                info = _.clone(this.last);
                delete info.meta;
                post.emit('cmd', info);
                this.term.succMeta(this.last.meta);
            }
        }
        if (empty(this.queue) && empty(this.inputQueue)) {
            return this.term.pwd();
        } else {
            return this.dequeue();
        }
    };

    Shell.prototype.enqueue = function(arg1) {
        var alias, cmd, front, ref1, ref2, ref3, ref4, update;
        cmd = (ref1 = arg1.cmd) != null ? ref1 : '', front = (ref2 = arg1.front) != null ? ref2 : false, update = (ref3 = arg1.update) != null ? ref3 : false, alias = (ref4 = arg1.alias) != null ? ref4 : false;
        if (update) {
            this.last.orig = this.last.cmd;
            this.last.cmd = cmd;
            if (this.last.meta) {
                this.editor.replaceTextInLine(this.last.meta[0], cmd);
                this.editor.meta.update(this.last.meta);
            }
        }
        if (alias) {
            this.last.alias = cmd;
        }
        cmd = cmd.replace(/\~/g, slash.home());
        if (front) {
            this.queue.unshift(cmd);
        } else {
            this.queue.push(cmd);
        }
        return cmd;
    };

    Shell.prototype.dequeue = function(lastCode) {
        var cmd;
        if (this.queue.length) {
            return this.executeCmd(this.queue.shift());
        } else if (this.inputQueue.length) {
            cmd = this.inputQueue.shift();
            this.editor.setInputText(cmd);
            return this.execute(cmd);
        } else {
            return this.onDone(lastCode);
        }
    };

    Shell.prototype.onStdOut = function(data) {
        var buf, c, j, len;
        if (data.replace == null) {
            data = 'utf' + data.toString('utf8');
        }
        if (data.slice(-1)[0] === '\n') {
            data = data.slice(0, +(data.length - 2) + 1 || 9e9);
        }
        data = data.replace(/(\x1B\[\?25[hl])|(\x0a)/g, '');
        buf = Buffer.from(data, 'utf8');
        for (j = 0, len = buf.length; j < len; j++) {
            c = buf[j];
            klog(c + " #" + (c.toString(16)) + " '" + (String.fromCharCode(c)) + "'");
        }
        this.editor.setInputText(this.editor.lastLine() + data);
        return this.editor.singleCursorAtEnd();
    };

    Shell.prototype.onStdErr = function(data) {
        return this.errorText += data;
    };

    return Shell;

})();

module.exports = Shell;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2hlbGwuanMiLCJzb3VyY2VSb290IjoiLiIsInNvdXJjZXMiOlsiIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUE7Ozs7Ozs7QUFBQSxJQUFBLGtIQUFBO0lBQUE7OztBQVFBLE1BQW9FLE9BQUEsQ0FBUSxLQUFSLENBQXBFLEVBQUUsZUFBRixFQUFRLHFCQUFSLEVBQWlCLG1CQUFqQixFQUF5QixpQkFBekIsRUFBZ0MsaUJBQWhDLEVBQXVDLGlCQUF2QyxFQUE4QyxlQUE5QyxFQUFvRCxXQUFwRCxFQUF3RCxlQUF4RCxFQUE4RDs7QUFFOUQsT0FBQSxHQUFVLE9BQUEsQ0FBUSxXQUFSOztBQUNWLEtBQUEsR0FBVSxPQUFBLENBQVEsU0FBUjs7QUFDVixLQUFBLEdBQVUsT0FBQSxDQUFRLFNBQVI7O0FBQ1YsTUFBQSxHQUFVLE9BQUEsQ0FBUSxTQUFSOztBQUNWLEdBQUEsR0FBVSxPQUFBLENBQVEsVUFBUjs7QUFDVixHQUFBLEdBQVUsT0FBQSxDQUFRLEtBQVI7O0FBRUo7SUFFQyxlQUFDLElBQUQ7UUFBQyxJQUFDLENBQUEsT0FBRDs7Ozs7Ozs7OztRQUVBLElBQUMsQ0FBQSxNQUFELEdBQVUsSUFBQyxDQUFBLElBQUksQ0FBQztRQUNoQixJQUFDLENBQUEsS0FBRCxHQUFTLElBQUksS0FBSixDQUFVLElBQVY7UUFDVCxJQUFDLENBQUEsS0FBRCxHQUFTLElBQUksS0FBSixDQUFVLElBQVY7UUFDVCxJQUFDLENBQUEsS0FBRCxHQUFTO1FBQ1QsSUFBQyxDQUFBLFVBQUQsR0FBYztRQUVkLElBQUMsQ0FBQSxRQUFELENBQUE7SUFSRDs7b0JBZ0JILFFBQUEsR0FBVSxTQUFBO0FBRU4sWUFBQTtRQUFBLEdBQUEsR0FBTTtRQUVOLElBQUEsQ0FBSyxPQUFMLEVBQWEsT0FBTyxDQUFDLEdBQUcsQ0FBQyxLQUF6QjtRQUVBLElBQUcsRUFBRSxDQUFDLFFBQUgsQ0FBQSxDQUFBLEtBQWlCLE9BQXBCO1lBQ0ksR0FBQSxHQUFNLElBRFY7O1FBR0EsR0FBQSxH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Q0FBYSwwQkFBYixFQUF5QyxFQUF6QztRQUVQLEdBQUEsR0FBTSxNQUFNLENBQUMsSUFBUCxDQUFZLElBQVosRUFBa0IsTUFBbEI7QUFDTixhQUFBLHFDQUFBOztZQUNJLElBQUEsQ0FBUSxDQUFELEdBQUcsSUFBSCxHQUFNLENBQUMsQ0FBQyxDQUFDLFFBQUYsQ0FBVyxFQUFYLENBQUQsQ0FBTixHQUFzQixJQUF0QixHQUF5QixDQUFDLE1BQU0sQ0FBQyxZQUFQLENBQW9CLENBQXBCLENBQUQsQ0FBekIsR0FBaUQsR0FBeEQ7QUFESjtRQUlBLElBQUMsQ0FBQSxNQUFNLENBQUMsWUFBUixDQUFxQixJQUFDLENBQUEsTUFBTSxDQUFDLFFBQVIsQ0FBQSxDQUFBLEdBQW1CLElBQXhDO2VBQ0EsSUFBQyxDQUFBLE1BQU0sQ0FBQyxpQkFBUixDQUFBO0lBZk07O29CQWlCVixRQUFBLEdBQVUsU0FBQyxJQUFEO2VBRU4sSUFBQyxDQUFBLFNBQUQsSUFBYztJQUZSOzs7Ozs7QUFJZCxNQUFNLENBQUMsT0FBUCxHQUFpQiIsInNvdXJjZXNDb250ZW50IjpbIiMjI1xuIDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwMDAwMDAgIDAwMCAgICAgIDAwMCAgICBcbjAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAgICAwMDAgICAgXG4wMDAwMDAwICAgMDAwMDAwMDAwICAwMDAwMDAwICAgMDAwICAgICAgMDAwICAgIFxuICAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgICAgIDAwMCAgICBcbjAwMDAwMDAgICAwMDAgICAwMDAgIDAwMDAwMDAwICAwMDAwMDAwICAwMDAwMDAwXG4jIyNcblxueyBwb3N0LCBoaXN0b3J5LCBjaGlsZHAsIHNsYXNoLCB2YWxpZCwgZW1wdHksIGFyZ3MsIG9zLCBrbG9nLCBfIH0gPSByZXF1aXJlICdreGsnXG5cbkhpc3RvcnkgPSByZXF1aXJlICcuL2hpc3RvcnknXG5BbGlhcyAgID0gcmVxdWlyZSAnLi9hbGlhcydcbkNoZGlyICAgPSByZXF1aXJlICcuL2NoZGlyJ1xucHNUcmVlICA9IHJlcXVpcmUgJ3BzLXRyZWUnXG5wdHkgICAgID0gcmVxdWlyZSAnbm9kZS1wdHknXG53eHcgICAgID0gcmVxdWlyZSAnd3h3J1xuXG5jbGFzcyBTaGVsbFxuXG4gICAgQDogKEB0ZXJtKSAtPlxuICAgICAgICBcbiAgICAgICAgQGVkaXRvciA9IEB0ZXJtLmVkaXRvclxuICAgICAgICBAYWxpYXMgPSBuZXcgQWxpYXMgQFxuICAgICAgICBAY2hkaXIgPSBuZXcgQ2hkaXIgQFxuICAgICAgICBAcXVldWUgPSBbXVxuICAgICAgICBAaW5wdXRRdWV1ZSA9IFtdXG4gICAgXG4gICAgICAgIEBpbml0UGF0aCgpXG4gICAgXG4gICAgIyAwMDAwMDAwMCAgICAwMDAwMDAwICAgMDAwMDAwMDAwICAwMDAgICAwMDAgIFxuICAgICMgMDAwICAgMDAwICAwMDAgICAwMDAgICAgIDAwMCAgICAgMDAwICAgMDAwICBcbiAgICAjIDAwMDAwMDAwICAgMDAwMDAwMDAwICAgICAwMDAgICAgIDAwMDAwMDAwMCAgXG4gICAgIyAwMDAgICAgICAgIDAwMCAgIDAwMCAgICAgMDAwICAgICAwMDAgICAwMDAgIFxuICAgICMgMDAwICAgICAgICAwMDAgICAwMDAgICAgIDAwMCAgICAgMDAwICAgMDAwICBcbiAgICBcbiAgICBpbml0UGF0aDogLT5cbiAgICAgICAgXG4gICAgICAgIHNlcCA9ICc7J1xuICAgICAgICBcbiAgICAgICAga2xvZyAnU0hFTEwnIHByb2Nlc3MuZW52LlNIRUxMXG4gICAgICAgIFxuICAgICAgICBpZiBvcy5wbGF0Zm9ybSgpICE9ICd3aW4zMicgI29yIHByb2Nlc3MuZW52LlNIRUxMXG4gICAgICAgICAgICBzZXAgPSAnOicgICAgICAgIFxuICAgICAgICAgICAgXG4gICAgICAgIHB0aCA9IHByb2Nlc3MuZW52LlBBVEguc3BsaXQoc2VwKS5tYXAgKHMpIC0+IHNsYXNoLnBhdGggc1xuXG4gICAgICAgIGZvciBhIGluIFsnbm9kZV9tb2R1bGVzLy5iaW4nICdiaW4nICcuJ11cbiAgICAgICAgICAgIGlmIGEgbm90IGluIHB0aFxuICAgICAgICAgICAgICAgICMga2xvZyBcImFkZCB0byBQQVRIICN7YX1cIlxuICAgICAgICAgICAgICAgIHB0aC51bnNoaWZ0IGFcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgaWYgc2xhc2guaXNEaXIgJ34vcydcbiAgICAgICAgICAgIGZvciBmIGluIHNsYXNoLmxpc3QgJ34vcydcbiAgICAgICAgICAgICAgICBpZiBmLnR5cGUgPT0gJ2RpcidcbiAgICAgICAgICAgICAgICAgICAgZXhlRGlyID0gc2xhc2guam9pbiBmLmZpbGUsIFwiI3tmLm5hbWV9LSN7cHJvY2Vzcy5wbGF0Zm9ybX0tI3twcm9jZXNzLmFyY2h9XCJcbiAgICAgICAgICAgICAgICAgICAgaWYgc2xhc2guaXNEaXIgZXhlRGlyXG4gICAgICAgICAgICAgICAgICAgICAgICAjIGtsb2cgXCJhZGQgZXhlIGRpclwiIGV4ZURpclxuICAgICAgICAgICAgICAgICAgICAgICAgcHRoLnVuc2hpZnQgZXhlRGlyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZVxuICAgICAgICAgICAgICAgICAgICBiaW5EaXIgPSBzbGFzaC5qb2luIGYuZmlsZSwgXCJiaW5cIlxuICAgICAgICAgICAgICAgICAgICBpZiBzbGFzaC5pc0RpciBiaW5EaXJcbiAgICAgICAgICAgICAgICAgICAgICAgICMga2xvZyBcImFkZCBiaW4gZGlyXCIgYmluRGlyXG4gICAgICAgICAgICAgICAgICAgICAgICBwdGgudW5zaGlmdCBiaW5EaXJcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgcHJvY2Vzcy5lbnYuUEFUSCA9IHB0aC5tYXAoKHMpIC0+IHNsYXNoLnVuc2xhc2ggcykuam9pbiBzZXBcbiAgICAgICAgXG4gICAgICAgIGtsb2cgJ1BBVEgnIHByb2Nlc3MuZW52LlBBVEhcbiAgICAgICAgXG4gICAgY2Q6IChkaXIpID0+XG4gICAgICAgIFxuICAgICAgICBpZiBub3Qgc2xhc2guc2FtZVBhdGggZGlyLCBwcm9jZXNzLmN3ZCgpXG4gICAgICAgICAgICBAZXhlY3V0ZUNtZCAnY2QgJyArIGRpclxuICAgICAgICAgICAgQGVkaXRvci5mb2N1cygpXG4gICAgICAgIFxuICAgIHN1YnN0aXR1dGU6IChjbWQpIC0+XG4gICAgICAgIFxuICAgICAgICBjbWQgPSBAYWxpYXMuc3Vic3RpdHV0ZSBjbWRcbiAgICAgICAgY21kID0gY21kLnJlcGxhY2UgL1xcfi9nLCBzbGFzaC5ob21lKClcbiAgICAgICAgY21kXG4gICAgICAgICAgICBcbiAgICAjIDAwMDAwMDAwICAwMDAgICAwMDAgIDAwMDAwMDAwICAgMDAwMDAwMCAgMDAwICAgMDAwICAwMDAwMDAwMDAgIDAwMDAwMDAwICBcbiAgICAjIDAwMCAgICAgICAgMDAwIDAwMCAgIDAwMCAgICAgICAwMDAgICAgICAgMDAwICAgMDAwICAgICAwMDAgICAgIDAwMCAgICAgICBcbiAgICAjIDAwMDAwMDAgICAgIDAwMDAwICAgIDAwMDAwMDAgICAwMDAgICAgICAgMDAwICAgMDAwICAgICAwMDAgICAgIDAwMDAwMDAgICBcbiAgICAjIDAwMCAgICAgICAgMDAwIDAwMCAgIDAwMCAgICAgICAwMDAgICAgICAgMDAwICAgMDAwICAgICAwMDAgICAgIDAwMCAgICAgICBcbiAgICAjIDAwMDAwMDAwICAwMDAgICAwMDAgIDAwMDAwMDAwICAgMDAwMDAwMCAgIDAwMDAwMDAgICAgICAwMDAgICAgIDAwMDAwMDAwICBcbiAgICBcbiAgICBleGVjdXRlOiAoQGNtZDosIGZhbGxiYWNrOikgPT5cbiAgICBcbiAgICAgICAgQGNtZCA/PSBAZWRpdG9yLmxhc3RMaW5lKClcbiAgICAgICAgQGNtZCA9IEBjbWQudHJpbSgpXG4gICAgXG4gICAgICAgIGlmIEBjbWQgPT0gJy4nIGFuZCB2YWxpZCBmYWxsYmFja1xuICAgICAgICAgICAgQGNtZCA9IGZhbGxiYWNrXG4gICAgICAgIFxuICAgICAgICBpZiBAY2hpbGRcbiAgICAgICAgICAgIEBpbnB1dFF1ZXVlLnB1c2ggQGNtZFxuICAgICAgICAgICAgQGVkaXRvci5zZXRJbnB1dFRleHQgJydcbiAgICAgICAgICAgIHJldHVyblxuICAgICAgICBcbiAgICAgICAgQGVycm9yVGV4dCA9ICcnXG4gICAgICAgIFxuICAgICAgICBpZiBAY21kICE9IGhzdWIgPSBIaXN0b3J5LnN1YnN0aXR1dGUgQGNtZFxuICAgICAgICAgICAgQGNtZCA9IGhzdWJcbiAgICAgICAgICAgIEBlZGl0b3Iuc2V0SW5wdXRUZXh0IEBjbWRcbiAgICAgICAgXG4gICAgICAgIEBlZGl0b3IuYXBwZW5kVGV4dCAnJ1xuICAgICAgICBAZWRpdG9yLnNpbmdsZUN1cnNvckF0RW5kKClcbiAgICAgICAgICAgIFxuICAgICAgICBpZiBlbXB0eSBAY21kIFxuICAgICAgICAgICAgQHRlcm0ubW92ZUlucHV0TWV0YSgpXG4gICAgICAgICAgICByZXR1cm5cbiAgICAgICAgXG4gICAgICAgIEB0ZXJtLmhpc3Rvcnkuc2hlbGxDbWQgQGNtZCAjIHJlc2V0IGhpc3RvcnkgcG9pbnRlciB0byBsYXN0XG5cbiAgICAgICAgQGxhc3QgPVxuICAgICAgICAgICAgY21kOiAgICAgIEBjbWRcbiAgICAgICAgICAgIGN3ZDogICAgICBzbGFzaC50aWxkZSBwcm9jZXNzLmN3ZCgpXG4gICAgICAgICAgICBtZXRhOiAgICAgQHRlcm0uaW5zZXJ0Q21kTWV0YSBAZWRpdG9yLm51bUxpbmVzKCktMiBAY21kXG4gICAgICAgICAgICBcbiAgICAgICAgQGxhc3QuZmFsbGJhY2sgPSBmYWxsYmFjayBpZiBmYWxsYmFja1xuICAgICAgICBcbiAgICAgICAgQGV4ZWN1dGVDbWQgQHN1YnN0aXR1dGUgQGNtZFxuICAgICAgICAgICAgICAgIFxuICAgICMgMDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwMDAwMDAgICAwMDAwMDAwICAgICAgICAwMDAwMDAwICAwMCAgICAgMDAgIDAwMDAwMDAgICAgXG4gICAgIyAwMDAgICAgICAgIDAwMCAwMDAgICAwMDAgICAgICAgMDAwICAgICAgICAgICAgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICBcbiAgICAjIDAwMDAwMDAgICAgIDAwMDAwICAgIDAwMDAwMDAgICAwMDAgICAgICAgICAgICAwMDAgICAgICAgMDAwMDAwMDAwICAwMDAgICAwMDAgIFxuICAgICMgMDAwICAgICAgICAwMDAgMDAwICAgMDAwICAgICAgIDAwMCAgICAgICAgICAgIDAwMCAgICAgICAwMDAgMCAwMDAgIDAwMCAgIDAwMCAgXG4gICAgIyAwMDAwMDAwMCAgMDAwICAgMDAwICAwMDAwMDAwMCAgIDAwMDAwMDAgICAgICAgIDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwMDAwMCAgICBcbiAgICBcbiAgICBleGVjdXRlQ21kOiAoQGNtZCkgPT5cblxuICAgICAgICBzcGxpdCA9IEBjbWQuc3BsaXQgJyYmJ1xuICAgICAgICBpZiBzcGxpdC5sZW5ndGggPiAxXG4gICAgICAgICAgICBAY21kID0gc3BsaXRbMF0udHJpbSgpXG4gICAgICAgICAgICBAcXVldWUgPSBAcXVldWUuY29uY2F0IHNwbGl0WzEuLl1cbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgQGNtZCA9IEBjbWQudHJpbSgpXG4gICAgICAgIFxuICAgICAgICBpZiBlbXB0eSBAY21kXG4gICAgICAgICAgICBAZGVxdWV1ZSgpXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgICBcbiAgICAgICAgaWYgQGFsaWFzLm9uQ29tbWFuZCBAY21kXG4gICAgICAgICAgICBAZGVxdWV1ZSgpXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZVxuXG4gICAgICAgIGlmIEBjaGRpci5vbkNvbW1hbmQgQGNtZFxuICAgICAgICAgICAgQGRlcXVldWUoKVxuICAgICAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgICAgICAgIFxuICAgICAgICAjIGtsb2cgJ3NoZWxsQ21kJyBAY21kXG4gICAgICAgIEBzaGVsbENtZCBAY21kXG4gICAgICAgICAgICAgICAgICAgIFxuICAgICMgIDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwMDAwMDAgIDAwMCAgICAgIDAwMCAgICAgICAgICAgMDAwMDAwMCAgMDAgICAgIDAwICAwMDAwMDAwICAgIFxuICAgICMgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgICAgIDAwMCAgICAgICAgICAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgIFxuICAgICMgMDAwMDAwMCAgIDAwMDAwMDAwMCAgMDAwMDAwMCAgIDAwMCAgICAgIDAwMCAgICAgICAgICAwMDAgICAgICAgMDAwMDAwMDAwICAwMDAgICAwMDAgIFxuICAgICMgICAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgICAgIDAwMCAgICAgICAgICAwMDAgICAgICAgMDAwIDAgMDAwICAwMDAgICAwMDAgIFxuICAgICMgMDAwMDAwMCAgIDAwMCAgIDAwMCAgMDAwMDAwMDAgIDAwMDAwMDAgIDAwMDAwMDAgICAgICAgMDAwMDAwMCAgMDAwICAgMDAwICAwMDAwMDAwICAgIFxuICAgIFxuICAgIHNoZWxsQ21kOiAoQGNtZCkgPT5cbiAgICAgICAgICAgIFxuICAgICAgICBzcGxpdCA9IEBjbWQuc3BsaXQgJ3wnXG4gICAgICAgIFxuICAgICAgICBpZiBzcGxpdC5sZW5ndGggPiAxXG4gICAgICAgICAgICBcbiAgICAgICAgICAgICMgMDAwMDAwMDAgICAwMDAgIDAwMDAwMDAwICAgMDAwMDAwMDAgIFxuICAgICAgICAgICAgIyAwMDAgICAwMDAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAgICAgXG4gICAgICAgICAgICAjIDAwMDAwMDAwICAgMDAwICAwMDAwMDAwMCAgIDAwMDAwMDAgICBcbiAgICAgICAgICAgICMgMDAwICAgICAgICAwMDAgIDAwMCAgICAgICAgMDAwICAgICAgIFxuICAgICAgICAgICAgIyAwMDAgICAgICAgIDAwMCAgMDAwICAgICAgICAwMDAwMDAwMCAgXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHBpcGUgPSAoY2hpbGQsIHN0ZG91dCwgc3RkZXJyKSAtPlxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIGNoaWxkLnN0ZGluLm9uICdlcnJvcicgKGVycikgLT4gc3RkZXJyLndyaXRlICdzdGRpbiBlcnJvcicgKyBlcnIgKyAnXFxuJ1xuICAgICAgICAgICAgICAgIGNoaWxkLnN0ZGVyci5vbiAnZGF0YScgKGRhdGEpIC0+IGlmIG5vdCAvXmV4ZWN2cFxcKFxcKS8udGVzdCBkYXRhIHRoZW4gc3RkZXJyLndyaXRlIGRhdGFcbiAgICAgICAgICAgICAgICBjaGlsZC5zdGRvdXQucGlwZSBzdGRvdXRcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIGNoaWxkLm9uICdlcnJvcicgKGVycikgLT5cbiAgICAgICAgICAgICAgICAgICAgcHJvY2Vzcy5zdGRlcnIud3JpdGUgJ0ZhaWxlZCB0byBleGVjdXRlICcgKyBlcnIgKyAnXFxuJ1xuICAgICAgICAgICAgICAgICAgICBmaXJzdENoaWxkLmtpbGwoKVxuXG4gICAgICAgICAgICBjdXJyZW50Q29tbWFuZCA9IHNwbGl0WzBdXG4gICAgICAgICAgICBhcmdzID0gY3VycmVudENvbW1hbmQuc3BsaXQgJyAnXG4gICAgICAgICAgICBjbWQgPSBhcmdzLnNoaWZ0KClcbiAgICAgICAgICAgIG9wdCA9IGVuY29kaW5nOid1dGY4JyBzaGVsbDp0cnVlXG4gICAgICAgICAgICBmaXJzdENoaWxkID0gcHJldmlvdXNDaGlsZCA9IEBjaGlsZCA9IGNoaWxkcC5zcGF3biBjbWQsIGFyZ3MsIG9wdFxuICAgICAgICBcbiAgICAgICAgICAgIGZvciBpIGluIFsxLi4uc3BsaXQubGVuZ3RoXVxuICAgICAgICAgICAgICAgIGN1cnJlbnRDb21tYW5kID0gc3BsaXRbaV0udHJpbSgpXG4gICAgICAgICAgICAgICAgYXJncyA9IGN1cnJlbnRDb21tYW5kLnNwbGl0ICcgJ1xuICAgICAgICAgICAgICAgIGNtZCA9IGFyZ3Muc2hpZnQoKVxuICAgICAgICAgICAgICAgIEBjaGlsZCA9IGNoaWxkcC5zcGF3biBjbWQsIGFyZ3MsIG9wdFxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIHBpcGUgcHJldmlvdXNDaGlsZCwgQGNoaWxkLnN0ZGluLCBwcm9jZXNzLnN0ZGVyclxuICAgICAgICBcbiAgICAgICAgICAgICAgICBwcmV2aW91c0NoaWxkID0gQGNoaWxkXG4gICAgICAgIFxuICAgICAgICAgICAgQGNoaWxkLnN0ZG91dC5vbiAnZGF0YScgQG9uU3RkT3V0XG4gICAgICAgICAgICBAY2hpbGQuc3RkZXJyLm9uICdkYXRhJyBAb25TdGRFcnJcbiAgICAgICAgXG4gICAgICAgICAgICBAY2hpbGQub24gJ2Nsb3NlJyAoY29kZSkgPT5cbiAgICAgICAgICAgICAgICBmaXJzdENoaWxkLmtpbGwoKVxuICAgICAgICAgICAgICAgIEBvbkV4aXQgY29kZVxuICAgICAgICBlbHNlXG4gICAgICAgIFxuICAgICAgICAgICAgIyAwMDAwMDAwMCAgMDAwICAgMDAwICAwMDAwMDAwMCAgIDAwMDAwMDAgIFxuICAgICAgICAgICAgIyAwMDAgICAgICAgIDAwMCAwMDAgICAwMDAgICAgICAgMDAwICAgICAgIFxuICAgICAgICAgICAgIyAwMDAwMDAwICAgICAwMDAwMCAgICAwMDAwMDAwICAgMDAwICAgICAgIFxuICAgICAgICAgICAgIyAwMDAgICAgICAgIDAwMCAwMDAgICAwMDAgICAgICAgMDAwICAgICAgIFxuICAgICAgICAgICAgIyAwMDAwMDAwMCAgMDAwICAgMDAwICAwMDAwMDAwMCAgIDAwMDAwMDAgIFxuICAgICAgICAgICAgXG4gICAgICAgICAgICBzaGVsbCA9IG9zLnBsYXRmb3JtKCkgPT0gJ3dpbjMyJyBhbmQgJ2NtZCcgb3IgJ2Jhc2gnXG4gICAgICAgICAgICBAY2hpbGQgPSBwdHkuc3Bhd24gc2hlbGwsIFtdLFxuICAgICAgICAgICAgICAgIHVzZUNvbnB0eTogdHJ1ZSBcbiAgICAgICAgICAgICAgICBuYW1lOiAneHRlcm0tY29sb3InXG4gICAgICAgICAgICAgICAgY29sczogODBcbiAgICAgICAgICAgICAgICByb3dzOiAzMFxuICAgICAgICAgICAgICAgIGN3ZDogcHJvY2Vzcy5jd2QoKVxuICAgICAgICAgICAgICAgIGVudjogcHJvY2Vzcy5lbnZcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgQGNoaWxkLm9uRGF0YSBAb25TdGRPdXRcbiAgICAgICAgICAgIEBjaGlsZC53cml0ZSBcIiN7Y21kfVxcclwiXG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAjIEBjaGlsZCA9IGNoaWxkcC5leGVjIEBjbWQsIHNoZWxsOnRydWUsIGVudjpwcm9jZXNzLmVudiAgICAgICAgICBcbiAgICAgICAgICAgICMgQGNoaWxkLnN0ZG91dC5vbiAnZGF0YScgIEBvblN0ZE91dFxuICAgICAgICAgICAgIyBAY2hpbGQuc3RkZXJyLm9uICdkYXRhJyAgQG9uU3RkRXJyXG4gICAgICAgICAgICAjIEBjaGlsZC5vbiAgICAgICAgJ2Nsb3NlJyBAb25FeGl0XG4gICAgICAgICAgICBcbiAgICAgICAgdHJ1ZVxuICAgICAgICBcbiAgICAjICAwMDAwMDAwICAgMDAwMDAwMCAgIDAwMCAgIDAwMCAgIDAwMDAwMDAgIDAwMDAwMDAwICAwMDAgICAgICBcbiAgICAjIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMDAgIDAwMCAgMDAwICAgICAgIDAwMCAgICAgICAwMDAgICAgICBcbiAgICAjIDAwMCAgICAgICAwMDAwMDAwMDAgIDAwMCAwIDAwMCAgMDAwICAgICAgIDAwMDAwMDAgICAwMDAgICAgICBcbiAgICAjIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgMDAwMCAgMDAwICAgICAgIDAwMCAgICAgICAwMDAgICAgICBcbiAgICAjICAwMDAwMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgIDAwMDAwMDAgIDAwMDAwMDAwICAwMDAwMDAwICBcbiAgICBcbiAgICBoYW5kbGVDYW5jZWw6IC0+XG4gICAgICAgIFxuICAgICAgICBAcXVldWUgPSBbXVxuICAgICAgICBAaW5wdXRRdWV1ZSA9IFtdXG4gICAgICAgIFxuICAgICAgICByZXR1cm4gJ3VuaGFuZGxlZCcgaWYgbm90IEBjaGlsZFxuICAgICAgICBcbiAgICAgICAgcHNUcmVlIEBjaGlsZC5waWQsIChlcnIsIGNoaWxkcmVuKSA9PlxuICAgICAgICAgICAgXG4gICAgICAgICAgICBhcmdzID0gY2hpbGRyZW4ubWFwIChwKSAtPiBwLlBJRFxuICAgICAgICAgICAgYXJncy51bnNoaWZ0IEBjaGlsZC5waWRcbiAgICAgICAgICAgIGFyZ3MucmV2ZXJzZSgpXG4gICAgICAgICAgICBAY2hpbGQua2lsbCgpXG4gICAgICAgICAgICBmb3IgYXJnIGluIGFyZ3NcbiAgICAgICAgICAgICAgICBrbG9nIGFyZywgd3h3ICd0ZXJtaW5hdGUnIGFyZ1xuICAgICAgICB0cnVlXG4gICAgICAgIFxuICAgICMgMDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwICAwMDAwMDAwMDAgIFxuICAgICMgMDAwICAgICAgICAwMDAgMDAwICAgMDAwICAgICAwMDAgICAgIFxuICAgICMgMDAwMDAwMCAgICAgMDAwMDAgICAgMDAwICAgICAwMDAgICAgIFxuICAgICMgMDAwICAgICAgICAwMDAgMDAwICAgMDAwICAgICAwMDAgICAgIFxuICAgICMgMDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwICAgICAwMDAgICAgIFxuICAgICAgICBcbiAgICBvbkV4aXQ6IChjb2RlKSA9PlxuXG4gICAgICAgIGtpbGxlZCA9IEBjaGlsZC5raWxsZWRcbiAgICAgICAgZGVsZXRlIEBjaGlsZFxuICAgICAgICBcbiAgICAgICAgaWYgY29kZSA9PSAwIG9yIGtpbGxlZCBcbiAgICAgICAgICAgIHNldEltbWVkaWF0ZSBAb25Eb25lXG4gICAgICAgIGVsc2UgaWYgQGZhbGxiYWNrKClcbiAgICAgICAgICAgIEBkZXF1ZXVlKClcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgQHRlcm0uZmFpbE1ldGEgQGxhc3QubWV0YVxuICAgICAgICAgICAgaWYgbm90IC9pcyBub3QgcmVjb2duaXplZC8udGVzdCBAZXJyb3JUZXh0XG4gICAgICAgICAgICAgICAgQGVkaXRvci5hcHBlbmRPdXRwdXQgJ1xcbicrQGVycm9yVGV4dFxuICAgICAgICAgICAgQGRlcXVldWUgJ2ZhaWwnXG4gICAgICAgICAgXG4gICAgIyAwMDAwMDAwMCAgIDAwMDAwMDAgICAwMDAgICAgICAwMDAgICAgICAwMDAwMDAwICAgICAwMDAwMDAwICAgIDAwMDAwMDAgIDAwMCAgIDAwMCAgXG4gICAgIyAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAgICAwMDAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgMDAwICAgXG4gICAgIyAwMDAwMDAgICAgMDAwMDAwMDAwICAwMDAgICAgICAwMDAgICAgICAwMDAwMDAwICAgIDAwMDAwMDAwMCAgMDAwICAgICAgIDAwMDAwMDAgICAgXG4gICAgIyAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAgICAwMDAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgMDAwICAgXG4gICAgIyAwMDAgICAgICAgMDAwICAgMDAwICAwMDAwMDAwICAwMDAwMDAwICAwMDAwMDAwICAgIDAwMCAgIDAwMCAgIDAwMDAwMDAgIDAwMCAgIDAwMCAgXG4gICAgXG4gICAgZmFsbGJhY2s6IC0+XG4gICAgICAgIFxuICAgICAgICBpZiBAbGFzdC5mYWxsYmFja1xuICAgICAgICAgICAga2xvZyAnZmFsbGJhY2snIEBsYXN0LmZhbGxiYWNrXG4gICAgICAgICAgICBAZW5xdWV1ZSBjbWQ6QGxhc3QuZmFsbGJhY2ssIHVwZGF0ZTp0cnVlXG4gICAgICAgICAgICBkZWxldGUgQGxhc3QuZmFsbGJhY2tcbiAgICAgICAgICAgIHJldHVybiB0cnVlXG4gICAgICAgIFxuICAgICMgMDAwMDAwMCAgICAgMDAwMDAwMCAgIDAwMCAgIDAwMCAgMDAwMDAwMDAgIFxuICAgICMgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMDAgIDAwMCAgMDAwICAgICAgIFxuICAgICMgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAwIDAwMCAgMDAwMDAwMCAgIFxuICAgICMgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgMDAwMCAgMDAwICAgICAgIFxuICAgICMgMDAwMDAwMCAgICAgMDAwMDAwMCAgIDAwMCAgIDAwMCAgMDAwMDAwMDAgIFxuICAgIFxuICAgIG9uRG9uZTogKGxhc3RDb2RlKSA9PlxuXG4gICAgICAgIGlmIGxhc3RDb2RlICE9ICdmYWlsJyBcbiAgICAgICAgICAgIGlmIEBsYXN0Py5tZXRhP1xuICAgICAgICAgICAgICAgIGluZm8gPSBfLmNsb25lIEBsYXN0XG4gICAgICAgICAgICAgICAgZGVsZXRlIGluZm8ubWV0YVxuICAgICAgICAgICAgICAgIHBvc3QuZW1pdCAnY21kJyBpbmZvICMgaW5zZXJ0IGludG8gZ2xvYmFsIGhpc3RvcnkgYW5kIGJyYWluXG4gICAgICAgICAgICAgICAgQHRlcm0uc3VjY01ldGEgQGxhc3QubWV0YVxuICAgICAgICBpZiBlbXB0eShAcXVldWUpIGFuZCBlbXB0eShAaW5wdXRRdWV1ZSlcbiAgICAgICAgICAgIEB0ZXJtLnB3ZCgpXG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIEBkZXF1ZXVlKClcbiAgICAgICAgICAgXG4gICAgIyAwMDAwMDAwMCAgMDAwICAgMDAwICAgMDAwMDAwMCAgIDAwMCAgIDAwMCAgMDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwMDAwMDAgIFxuICAgICMgMDAwICAgICAgIDAwMDAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgICAgICBcbiAgICAjIDAwMDAwMDAgICAwMDAgMCAwMDAgIDAwMCAwMCAwMCAgMDAwICAgMDAwICAwMDAwMDAwICAgMDAwICAgMDAwICAwMDAwMDAwICAgXG4gICAgIyAwMDAgICAgICAgMDAwICAwMDAwICAwMDAgMDAwMCAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgICAgIFxuICAgICMgMDAwMDAwMDAgIDAwMCAgIDAwMCAgIDAwMDAwIDAwICAgMDAwMDAwMCAgIDAwMDAwMDAwICAgMDAwMDAwMCAgIDAwMDAwMDAwICBcbiAgICBcbiAgICBlbnF1ZXVlOiAoY21kOicnIGZyb250OmZhbHNlIHVwZGF0ZTpmYWxzZSBhbGlhczpmYWxzZSkgLT4gXG4gICAgXG4gICAgICAgIGlmIHVwZGF0ZVxuICAgICAgICAgICAgQGxhc3Qub3JpZyA9IEBsYXN0LmNtZFxuICAgICAgICAgICAgQGxhc3QuY21kID0gY21kXG4gICAgICAgICAgICBpZiBAbGFzdC5tZXRhXG4gICAgICAgICAgICAgICAgQGVkaXRvci5yZXBsYWNlVGV4dEluTGluZSBAbGFzdC5tZXRhWzBdLCBjbWRcbiAgICAgICAgICAgICAgICBAZWRpdG9yLm1ldGEudXBkYXRlIEBsYXN0Lm1ldGFcbiAgICAgICAgICAgIFxuICAgICAgICBpZiBhbGlhc1xuICAgICAgICAgICAgQGxhc3QuYWxpYXMgPSBjbWRcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgY21kID0gY21kLnJlcGxhY2UgL1xcfi9nLCBzbGFzaC5ob21lKClcbiAgICAgICAgXG4gICAgICAgIGlmIGZyb250XG4gICAgICAgICAgICBAcXVldWUudW5zaGlmdCBjbWRcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgQHF1ZXVlLnB1c2ggY21kXG4gICAgICAgIGNtZFxuICAgICAgICAgICAgICAgICAgICBcbiAgICAjIDAwMDAwMDAgICAgMDAwMDAwMDAgICAwMDAwMDAwICAgMDAwICAgMDAwICAwMDAwMDAwMCAgMDAwICAgMDAwICAwMDAwMDAwMCAgXG4gICAgIyAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgICAgIFxuICAgICMgMDAwICAgMDAwICAwMDAwMDAwICAgMDAwIDAwIDAwICAwMDAgICAwMDAgIDAwMDAwMDAgICAwMDAgICAwMDAgIDAwMDAwMDAgICBcbiAgICAjIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAwMDAwICAgMDAwICAgMDAwICAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAgICAgXG4gICAgIyAwMDAwMDAwICAgIDAwMDAwMDAwICAgMDAwMDAgMDAgICAwMDAwMDAwICAgMDAwMDAwMDAgICAwMDAwMDAwICAgMDAwMDAwMDAgIFxuICAgIFxuICAgIGRlcXVldWU6IChsYXN0Q29kZSkgPT5cbiBcbiAgICAgICAgaWYgQHF1ZXVlLmxlbmd0aFxuICAgICAgICAgICAgQGV4ZWN1dGVDbWQgQHF1ZXVlLnNoaWZ0KClcbiAgICAgICAgZWxzZSBpZiBAaW5wdXRRdWV1ZS5sZW5ndGhcbiAgICAgICAgICAgIGNtZCA9IEBpbnB1dFF1ZXVlLnNoaWZ0KClcbiAgICAgICAgICAgIEBlZGl0b3Iuc2V0SW5wdXRUZXh0IGNtZFxuICAgICAgICAgICAgQGV4ZWN1dGUgY21kXG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIEBvbkRvbmUgbGFzdENvZGVcbiAgICAgICAgXG4gICAgIyAgMDAwMDAwMCAgMDAwMDAwMDAwICAwMDAwMDAwICAgIFxuICAgICMgMDAwICAgICAgICAgIDAwMCAgICAgMDAwICAgMDAwICBcbiAgICAjIDAwMDAwMDAgICAgICAwMDAgICAgIDAwMCAgIDAwMCAgXG4gICAgIyAgICAgIDAwMCAgICAgMDAwICAgICAwMDAgICAwMDAgIFxuICAgICMgMDAwMDAwMCAgICAgIDAwMCAgICAgMDAwMDAwMCAgICBcbiAgICBcbiAgICBvblN0ZE91dDogKGRhdGEpID0+XG4gICAgICAgIFxuICAgICAgICBpZiBub3QgZGF0YS5yZXBsYWNlP1xuICAgICAgICAgICAgZGF0YSA9ICd1dGYnICsgZGF0YS50b1N0cmluZyAndXRmOCdcbiAgICAgICAgaWYgZGF0YVstMV0gPT0gJ1xcbidcbiAgICAgICAgICAgIGRhdGEgPSBkYXRhWzAuLmRhdGEubGVuZ3RoLTJdXG5cbiAgICAgICAgZGF0YSA9IGRhdGEucmVwbGFjZSAvKFxceDFCXFxbXFw/MjVbaGxdKXwoXFx4MGEpL2csICcnXG4gICAgICAgICAgICBcbiAgICAgICAgYnVmID0gQnVmZmVyLmZyb20gZGF0YSwgJ3V0ZjgnXG4gICAgICAgIGZvciBjIGluIGJ1ZlxuICAgICAgICAgICAga2xvZyBcIiN7Y30gIyN7Yy50b1N0cmluZygxNil9ICcje1N0cmluZy5mcm9tQ2hhckNvZGUoYyl9J1wiXG4gICAgICAgICAgICBcbiAgICAgICAgIyBAZWRpdG9yLmFwcGVuZE91dHB1dCBkYXRhXG4gICAgICAgIEBlZGl0b3Iuc2V0SW5wdXRUZXh0IEBlZGl0b3IubGFzdExpbmUoKStkYXRhXG4gICAgICAgIEBlZGl0b3Iuc2luZ2xlQ3Vyc29yQXRFbmQoKVxuXG4gICAgb25TdGRFcnI6IChkYXRhKSA9PlxuXG4gICAgICAgIEBlcnJvclRleHQgKz0gZGF0YVxuICAgICAgICBcbm1vZHVsZS5leHBvcnRzID0gU2hlbGxcbiJdfQ==
//# sourceURL=../coffee/shell.coffee