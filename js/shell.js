// koffee 1.4.0

/*
 0000000  000   000  00000000  000      000    
000       000   000  000       000      000    
0000000   000000000  0000000   000      000    
     000  000   000  000       000      000    
0000000   000   000  00000000  0000000  0000000
 */
var Alias, Chdir, History, Shell, _, args, childp, empty, history, klog, post, psTree, ref, slash, wxw,
    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

ref = require('kxk'), post = ref.post, history = ref.history, childp = ref.childp, slash = ref.slash, empty = ref.empty, args = ref.args, klog = ref.klog, _ = ref._;

History = require('./history');

Alias = require('./alias');

Chdir = require('./chdir');

psTree = require('ps-tree');

wxw = require('wxw');

Shell = (function() {
    function Shell(term) {
        this.term = term;
        this.onStdErr = bind(this.onStdErr, this);
        this.onStdOut = bind(this.onStdOut, this);
        this.dequeue = bind(this.dequeue, this);
        this.onDone = bind(this.onDone, this);
        this.onExit = bind(this.onExit, this);
        this.shellCmd = bind(this.shellCmd, this);
        this.executeCmd = bind(this.executeCmd, this);
        this.execute = bind(this.execute, this);
        this.cd = bind(this.cd, this);
        this.editor = this.term.editor;
        this.alias = new Alias(this);
        this.chdir = new Chdir(this);
        this.queue = [];
        this.inputQueue = [];
    }

    Shell.prototype.cd = function(dir) {
        if (!slash.samePath(dir, process.cwd())) {
            this.executeCmd('cd ' + dir);
            return this.editor.focus();
        }
    };

    Shell.prototype.substitute = function(cmd) {
        cmd = this.alias.substitute(cmd);
        cmd = cmd.replace(/\~/g, slash.home());
        return cmd;
    };

    Shell.prototype.execute = function(arg1) {
        var fallback, hsub, ref1, ref2;
        this.cmd = (ref1 = arg1.cmd) != null ? ref1 : null, fallback = (ref2 = arg1.fallback) != null ? ref2 : null;
        if (this.cmd != null) {
            this.cmd;
        } else {
            this.cmd = this.editor.lastLine();
        }
        this.cmd = this.cmd.trim();
        if (this.child) {
            this.inputQueue.push(this.cmd);
            this.editor.setInputText('');
            return;
        }
        this.errorText = '';
        if (this.cmd !== (hsub = History.substitute(this.cmd))) {
            this.cmd = hsub;
            this.editor.setInputText(this.cmd);
        }
        this.editor.appendText('');
        this.editor.singleCursorAtEnd();
        if (empty(this.cmd)) {
            return;
        }
        this.term.history.shellCmd(this.cmd);
        this.last = {
            cmd: this.cmd,
            cwd: slash.tilde(process.cwd()),
            meta: this.term.insertCmdMeta(this.editor.numLines() - 2, this.cmd)
        };
        if (fallback) {
            this.last.fallback = fallback;
        }
        return this.executeCmd(this.substitute(this.cmd));
    };

    Shell.prototype.executeCmd = function(cmd1) {
        var split;
        this.cmd = cmd1;
        klog('executeCmd', this.cmd);
        split = this.cmd.split('&&');
        if (split.length > 1) {
            this.cmd = split[0].trim();
            this.queue = this.queue.concat(split.slice(1));
        } else {
            this.cmd = this.cmd.trim();
        }
        if (empty(this.cmd)) {
            this.dequeue();
            return true;
        }
        if (this.alias.onCommand(this.cmd)) {
            this.dequeue();
            return true;
        }
        if (this.chdir.onCommand(this.cmd)) {
            klog('chdir', this.cmd);
            this.dequeue();
            return true;
        }
        klog('shellCmd', this.cmd);
        return this.shellCmd(this.cmd);
    };

    Shell.prototype.shellCmd = function(cmd1) {
        var cmd, currentCommand, firstChild, i, j, opt, pipe, previousChild, ref1, split;
        this.cmd = cmd1;
        split = this.cmd.split('|');
        if (split.length > 1) {
            pipe = function(child, stdout, stderr) {
                child.stdin.on('error', function(err) {
                    return stderr.write('stdin error' + err + '\n');
                });
                child.stderr.on('data', function(data) {
                    if (!/^execvp\(\)/.test(data)) {
                        return stderr.write(data);
                    }
                });
                child.stdout.pipe(stdout);
                return child.on('error', function(err) {
                    process.stderr.write('Failed to execute ' + err + '\n');
                    return firstChild.kill();
                });
            };
            currentCommand = split[0];
            args = currentCommand.split(' ');
            cmd = args.shift();
            opt = {
                encoding: 'utf8',
                shell: true
            };
            firstChild = previousChild = this.child = childp.spawn(cmd, args, opt);
            for (i = j = 1, ref1 = split.length; 1 <= ref1 ? j < ref1 : j > ref1; i = 1 <= ref1 ? ++j : --j) {
                currentCommand = split[i].trim();
                args = currentCommand.split(' ');
                cmd = args.shift();
                this.child = childp.spawn(cmd, args, opt);
                pipe(previousChild, this.child.stdin, process.stderr);
                previousChild = this.child;
            }
            this.child.stdout.on('data', this.onStdOut);
            this.child.stderr.on('data', this.onStdErr);
            this.child.on('close', (function(_this) {
                return function(code) {
                    firstChild.kill();
                    return _this.onExit(code);
                };
            })(this));
        } else {
            this.child = childp.exec(this.cmd, {
                shell: true
            });
            this.child.stdout.on('data', this.onStdOut);
            this.child.stderr.on('data', this.onStdErr);
            this.child.on('close', this.onExit);
        }
        return true;
    };

    Shell.prototype.handleCancel = function() {
        if (!this.child) {
            return 'unhandled';
        }
        psTree(this.child.pid, (function(_this) {
            return function(err, children) {
                var arg, j, len, results;
                args = children.map(function(p) {
                    return p.PID;
                });
                args.unshift(_this.child.pid);
                args.reverse();
                _this.child.kill();
                results = [];
                for (j = 0, len = args.length; j < len; j++) {
                    arg = args[j];
                    results.push(klog(arg, wxw('terminate', arg)));
                }
                return results;
            };
        })(this));
        return true;
    };

    Shell.prototype.onExit = function(code) {
        var killed;
        killed = this.child.killed;
        delete this.child;
        if (code === 0 || killed) {
            return setImmediate(this.onDone);
        } else if (this.fallback()) {
            return this.dequeue();
        } else {
            klog('exit fail', this.last);
            this.term.failMeta(this.last.meta);
            if (!/is not recognized/.test(this.errorText)) {
                this.editor.appendOutput('\n' + this.errorText);
            }
            return this.dequeue('fail');
        }
    };

    Shell.prototype.fallback = function() {
        if (this.last.fallback) {
            klog('fallback', this.last.fallback);
            this.enqueue({
                cmd: this.last.fallback,
                update: true
            });
            delete this.last.fallback;
            return true;
        }
    };

    Shell.prototype.onDone = function(lastCode) {
        var info;
        if (lastCode !== 'fail') {
            if (this.last.meta != null) {
                info = _.clone(this.last);
                delete info.meta;
                post.emit('cmd', info);
                this.term.succMeta(this.last.meta);
            }
        }
        if (empty(this.queue) && empty(this.inputQueue)) {
            return this.term.pwd();
        } else {
            return this.dequeue();
        }
    };

    Shell.prototype.enqueue = function(arg1) {
        var cmd, front, ref1, ref2, ref3, update;
        cmd = (ref1 = arg1.cmd) != null ? ref1 : '', front = (ref2 = arg1.front) != null ? ref2 : false, update = (ref3 = arg1.update) != null ? ref3 : false;
        if (update) {
            this.last.cmd = cmd;
            if (this.last.meta) {
                this.editor.replaceTextInLine(this.last.meta[0], cmd);
                this.editor.meta.update(this.last.meta);
            }
        }
        cmd = cmd.replace(/\~/g, slash.home());
        if (front) {
            this.queue.unshift(cmd);
        } else {
            this.queue.push(cmd);
        }
        return cmd;
    };

    Shell.prototype.dequeue = function(lastCode) {
        var cmd;
        if (this.queue.length) {
            return this.executeCmd(this.queue.shift());
        } else if (this.inputQueue.length) {
            cmd = this.inputQueue.shift();
            this.editor.setInputText(cmd);
            return this.execute(cmd);
        } else {
            return this.onDone(lastCode);
        }
    };

    Shell.prototype.onStdOut = function(data) {
        if (data.replace == null) {
            data = data.toString('utf8');
        }
        if (data.slice(-1)[0] === '\n') {
            data = data.slice(0, +(data.length - 2) + 1 || 9e9);
        }
        this.editor.appendOutput(data);
        return this.editor.singleCursorAtEnd();
    };

    Shell.prototype.onStdErr = function(data) {
        return this.errorText += data;
    };

    return Shell;

})();

module.exports = Shell;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2hlbGwuanMiLCJzb3VyY2VSb290IjoiLiIsInNvdXJjZXMiOlsiIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUE7Ozs7Ozs7QUFBQSxJQUFBLGtHQUFBO0lBQUE7O0FBUUEsTUFBeUQsT0FBQSxDQUFRLEtBQVIsQ0FBekQsRUFBRSxlQUFGLEVBQVEscUJBQVIsRUFBaUIsbUJBQWpCLEVBQXlCLGlCQUF6QixFQUFnQyxpQkFBaEMsRUFBdUMsZUFBdkMsRUFBNkMsZUFBN0MsRUFBbUQ7O0FBRW5ELE9BQUEsR0FBVSxPQUFBLENBQVEsV0FBUjs7QUFDVixLQUFBLEdBQVUsT0FBQSxDQUFRLFNBQVI7O0FBQ1YsS0FBQSxHQUFVLE9BQUEsQ0FBUSxTQUFSOztBQUNWLE1BQUEsR0FBVSxPQUFBLENBQVEsU0FBUjs7QUFDVixHQUFBLEdBQVUsT0FBQSxDQUFRLEtBQVI7O0FBRUo7SUFFQyxlQUFDLElBQUQ7UUFBQyxJQUFDLENBQUEsT0FBRDs7Ozs7Ozs7OztRQUVBLElBQUMsQ0FBQSxNQUFELEdBQVUsSUFBQyxDQUFBLElBQUksQ0FBQztRQUNoQixJQUFDLENBQUEsS0FBRCxHQUFTLElBQUksS0FBSixDQUFVLElBQVY7UUFDVCxJQUFDLENBQUEsS0FBRCxHQUFTLElBQUksS0FBSixDQUFVLElBQVY7UUFDVCxJQUFDLENBQUEsS0FBRCxHQUFTO1FBQ1QsSUFBQyxDQUFBLFVBQUQsR0FBYztJQU5mOztvQkFRSCxFQUFBLEdBQUksU0FBQyxHQUFEO1FBRUEsSUFBRyxDQUFJLEtBQUssQ0FBQyxRQUFOLENBQWUsR0FBZixFQUFvQixPQUFPLENBQUMsR0FBUixDQUFBLENBQXBCLENBQVA7WUFDSSxJQUFDLENBQUEsVUFBRCxDQUFZLEtBQUEsR0FBUSxHQUFwQjttQkFDQSxJQUFDLENBQUEsTUFBTSxDQUFDLEtBQVIsQ0FBQSxFQUZKOztJQUZBOztvQkFNSixVQUFBLEdBQVksU0FBQyxHQUFEO1FBRVIsR0FBQSxHQUFNLElBQUMsQ0FBQSxLQUFLLENBQUMsVUFBUCxD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LENBQUEsVUFBVSxDQUFDLE1BQWY7WUFDRCxHQUFBLEdBQU0sSUFBQyxDQUFBLFVBQVUsQ0FBQyxLQUFaLENBQUE7WUFDTixJQUFDLENBQUEsTUFBTSxDQUFDLFlBQVIsQ0FBcUIsR0FBckI7bUJBQ0EsSUFBQyxDQUFBLE9BQUQsQ0FBUyxHQUFULEVBSEM7U0FBQSxNQUFBO21CQUtELElBQUMsQ0FBQSxNQUFELENBQVEsUUFBUixFQUxDOztJQUpBOztvQkFpQlQsUUFBQSxHQUFVLFNBQUMsSUFBRDtRQUVOLElBQU8sb0JBQVA7WUFDSSxJQUFBLEdBQU8sSUFBSSxDQUFDLFFBQUwsQ0FBYyxNQUFkLEVBRFg7O1FBRUEsSUFBRyxJQUFLLFVBQUUsQ0FBQSxDQUFBLENBQVAsS0FBWSxJQUFmO1lBQ0ksSUFBQSxHQUFPLElBQUsseUNBRGhCOztRQUdBLElBQUMsQ0FBQSxNQUFNLENBQUMsWUFBUixDQUFxQixJQUFyQjtlQUNBLElBQUMsQ0FBQSxNQUFNLENBQUMsaUJBQVIsQ0FBQTtJQVJNOztvQkFVVixRQUFBLEdBQVUsU0FBQyxJQUFEO2VBRU4sSUFBQyxDQUFBLFNBQUQsSUFBYztJQUZSOzs7Ozs7QUFJZCxNQUFNLENBQUMsT0FBUCxHQUFpQiIsInNvdXJjZXNDb250ZW50IjpbIiMjI1xuIDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwMDAwMDAgIDAwMCAgICAgIDAwMCAgICBcbjAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAgICAwMDAgICAgXG4wMDAwMDAwICAgMDAwMDAwMDAwICAwMDAwMDAwICAgMDAwICAgICAgMDAwICAgIFxuICAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgICAgIDAwMCAgICBcbjAwMDAwMDAgICAwMDAgICAwMDAgIDAwMDAwMDAwICAwMDAwMDAwICAwMDAwMDAwXG4jIyNcblxueyBwb3N0LCBoaXN0b3J5LCBjaGlsZHAsIHNsYXNoLCBlbXB0eSwgYXJncywga2xvZywgXyB9ID0gcmVxdWlyZSAna3hrJ1xuXG5IaXN0b3J5ID0gcmVxdWlyZSAnLi9oaXN0b3J5J1xuQWxpYXMgICA9IHJlcXVpcmUgJy4vYWxpYXMnXG5DaGRpciAgID0gcmVxdWlyZSAnLi9jaGRpcidcbnBzVHJlZSAgPSByZXF1aXJlICdwcy10cmVlJ1xud3h3ICAgICA9IHJlcXVpcmUgJ3d4dydcblxuY2xhc3MgU2hlbGxcblxuICAgIEA6IChAdGVybSkgLT5cbiAgICAgICAgXG4gICAgICAgIEBlZGl0b3IgPSBAdGVybS5lZGl0b3JcbiAgICAgICAgQGFsaWFzID0gbmV3IEFsaWFzIEBcbiAgICAgICAgQGNoZGlyID0gbmV3IENoZGlyIEBcbiAgICAgICAgQHF1ZXVlID0gW11cbiAgICAgICAgQGlucHV0UXVldWUgPSBbXVxuICAgICAgICBcbiAgICBjZDogKGRpcikgPT5cbiAgICAgICAgXG4gICAgICAgIGlmIG5vdCBzbGFzaC5zYW1lUGF0aCBkaXIsIHByb2Nlc3MuY3dkKClcbiAgICAgICAgICAgIEBleGVjdXRlQ21kICdjZCAnICsgZGlyXG4gICAgICAgICAgICBAZWRpdG9yLmZvY3VzKClcbiAgICAgICAgXG4gICAgc3Vic3RpdHV0ZTogKGNtZCkgLT5cbiAgICAgICAgXG4gICAgICAgIGNtZCA9IEBhbGlhcy5zdWJzdGl0dXRlIGNtZFxuICAgICAgICBjbWQgPSBjbWQucmVwbGFjZSAvXFx+L2csIHNsYXNoLmhvbWUoKVxuICAgICAgICBjbWRcbiAgICAgICAgICAgIFxuICAgICMgMDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwMDAwMDAgICAwMDAwMDAwICAwMDAgICAwMDAgIDAwMDAwMDAwMCAgMDAwMDAwMDAgIFxuICAgICMgMDAwICAgICAgICAwMDAgMDAwICAgMDAwICAgICAgIDAwMCAgICAgICAwMDAgICAwMDAgICAgIDAwMCAgICAgMDAwICAgICAgIFxuICAgICMgMDAwMDAwMCAgICAgMDAwMDAgICAgMDAwMDAwMCAgIDAwMCAgICAgICAwMDAgICAwMDAgICAgIDAwMCAgICAgMDAwMDAwMCAgIFxuICAgICMgMDAwICAgICAgICAwMDAgMDAwICAgMDAwICAgICAgIDAwMCAgICAgICAwMDAgICAwMDAgICAgIDAwMCAgICAgMDAwICAgICAgIFxuICAgICMgMDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwMDAwMDAgICAwMDAwMDAwICAgMDAwMDAwMCAgICAgIDAwMCAgICAgMDAwMDAwMDAgIFxuICAgIFxuICAgIGV4ZWN1dGU6IChAY21kOiwgZmFsbGJhY2s6KSA9PlxuICAgIFxuICAgICAgICBAY21kID89IEBlZGl0b3IubGFzdExpbmUoKVxuICAgICAgICBAY21kID0gQGNtZC50cmltKClcbiAgICAgICAgXG4gICAgICAgIGlmIEBjaGlsZFxuICAgICAgICAgICAgQGlucHV0UXVldWUucHVzaCBAY21kXG4gICAgICAgICAgICBAZWRpdG9yLnNldElucHV0VGV4dCAnJ1xuICAgICAgICAgICAgcmV0dXJuXG4gICAgICAgIFxuICAgICAgICBAZXJyb3JUZXh0ID0gJydcbiAgICAgICAgXG4gICAgICAgIGlmIEBjbWQgIT0gaHN1YiA9IEhpc3Rvcnkuc3Vic3RpdHV0ZSBAY21kXG4gICAgICAgICAgICBAY21kID0gaHN1YlxuICAgICAgICAgICAgQGVkaXRvci5zZXRJbnB1dFRleHQgQGNtZFxuICAgICAgICBcbiAgICAgICAgQGVkaXRvci5hcHBlbmRUZXh0ICcnXG4gICAgICAgIEBlZGl0b3Iuc2luZ2xlQ3Vyc29yQXRFbmQoKVxuICAgICAgICAgICAgXG4gICAgICAgIGlmIGVtcHR5IEBjbWQgdGhlbiByZXR1cm5cbiAgICAgICAgXG4gICAgICAgIEB0ZXJtLmhpc3Rvcnkuc2hlbGxDbWQgQGNtZCAjIG1pZ2h0IHJlc2V0IGhpc3RvcnkgcG9pbnRlciB0byBsYXN0XG5cbiAgICAgICAgQGxhc3QgPVxuICAgICAgICAgICAgY21kOiAgICAgIEBjbWRcbiAgICAgICAgICAgIGN3ZDogICAgICBzbGFzaC50aWxkZSBwcm9jZXNzLmN3ZCgpXG4gICAgICAgICAgICBtZXRhOiAgICAgQHRlcm0uaW5zZXJ0Q21kTWV0YSBAZWRpdG9yLm51bUxpbmVzKCktMiBAY21kXG4gICAgICAgICAgICBcbiAgICAgICAgQGxhc3QuZmFsbGJhY2sgPSBmYWxsYmFjayBpZiBmYWxsYmFja1xuICAgICAgICBcbiAgICAgICAgQGV4ZWN1dGVDbWQgQHN1YnN0aXR1dGUgQGNtZFxuICAgICAgICAgICAgICAgIFxuICAgICMgMDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwMDAwMDAgICAwMDAwMDAwICAgICAgICAwMDAwMDAwICAwMCAgICAgMDAgIDAwMDAwMDAgICAgXG4gICAgIyAwMDAgICAgICAgIDAwMCAwMDAgICAwMDAgICAgICAgMDAwICAgICAgICAgICAgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICBcbiAgICAjIDAwMDAwMDAgICAgIDAwMDAwICAgIDAwMDAwMDAgICAwMDAgICAgICAgICAgICAwMDAgICAgICAgMDAwMDAwMDAwICAwMDAgICAwMDAgIFxuICAgICMgMDAwICAgICAgICAwMDAgMDAwICAgMDAwICAgICAgIDAwMCAgICAgICAgICAgIDAwMCAgICAgICAwMDAgMCAwMDAgIDAwMCAgIDAwMCAgXG4gICAgIyAwMDAwMDAwMCAgMDAwICAgMDAwICAwMDAwMDAwMCAgIDAwMDAwMDAgICAgICAgIDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwMDAwMCAgICBcbiAgICBcbiAgICBleGVjdXRlQ21kOiAoQGNtZCkgPT5cbiAgICAgICAga2xvZyAnZXhlY3V0ZUNtZCcgQGNtZFxuICAgICAgICBzcGxpdCA9IEBjbWQuc3BsaXQgJyYmJ1xuICAgICAgICBpZiBzcGxpdC5sZW5ndGggPiAxXG4gICAgICAgICAgICBAY21kID0gc3BsaXRbMF0udHJpbSgpXG4gICAgICAgICAgICBAcXVldWUgPSBAcXVldWUuY29uY2F0IHNwbGl0WzEuLl1cbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgQGNtZCA9IEBjbWQudHJpbSgpXG4gICAgICAgIFxuICAgICAgICBpZiBlbXB0eSBAY21kXG4gICAgICAgICAgICBAZGVxdWV1ZSgpXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgICBcbiAgICAgICAgaWYgQGFsaWFzLm9uQ29tbWFuZCBAY21kXG4gICAgICAgICAgICBAZGVxdWV1ZSgpXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZVxuXG4gICAgICAgIGlmIEBjaGRpci5vbkNvbW1hbmQgQGNtZFxuICAgICAgICAgICAgXG4gICAgICAgICAgICBrbG9nICdjaGRpcicgQGNtZFxuICAgICAgICAgICAgQGRlcXVldWUoKVxuICAgICAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgICAgICAgIFxuICAgICAgICBrbG9nICdzaGVsbENtZCcgQGNtZCAgICBcbiAgICAgICAgQHNoZWxsQ21kIEBjbWRcbiAgICAgICAgICAgICAgICAgICAgXG4gICAgIyAgMDAwMDAwMCAgMDAwICAgMDAwICAwMDAwMDAwMCAgMDAwICAgICAgMDAwICAgICAgICAgICAwMDAwMDAwICAwMCAgICAgMDAgIDAwMDAwMDAgICAgXG4gICAgIyAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAgICAgMDAwICAgICAgMDAwICAgICAgICAgIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgXG4gICAgIyAwMDAwMDAwICAgMDAwMDAwMDAwICAwMDAwMDAwICAgMDAwICAgICAgMDAwICAgICAgICAgIDAwMCAgICAgICAwMDAwMDAwMDAgIDAwMCAgIDAwMCAgXG4gICAgIyAgICAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAgICAgMDAwICAgICAgMDAwICAgICAgICAgIDAwMCAgICAgICAwMDAgMCAwMDAgIDAwMCAgIDAwMCAgXG4gICAgIyAwMDAwMDAwICAgMDAwICAgMDAwICAwMDAwMDAwMCAgMDAwMDAwMCAgMDAwMDAwMCAgICAgICAwMDAwMDAwICAwMDAgICAwMDAgIDAwMDAwMDAgICAgXG4gICAgXG4gICAgc2hlbGxDbWQ6IChAY21kKSA9PlxuICAgICAgICAgICAgXG4gICAgICAgIHNwbGl0ID0gQGNtZC5zcGxpdCAnfCdcbiAgICAgICAgXG4gICAgICAgIGlmIHNwbGl0Lmxlbmd0aCA+IDFcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgIyAwMDAwMDAwMCAgIDAwMCAgMDAwMDAwMDAgICAwMDAwMDAwMCAgXG4gICAgICAgICAgICAjIDAwMCAgIDAwMCAgMDAwICAwMDAgICAwMDAgIDAwMCAgICAgICBcbiAgICAgICAgICAgICMgMDAwMDAwMDAgICAwMDAgIDAwMDAwMDAwICAgMDAwMDAwMCAgIFxuICAgICAgICAgICAgIyAwMDAgICAgICAgIDAwMCAgMDAwICAgICAgICAwMDAgICAgICAgXG4gICAgICAgICAgICAjIDAwMCAgICAgICAgMDAwICAwMDAgICAgICAgIDAwMDAwMDAwICBcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgcGlwZSA9IChjaGlsZCwgc3Rkb3V0LCBzdGRlcnIpIC0+XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgY2hpbGQuc3RkaW4ub24gJ2Vycm9yJyAoZXJyKSAtPiBzdGRlcnIud3JpdGUgJ3N0ZGluIGVycm9yJyArIGVyciArICdcXG4nXG4gICAgICAgICAgICAgICAgY2hpbGQuc3RkZXJyLm9uICdkYXRhJyAoZGF0YSkgLT4gaWYgbm90IC9eZXhlY3ZwXFwoXFwpLy50ZXN0IGRhdGEgdGhlbiBzdGRlcnIud3JpdGUgZGF0YVxuICAgICAgICAgICAgICAgIGNoaWxkLnN0ZG91dC5waXBlIHN0ZG91dFxuICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgY2hpbGQub24gJ2Vycm9yJyAoZXJyKSAtPlxuICAgICAgICAgICAgICAgICAgICBwcm9jZXNzLnN0ZGVyci53cml0ZSAnRmFpbGVkIHRvIGV4ZWN1dGUgJyArIGVyciArICdcXG4nXG4gICAgICAgICAgICAgICAgICAgIGZpcnN0Q2hpbGQua2lsbCgpXG5cbiAgICAgICAgICAgIGN1cnJlbnRDb21tYW5kID0gc3BsaXRbMF1cbiAgICAgICAgICAgIGFyZ3MgPSBjdXJyZW50Q29tbWFuZC5zcGxpdCAnICdcbiAgICAgICAgICAgIGNtZCA9IGFyZ3Muc2hpZnQoKVxuICAgICAgICAgICAgb3B0ID0gZW5jb2Rpbmc6J3V0ZjgnIHNoZWxsOnRydWVcbiAgICAgICAgICAgIGZpcnN0Q2hpbGQgPSBwcmV2aW91c0NoaWxkID0gQGNoaWxkID0gY2hpbGRwLnNwYXduIGNtZCwgYXJncywgb3B0XG4gICAgICAgIFxuICAgICAgICAgICAgZm9yIGkgaW4gWzEuLi5zcGxpdC5sZW5ndGhdXG4gICAgICAgICAgICAgICAgY3VycmVudENvbW1hbmQgPSBzcGxpdFtpXS50cmltKClcbiAgICAgICAgICAgICAgICBhcmdzID0gY3VycmVudENvbW1hbmQuc3BsaXQgJyAnXG4gICAgICAgICAgICAgICAgY21kID0gYXJncy5zaGlmdCgpXG4gICAgICAgICAgICAgICAgQGNoaWxkID0gY2hpbGRwLnNwYXduIGNtZCwgYXJncywgb3B0XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgcGlwZSBwcmV2aW91c0NoaWxkLCBAY2hpbGQuc3RkaW4sIHByb2Nlc3Muc3RkZXJyXG4gICAgICAgIFxuICAgICAgICAgICAgICAgIHByZXZpb3VzQ2hpbGQgPSBAY2hpbGRcbiAgICAgICAgXG4gICAgICAgICAgICBAY2hpbGQuc3Rkb3V0Lm9uICdkYXRhJyBAb25TdGRPdXRcbiAgICAgICAgICAgIEBjaGlsZC5zdGRlcnIub24gJ2RhdGEnIEBvblN0ZEVyclxuICAgICAgICBcbiAgICAgICAgICAgIEBjaGlsZC5vbiAnY2xvc2UnIChjb2RlKSA9PlxuICAgICAgICAgICAgICAgIGZpcnN0Q2hpbGQua2lsbCgpXG4gICAgICAgICAgICAgICAgQG9uRXhpdCBjb2RlXG4gICAgICAgIGVsc2VcbiAgICAgICAgXG4gICAgICAgICAgICAjIDAwMDAwMDAwICAwMDAgICAwMDAgIDAwMDAwMDAwICAgMDAwMDAwMCAgXG4gICAgICAgICAgICAjIDAwMCAgICAgICAgMDAwIDAwMCAgIDAwMCAgICAgICAwMDAgICAgICAgXG4gICAgICAgICAgICAjIDAwMDAwMDAgICAgIDAwMDAwICAgIDAwMDAwMDAgICAwMDAgICAgICAgXG4gICAgICAgICAgICAjIDAwMCAgICAgICAgMDAwIDAwMCAgIDAwMCAgICAgICAwMDAgICAgICAgXG4gICAgICAgICAgICAjIDAwMDAwMDAwICAwMDAgICAwMDAgIDAwMDAwMDAwICAgMDAwMDAwMCAgXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIEBjaGlsZCA9IGNoaWxkcC5leGVjIEBjbWQsIHNoZWxsOnRydWVcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgQGNoaWxkLnN0ZG91dC5vbiAnZGF0YScgIEBvblN0ZE91dFxuICAgICAgICAgICAgQGNoaWxkLnN0ZGVyci5vbiAnZGF0YScgIEBvblN0ZEVyclxuICAgICAgICAgICAgQGNoaWxkLm9uICAgICAgICAnY2xvc2UnIEBvbkV4aXRcbiAgICAgICAgICAgIFxuICAgICAgICB0cnVlXG4gICAgICAgIFxuICAgICMgIDAwMDAwMDAgICAwMDAwMDAwICAgMDAwICAgMDAwICAgMDAwMDAwMCAgMDAwMDAwMDAgIDAwMCAgICAgIFxuICAgICMgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwMCAgMDAwICAwMDAgICAgICAgMDAwICAgICAgIDAwMCAgICAgIFxuICAgICMgMDAwICAgICAgIDAwMDAwMDAwMCAgMDAwIDAgMDAwICAwMDAgICAgICAgMDAwMDAwMCAgIDAwMCAgICAgIFxuICAgICMgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAwMDAwICAwMDAgICAgICAgMDAwICAgICAgIDAwMCAgICAgIFxuICAgICMgIDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAgMDAwMDAwMCAgMDAwMDAwMDAgIDAwMDAwMDAgIFxuICAgIFxuICAgIGhhbmRsZUNhbmNlbDogLT5cbiAgICAgICAgXG4gICAgICAgIHJldHVybiAndW5oYW5kbGVkJyBpZiBub3QgQGNoaWxkXG4gICAgICAgIFxuICAgICAgICBwc1RyZWUgQGNoaWxkLnBpZCwgKGVyciwgY2hpbGRyZW4pID0+XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGFyZ3MgPSBjaGlsZHJlbi5tYXAgKHApIC0+IHAuUElEXG4gICAgICAgICAgICBhcmdzLnVuc2hpZnQgQGNoaWxkLnBpZFxuICAgICAgICAgICAgYXJncy5yZXZlcnNlKClcbiAgICAgICAgICAgIEBjaGlsZC5raWxsKClcbiAgICAgICAgICAgIGZvciBhcmcgaW4gYXJnc1xuICAgICAgICAgICAgICAgIGtsb2cgYXJnLCB3eHcgJ3Rlcm1pbmF0ZScgYXJnXG4gICAgICAgIHRydWVcbiAgICAgICAgXG4gICAgIyAwMDAwMDAwMCAgMDAwICAgMDAwICAwMDAgIDAwMDAwMDAwMCAgXG4gICAgIyAwMDAgICAgICAgIDAwMCAwMDAgICAwMDAgICAgIDAwMCAgICAgXG4gICAgIyAwMDAwMDAwICAgICAwMDAwMCAgICAwMDAgICAgIDAwMCAgICAgXG4gICAgIyAwMDAgICAgICAgIDAwMCAwMDAgICAwMDAgICAgIDAwMCAgICAgXG4gICAgIyAwMDAwMDAwMCAgMDAwICAgMDAwICAwMDAgICAgIDAwMCAgICAgXG4gICAgICAgIFxuICAgIG9uRXhpdDogKGNvZGUpID0+XG5cbiAgICAgICAga2lsbGVkID0gQGNoaWxkLmtpbGxlZFxuICAgICAgICAjIGtsb2cgJ29uRXhpdCcgQGNoaWxkLnBpZCwga2lsbGVkIGFuZCAna2lsbGVkJyBvciBjb2RlXG4gICAgICAgIGRlbGV0ZSBAY2hpbGRcbiAgICAgICAgaWYgY29kZSA9PSAwIG9yIGtpbGxlZCBcbiAgICAgICAgICAgIHNldEltbWVkaWF0ZSBAb25Eb25lXG4gICAgICAgIGVsc2UgaWYgQGZhbGxiYWNrKClcbiAgICAgICAgICAgIEBkZXF1ZXVlKClcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAga2xvZyAnZXhpdCBmYWlsJyBAbGFzdFxuICAgICAgICAgICAgQHRlcm0uZmFpbE1ldGEgQGxhc3QubWV0YVxuICAgICAgICAgICAgaWYgbm90IC9pcyBub3QgcmVjb2duaXplZC8udGVzdCBAZXJyb3JUZXh0XG4gICAgICAgICAgICAgICAgQGVkaXRvci5hcHBlbmRPdXRwdXQgJ1xcbicrQGVycm9yVGV4dFxuICAgICAgICAgICAgQGRlcXVldWUgJ2ZhaWwnXG4gICAgICAgICAgXG4gICAgIyAwMDAwMDAwMCAgIDAwMDAwMDAgICAwMDAgICAgICAwMDAgICAgICAwMDAwMDAwICAgICAwMDAwMDAwICAgIDAwMDAwMDAgIDAwMCAgIDAwMCAgXG4gICAgIyAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAgICAwMDAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgMDAwICAgXG4gICAgIyAwMDAwMDAgICAgMDAwMDAwMDAwICAwMDAgICAgICAwMDAgICAgICAwMDAwMDAwICAgIDAwMDAwMDAwMCAgMDAwICAgICAgIDAwMDAwMDAgICAgXG4gICAgIyAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAgICAwMDAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgMDAwICAgXG4gICAgIyAwMDAgICAgICAgMDAwICAgMDAwICAwMDAwMDAwICAwMDAwMDAwICAwMDAwMDAwICAgIDAwMCAgIDAwMCAgIDAwMDAwMDAgIDAwMCAgIDAwMCAgXG4gICAgXG4gICAgZmFsbGJhY2s6IC0+XG4gICAgICAgIFxuICAgICAgICBpZiBAbGFzdC5mYWxsYmFja1xuICAgICAgICAgICAga2xvZyAnZmFsbGJhY2snIEBsYXN0LmZhbGxiYWNrXG4gICAgICAgICAgICBAZW5xdWV1ZSBjbWQ6QGxhc3QuZmFsbGJhY2ssIHVwZGF0ZTp0cnVlXG4gICAgICAgICAgICBkZWxldGUgQGxhc3QuZmFsbGJhY2tcbiAgICAgICAgICAgIHJldHVybiB0cnVlXG4gICAgICAgIFxuICAgICMgMDAwMDAwMCAgICAgMDAwMDAwMCAgIDAwMCAgIDAwMCAgMDAwMDAwMDAgIFxuICAgICMgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMDAgIDAwMCAgMDAwICAgICAgIFxuICAgICMgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAwIDAwMCAgMDAwMDAwMCAgIFxuICAgICMgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgMDAwMCAgMDAwICAgICAgIFxuICAgICMgMDAwMDAwMCAgICAgMDAwMDAwMCAgIDAwMCAgIDAwMCAgMDAwMDAwMDAgIFxuICAgIFxuICAgIG9uRG9uZTogKGxhc3RDb2RlKSA9PlxuXG4gICAgICAgIGlmIGxhc3RDb2RlICE9ICdmYWlsJyBcbiAgICAgICAgICAgIGlmIEBsYXN0Lm1ldGE/XG4gICAgICAgICAgICAgICAgaW5mbyA9IF8uY2xvbmUgQGxhc3RcbiAgICAgICAgICAgICAgICBkZWxldGUgaW5mby5tZXRhXG4gICAgICAgICAgICAgICAgcG9zdC5lbWl0ICdjbWQnIGluZm8gIyBpbnNlcnQgaW50byBnbG9iYWwgaGlzdG9yeSBhbmQgYnJhaW5cbiAgICAgICAgICAgICAgICBAdGVybS5zdWNjTWV0YSBAbGFzdC5tZXRhXG4gICAgICAgIGlmIGVtcHR5KEBxdWV1ZSkgYW5kIGVtcHR5KEBpbnB1dFF1ZXVlKVxuICAgICAgICAgICAgQHRlcm0ucHdkKClcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgQGRlcXVldWUoKVxuICAgICAgICAgICBcbiAgICAjIDAwMDAwMDAwICAwMDAgICAwMDAgICAwMDAwMDAwICAgMDAwICAgMDAwICAwMDAwMDAwMCAgMDAwICAgMDAwICAwMDAwMDAwMCAgXG4gICAgIyAwMDAgICAgICAgMDAwMCAgMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgICAgIFxuICAgICMgMDAwMDAwMCAgIDAwMCAwIDAwMCAgMDAwIDAwIDAwICAwMDAgICAwMDAgIDAwMDAwMDAgICAwMDAgICAwMDAgIDAwMDAwMDAgICBcbiAgICAjIDAwMCAgICAgICAwMDAgIDAwMDAgIDAwMCAwMDAwICAgMDAwICAgMDAwICAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAgICAgXG4gICAgIyAwMDAwMDAwMCAgMDAwICAgMDAwICAgMDAwMDAgMDAgICAwMDAwMDAwICAgMDAwMDAwMDAgICAwMDAwMDAwICAgMDAwMDAwMDAgIFxuICAgIFxuICAgIGVucXVldWU6IChjbWQ6JycgZnJvbnQ6ZmFsc2UgdXBkYXRlOmZhbHNlKSAtPiBcbiAgICBcbiAgICAgICAgaWYgdXBkYXRlXG4gICAgICAgICAgICBAbGFzdC5jbWQgPSBjbWRcbiAgICAgICAgICAgIGlmIEBsYXN0Lm1ldGFcbiAgICAgICAgICAgICAgICBAZWRpdG9yLnJlcGxhY2VUZXh0SW5MaW5lIEBsYXN0Lm1ldGFbMF0sIGNtZFxuICAgICAgICAgICAgICAgIEBlZGl0b3IubWV0YS51cGRhdGUgQGxhc3QubWV0YVxuICAgICAgICAgICAgXG4gICAgICAgIGNtZCA9IGNtZC5yZXBsYWNlIC9cXH4vZywgc2xhc2guaG9tZSgpXG4gICAgICAgIFxuICAgICAgICBpZiBmcm9udFxuICAgICAgICAgICAgQHF1ZXVlLnVuc2hpZnQgY21kXG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIEBxdWV1ZS5wdXNoIGNtZFxuICAgICAgICBjbWRcbiAgICAgICAgICAgICAgICAgICAgXG4gICAgIyAwMDAwMDAwICAgIDAwMDAwMDAwICAgMDAwMDAwMCAgIDAwMCAgIDAwMCAgMDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwMDAwMDAgIFxuICAgICMgMDAwICAgMDAwICAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgICAgICBcbiAgICAjIDAwMCAgIDAwMCAgMDAwMDAwMCAgIDAwMCAwMCAwMCAgMDAwICAgMDAwICAwMDAwMDAwICAgMDAwICAgMDAwICAwMDAwMDAwICAgXG4gICAgIyAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgMDAwMCAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgICAgIFxuICAgICMgMDAwMDAwMCAgICAwMDAwMDAwMCAgIDAwMDAwIDAwICAgMDAwMDAwMCAgIDAwMDAwMDAwICAgMDAwMDAwMCAgIDAwMDAwMDAwICBcbiAgICBcbiAgICBkZXF1ZXVlOiAobGFzdENvZGUpID0+XG4gXG4gICAgICAgIGlmIEBxdWV1ZS5sZW5ndGhcbiAgICAgICAgICAgIEBleGVjdXRlQ21kIEBxdWV1ZS5zaGlmdCgpXG4gICAgICAgIGVsc2UgaWYgQGlucHV0UXVldWUubGVuZ3RoXG4gICAgICAgICAgICBjbWQgPSBAaW5wdXRRdWV1ZS5zaGlmdCgpXG4gICAgICAgICAgICBAZWRpdG9yLnNldElucHV0VGV4dCBjbWRcbiAgICAgICAgICAgIEBleGVjdXRlIGNtZFxuICAgICAgICBlbHNlXG4gICAgICAgICAgICBAb25Eb25lIGxhc3RDb2RlXG4gICAgICAgIFxuICAgICMgIDAwMDAwMDAgIDAwMDAwMDAwMCAgMDAwMDAwMCAgICBcbiAgICAjIDAwMCAgICAgICAgICAwMDAgICAgIDAwMCAgIDAwMCAgXG4gICAgIyAwMDAwMDAwICAgICAgMDAwICAgICAwMDAgICAwMDAgIFxuICAgICMgICAgICAwMDAgICAgIDAwMCAgICAgMDAwICAgMDAwICBcbiAgICAjIDAwMDAwMDAgICAgICAwMDAgICAgIDAwMDAwMDAgICAgXG4gICAgXG4gICAgb25TdGRPdXQ6IChkYXRhKSA9PlxuICAgICAgICBcbiAgICAgICAgaWYgbm90IGRhdGEucmVwbGFjZT9cbiAgICAgICAgICAgIGRhdGEgPSBkYXRhLnRvU3RyaW5nICd1dGY4J1xuICAgICAgICBpZiBkYXRhWy0xXSA9PSAnXFxuJ1xuICAgICAgICAgICAgZGF0YSA9IGRhdGFbMC4uZGF0YS5sZW5ndGgtMl1cbiAgICAgICAgICAgIFxuICAgICAgICBAZWRpdG9yLmFwcGVuZE91dHB1dCBkYXRhXG4gICAgICAgIEBlZGl0b3Iuc2luZ2xlQ3Vyc29yQXRFbmQoKVxuXG4gICAgb25TdGRFcnI6IChkYXRhKSA9PlxuXG4gICAgICAgIEBlcnJvclRleHQgKz0gZGF0YVxuICAgICAgICBcbm1vZHVsZS5leHBvcnRzID0gU2hlbGxcbiJdfQ==
//# sourceURL=../coffee/shell.coffee