// koffee 1.12.0

/*
 0000000  000   000  00000000  000      000    
000       000   000  000       000      000    
0000000   000000000  0000000   000      000    
     000  000   000  000       000      000    
0000000   000   000  00000000  0000000  0000000
 */
var Alias, Chdir, History, Paths, Shell, _, args, childp, empty, history, klog, post, psTree, ref, slash, valid, wxw,
    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

ref = require('kxk'), _ = ref._, args = ref.args, childp = ref.childp, empty = ref.empty, history = ref.history, klog = ref.klog, post = ref.post, slash = ref.slash, valid = ref.valid;

History = require('./history');

Alias = require('./alias');

Chdir = require('./chdir');

Paths = require('./paths');

psTree = require('ps-tree');

wxw = require('wxw');

Shell = (function() {
    function Shell(term) {
        this.term = term;
        this.onStdErr = bind(this.onStdErr, this);
        this.onStdOut = bind(this.onStdOut, this);
        this.dequeue = bind(this.dequeue, this);
        this.onDone = bind(this.onDone, this);
        this.onExit = bind(this.onExit, this);
        this.shellCmd = bind(this.shellCmd, this);
        this.executeCmd = bind(this.executeCmd, this);
        this.execute = bind(this.execute, this);
        this.cd = bind(this.cd, this);
        this.shellPath = 'C:/msys64/usr/bin/bash.exe';
        if (!slash.fileExists(this.shellPath)) {
            this.shellPath = true;
        }
        this.editor = this.term.editor;
        this.alias = new Alias(this);
        this.chdir = new Chdir(this);
        this.paths = new Paths(this);
        this.queue = [];
        this.inputQueue = [];
        this.paths.init();
    }

    Shell.prototype.cd = function(dir) {
        if (!slash.samePath(dir, process.cwd())) {
            this.executeCmd('cd ' + dir);
            return this.editor.focus();
        }
    };

    Shell.prototype.substitute = function(cmd) {
        cmd = this.alias.substitute(cmd);
        cmd = cmd.replace(/\~/g, slash.home());
        return cmd;
    };

    Shell.prototype.execute = function(arg1) {
        var fallback, hsub, ref1, ref2;
        this.cmd = (ref1 = arg1.cmd) != null ? ref1 : null, fallback = (ref2 = arg1.fallback) != null ? ref2 : null;
        if (this.cmd != null) {
            this.cmd;
        } else {
            this.cmd = this.editor.lastLine();
        }
        this.cmd = this.cmd.trim();
        if (this.cmd === '.' && valid(fallback)) {
            this.cmd = fallback;
        }
        if (this.child) {
            this.inputQueue.push(this.cmd);
            this.editor.setInputText('');
            return;
        }
        this.errorText = '';
        if (this.cmd !== (hsub = History.substitute(this.cmd))) {
            this.cmd = hsub;
            this.editor.setInputText(this.cmd);
        }
        this.editor.appendText('');
        this.editor.singleCursorAtEnd();
        if (empty(this.cmd)) {
            this.term.moveInputMeta();
            return;
        }
        this.term.history.shellCmd(this.cmd);
        this.last = {
            cmd: this.cmd,
            cwd: slash.tilde(process.cwd()),
            meta: this.term.insertCmdMeta(this.editor.numLines() - 2, this.cmd)
        };
        if (fallback) {
            this.last.fallback = fallback;
        }
        return this.executeCmd(this.substitute(this.cmd));
    };

    Shell.prototype.executeCmd = function(cmd1) {
        var split;
        this.cmd = cmd1;
        split = this.cmd.split('&&');
        if (split.length > 1) {
            this.cmd = split[0].trim();
            this.queue = this.queue.concat(split.slice(1));
        } else {
            this.cmd = this.cmd.trim();
        }
        if (empty(this.cmd)) {
            this.dequeue();
            return true;
        }
        if (this.alias.onCommand(this.cmd)) {
            this.dequeue();
            return true;
        }
        if (this.chdir.onCommand(this.cmd)) {
            this.dequeue();
            return true;
        }
        return this.shellCmd(this.cmd);
    };

    Shell.prototype.seperateCmdArgs = function(cmd) {
        var exe, i, n, next;
        next = function(c, s) {
            var n;
            n = cmd.indexOf(c, s + 1);
            if (n < 0) {
                n = cmd.length;
            }
            return n;
        };
        i = next(' ', 0);
        n = next('"', -1);
        if (n < i) {
            i = 1 + next('"', n);
        }
        exe = cmd.slice(0, i);
        args = [];
        while (i++ < cmd.length) {
            if (cmd[i] !== ' ') {
                if (cmd[i] === '"') {
                    n = next('"', i);
                    args.push(cmd.slice(i, n));
                } else {
                    n = next(' ', i);
                    args.push(cmd.slice(i, n));
                }
                i = n;
            }
        }
        return [exe, args];
    };

    Shell.prototype.shellCmd = function(cmd1) {
        var cmd, ref1;
        this.cmd = cmd1;
        process.env.LINES = this.editor.scroll.fullLines;
        process.env.COLUMNS = parseInt(this.editor.layersWidth / this.editor.size.charWidth);
        process.env.ADBLOCK = true;
        if (this.cmd.endsWith('&')) {
            ref1 = this.seperateCmdArgs(this.cmd.slice(0, this.cmd.length - 1)), cmd = ref1[0], args = ref1[1];
            this.spawn = childp.spawn(cmd, args, {
                detached: true,
                shell: this.shellPath,
                env: process.env,
                cwd: process.cwd()
            });
            this.last.meta.pid = this.spawn.pid;
            this.spawn.on('close', ((function(_this) {
                return function(pid) {
                    return function(code) {
                        var j, len, meta, ref2, results;
                        klog('spawn exit', code, pid);
                        ref2 = _this.editor.meta.metasOfClass('succ');
                        results = [];
                        for (j = 0, len = ref2.length; j < len; j++) {
                            meta = ref2[j];
                            if (meta.pid === pid) {
                                meta[2].number.text = 'â–¶';
                                meta[2].number.clss = 'succ';
                                _this.editor.meta.update(meta);
                                break;
                            } else {
                                results.push(void 0);
                            }
                        }
                        return results;
                    };
                };
            })(this))(this.spawn.pid));
            this.onDone('busy');
        } else {
            this.child = childp.exec(this.cmd, {
                shell: this.shellPath,
                env: process.env,
                cwd: process.cwd()
            });
            this.child.stdout.on('data', this.onStdOut);
            this.child.stderr.on('data', this.onStdErr);
            this.child.on('close', this.onExit);
        }
        return true;
    };

    Shell.prototype.handleCancel = function() {
        this.queue = [];
        this.inputQueue = [];
        if (!this.child) {
            klog('no child?');
            return 'unhandled';
        }
        psTree(this.child.pid, (function(_this) {
            return function(err, children) {
                var arg, j, len, results;
                args = children.map(function(p) {
                    return p.PID;
                });
                args.unshift(_this.child.pid);
                args.reverse();
                _this.child.kill();
                results = [];
                for (j = 0, len = args.length; j < len; j++) {
                    arg = args[j];
                    results.push(wxw('terminate', arg));
                }
                return results;
            };
        })(this));
        return true;
    };

    Shell.prototype.onExit = function(code) {
        var killed;
        killed = this.child.killed;
        delete this.child;
        if (code === 0 || killed) {
            return setImmediate(this.onDone);
        } else if (this.fallback()) {
            return this.dequeue();
        } else {
            this.term.failMeta(this.last.meta);
            if (!/is not recognized/.test(this.errorText)) {
                this.editor.appendOutput('\n' + this.errorText);
            }
            return this.dequeue('fail');
        }
    };

    Shell.prototype.fallback = function() {
        if (this.last.fallback) {
            klog('fallback', this.last.fallback);
            this.enqueue({
                cmd: this.last.fallback,
                update: true
            });
            delete this.last.fallback;
            return true;
        }
    };

    Shell.prototype.onDone = function(lastCode) {
        var info, ref1;
        info = _.clone(this.last);
        delete info.meta;
        post.emit('cmd', info);
        if (lastCode !== 'fail') {
            if (((ref1 = this.last) != null ? ref1.meta : void 0) != null) {
                this.term.succMeta(this.last.meta, lastCode);
            }
        }
        if (empty(this.queue) && empty(this.inputQueue)) {
            return this.term.pwd();
        } else {
            return this.dequeue();
        }
    };

    Shell.prototype.enqueue = function(arg1) {
        var alias, cmd, front, ref1, ref2, ref3, ref4, update;
        cmd = (ref1 = arg1.cmd) != null ? ref1 : '', front = (ref2 = arg1.front) != null ? ref2 : false, update = (ref3 = arg1.update) != null ? ref3 : false, alias = (ref4 = arg1.alias) != null ? ref4 : false;
        if (update) {
            this.last.orig = this.last.cmd;
            this.last.cmd = cmd;
            if (this.last.meta) {
                this.editor.replaceTextInLine(this.last.meta[0], cmd);
                this.editor.meta.update(this.last.meta);
            }
        }
        if (alias) {
            this.last.alias = cmd;
        }
        cmd = cmd.replace(/\~/g, slash.home());
        if (front) {
            this.queue.unshift(cmd);
        } else {
            this.queue.push(cmd);
        }
        return cmd;
    };

    Shell.prototype.dequeue = function(lastCode) {
        var cmd;
        if (this.queue.length) {
            return this.executeCmd(this.queue.shift());
        } else if (this.inputQueue.length) {
            cmd = this.inputQueue.shift();
            this.editor.setInputText(cmd);
            return this.execute(cmd);
        } else {
            return this.onDone(lastCode);
        }
    };

    Shell.prototype.onStdOut = function(data) {
        if (data.slice(-1)[0] === '\n') {
            data = data.slice(0, +(data.length - 2) + 1 || 9e9);
        }
        this.editor.appendOutput(data);
        return this.editor.singleCursorAtEnd();
    };

    Shell.prototype.onStdErr = function(data) {
        var c, i, path;
        if (data.startsWith('\x1b]0;')) {
            klog('bash prompt');
            data = data.slice(4);
            i = 0;
            c = data[0];
            path = '';
            while (c !== '\x07') {
                path += c;
                c = data[i++];
            }
            klog('path', path);
            return this.editor.appendOutput(data.slice(i));
        } else {
            return this.errorText += data;
        }
    };

    return Shell;

})();

module.exports = Shell;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2hlbGwuanMiLCJzb3VyY2VSb290IjoiLi4vY29mZmVlIiwic291cmNlcyI6WyJzaGVsbC5jb2ZmZWUiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQTs7Ozs7OztBQUFBLElBQUEsZ0hBQUE7SUFBQTs7QUFRQSxNQUFnRSxPQUFBLENBQVEsS0FBUixDQUFoRSxFQUFFLFNBQUYsRUFBSyxlQUFMLEVBQVcsbUJBQVgsRUFBbUIsaUJBQW5CLEVBQTBCLHFCQUExQixFQUFtQyxlQUFuQyxFQUF5QyxlQUF6QyxFQUErQyxpQkFBL0MsRUFBc0Q7O0FBRXRELE9BQUEsR0FBVSxPQUFBLENBQVEsV0FBUjs7QUFDVixLQUFBLEdBQVUsT0FBQSxDQUFRLFNBQVI7O0FBQ1YsS0FBQSxHQUFVLE9BQUEsQ0FBUSxTQUFSOztBQUNWLEtBQUEsR0FBVSxPQUFBLENBQVEsU0FBUjs7QUFDVixNQUFBLEdBQVUsT0FBQSxDQUFRLFNBQVI7O0FBQ1YsR0FBQSxHQUFVLE9BQUEsQ0FBUSxLQUFSOztBQUVKO0lBRUMsZUFBQyxJQUFEO1FBQUMsSUFBQyxDQUFBLE9BQUQ7Ozs7Ozs7Ozs7UUFFQSxJQUFDLENBQUEsU0FBRCxHQUFhO1FBQ2IsSUFBRyxDQUFJLEtBQUssQ0FBQyxVQUFOLENBQWlCLElBQUMsQ0FBQSxTQUFsQixDQUFQO1lBQ0ksSUFBQyxDQUFBLFNBQUQsR0FBYSxLQURqQjs7UUFHQSxJQUFDLENBQUEsTUFBRCxHQUFVLElBQUMsQ0FBQSxJQUFJLENBQUM7UUFDaEIsSUFBQyxDQUFBLEtBQUQsR0FBUyxJQUFJLEtBQUosQ0FBVSxJQUFWO1FBQ1QsSUFBQyxDQUFBLEtBQUQsR0FBUyxJQUFJLEtBQUosQ0FBVSxJQUFWO1FBQ1QsSUFBQyxDQUFBLEtBQUQsR0FBUyxJQUFJLEtBQUosQ0FBVSxJQUFWO1FBQ1QsSUFBQyxDQUFBLEtBQUQsR0FBUztRQUNULElBQUMsQ0FBQSxVQUFELEdBQWM7UUFFZCxJQUFDLENBQUEsS0FBSyxDQUFDLElBQVAsQ0FBQTtJQWJEOztvQkFl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QSxVQUFVLENBQUMsS0FBWixDQUFBO1lBQ04sSUFBQyxDQUFBLE1BQU0sQ0FBQyxZQUFSLENBQXFCLEdBQXJCO21CQUNBLElBQUMsQ0FBQSxPQUFELENBQVMsR0FBVCxFQUhDO1NBQUEsTUFBQTttQkFLRCxJQUFDLENBQUEsTUFBRCxDQUFRLFFBQVIsRUFMQzs7SUFKQTs7b0JBaUJULFFBQUEsR0FBVSxTQUFDLElBQUQ7UUFFTixJQUFHLElBQUssVUFBRSxDQUFBLENBQUEsQ0FBUCxLQUFZLElBQWY7WUFDSSxJQUFBLEdBQU8sSUFBSyx5Q0FEaEI7O1FBV0EsSUFBQyxDQUFBLE1BQU0sQ0FBQyxZQUFSLENBQXFCLElBQXJCO2VBRUEsSUFBQyxDQUFBLE1BQU0sQ0FBQyxpQkFBUixDQUFBO0lBZk07O29CQWlCVixRQUFBLEdBQVUsU0FBQyxJQUFEO0FBUU4sWUFBQTtRQUFBLElBQUcsSUFBSSxDQUFDLFVBQUwsQ0FBZ0IsU0FBaEIsQ0FBSDtZQUNJLElBQUEsQ0FBSyxhQUFMO1lBQ0EsSUFBQSxHQUFPLElBQUs7WUFDWixDQUFBLEdBQUk7WUFDSixDQUFBLEdBQUksSUFBSyxDQUFBLENBQUE7WUFDVCxJQUFBLEdBQU87QUFDUCxtQkFBTSxDQUFBLEtBQUssTUFBWDtnQkFDSSxJQUFBLElBQVE7Z0JBQ1IsQ0FBQSxHQUFJLElBQUssQ0FBQSxDQUFBLEVBQUE7WUFGYjtZQUdBLElBQUEsQ0FBSyxNQUFMLEVBQVksSUFBWjttQkFDQSxJQUFDLENBQUEsTUFBTSxDQUFDLFlBQVIsQ0FBcUIsSUFBSyxTQUExQixFQVZKO1NBQUEsTUFBQTttQkFZSSxJQUFDLENBQUEsU0FBRCxJQUFjLEtBWmxCOztJQVJNOzs7Ozs7QUFzQmQsTUFBTSxDQUFDLE9BQVAsR0FBaUIiLCJzb3VyY2VzQ29udGVudCI6WyIjIyNcbiAwMDAwMDAwICAwMDAgICAwMDAgIDAwMDAwMDAwICAwMDAgICAgICAwMDAgICAgXG4wMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAgICAgMDAwICAgICAgMDAwICAgIFxuMDAwMDAwMCAgIDAwMDAwMDAwMCAgMDAwMDAwMCAgIDAwMCAgICAgIDAwMCAgICBcbiAgICAgMDAwICAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAgICAwMDAgICAgXG4wMDAwMDAwICAgMDAwICAgMDAwICAwMDAwMDAwMCAgMDAwMDAwMCAgMDAwMDAwMFxuIyMjXG5cbnsgXywgYXJncywgY2hpbGRwLCBlbXB0eSwgaGlzdG9yeSwga2xvZywgcG9zdCwgc2xhc2gsIHZhbGlkIH0gPSByZXF1aXJlICdreGsnXG5cbkhpc3RvcnkgPSByZXF1aXJlICcuL2hpc3RvcnknXG5BbGlhcyAgID0gcmVxdWlyZSAnLi9hbGlhcydcbkNoZGlyICAgPSByZXF1aXJlICcuL2NoZGlyJ1xuUGF0aHMgICA9IHJlcXVpcmUgJy4vcGF0aHMnXG5wc1RyZWUgID0gcmVxdWlyZSAncHMtdHJlZSdcbnd4dyAgICAgPSByZXF1aXJlICd3eHcnXG5cbmNsYXNzIFNoZWxsXG5cbiAgICBAOiAoQHRlcm0pIC0+XG4gICAgICAgIFxuICAgICAgICBAc2hlbGxQYXRoID0gJ0M6L21zeXM2NC91c3IvYmluL2Jhc2guZXhlJ1xuICAgICAgICBpZiBub3Qgc2xhc2guZmlsZUV4aXN0cyBAc2hlbGxQYXRoXG4gICAgICAgICAgICBAc2hlbGxQYXRoID0gdHJ1ZVxuICAgICAgICBcbiAgICAgICAgQGVkaXRvciA9IEB0ZXJtLmVkaXRvclxuICAgICAgICBAYWxpYXMgPSBuZXcgQWxpYXMgQFxuICAgICAgICBAY2hkaXIgPSBuZXcgQ2hkaXIgQFxuICAgICAgICBAcGF0aHMgPSBuZXcgUGF0aHMgQFxuICAgICAgICBAcXVldWUgPSBbXVxuICAgICAgICBAaW5wdXRRdWV1ZSA9IFtdXG4gICAgXG4gICAgICAgIEBwYXRocy5pbml0KClcbiAgICAgICAgICAgIFxuICAgIGNkOiAoZGlyKSA9PlxuICAgICAgICBcbiAgICAgICAgaWYgbm90IHNsYXNoLnNhbWVQYXRoIGRpciwgcHJvY2Vzcy5jd2QoKVxuICAgICAgICAgICAgQGV4ZWN1dGVDbWQgJ2NkICcgKyBkaXJcbiAgICAgICAgICAgIEBlZGl0b3IuZm9jdXMoKVxuICAgICAgICBcbiAgICBzdWJzdGl0dXRlOiAoY21kKSAtPlxuICAgICAgICBcbiAgICAgICAgY21kID0gQGFsaWFzLnN1YnN0aXR1dGUgY21kXG4gICAgICAgIGNtZCA9IGNtZC5yZXBsYWNlIC9cXH4vZywgc2xhc2guaG9tZSgpXG4gICAgICAgIGNtZFxuICAgICAgICAgICAgXG4gICAgIyAwMDAwMDAwMCAgMDAwICAgMDAwICAwMDAwMDAwMCAgIDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwMDAwMDAwICAwMDAwMDAwMCAgXG4gICAgIyAwMDAgICAgICAgIDAwMCAwMDAgICAwMDAgICAgICAgMDAwICAgICAgIDAwMCAgIDAwMCAgICAgMDAwICAgICAwMDAgICAgICAgXG4gICAgIyAwMDAwMDAwICAgICAwMDAwMCAgICAwMDAwMDAwICAgMDAwICAgICAgIDAwMCAgIDAwMCAgICAgMDAwICAgICAwMDAwMDAwICAgXG4gICAgIyAwMDAgICAgICAgIDAwMCAwMDAgICAwMDAgICAgICAgMDAwICAgICAgIDAwMCAgIDAwMCAgICAgMDAwICAgICAwMDAgICAgICAgXG4gICAgIyAwMDAwMDAwMCAgMDAwICAgMDAwICAwMDAwMDAwMCAgIDAwMDAwMDAgICAwMDAwMDAwICAgICAgMDAwICAgICAwMDAwMDAwMCAgXG4gICAgXG4gICAgZXhlY3V0ZTogKEBjbWQ6LCBmYWxsYmFjazopID0+XG4gICAgXG4gICAgICAgIEBjbWQgPz0gQGVkaXRvci5sYXN0TGluZSgpXG4gICAgICAgIEBjbWQgPSBAY21kLnRyaW0oKVxuICAgIFxuICAgICAgICBpZiBAY21kID09ICcuJyBhbmQgdmFsaWQgZmFsbGJhY2tcbiAgICAgICAgICAgIEBjbWQgPSBmYWxsYmFja1xuICAgICAgICBcbiAgICAgICAgaWYgQGNoaWxkXG4gICAgICAgICAgICBAaW5wdXRRdWV1ZS5wdXNoIEBjbWRcbiAgICAgICAgICAgIEBlZGl0b3Iuc2V0SW5wdXRUZXh0ICcnXG4gICAgICAgICAgICByZXR1cm5cbiAgICAgICAgXG4gICAgICAgIEBlcnJvclRleHQgPSAnJ1xuICAgICAgICBcbiAgICAgICAgaWYgQGNtZCAhPSBoc3ViID0gSGlzdG9yeS5zdWJzdGl0dXRlIEBjbWRcbiAgICAgICAgICAgIEBjbWQgPSBoc3ViXG4gICAgICAgICAgICBAZWRpdG9yLnNldElucHV0VGV4dCBAY21kXG4gICAgICAgIFxuICAgICAgICBAZWRpdG9yLmFwcGVuZFRleHQgJydcbiAgICAgICAgQGVkaXRvci5zaW5nbGVDdXJzb3JBdEVuZCgpXG4gICAgICAgICAgICBcbiAgICAgICAgaWYgZW1wdHkgQGNtZCBcbiAgICAgICAgICAgIEB0ZXJtLm1vdmVJbnB1dE1ldGEoKVxuICAgICAgICAgICAgcmV0dXJuXG4gICAgICAgIFxuICAgICAgICBAdGVybS5oaXN0b3J5LnNoZWxsQ21kIEBjbWQgIyByZXNldCBoaXN0b3J5IHBvaW50ZXIgdG8gbGFzdFxuXG4gICAgICAgIEBsYXN0ID1cbiAgICAgICAgICAgIGNtZDogICAgICBAY21kXG4gICAgICAgICAgICBjd2Q6ICAgICAgc2xhc2gudGlsZGUgcHJvY2Vzcy5jd2QoKVxuICAgICAgICAgICAgbWV0YTogICAgIEB0ZXJtLmluc2VydENtZE1ldGEgQGVkaXRvci5udW1MaW5lcygpLTIgQGNtZFxuICAgICAgICAgICAgXG4gICAgICAgIEBsYXN0LmZhbGxiYWNrID0gZmFsbGJhY2sgaWYgZmFsbGJhY2tcbiAgICAgICAgXG4gICAgICAgIEBleGVjdXRlQ21kIEBzdWJzdGl0dXRlIEBjbWRcbiAgICAgICAgICAgICAgICBcbiAgICAjIDAwMDAwMDAwICAwMDAgICAwMDAgIDAwMDAwMDAwICAgMDAwMDAwMCAgICAgICAgMDAwMDAwMCAgMDAgICAgIDAwICAwMDAwMDAwICAgIFxuICAgICMgMDAwICAgICAgICAwMDAgMDAwICAgMDAwICAgICAgIDAwMCAgICAgICAgICAgIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgXG4gICAgIyAwMDAwMDAwICAgICAwMDAwMCAgICAwMDAwMDAwICAgMDAwICAgICAgICAgICAgMDAwICAgICAgIDAwMDAwMDAwMCAgMDAwICAgMDAwICBcbiAgICAjIDAwMCAgICAgICAgMDAwIDAwMCAgIDAwMCAgICAgICAwMDAgICAgICAgICAgICAwMDAgICAgICAgMDAwIDAgMDAwICAwMDAgICAwMDAgIFxuICAgICMgMDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwMDAwMDAgICAwMDAwMDAwICAgICAgICAwMDAwMDAwICAwMDAgICAwMDAgIDAwMDAwMDAgICAgXG4gICAgXG4gICAgZXhlY3V0ZUNtZDogKEBjbWQpID0+XG5cbiAgICAgICAgc3BsaXQgPSBAY21kLnNwbGl0ICcmJidcbiAgICAgICAgaWYgc3BsaXQubGVuZ3RoID4gMVxuICAgICAgICAgICAgQGNtZCA9IHNwbGl0WzBdLnRyaW0oKVxuICAgICAgICAgICAgQHF1ZXVlID0gQHF1ZXVlLmNvbmNhdCBzcGxpdFsxLi5dXG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIEBjbWQgPSBAY21kLnRyaW0oKVxuICAgICAgICBcbiAgICAgICAgaWYgZW1wdHkgQGNtZFxuICAgICAgICAgICAgQGRlcXVldWUoKVxuICAgICAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgICAgXG4gICAgICAgIGlmIEBhbGlhcy5vbkNvbW1hbmQgQGNtZFxuICAgICAgICAgICAgQGRlcXVldWUoKVxuICAgICAgICAgICAgcmV0dXJuIHRydWVcblxuICAgICAgICBpZiBAY2hkaXIub25Db21tYW5kIEBjbWRcbiAgICAgICAgICAgIEBkZXF1ZXVlKClcbiAgICAgICAgICAgIHJldHVybiB0cnVlXG4gICAgICAgICAgICBcbiAgICAgICAgQHNoZWxsQ21kIEBjbWRcbiAgICAgICAgICAgICAgICAgICAgXG4gICAgIyAgMDAwMDAwMCAgMDAwICAgMDAwICAwMDAwMDAwMCAgMDAwICAgICAgMDAwICAgICAgICAgICAwMDAwMDAwICAwMCAgICAgMDAgIDAwMDAwMDAgICAgXG4gICAgIyAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAgICAgMDAwICAgICAgMDAwICAgICAgICAgIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgXG4gICAgIyAwMDAwMDAwICAgMDAwMDAwMDAwICAwMDAwMDAwICAgMDAwICAgICAgMDAwICAgICAgICAgIDAwMCAgICAgICAwMDAwMDAwMDAgIDAwMCAgIDAwMCAgXG4gICAgIyAgICAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAgICAgMDAwICAgICAgMDAwICAgICAgICAgIDAwMCAgICAgICAwMDAgMCAwMDAgIDAwMCAgIDAwMCAgXG4gICAgIyAwMDAwMDAwICAgMDAwICAgMDAwICAwMDAwMDAwMCAgMDAwMDAwMCAgMDAwMDAwMCAgICAgICAwMDAwMDAwICAwMDAgICAwMDAgIDAwMDAwMDAgICAgXG4gICAgXG4gICAgc2VwZXJhdGVDbWRBcmdzOiAoY21kKSAtPlxuICAgICAgICBcbiAgICAgICAgbmV4dCA9IChjLCBzKSAtPiBcbiAgICAgICAgICAgIG4gPSBjbWQuaW5kZXhPZiBjLCBzKzFcbiAgICAgICAgICAgIG4gPSBjbWQubGVuZ3RoIGlmIG48MFxuICAgICAgICAgICAgblxuICAgICAgICBpID0gbmV4dCAnICcgIDBcbiAgICAgICAgbiA9IG5leHQgJ1wiJywgLTFcbiAgICAgICAgaWYgbiA8IGkgdGhlbiBpID0gMSArIG5leHQgJ1wiJyBuXG4gICAgICAgIGV4ZSA9IGNtZFswLi4uaV1cbiAgICAgICAgYXJncyA9IFtdXG4gICAgICAgIHdoaWxlIGkrKyA8IGNtZC5sZW5ndGhcbiAgICAgICAgICAgIGlmIGNtZFtpXSAhPSAnICdcbiAgICAgICAgICAgICAgICBpZiBjbWRbaV0gPT0gJ1wiJ1xuICAgICAgICAgICAgICAgICAgICBuID0gbmV4dCAnXCInIGlcbiAgICAgICAgICAgICAgICAgICAgYXJncy5wdXNoIGNtZFtpLi4ubl1cbiAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgIG4gPSBuZXh0ICcgJyBpXG4gICAgICAgICAgICAgICAgICAgIGFyZ3MucHVzaCBjbWRbaS4uLm5dXG4gICAgICAgICAgICAgICAgaSA9IG5cbiAgICAgICAgW2V4ZSwgYXJnc10gICAgICAgIFxuICAgIFxuICAgIHNoZWxsQ21kOiAoQGNtZCkgPT5cbiAgICAgICAgICAgIFxuICAgICAgICBwcm9jZXNzLmVudi5MSU5FUyAgID0gQGVkaXRvci5zY3JvbGwuZnVsbExpbmVzXG4gICAgICAgIHByb2Nlc3MuZW52LkNPTFVNTlMgPSBwYXJzZUludCBAZWRpdG9yLmxheWVyc1dpZHRoIC8gQGVkaXRvci5zaXplLmNoYXJXaWR0aFxuICAgICAgICBwcm9jZXNzLmVudi5BREJMT0NLID0gdHJ1ZVxuICAgICAgICBcbiAgICAgICAgaWYgQGNtZC5lbmRzV2l0aCAnJidcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgW2NtZCwgYXJnc10gPSBAc2VwZXJhdGVDbWRBcmdzIEBjbWRbMC4uLkBjbWQubGVuZ3RoLTFdXG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAjIGtsb2cgXCJkZXRhY2ggfCN7Y21kfXxcIiBhcmdzXG4gICAgICAgICAgICBAc3Bhd24gPSBjaGlsZHAuc3Bhd24gY21kLCBhcmdzLCBkZXRhY2hlZDp0cnVlLCBzaGVsbDpAc2hlbGxQYXRoLCBlbnY6cHJvY2Vzcy5lbnYsIGN3ZDpwcm9jZXNzLmN3ZCgpICAgIFxuICAgICAgICAgICAgQGxhc3QubWV0YS5waWQgPSBAc3Bhd24ucGlkXG4gICAgICAgICAgICBAc3Bhd24ub24gJ2Nsb3NlJyAoKHBpZCkgPT4gKGNvZGUpID0+IFxuICAgICAgICAgICAgICAgICAgICBrbG9nICdzcGF3biBleGl0JyBjb2RlLCBwaWRcbiAgICAgICAgICAgICAgICAgICAgZm9yIG1ldGEgaW4gQGVkaXRvci5tZXRhLm1ldGFzT2ZDbGFzcyAnc3VjYydcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIG1ldGEucGlkID09IHBpZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGFbMl0ubnVtYmVyLnRleHQgPSAn4pa2J1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGFbMl0ubnVtYmVyLmNsc3MgPSAnc3VjYydcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBAZWRpdG9yLm1ldGEudXBkYXRlIG1ldGFcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVha1xuICAgICAgICAgICAgICAgICkgQHNwYXduLnBpZFxuICAgICAgICAgICAgQG9uRG9uZSAnYnVzeSdcbiAgICAgICAgZWxzZVxuICAgICAgICBcbiAgICAgICAgICAgIEBjaGlsZCA9IGNoaWxkcC5leGVjIEBjbWQsIHNoZWxsOkBzaGVsbFBhdGgsIGVudjpwcm9jZXNzLmVudiwgY3dkOnByb2Nlc3MuY3dkKCkgICAgXG4gICAgICAgICAgICBAY2hpbGQuc3Rkb3V0Lm9uICdkYXRhJyAgQG9uU3RkT3V0XG4gICAgICAgICAgICBAY2hpbGQuc3RkZXJyLm9uICdkYXRhJyAgQG9uU3RkRXJyXG4gICAgICAgICAgICBAY2hpbGQub24gICAgICAgICdjbG9zZScgQG9uRXhpdFxuICAgICAgICAgICAgXG4gICAgICAgIHRydWVcbiAgICAgICAgXG4gICAgIyAgMDAwMDAwMCAgIDAwMDAwMDAgICAwMDAgICAwMDAgICAwMDAwMDAwICAwMDAwMDAwMCAgMDAwICAgICAgXG4gICAgIyAwMDAgICAgICAgMDAwICAgMDAwICAwMDAwICAwMDAgIDAwMCAgICAgICAwMDAgICAgICAgMDAwICAgICAgXG4gICAgIyAwMDAgICAgICAgMDAwMDAwMDAwICAwMDAgMCAwMDAgIDAwMCAgICAgICAwMDAwMDAwICAgMDAwICAgICAgXG4gICAgIyAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgIDAwMDAgIDAwMCAgICAgICAwMDAgICAgICAgMDAwICAgICAgXG4gICAgIyAgMDAwMDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgICAwMDAwMDAwICAwMDAwMDAwMCAgMDAwMDAwMCAgXG4gICAgXG4gICAgaGFuZGxlQ2FuY2VsOiAtPlxuICAgICAgICBcbiAgICAgICAgQHF1ZXVlID0gW11cbiAgICAgICAgQGlucHV0UXVldWUgPSBbXVxuICAgICAgICBcbiAgICAgICAgaWYgbm90IEBjaGlsZFxuICAgICAgICAgICAga2xvZyAnbm8gY2hpbGQ/J1xuICAgICAgICAgICAgcmV0dXJuICd1bmhhbmRsZWQnXG4gICAgICAgICAgICBcbiAgICAgICAgcHNUcmVlIEBjaGlsZC5waWQsIChlcnIsIGNoaWxkcmVuKSA9PlxuICAgICAgICAgICAgXG4gICAgICAgICAgICBhcmdzID0gY2hpbGRyZW4ubWFwIChwKSAtPiBwLlBJRFxuICAgICAgICAgICAgYXJncy51bnNoaWZ0IEBjaGlsZC5waWRcbiAgICAgICAgICAgIGFyZ3MucmV2ZXJzZSgpXG4gICAgICAgICAgICBAY2hpbGQua2lsbCgpXG4gICAgICAgICAgICBmb3IgYXJnIGluIGFyZ3NcbiAgICAgICAgICAgICAgICB3eHcgJ3Rlcm1pbmF0ZScgYXJnXG4gICAgICAgIHRydWVcbiAgICAgICAgXG4gICAgIyAwMDAwMDAwMCAgMDAwICAgMDAwICAwMDAgIDAwMDAwMDAwMCAgXG4gICAgIyAwMDAgICAgICAgIDAwMCAwMDAgICAwMDAgICAgIDAwMCAgICAgXG4gICAgIyAwMDAwMDAwICAgICAwMDAwMCAgICAwMDAgICAgIDAwMCAgICAgXG4gICAgIyAwMDAgICAgICAgIDAwMCAwMDAgICAwMDAgICAgIDAwMCAgICAgXG4gICAgIyAwMDAwMDAwMCAgMDAwICAgMDAwICAwMDAgICAgIDAwMCAgICAgXG4gICAgICAgIFxuICAgIG9uRXhpdDogKGNvZGUpID0+XG5cbiAgICAgICAgIyBrbG9nICdvbkV4aXQnIEBjaGlsZC5waWRcbiAgICAgICAga2lsbGVkID0gQGNoaWxkLmtpbGxlZFxuICAgICAgICBkZWxldGUgQGNoaWxkXG4gICAgICAgIFxuICAgICAgICBpZiBjb2RlID09IDAgb3Iga2lsbGVkIFxuICAgICAgICAgICAgc2V0SW1tZWRpYXRlIEBvbkRvbmVcbiAgICAgICAgZWxzZSBpZiBAZmFsbGJhY2soKVxuICAgICAgICAgICAgQGRlcXVldWUoKVxuICAgICAgICBlbHNlXG4gICAgICAgICAgICBAdGVybS5mYWlsTWV0YSBAbGFzdC5tZXRhXG4gICAgICAgICAgICBpZiBub3QgL2lzIG5vdCByZWNvZ25pemVkLy50ZXN0IEBlcnJvclRleHRcbiAgICAgICAgICAgICAgICBAZWRpdG9yLmFwcGVuZE91dHB1dCAnXFxuJytAZXJyb3JUZXh0XG4gICAgICAgICAgICBAZGVxdWV1ZSAnZmFpbCdcbiAgICAgICAgICBcbiAgICAjIDAwMDAwMDAwICAgMDAwMDAwMCAgIDAwMCAgICAgIDAwMCAgICAgIDAwMDAwMDAgICAgIDAwMDAwMDAgICAgMDAwMDAwMCAgMDAwICAgMDAwICBcbiAgICAjIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgICAgIDAwMCAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAgICAgMDAwICAwMDAgICBcbiAgICAjIDAwMDAwMCAgICAwMDAwMDAwMDAgIDAwMCAgICAgIDAwMCAgICAgIDAwMDAwMDAgICAgMDAwMDAwMDAwICAwMDAgICAgICAgMDAwMDAwMCAgICBcbiAgICAjIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgICAgIDAwMCAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAgICAgMDAwICAwMDAgICBcbiAgICAjIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMDAwMDAgIDAwMDAwMDAgIDAwMDAwMDAgICAgMDAwICAgMDAwICAgMDAwMDAwMCAgMDAwICAgMDAwICBcbiAgICBcbiAgICBmYWxsYmFjazogLT5cbiAgICAgICAgXG4gICAgICAgIGlmIEBsYXN0LmZhbGxiYWNrXG4gICAgICAgICAgICBrbG9nICdmYWxsYmFjaycgQGxhc3QuZmFsbGJhY2tcbiAgICAgICAgICAgIEBlbnF1ZXVlIGNtZDpAbGFzdC5mYWxsYmFjaywgdXBkYXRlOnRydWVcbiAgICAgICAgICAgIGRlbGV0ZSBAbGFzdC5mYWxsYmFja1xuICAgICAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgICAgXG4gICAgIyAwMDAwMDAwICAgICAwMDAwMDAwICAgMDAwICAgMDAwICAwMDAwMDAwMCAgXG4gICAgIyAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwMCAgMDAwICAwMDAgICAgICAgXG4gICAgIyAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwIDAgMDAwICAwMDAwMDAwICAgXG4gICAgIyAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAwMDAwICAwMDAgICAgICAgXG4gICAgIyAwMDAwMDAwICAgICAwMDAwMDAwICAgMDAwICAgMDAwICAwMDAwMDAwMCAgXG4gICAgXG4gICAgb25Eb25lOiAobGFzdENvZGUpID0+XG5cbiAgICAgICAgaW5mbyA9IF8uY2xvbmUgQGxhc3RcbiAgICAgICAgZGVsZXRlIGluZm8ubWV0YVxuICAgICAgICBwb3N0LmVtaXQgJ2NtZCcgaW5mbyAjIGluc2VydCBpbnRvIGdsb2JhbCBoaXN0b3J5IGFuZCBicmFpblxuICAgICAgICBcbiAgICAgICAgaWYgbGFzdENvZGUgIT0gJ2ZhaWwnIFxuICAgICAgICAgICAgaWYgQGxhc3Q/Lm1ldGE/XG4gICAgICAgICAgICAgICAgQHRlcm0uc3VjY01ldGEgQGxhc3QubWV0YSwgbGFzdENvZGVcbiAgICAgICAgICAgIFxuICAgICAgICBpZiBlbXB0eShAcXVldWUpIGFuZCBlbXB0eShAaW5wdXRRdWV1ZSlcbiAgICAgICAgICAgIEB0ZXJtLnB3ZCgpXG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIEBkZXF1ZXVlKClcbiAgICAgICAgICAgXG4gICAgIyAwMDAwMDAwMCAgMDAwICAgMDAwICAgMDAwMDAwMCAgIDAwMCAgIDAwMCAgMDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwMDAwMDAgIFxuICAgICMgMDAwICAgICAgIDAwMDAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgICAgICBcbiAgICAjIDAwMDAwMDAgICAwMDAgMCAwMDAgIDAwMCAwMCAwMCAgMDAwICAgMDAwICAwMDAwMDAwICAgMDAwICAgMDAwICAwMDAwMDAwICAgXG4gICAgIyAwMDAgICAgICAgMDAwICAwMDAwICAwMDAgMDAwMCAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgICAgIFxuICAgICMgMDAwMDAwMDAgIDAwMCAgIDAwMCAgIDAwMDAwIDAwICAgMDAwMDAwMCAgIDAwMDAwMDAwICAgMDAwMDAwMCAgIDAwMDAwMDAwICBcbiAgICBcbiAgICBlbnF1ZXVlOiAoY21kOicnIGZyb250OmZhbHNlIHVwZGF0ZTpmYWxzZSBhbGlhczpmYWxzZSkgLT4gXG4gICAgXG4gICAgICAgIGlmIHVwZGF0ZVxuICAgICAgICAgICAgQGxhc3Qub3JpZyA9IEBsYXN0LmNtZFxuICAgICAgICAgICAgQGxhc3QuY21kID0gY21kXG4gICAgICAgICAgICBpZiBAbGFzdC5tZXRhXG4gICAgICAgICAgICAgICAgQGVkaXRvci5yZXBsYWNlVGV4dEluTGluZSBAbGFzdC5tZXRhWzBdLCBjbWRcbiAgICAgICAgICAgICAgICBAZWRpdG9yLm1ldGEudXBkYXRlIEBsYXN0Lm1ldGFcbiAgICAgICAgICAgIFxuICAgICAgICBpZiBhbGlhc1xuICAgICAgICAgICAgQGxhc3QuYWxpYXMgPSBjbWRcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgY21kID0gY21kLnJlcGxhY2UgL1xcfi9nLCBzbGFzaC5ob21lKClcbiAgICAgICAgXG4gICAgICAgIGlmIGZyb250XG4gICAgICAgICAgICBAcXVldWUudW5zaGlmdCBjbWRcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgQHF1ZXVlLnB1c2ggY21kXG4gICAgICAgIGNtZFxuICAgICAgICAgICAgICAgICAgICBcbiAgICAjIDAwMDAwMDAgICAgMDAwMDAwMDAgICAwMDAwMDAwICAgMDAwICAgMDAwICAwMDAwMDAwMCAgMDAwICAgMDAwICAwMDAwMDAwMCAgXG4gICAgIyAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgICAgIFxuICAgICMgMDAwICAgMDAwICAwMDAwMDAwICAgMDAwIDAwIDAwICAwMDAgICAwMDAgIDAwMDAwMDAgICAwMDAgICAwMDAgIDAwMDAwMDAgICBcbiAgICAjIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAwMDAwICAgMDAwICAgMDAwICAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAgICAgXG4gICAgIyAwMDAwMDAwICAgIDAwMDAwMDAwICAgMDAwMDAgMDAgICAwMDAwMDAwICAgMDAwMDAwMDAgICAwMDAwMDAwICAgMDAwMDAwMDAgIFxuICAgIFxuICAgIGRlcXVldWU6IChsYXN0Q29kZSkgPT5cbiBcbiAgICAgICAgaWYgQHF1ZXVlLmxlbmd0aFxuICAgICAgICAgICAgQGV4ZWN1dGVDbWQgQHF1ZXVlLnNoaWZ0KClcbiAgICAgICAgZWxzZSBpZiBAaW5wdXRRdWV1ZS5sZW5ndGhcbiAgICAgICAgICAgIGNtZCA9IEBpbnB1dFF1ZXVlLnNoaWZ0KClcbiAgICAgICAgICAgIEBlZGl0b3Iuc2V0SW5wdXRUZXh0IGNtZFxuICAgICAgICAgICAgQGV4ZWN1dGUgY21kXG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIEBvbkRvbmUgbGFzdENvZGVcbiAgICAgICAgXG4gICAgIyAgMDAwMDAwMCAgMDAwMDAwMDAwICAwMDAwMDAwICAgIFxuICAgICMgMDAwICAgICAgICAgIDAwMCAgICAgMDAwICAgMDAwICBcbiAgICAjIDAwMDAwMDAgICAgICAwMDAgICAgIDAwMCAgIDAwMCAgXG4gICAgIyAgICAgIDAwMCAgICAgMDAwICAgICAwMDAgICAwMDAgIFxuICAgICMgMDAwMDAwMCAgICAgIDAwMCAgICAgMDAwMDAwMCAgICBcbiAgICBcbiAgICBvblN0ZE91dDogKGRhdGEpID0+XG4gICAgICAgIFxuICAgICAgICBpZiBkYXRhWy0xXSA9PSAnXFxuJ1xuICAgICAgICAgICAgZGF0YSA9IGRhdGFbMC4uZGF0YS5sZW5ndGgtMl1cblxuICAgICAgICAjIGRhdGEgPSBkYXRhLnJlcGxhY2UgLyhcXHgxQlxcW1xcPzI1W2hsXSl8KFxceDBhKS9nLCAnJ1xuICAgICAgICAgICAgXG4gICAgICAgICMgYnVmID0gQnVmZmVyLmZyb20gZGF0YSwgJ3V0ZjgnXG4gICAgICAgICMgZm9yIGMgaW4gYnVmXG4gICAgICAgICAgICAjIGtsb2cgXCIje2tzdHIucGFkIGMsIDN9IDB4I3tjLnRvU3RyaW5nKDE2KX0gJyN7U3RyaW5nLmZyb21DaGFyQ29kZShjKX0nXCJcbiAgICAgICAgICAgIFxuICAgICAgICAjIGtsb2cgJz09PT09PT09PT09PT09PT0nIGRhdGFcbiAgICAgICAgICAgIFxuICAgICAgICBAZWRpdG9yLmFwcGVuZE91dHB1dCBkYXRhXG4gICAgICAgICMgQGVkaXRvci5zZXRJbnB1dFRleHQgQGVkaXRvci5sYXN0TGluZSgpK2RhdGFcbiAgICAgICAgQGVkaXRvci5zaW5nbGVDdXJzb3JBdEVuZCgpXG5cbiAgICBvblN0ZEVycjogKGRhdGEpID0+XG5cbiAgICAgICAgIyBrbG9nICctLS0tLS0tLS0tLS0tLS0tJyBkYXRhXG4gICAgICAgIFxuICAgICAgICAjIGJ1ZiA9IEJ1ZmZlci5mcm9tIGRhdGEsICd1dGY4J1xuICAgICAgICAjIGZvciBjIGluIGJ1ZlxuICAgICAgICAgICAgIyBrbG9nIFwiI3trc3RyLnBhZCBjLCAzfSAweCN7Yy50b1N0cmluZygxNil9ICcje1N0cmluZy5mcm9tQ2hhckNvZGUoYyl9J1wiXG4gICAgICAgIFxuICAgICAgICBpZiBkYXRhLnN0YXJ0c1dpdGggJ1xceDFiXTA7J1xuICAgICAgICAgICAga2xvZyAnYmFzaCBwcm9tcHQnXG4gICAgICAgICAgICBkYXRhID0gZGF0YVs0Li5dXG4gICAgICAgICAgICBpID0gMFxuICAgICAgICAgICAgYyA9IGRhdGFbMF1cbiAgICAgICAgICAgIHBhdGggPSAnJ1xuICAgICAgICAgICAgd2hpbGUgYyAhPSAnXFx4MDcnXG4gICAgICAgICAgICAgICAgcGF0aCArPSBjXG4gICAgICAgICAgICAgICAgYyA9IGRhdGFbaSsrXVxuICAgICAgICAgICAga2xvZyAncGF0aCcgcGF0aFxuICAgICAgICAgICAgQGVkaXRvci5hcHBlbmRPdXRwdXQgZGF0YVtpLi5dXG4gICAgICAgIGVsc2UgICBcbiAgICAgICAgICAgIEBlcnJvclRleHQgKz0gZGF0YVxuICAgICAgICBcbm1vZHVsZS5leHBvcnRzID0gU2hlbGxcbiJdfQ==
//# sourceURL=../coffee/shell.coffee