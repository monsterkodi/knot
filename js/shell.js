// koffee 1.4.0

/*
 0000000  000   000  00000000  000      000    
000       000   000  000       000      000    
0000000   000000000  0000000   000      000    
     000  000   000  000       000      000    
0000000   000   000  00000000  0000000  0000000
 */
var Alias, Chdir, History, Paths, Shell, _, args, childp, empty, history, klog, post, psTree, ref, slash, valid, wxw,
    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

ref = require('kxk'), _ = ref._, args = ref.args, childp = ref.childp, empty = ref.empty, history = ref.history, klog = ref.klog, post = ref.post, slash = ref.slash, valid = ref.valid;

History = require('./history');

Alias = require('./alias');

Chdir = require('./chdir');

Paths = require('./paths');

psTree = require('ps-tree');

wxw = require('wxw');

Shell = (function() {
    function Shell(term) {
        this.term = term;
        this.onStdErr = bind(this.onStdErr, this);
        this.onStdOut = bind(this.onStdOut, this);
        this.dequeue = bind(this.dequeue, this);
        this.onDone = bind(this.onDone, this);
        this.onExit = bind(this.onExit, this);
        this.shellCmd = bind(this.shellCmd, this);
        this.executeCmd = bind(this.executeCmd, this);
        this.execute = bind(this.execute, this);
        this.cd = bind(this.cd, this);
        this.shellPath = 'C:/msys64/usr/bin/bash.exe';
        if (!slash.fileExists(this.shellPath)) {
            this.shellPath = true;
        }
        this.editor = this.term.editor;
        this.alias = new Alias(this);
        this.chdir = new Chdir(this);
        this.paths = new Paths(this);
        this.queue = [];
        this.inputQueue = [];
        this.paths.init();
    }

    Shell.prototype.cd = function(dir) {
        if (!slash.samePath(dir, process.cwd())) {
            this.executeCmd('cd ' + dir);
            return this.editor.focus();
        }
    };

    Shell.prototype.substitute = function(cmd) {
        cmd = this.alias.substitute(cmd);
        cmd = cmd.replace(/\~/g, slash.home());
        return cmd;
    };

    Shell.prototype.execute = function(arg1) {
        var fallback, hsub, ref1, ref2;
        this.cmd = (ref1 = arg1.cmd) != null ? ref1 : null, fallback = (ref2 = arg1.fallback) != null ? ref2 : null;
        if (this.cmd != null) {
            this.cmd;
        } else {
            this.cmd = this.editor.lastLine();
        }
        this.cmd = this.cmd.trim();
        if (this.cmd === '.' && valid(fallback)) {
            this.cmd = fallback;
        }
        if (this.child) {
            this.inputQueue.push(this.cmd);
            this.editor.setInputText('');
            return;
        }
        this.errorText = '';
        if (this.cmd !== (hsub = History.substitute(this.cmd))) {
            this.cmd = hsub;
            this.editor.setInputText(this.cmd);
        }
        this.editor.appendText('');
        this.editor.singleCursorAtEnd();
        if (empty(this.cmd)) {
            this.term.moveInputMeta();
            return;
        }
        this.term.history.shellCmd(this.cmd);
        this.last = {
            cmd: this.cmd,
            cwd: slash.tilde(process.cwd()),
            meta: this.term.insertCmdMeta(this.editor.numLines() - 2, this.cmd)
        };
        if (fallback) {
            this.last.fallback = fallback;
        }
        return this.executeCmd(this.substitute(this.cmd));
    };

    Shell.prototype.executeCmd = function(cmd1) {
        var split;
        this.cmd = cmd1;
        split = this.cmd.split('&&');
        if (split.length > 1) {
            this.cmd = split[0].trim();
            this.queue = this.queue.concat(split.slice(1));
        } else {
            this.cmd = this.cmd.trim();
        }
        if (empty(this.cmd)) {
            this.dequeue();
            return true;
        }
        if (this.alias.onCommand(this.cmd)) {
            this.dequeue();
            return true;
        }
        if (this.chdir.onCommand(this.cmd)) {
            this.dequeue();
            return true;
        }
        return this.shellCmd(this.cmd);
    };

    Shell.prototype.seperateCmdArgs = function(cmd) {
        var exe, i, n, next;
        next = function(c, s) {
            var n;
            n = cmd.indexOf(c, s + 1);
            if (n < 0) {
                n = cmd.length;
            }
            return n;
        };
        i = next(' ', 0);
        n = next('"', -1);
        if (n < i) {
            i = 1 + next('"', n);
        }
        exe = cmd.slice(0, i);
        args = [];
        while (i++ < cmd.length) {
            if (cmd[i] !== ' ') {
                if (cmd[i] === '"') {
                    n = next('"', i);
                    args.push(cmd.slice(i, n));
                } else {
                    n = next(' ', i);
                    args.push(cmd.slice(i, n));
                }
                i = n;
            }
        }
        return [exe, args];
    };

    Shell.prototype.shellCmd = function(cmd1) {
        var cmd, ref1;
        this.cmd = cmd1;
        process.env.LINES = this.editor.scroll.fullLines;
        process.env.COLUMNS = parseInt(this.editor.layersWidth / this.editor.size.charWidth);
        process.env.ADBLOCK = true;
        if (this.cmd.endsWith('&')) {
            ref1 = this.seperateCmdArgs(this.cmd.slice(0, this.cmd.length - 1)), cmd = ref1[0], args = ref1[1];
            this.spawn = childp.spawn(cmd, args, {
                detached: true,
                shell: this.shellPath,
                env: process.env,
                cwd: process.cwd()
            });
            this.last.meta.pid = this.spawn.pid;
            this.spawn.on('close', ((function(_this) {
                return function(pid) {
                    return function(code) {
                        var j, len, meta, ref2, results;
                        klog('spawn exit', code, pid);
                        ref2 = _this.editor.meta.metasOfClass('succ');
                        results = [];
                        for (j = 0, len = ref2.length; j < len; j++) {
                            meta = ref2[j];
                            if (meta.pid === pid) {
                                meta[2].number.text = 'â–¶';
                                meta[2].number.clss = 'succ';
                                _this.editor.meta.update(meta);
                                break;
                            } else {
                                results.push(void 0);
                            }
                        }
                        return results;
                    };
                };
            })(this))(this.spawn.pid));
            this.onDone('busy');
        } else {
            this.child = childp.exec(this.cmd, {
                shell: this.shellPath,
                env: process.env,
                cwd: process.cwd()
            });
            this.child.stdout.on('data', this.onStdOut);
            this.child.stderr.on('data', this.onStdErr);
            this.child.on('close', this.onExit);
        }
        return true;
    };

    Shell.prototype.handleCancel = function() {
        this.queue = [];
        this.inputQueue = [];
        if (!this.child) {
            klog('no child?');
            return 'unhandled';
        }
        psTree(this.child.pid, (function(_this) {
            return function(err, children) {
                var arg, j, len, results;
                args = children.map(function(p) {
                    return p.PID;
                });
                args.unshift(_this.child.pid);
                args.reverse();
                _this.child.kill();
                results = [];
                for (j = 0, len = args.length; j < len; j++) {
                    arg = args[j];
                    results.push(wxw('terminate', arg));
                }
                return results;
            };
        })(this));
        return true;
    };

    Shell.prototype.onExit = function(code) {
        var killed;
        killed = this.child.killed;
        delete this.child;
        if (code === 0 || killed) {
            return setImmediate(this.onDone);
        } else if (this.fallback()) {
            return this.dequeue();
        } else {
            this.term.failMeta(this.last.meta);
            if (!/is not recognized/.test(this.errorText)) {
                this.editor.appendOutput('\n' + this.errorText);
            }
            return this.dequeue('fail');
        }
    };

    Shell.prototype.fallback = function() {
        if (this.last.fallback) {
            klog('fallback', this.last.fallback);
            this.enqueue({
                cmd: this.last.fallback,
                update: true
            });
            delete this.last.fallback;
            return true;
        }
    };

    Shell.prototype.onDone = function(lastCode) {
        var info, ref1;
        info = _.clone(this.last);
        delete info.meta;
        post.emit('cmd', info);
        if (lastCode !== 'fail') {
            if (((ref1 = this.last) != null ? ref1.meta : void 0) != null) {
                this.term.succMeta(this.last.meta, lastCode);
            }
        }
        if (empty(this.queue) && empty(this.inputQueue)) {
            return this.term.pwd();
        } else {
            return this.dequeue();
        }
    };

    Shell.prototype.enqueue = function(arg1) {
        var alias, cmd, front, ref1, ref2, ref3, ref4, update;
        cmd = (ref1 = arg1.cmd) != null ? ref1 : '', front = (ref2 = arg1.front) != null ? ref2 : false, update = (ref3 = arg1.update) != null ? ref3 : false, alias = (ref4 = arg1.alias) != null ? ref4 : false;
        if (update) {
            this.last.orig = this.last.cmd;
            this.last.cmd = cmd;
            if (this.last.meta) {
                this.editor.replaceTextInLine(this.last.meta[0], cmd);
                this.editor.meta.update(this.last.meta);
            }
        }
        if (alias) {
            this.last.alias = cmd;
        }
        cmd = cmd.replace(/\~/g, slash.home());
        if (front) {
            this.queue.unshift(cmd);
        } else {
            this.queue.push(cmd);
        }
        return cmd;
    };

    Shell.prototype.dequeue = function(lastCode) {
        var cmd;
        if (this.queue.length) {
            return this.executeCmd(this.queue.shift());
        } else if (this.inputQueue.length) {
            cmd = this.inputQueue.shift();
            this.editor.setInputText(cmd);
            return this.execute(cmd);
        } else {
            return this.onDone(lastCode);
        }
    };

    Shell.prototype.onStdOut = function(data) {
        if (data.slice(-1)[0] === '\n') {
            data = data.slice(0, +(data.length - 2) + 1 || 9e9);
        }
        this.editor.appendOutput(data);
        return this.editor.singleCursorAtEnd();
    };

    Shell.prototype.onStdErr = function(data) {
        var c, i, path;
        if (data.startsWith('\x1b]0;')) {
            klog('bash prompt');
            data = data.slice(4);
            i = 0;
            c = data[0];
            path = '';
            while (c !== '\x07') {
                path += c;
                c = data[i++];
            }
            klog('path', path);
            return this.editor.appendOutput(data.slice(i));
        } else {
            return this.errorText += data;
        }
    };

    return Shell;

})();

module.exports = Shell;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2hlbGwuanMiLCJzb3VyY2VSb290IjoiLiIsInNvdXJjZXMiOlsiIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUE7Ozs7Ozs7QUFBQSxJQUFBLGdIQUFBO0lBQUE7O0FBUUEsTUFBZ0UsT0FBQSxDQUFRLEtBQVIsQ0FBaEUsRUFBRSxTQUFGLEVBQUssZUFBTCxFQUFXLG1CQUFYLEVBQW1CLGlCQUFuQixFQUEwQixxQkFBMUIsRUFBbUMsZUFBbkMsRUFBeUMsZUFBekMsRUFBK0MsaUJBQS9DLEVBQXNEOztBQUV0RCxPQUFBLEdBQVUsT0FBQSxDQUFRLFdBQVI7O0FBQ1YsS0FBQSxHQUFVLE9BQUEsQ0FBUSxTQUFSOztBQUNWLEtBQUEsR0FBVSxPQUFBLENBQVEsU0FBUjs7QUFDVixLQUFBLEdBQVUsT0FBQSxDQUFRLFNBQVI7O0FBQ1YsTUFBQSxHQUFVLE9BQUEsQ0FBUSxTQUFSOztBQUNWLEdBQUEsR0FBVSxPQUFBLENBQVEsS0FBUjs7QUFFSjtJQUVDLGVBQUMsSUFBRDtRQUFDLElBQUMsQ0FBQSxPQUFEOzs7Ozs7Ozs7O1FBRUEsSUFBQyxDQUFBLFNBQUQsR0FBYTtRQUNiLElBQUcsQ0FBSSxLQUFLLENBQUMsVUFBTixDQUFpQixJQUFDLENBQUEsU0FBbEIsQ0FBUDtZQUNJLElBQUMsQ0FBQSxTQUFELEdBQWEsS0FEakI7O1FBR0EsSUFBQyxDQUFBLE1BQUQsR0FBVSxJQUFDLENBQUEsSUFBSSxDQUFDO1FBQ2hCLElBQUMsQ0FBQSxLQUFELEdBQVMsSUFBSSxLQUFKLENBQVUsSUFBVjtRQUNULElBQUMsQ0FBQSxLQUFELEdBQVMsSUFBSSxLQUFKLENBQVUsSUFBVjtRQUNULElBQUMsQ0FBQSxLQUFELEdBQVMsSUFBSSxLQUFKLENBQVUsSUFBVjtRQUNULElBQUMsQ0FBQSxLQUFELEdBQVM7UUFDVCxJQUFDLENBQUEsVUFBRCxHQUFjO1FBRWQsSUFBQyxDQUFBLEtBQUssQ0FBQyxJQUFQLENBQUE7SUFiRDs7b0JBZUgsRUFBQSxHQUFJLFNBQUMsR0FB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QTtZQUNOLElBQUMsQ0FBQSxNQUFNLENBQUMsWUFBUixDQUFxQixHQUFyQjttQkFDQSxJQUFDLENBQUEsT0FBRCxDQUFTLEdBQVQsRUFIQztTQUFBLE1BQUE7bUJBS0QsSUFBQyxDQUFBLE1BQUQsQ0FBUSxRQUFSLEVBTEM7O0lBSkE7O29CQWlCVCxRQUFBLEdBQVUsU0FBQyxJQUFEO1FBRU4sSUFBRyxJQUFLLFVBQUUsQ0FBQSxDQUFBLENBQVAsS0FBWSxJQUFmO1lBQ0ksSUFBQSxHQUFPLElBQUsseUNBRGhCOztRQVdBLElBQUMsQ0FBQSxNQUFNLENBQUMsWUFBUixDQUFxQixJQUFyQjtlQUVBLElBQUMsQ0FBQSxNQUFNLENBQUMsaUJBQVIsQ0FBQTtJQWZNOztvQkFpQlYsUUFBQSxHQUFVLFNBQUMsSUFBRDtBQVFOLFlBQUE7UUFBQSxJQUFHLElBQUksQ0FBQyxVQUFMLENBQWdCLFNBQWhCLENBQUg7WUFDSSxJQUFBLENBQUssYUFBTDtZQUNBLElBQUEsR0FBTyxJQUFLO1lBQ1osQ0FBQSxHQUFJO1lBQ0osQ0FBQSxHQUFJLElBQUssQ0FBQSxDQUFBO1lBQ1QsSUFBQSxHQUFPO0FBQ1AsbUJBQU0sQ0FBQSxLQUFLLE1BQVg7Z0JBQ0ksSUFBQSxJQUFRO2dCQUNSLENBQUEsR0FBSSxJQUFLLENBQUEsQ0FBQSxFQUFBO1lBRmI7WUFHQSxJQUFBLENBQUssTUFBTCxFQUFZLElBQVo7bUJBQ0EsSUFBQyxDQUFBLE1BQU0sQ0FBQyxZQUFSLENBQXFCLElBQUssU0FBMUIsRUFWSjtTQUFBLE1BQUE7bUJBWUksSUFBQyxDQUFBLFNBQUQsSUFBYyxLQVpsQjs7SUFSTTs7Ozs7O0FBc0JkLE1BQU0sQ0FBQyxPQUFQLEdBQWlCIiwic291cmNlc0NvbnRlbnQiOlsiIyMjXG4gMDAwMDAwMCAgMDAwICAgMDAwICAwMDAwMDAwMCAgMDAwICAgICAgMDAwICAgIFxuMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgICAgIDAwMCAgICBcbjAwMDAwMDAgICAwMDAwMDAwMDAgIDAwMDAwMDAgICAwMDAgICAgICAwMDAgICAgXG4gICAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAgICAgMDAwICAgICAgMDAwICAgIFxuMDAwMDAwMCAgIDAwMCAgIDAwMCAgMDAwMDAwMDAgIDAwMDAwMDAgIDAwMDAwMDBcbiMjI1xuXG57IF8sIGFyZ3MsIGNoaWxkcCwgZW1wdHksIGhpc3RvcnksIGtsb2csIHBvc3QsIHNsYXNoLCB2YWxpZCB9ID0gcmVxdWlyZSAna3hrJ1xuXG5IaXN0b3J5ID0gcmVxdWlyZSAnLi9oaXN0b3J5J1xuQWxpYXMgICA9IHJlcXVpcmUgJy4vYWxpYXMnXG5DaGRpciAgID0gcmVxdWlyZSAnLi9jaGRpcidcblBhdGhzICAgPSByZXF1aXJlICcuL3BhdGhzJ1xucHNUcmVlICA9IHJlcXVpcmUgJ3BzLXRyZWUnXG53eHcgICAgID0gcmVxdWlyZSAnd3h3J1xuXG5jbGFzcyBTaGVsbFxuXG4gICAgQDogKEB0ZXJtKSAtPlxuICAgICAgICBcbiAgICAgICAgQHNoZWxsUGF0aCA9ICdDOi9tc3lzNjQvdXNyL2Jpbi9iYXNoLmV4ZSdcbiAgICAgICAgaWYgbm90IHNsYXNoLmZpbGVFeGlzdHMgQHNoZWxsUGF0aFxuICAgICAgICAgICAgQHNoZWxsUGF0aCA9IHRydWVcbiAgICAgICAgXG4gICAgICAgIEBlZGl0b3IgPSBAdGVybS5lZGl0b3JcbiAgICAgICAgQGFsaWFzID0gbmV3IEFsaWFzIEBcbiAgICAgICAgQGNoZGlyID0gbmV3IENoZGlyIEBcbiAgICAgICAgQHBhdGhzID0gbmV3IFBhdGhzIEBcbiAgICAgICAgQHF1ZXVlID0gW11cbiAgICAgICAgQGlucHV0UXVldWUgPSBbXVxuICAgIFxuICAgICAgICBAcGF0aHMuaW5pdCgpXG4gICAgICAgICAgICBcbiAgICBjZDogKGRpcikgPT5cbiAgICAgICAgXG4gICAgICAgIGlmIG5vdCBzbGFzaC5zYW1lUGF0aCBkaXIsIHByb2Nlc3MuY3dkKClcbiAgICAgICAgICAgIEBleGVjdXRlQ21kICdjZCAnICsgZGlyXG4gICAgICAgICAgICBAZWRpdG9yLmZvY3VzKClcbiAgICAgICAgXG4gICAgc3Vic3RpdHV0ZTogKGNtZCkgLT5cbiAgICAgICAgXG4gICAgICAgIGNtZCA9IEBhbGlhcy5zdWJzdGl0dXRlIGNtZFxuICAgICAgICBjbWQgPSBjbWQucmVwbGFjZSAvXFx+L2csIHNsYXNoLmhvbWUoKVxuICAgICAgICBjbWRcbiAgICAgICAgICAgIFxuICAgICMgMDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwMDAwMDAgICAwMDAwMDAwICAwMDAgICAwMDAgIDAwMDAwMDAwMCAgMDAwMDAwMDAgIFxuICAgICMgMDAwICAgICAgICAwMDAgMDAwICAgMDAwICAgICAgIDAwMCAgICAgICAwMDAgICAwMDAgICAgIDAwMCAgICAgMDAwICAgICAgIFxuICAgICMgMDAwMDAwMCAgICAgMDAwMDAgICAgMDAwMDAwMCAgIDAwMCAgICAgICAwMDAgICAwMDAgICAgIDAwMCAgICAgMDAwMDAwMCAgIFxuICAgICMgMDAwICAgICAgICAwMDAgMDAwICAgMDAwICAgICAgIDAwMCAgICAgICAwMDAgICAwMDAgICAgIDAwMCAgICAgMDAwICAgICAgIFxuICAgICMgMDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwMDAwMDAgICAwMDAwMDAwICAgMDAwMDAwMCAgICAgIDAwMCAgICAgMDAwMDAwMDAgIFxuICAgIFxuICAgIGV4ZWN1dGU6IChAY21kOiwgZmFsbGJhY2s6KSA9PlxuICAgIFxuICAgICAgICBAY21kID89IEBlZGl0b3IubGFzdExpbmUoKVxuICAgICAgICBAY21kID0gQGNtZC50cmltKClcbiAgICBcbiAgICAgICAgaWYgQGNtZCA9PSAnLicgYW5kIHZhbGlkIGZhbGxiYWNrXG4gICAgICAgICAgICBAY21kID0gZmFsbGJhY2tcbiAgICAgICAgXG4gICAgICAgIGlmIEBjaGlsZFxuICAgICAgICAgICAgQGlucHV0UXVldWUucHVzaCBAY21kXG4gICAgICAgICAgICBAZWRpdG9yLnNldElucHV0VGV4dCAnJ1xuICAgICAgICAgICAgcmV0dXJuXG4gICAgICAgIFxuICAgICAgICBAZXJyb3JUZXh0ID0gJydcbiAgICAgICAgXG4gICAgICAgIGlmIEBjbWQgIT0gaHN1YiA9IEhpc3Rvcnkuc3Vic3RpdHV0ZSBAY21kXG4gICAgICAgICAgICBAY21kID0gaHN1YlxuICAgICAgICAgICAgQGVkaXRvci5zZXRJbnB1dFRleHQgQGNtZFxuICAgICAgICBcbiAgICAgICAgQGVkaXRvci5hcHBlbmRUZXh0ICcnXG4gICAgICAgIEBlZGl0b3Iuc2luZ2xlQ3Vyc29yQXRFbmQoKVxuICAgICAgICAgICAgXG4gICAgICAgIGlmIGVtcHR5IEBjbWQgXG4gICAgICAgICAgICBAdGVybS5tb3ZlSW5wdXRNZXRhKClcbiAgICAgICAgICAgIHJldHVyblxuICAgICAgICBcbiAgICAgICAgQHRlcm0uaGlzdG9yeS5zaGVsbENtZCBAY21kICMgcmVzZXQgaGlzdG9yeSBwb2ludGVyIHRvIGxhc3RcblxuICAgICAgICBAbGFzdCA9XG4gICAgICAgICAgICBjbWQ6ICAgICAgQGNtZFxuICAgICAgICAgICAgY3dkOiAgICAgIHNsYXNoLnRpbGRlIHByb2Nlc3MuY3dkKClcbiAgICAgICAgICAgIG1ldGE6ICAgICBAdGVybS5pbnNlcnRDbWRNZXRhIEBlZGl0b3IubnVtTGluZXMoKS0yIEBjbWRcbiAgICAgICAgICAgIFxuICAgICAgICBAbGFzdC5mYWxsYmFjayA9IGZhbGxiYWNrIGlmIGZhbGxiYWNrXG4gICAgICAgIFxuICAgICAgICBAZXhlY3V0ZUNtZCBAc3Vic3RpdHV0ZSBAY21kXG4gICAgICAgICAgICAgICAgXG4gICAgIyAwMDAwMDAwMCAgMDAwICAgMDAwICAwMDAwMDAwMCAgIDAwMDAwMDAgICAgICAgIDAwMDAwMDAgIDAwICAgICAwMCAgMDAwMDAwMCAgICBcbiAgICAjIDAwMCAgICAgICAgMDAwIDAwMCAgIDAwMCAgICAgICAwMDAgICAgICAgICAgICAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgIFxuICAgICMgMDAwMDAwMCAgICAgMDAwMDAgICAgMDAwMDAwMCAgIDAwMCAgICAgICAgICAgIDAwMCAgICAgICAwMDAwMDAwMDAgIDAwMCAgIDAwMCAgXG4gICAgIyAwMDAgICAgICAgIDAwMCAwMDAgICAwMDAgICAgICAgMDAwICAgICAgICAgICAgMDAwICAgICAgIDAwMCAwIDAwMCAgMDAwICAgMDAwICBcbiAgICAjIDAwMDAwMDAwICAwMDAgICAwMDAgIDAwMDAwMDAwICAgMDAwMDAwMCAgICAgICAgMDAwMDAwMCAgMDAwICAgMDAwICAwMDAwMDAwICAgIFxuICAgIFxuICAgIGV4ZWN1dGVDbWQ6IChAY21kKSA9PlxuXG4gICAgICAgIHNwbGl0ID0gQGNtZC5zcGxpdCAnJiYnXG4gICAgICAgIGlmIHNwbGl0Lmxlbmd0aCA+IDFcbiAgICAgICAgICAgIEBjbWQgPSBzcGxpdFswXS50cmltKClcbiAgICAgICAgICAgIEBxdWV1ZSA9IEBxdWV1ZS5jb25jYXQgc3BsaXRbMS4uXVxuICAgICAgICBlbHNlXG4gICAgICAgICAgICBAY21kID0gQGNtZC50cmltKClcbiAgICAgICAgXG4gICAgICAgIGlmIGVtcHR5IEBjbWRcbiAgICAgICAgICAgIEBkZXF1ZXVlKClcbiAgICAgICAgICAgIHJldHVybiB0cnVlXG4gICAgICAgIFxuICAgICAgICBpZiBAYWxpYXMub25Db21tYW5kIEBjbWRcbiAgICAgICAgICAgIEBkZXF1ZXVlKClcbiAgICAgICAgICAgIHJldHVybiB0cnVlXG5cbiAgICAgICAgaWYgQGNoZGlyLm9uQ29tbWFuZCBAY21kXG4gICAgICAgICAgICBAZGVxdWV1ZSgpXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgICAgICAgXG4gICAgICAgIEBzaGVsbENtZCBAY21kXG4gICAgICAgICAgICAgICAgICAgIFxuICAgICMgIDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwMDAwMDAgIDAwMCAgICAgIDAwMCAgICAgICAgICAgMDAwMDAwMCAgMDAgICAgIDAwICAwMDAwMDAwICAgIFxuICAgICMgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgICAgIDAwMCAgICAgICAgICAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgIFxuICAgICMgMDAwMDAwMCAgIDAwMDAwMDAwMCAgMDAwMDAwMCAgIDAwMCAgICAgIDAwMCAgICAgICAgICAwMDAgICAgICAgMDAwMDAwMDAwICAwMDAgICAwMDAgIFxuICAgICMgICAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgICAgIDAwMCAgICAgICAgICAwMDAgICAgICAgMDAwIDAgMDAwICAwMDAgICAwMDAgIFxuICAgICMgMDAwMDAwMCAgIDAwMCAgIDAwMCAgMDAwMDAwMDAgIDAwMDAwMDAgIDAwMDAwMDAgICAgICAgMDAwMDAwMCAgMDAwICAgMDAwICAwMDAwMDAwICAgIFxuICAgIFxuICAgIHNlcGVyYXRlQ21kQXJnczogKGNtZCkgLT5cbiAgICAgICAgXG4gICAgICAgIG5leHQgPSAoYywgcykgLT4gXG4gICAgICAgICAgICBuID0gY21kLmluZGV4T2YgYywgcysxXG4gICAgICAgICAgICBuID0gY21kLmxlbmd0aCBpZiBuPDBcbiAgICAgICAgICAgIG5cbiAgICAgICAgaSA9IG5leHQgJyAnICAwXG4gICAgICAgIG4gPSBuZXh0ICdcIicsIC0xXG4gICAgICAgIGlmIG4gPCBpIHRoZW4gaSA9IDEgKyBuZXh0ICdcIicgblxuICAgICAgICBleGUgPSBjbWRbMC4uLmldXG4gICAgICAgIGFyZ3MgPSBbXVxuICAgICAgICB3aGlsZSBpKysgPCBjbWQubGVuZ3RoXG4gICAgICAgICAgICBpZiBjbWRbaV0gIT0gJyAnXG4gICAgICAgICAgICAgICAgaWYgY21kW2ldID09ICdcIidcbiAgICAgICAgICAgICAgICAgICAgbiA9IG5leHQgJ1wiJyBpXG4gICAgICAgICAgICAgICAgICAgIGFyZ3MucHVzaCBjbWRbaS4uLm5dXG4gICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICBuID0gbmV4dCAnICcgaVxuICAgICAgICAgICAgICAgICAgICBhcmdzLnB1c2ggY21kW2kuLi5uXVxuICAgICAgICAgICAgICAgIGkgPSBuXG4gICAgICAgIFtleGUsIGFyZ3NdICAgICAgICBcbiAgICBcbiAgICBzaGVsbENtZDogKEBjbWQpID0+XG4gICAgICAgICAgICBcbiAgICAgICAgcHJvY2Vzcy5lbnYuTElORVMgICA9IEBlZGl0b3Iuc2Nyb2xsLmZ1bGxMaW5lc1xuICAgICAgICBwcm9jZXNzLmVudi5DT0xVTU5TID0gcGFyc2VJbnQgQGVkaXRvci5sYXllcnNXaWR0aCAvIEBlZGl0b3Iuc2l6ZS5jaGFyV2lkdGhcbiAgICAgICAgcHJvY2Vzcy5lbnYuQURCTE9DSyA9IHRydWVcbiAgICAgICAgXG4gICAgICAgIGlmIEBjbWQuZW5kc1dpdGggJyYnXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIFtjbWQsIGFyZ3NdID0gQHNlcGVyYXRlQ21kQXJncyBAY21kWzAuLi5AY21kLmxlbmd0aC0xXVxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgIyBrbG9nIFwiZGV0YWNoIHwje2NtZH18XCIgYXJnc1xuICAgICAgICAgICAgQHNwYXduID0gY2hpbGRwLnNwYXduIGNtZCwgYXJncywgZGV0YWNoZWQ6dHJ1ZSwgc2hlbGw6QHNoZWxsUGF0aCwgZW52OnByb2Nlc3MuZW52LCBjd2Q6cHJvY2Vzcy5jd2QoKSAgICBcbiAgICAgICAgICAgIEBsYXN0Lm1ldGEucGlkID0gQHNwYXduLnBpZFxuICAgICAgICAgICAgQHNwYXduLm9uICdjbG9zZScgKChwaWQpID0+IChjb2RlKSA9PiBcbiAgICAgICAgICAgICAgICAgICAga2xvZyAnc3Bhd24gZXhpdCcgY29kZSwgcGlkXG4gICAgICAgICAgICAgICAgICAgIGZvciBtZXRhIGluIEBlZGl0b3IubWV0YS5tZXRhc09mQ2xhc3MgJ3N1Y2MnXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiBtZXRhLnBpZCA9PSBwaWRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRhWzJdLm51bWJlci50ZXh0ID0gJ+KWtidcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRhWzJdLm51bWJlci5jbHNzID0gJ3N1Y2MnXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgQGVkaXRvci5tZXRhLnVwZGF0ZSBtZXRhXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWtcbiAgICAgICAgICAgICAgICApIEBzcGF3bi5waWRcbiAgICAgICAgICAgIEBvbkRvbmUgJ2J1c3knXG4gICAgICAgIGVsc2VcbiAgICAgICAgXG4gICAgICAgICAgICBAY2hpbGQgPSBjaGlsZHAuZXhlYyBAY21kLCBzaGVsbDpAc2hlbGxQYXRoLCBlbnY6cHJvY2Vzcy5lbnYsIGN3ZDpwcm9jZXNzLmN3ZCgpICAgIFxuICAgICAgICAgICAgQGNoaWxkLnN0ZG91dC5vbiAnZGF0YScgIEBvblN0ZE91dFxuICAgICAgICAgICAgQGNoaWxkLnN0ZGVyci5vbiAnZGF0YScgIEBvblN0ZEVyclxuICAgICAgICAgICAgQGNoaWxkLm9uICAgICAgICAnY2xvc2UnIEBvbkV4aXRcbiAgICAgICAgICAgIFxuICAgICAgICB0cnVlXG4gICAgICAgIFxuICAgICMgIDAwMDAwMDAgICAwMDAwMDAwICAgMDAwICAgMDAwICAgMDAwMDAwMCAgMDAwMDAwMDAgIDAwMCAgICAgIFxuICAgICMgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwMCAgMDAwICAwMDAgICAgICAgMDAwICAgICAgIDAwMCAgICAgIFxuICAgICMgMDAwICAgICAgIDAwMDAwMDAwMCAgMDAwIDAgMDAwICAwMDAgICAgICAgMDAwMDAwMCAgIDAwMCAgICAgIFxuICAgICMgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAwMDAwICAwMDAgICAgICAgMDAwICAgICAgIDAwMCAgICAgIFxuICAgICMgIDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAgMDAwMDAwMCAgMDAwMDAwMDAgIDAwMDAwMDAgIFxuICAgIFxuICAgIGhhbmRsZUNhbmNlbDogLT5cbiAgICAgICAgXG4gICAgICAgIEBxdWV1ZSA9IFtdXG4gICAgICAgIEBpbnB1dFF1ZXVlID0gW11cbiAgICAgICAgXG4gICAgICAgIGlmIG5vdCBAY2hpbGRcbiAgICAgICAgICAgIGtsb2cgJ25vIGNoaWxkPydcbiAgICAgICAgICAgIHJldHVybiAndW5oYW5kbGVkJ1xuICAgICAgICAgICAgXG4gICAgICAgIHBzVHJlZSBAY2hpbGQucGlkLCAoZXJyLCBjaGlsZHJlbikgPT5cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgYXJncyA9IGNoaWxkcmVuLm1hcCAocCkgLT4gcC5QSURcbiAgICAgICAgICAgIGFyZ3MudW5zaGlmdCBAY2hpbGQucGlkXG4gICAgICAgICAgICBhcmdzLnJldmVyc2UoKVxuICAgICAgICAgICAgQGNoaWxkLmtpbGwoKVxuICAgICAgICAgICAgZm9yIGFyZyBpbiBhcmdzXG4gICAgICAgICAgICAgICAgd3h3ICd0ZXJtaW5hdGUnIGFyZ1xuICAgICAgICB0cnVlXG4gICAgICAgIFxuICAgICMgMDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwICAwMDAwMDAwMDAgIFxuICAgICMgMDAwICAgICAgICAwMDAgMDAwICAgMDAwICAgICAwMDAgICAgIFxuICAgICMgMDAwMDAwMCAgICAgMDAwMDAgICAgMDAwICAgICAwMDAgICAgIFxuICAgICMgMDAwICAgICAgICAwMDAgMDAwICAgMDAwICAgICAwMDAgICAgIFxuICAgICMgMDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwICAgICAwMDAgICAgIFxuICAgICAgICBcbiAgICBvbkV4aXQ6IChjb2RlKSA9PlxuXG4gICAgICAgICMga2xvZyAnb25FeGl0JyBAY2hpbGQucGlkXG4gICAgICAgIGtpbGxlZCA9IEBjaGlsZC5raWxsZWRcbiAgICAgICAgZGVsZXRlIEBjaGlsZFxuICAgICAgICBcbiAgICAgICAgaWYgY29kZSA9PSAwIG9yIGtpbGxlZCBcbiAgICAgICAgICAgIHNldEltbWVkaWF0ZSBAb25Eb25lXG4gICAgICAgIGVsc2UgaWYgQGZhbGxiYWNrKClcbiAgICAgICAgICAgIEBkZXF1ZXVlKClcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgQHRlcm0uZmFpbE1ldGEgQGxhc3QubWV0YVxuICAgICAgICAgICAgaWYgbm90IC9pcyBub3QgcmVjb2duaXplZC8udGVzdCBAZXJyb3JUZXh0XG4gICAgICAgICAgICAgICAgQGVkaXRvci5hcHBlbmRPdXRwdXQgJ1xcbicrQGVycm9yVGV4dFxuICAgICAgICAgICAgQGRlcXVldWUgJ2ZhaWwnXG4gICAgICAgICAgXG4gICAgIyAwMDAwMDAwMCAgIDAwMDAwMDAgICAwMDAgICAgICAwMDAgICAgICAwMDAwMDAwICAgICAwMDAwMDAwICAgIDAwMDAwMDAgIDAwMCAgIDAwMCAgXG4gICAgIyAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAgICAwMDAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgMDAwICAgXG4gICAgIyAwMDAwMDAgICAgMDAwMDAwMDAwICAwMDAgICAgICAwMDAgICAgICAwMDAwMDAwICAgIDAwMDAwMDAwMCAgMDAwICAgICAgIDAwMDAwMDAgICAgXG4gICAgIyAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAgICAwMDAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgMDAwICAgXG4gICAgIyAwMDAgICAgICAgMDAwICAgMDAwICAwMDAwMDAwICAwMDAwMDAwICAwMDAwMDAwICAgIDAwMCAgIDAwMCAgIDAwMDAwMDAgIDAwMCAgIDAwMCAgXG4gICAgXG4gICAgZmFsbGJhY2s6IC0+XG4gICAgICAgIFxuICAgICAgICBpZiBAbGFzdC5mYWxsYmFja1xuICAgICAgICAgICAga2xvZyAnZmFsbGJhY2snIEBsYXN0LmZhbGxiYWNrXG4gICAgICAgICAgICBAZW5xdWV1ZSBjbWQ6QGxhc3QuZmFsbGJhY2ssIHVwZGF0ZTp0cnVlXG4gICAgICAgICAgICBkZWxldGUgQGxhc3QuZmFsbGJhY2tcbiAgICAgICAgICAgIHJldHVybiB0cnVlXG4gICAgICAgIFxuICAgICMgMDAwMDAwMCAgICAgMDAwMDAwMCAgIDAwMCAgIDAwMCAgMDAwMDAwMDAgIFxuICAgICMgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMDAgIDAwMCAgMDAwICAgICAgIFxuICAgICMgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAwIDAwMCAgMDAwMDAwMCAgIFxuICAgICMgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgMDAwMCAgMDAwICAgICAgIFxuICAgICMgMDAwMDAwMCAgICAgMDAwMDAwMCAgIDAwMCAgIDAwMCAgMDAwMDAwMDAgIFxuICAgIFxuICAgIG9uRG9uZTogKGxhc3RDb2RlKSA9PlxuXG4gICAgICAgIGluZm8gPSBfLmNsb25lIEBsYXN0XG4gICAgICAgIGRlbGV0ZSBpbmZvLm1ldGFcbiAgICAgICAgcG9zdC5lbWl0ICdjbWQnIGluZm8gIyBpbnNlcnQgaW50byBnbG9iYWwgaGlzdG9yeSBhbmQgYnJhaW5cbiAgICAgICAgXG4gICAgICAgIGlmIGxhc3RDb2RlICE9ICdmYWlsJyBcbiAgICAgICAgICAgIGlmIEBsYXN0Py5tZXRhP1xuICAgICAgICAgICAgICAgIEB0ZXJtLnN1Y2NNZXRhIEBsYXN0Lm1ldGEsIGxhc3RDb2RlXG4gICAgICAgICAgICBcbiAgICAgICAgaWYgZW1wdHkoQHF1ZXVlKSBhbmQgZW1wdHkoQGlucHV0UXVldWUpXG4gICAgICAgICAgICBAdGVybS5wd2QoKVxuICAgICAgICBlbHNlXG4gICAgICAgICAgICBAZGVxdWV1ZSgpXG4gICAgICAgICAgIFxuICAgICMgMDAwMDAwMDAgIDAwMCAgIDAwMCAgIDAwMDAwMDAgICAwMDAgICAwMDAgIDAwMDAwMDAwICAwMDAgICAwMDAgIDAwMDAwMDAwICBcbiAgICAjIDAwMCAgICAgICAwMDAwICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAgICAgXG4gICAgIyAwMDAwMDAwICAgMDAwIDAgMDAwICAwMDAgMDAgMDAgIDAwMCAgIDAwMCAgMDAwMDAwMCAgIDAwMCAgIDAwMCAgMDAwMDAwMCAgIFxuICAgICMgMDAwICAgICAgIDAwMCAgMDAwMCAgMDAwIDAwMDAgICAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgICAgICBcbiAgICAjIDAwMDAwMDAwICAwMDAgICAwMDAgICAwMDAwMCAwMCAgIDAwMDAwMDAgICAwMDAwMDAwMCAgIDAwMDAwMDAgICAwMDAwMDAwMCAgXG4gICAgXG4gICAgZW5xdWV1ZTogKGNtZDonJyBmcm9udDpmYWxzZSB1cGRhdGU6ZmFsc2UgYWxpYXM6ZmFsc2UpIC0+IFxuICAgIFxuICAgICAgICBpZiB1cGRhdGVcbiAgICAgICAgICAgIEBsYXN0Lm9yaWcgPSBAbGFzdC5jbWRcbiAgICAgICAgICAgIEBsYXN0LmNtZCA9IGNtZFxuICAgICAgICAgICAgaWYgQGxhc3QubWV0YVxuICAgICAgICAgICAgICAgIEBlZGl0b3IucmVwbGFjZVRleHRJbkxpbmUgQGxhc3QubWV0YVswXSwgY21kXG4gICAgICAgICAgICAgICAgQGVkaXRvci5tZXRhLnVwZGF0ZSBAbGFzdC5tZXRhXG4gICAgICAgICAgICBcbiAgICAgICAgaWYgYWxpYXNcbiAgICAgICAgICAgIEBsYXN0LmFsaWFzID0gY21kXG4gICAgICAgICAgICAgICAgXG4gICAgICAgIGNtZCA9IGNtZC5yZXBsYWNlIC9cXH4vZywgc2xhc2guaG9tZSgpXG4gICAgICAgIFxuICAgICAgICBpZiBmcm9udFxuICAgICAgICAgICAgQHF1ZXVlLnVuc2hpZnQgY21kXG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIEBxdWV1ZS5wdXNoIGNtZFxuICAgICAgICBjbWRcbiAgICAgICAgICAgICAgICAgICAgXG4gICAgIyAwMDAwMDAwICAgIDAwMDAwMDAwICAgMDAwMDAwMCAgIDAwMCAgIDAwMCAgMDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwMDAwMDAgIFxuICAgICMgMDAwICAgMDAwICAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgICAgICBcbiAgICAjIDAwMCAgIDAwMCAgMDAwMDAwMCAgIDAwMCAwMCAwMCAgMDAwICAgMDAwICAwMDAwMDAwICAgMDAwICAgMDAwICAwMDAwMDAwICAgXG4gICAgIyAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgMDAwMCAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgICAgIFxuICAgICMgMDAwMDAwMCAgICAwMDAwMDAwMCAgIDAwMDAwIDAwICAgMDAwMDAwMCAgIDAwMDAwMDAwICAgMDAwMDAwMCAgIDAwMDAwMDAwICBcbiAgICBcbiAgICBkZXF1ZXVlOiAobGFzdENvZGUpID0+XG4gXG4gICAgICAgIGlmIEBxdWV1ZS5sZW5ndGhcbiAgICAgICAgICAgIEBleGVjdXRlQ21kIEBxdWV1ZS5zaGlmdCgpXG4gICAgICAgIGVsc2UgaWYgQGlucHV0UXVldWUubGVuZ3RoXG4gICAgICAgICAgICBjbWQgPSBAaW5wdXRRdWV1ZS5zaGlmdCgpXG4gICAgICAgICAgICBAZWRpdG9yLnNldElucHV0VGV4dCBjbWRcbiAgICAgICAgICAgIEBleGVjdXRlIGNtZFxuICAgICAgICBlbHNlXG4gICAgICAgICAgICBAb25Eb25lIGxhc3RDb2RlXG4gICAgICAgIFxuICAgICMgIDAwMDAwMDAgIDAwMDAwMDAwMCAgMDAwMDAwMCAgICBcbiAgICAjIDAwMCAgICAgICAgICAwMDAgICAgIDAwMCAgIDAwMCAgXG4gICAgIyAwMDAwMDAwICAgICAgMDAwICAgICAwMDAgICAwMDAgIFxuICAgICMgICAgICAwMDAgICAgIDAwMCAgICAgMDAwICAgMDAwICBcbiAgICAjIDAwMDAwMDAgICAgICAwMDAgICAgIDAwMDAwMDAgICAgXG4gICAgXG4gICAgb25TdGRPdXQ6IChkYXRhKSA9PlxuICAgICAgICBcbiAgICAgICAgaWYgZGF0YVstMV0gPT0gJ1xcbidcbiAgICAgICAgICAgIGRhdGEgPSBkYXRhWzAuLmRhdGEubGVuZ3RoLTJdXG5cbiAgICAgICAgIyBkYXRhID0gZGF0YS5yZXBsYWNlIC8oXFx4MUJcXFtcXD8yNVtobF0pfChcXHgwYSkvZywgJydcbiAgICAgICAgICAgIFxuICAgICAgICAjIGJ1ZiA9IEJ1ZmZlci5mcm9tIGRhdGEsICd1dGY4J1xuICAgICAgICAjIGZvciBjIGluIGJ1ZlxuICAgICAgICAgICAgIyBrbG9nIFwiI3trc3RyLnBhZCBjLCAzfSAweCN7Yy50b1N0cmluZygxNil9ICcje1N0cmluZy5mcm9tQ2hhckNvZGUoYyl9J1wiXG4gICAgICAgICAgICBcbiAgICAgICAgIyBrbG9nICc9PT09PT09PT09PT09PT09JyBkYXRhXG4gICAgICAgICAgICBcbiAgICAgICAgQGVkaXRvci5hcHBlbmRPdXRwdXQgZGF0YVxuICAgICAgICAjIEBlZGl0b3Iuc2V0SW5wdXRUZXh0IEBlZGl0b3IubGFzdExpbmUoKStkYXRhXG4gICAgICAgIEBlZGl0b3Iuc2luZ2xlQ3Vyc29yQXRFbmQoKVxuXG4gICAgb25TdGRFcnI6IChkYXRhKSA9PlxuXG4gICAgICAgICMga2xvZyAnLS0tLS0tLS0tLS0tLS0tLScgZGF0YVxuICAgICAgICBcbiAgICAgICAgIyBidWYgPSBCdWZmZXIuZnJvbSBkYXRhLCAndXRmOCdcbiAgICAgICAgIyBmb3IgYyBpbiBidWZcbiAgICAgICAgICAgICMga2xvZyBcIiN7a3N0ci5wYWQgYywgM30gMHgje2MudG9TdHJpbmcoMTYpfSAnI3tTdHJpbmcuZnJvbUNoYXJDb2RlKGMpfSdcIlxuICAgICAgICBcbiAgICAgICAgaWYgZGF0YS5zdGFydHNXaXRoICdcXHgxYl0wOydcbiAgICAgICAgICAgIGtsb2cgJ2Jhc2ggcHJvbXB0J1xuICAgICAgICAgICAgZGF0YSA9IGRhdGFbNC4uXVxuICAgICAgICAgICAgaSA9IDBcbiAgICAgICAgICAgIGMgPSBkYXRhWzBdXG4gICAgICAgICAgICBwYXRoID0gJydcbiAgICAgICAgICAgIHdoaWxlIGMgIT0gJ1xceDA3J1xuICAgICAgICAgICAgICAgIHBhdGggKz0gY1xuICAgICAgICAgICAgICAgIGMgPSBkYXRhW2krK11cbiAgICAgICAgICAgIGtsb2cgJ3BhdGgnIHBhdGhcbiAgICAgICAgICAgIEBlZGl0b3IuYXBwZW5kT3V0cHV0IGRhdGFbaS4uXVxuICAgICAgICBlbHNlICAgXG4gICAgICAgICAgICBAZXJyb3JUZXh0ICs9IGRhdGFcbiAgICAgICAgXG5tb2R1bGUuZXhwb3J0cyA9IFNoZWxsXG4iXX0=
//# sourceURL=../coffee/shell.coffee