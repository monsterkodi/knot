// koffee 1.4.0

/*
 0000000  000   000  00000000  000      000    
000       000   000  000       000      000    
0000000   000000000  0000000   000      000    
     000  000   000  000       000      000    
0000000   000   000  00000000  0000000  0000000
 */
var Alias, Chdir, History, Shell, _, args, childp, empty, history, klog, os, post, psTree, ref, slash, valid, wxw,
    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
    indexOf = [].indexOf;

ref = require('kxk'), post = ref.post, history = ref.history, childp = ref.childp, slash = ref.slash, valid = ref.valid, empty = ref.empty, args = ref.args, os = ref.os, klog = ref.klog, _ = ref._;

History = require('./history');

Alias = require('./alias');

Chdir = require('./chdir');

psTree = require('ps-tree');

wxw = require('wxw');

Shell = (function() {
    function Shell(term) {
        this.term = term;
        this.onStdErr = bind(this.onStdErr, this);
        this.onStdOut = bind(this.onStdOut, this);
        this.dequeue = bind(this.dequeue, this);
        this.onDone = bind(this.onDone, this);
        this.onExit = bind(this.onExit, this);
        this.shellCmd = bind(this.shellCmd, this);
        this.executeCmd = bind(this.executeCmd, this);
        this.execute = bind(this.execute, this);
        this.cd = bind(this.cd, this);
        this.editor = this.term.editor;
        this.alias = new Alias(this);
        this.chdir = new Chdir(this);
        this.queue = [];
        this.inputQueue = [];
        this.initPath();
    }

    Shell.prototype.initPath = function() {
        var a, binDir, exeDir, f, j, k, len, len1, pth, ref1, ref2, sep;
        sep = ';';
        klog('SHELL', process.env.SHELL);
        if (os.platform() !== 'win32') {
            sep = ':';
        }
        pth = process.env.PATH.split(sep).map(function(s) {
            return slash.path(s);
        });
        ref1 = ['node_modules/.bin', 'bin', '.'];
        for (j = 0, len = ref1.length; j < len; j++) {
            a = ref1[j];
            if (indexOf.call(pth, a) < 0) {
                pth.unshift(a);
            }
        }
        if (slash.isDir('~/s')) {
            ref2 = slash.list('~/s');
            for (k = 0, len1 = ref2.length; k < len1; k++) {
                f = ref2[k];
                if (f.type === 'dir') {
                    exeDir = slash.join(f.file, f.name + "-" + process.platform + "-" + process.arch);
                    if (slash.isDir(exeDir)) {
                        pth.unshift(exeDir);
                        continue;
                    }
                    binDir = slash.join(f.file, "bin");
                    if (slash.isDir(binDir)) {
                        pth.unshift(binDir);
                    }
                }
            }
        }
        process.env.PATH = pth.map(function(s) {
            return slash.unslash(s);
        }).join(sep);
        return klog('PATH', process.env.PATH);
    };

    Shell.prototype.cd = function(dir) {
        if (!slash.samePath(dir, process.cwd())) {
            this.executeCmd('cd ' + dir);
            return this.editor.focus();
        }
    };

    Shell.prototype.substitute = function(cmd) {
        cmd = this.alias.substitute(cmd);
        cmd = cmd.replace(/\~/g, slash.home());
        return cmd;
    };

    Shell.prototype.execute = function(arg1) {
        var fallback, hsub, ref1, ref2;
        this.cmd = (ref1 = arg1.cmd) != null ? ref1 : null, fallback = (ref2 = arg1.fallback) != null ? ref2 : null;
        if (this.cmd != null) {
            this.cmd;
        } else {
            this.cmd = this.editor.lastLine();
        }
        this.cmd = this.cmd.trim();
        if (this.cmd === '.' && valid(fallback)) {
            this.cmd = fallback;
        }
        if (this.child) {
            this.inputQueue.push(this.cmd);
            this.editor.setInputText('');
            return;
        }
        this.errorText = '';
        if (this.cmd !== (hsub = History.substitute(this.cmd))) {
            this.cmd = hsub;
            this.editor.setInputText(this.cmd);
        }
        this.editor.appendText('');
        this.editor.singleCursorAtEnd();
        if (empty(this.cmd)) {
            this.term.moveInputMeta();
            return;
        }
        this.term.history.shellCmd(this.cmd);
        this.last = {
            cmd: this.cmd,
            cwd: slash.tilde(process.cwd()),
            meta: this.term.insertCmdMeta(this.editor.numLines() - 2, this.cmd)
        };
        if (fallback) {
            this.last.fallback = fallback;
        }
        return this.executeCmd(this.substitute(this.cmd));
    };

    Shell.prototype.executeCmd = function(cmd1) {
        var split;
        this.cmd = cmd1;
        split = this.cmd.split('&&');
        if (split.length > 1) {
            this.cmd = split[0].trim();
            this.queue = this.queue.concat(split.slice(1));
        } else {
            this.cmd = this.cmd.trim();
        }
        if (empty(this.cmd)) {
            this.dequeue();
            return true;
        }
        if (this.alias.onCommand(this.cmd)) {
            this.dequeue();
            return true;
        }
        if (this.chdir.onCommand(this.cmd)) {
            this.dequeue();
            return true;
        }
        return this.shellCmd(this.cmd);
    };

    Shell.prototype.shellCmd = function(cmd1) {
        var cmd, currentCommand, firstChild, i, j, opt, pipe, previousChild, ref1, split;
        this.cmd = cmd1;
        split = this.cmd.split('|');
        if (split.length > 1) {
            pipe = function(child, stdout, stderr) {
                child.stdin.on('error', function(err) {
                    return stderr.write('stdin error' + err + '\n');
                });
                child.stderr.on('data', function(data) {
                    if (!/^execvp\(\)/.test(data)) {
                        return stderr.write(data);
                    }
                });
                child.stdout.pipe(stdout);
                return child.on('error', function(err) {
                    process.stderr.write('Failed to execute ' + err + '\n');
                    return firstChild.kill();
                });
            };
            currentCommand = split[0];
            args = currentCommand.split(' ');
            cmd = args.shift();
            opt = {
                encoding: 'utf8',
                shell: true
            };
            firstChild = previousChild = this.child = childp.spawn(cmd, args, opt);
            for (i = j = 1, ref1 = split.length; 1 <= ref1 ? j < ref1 : j > ref1; i = 1 <= ref1 ? ++j : --j) {
                currentCommand = split[i].trim();
                args = currentCommand.split(' ');
                cmd = args.shift();
                this.child = childp.spawn(cmd, args, opt);
                pipe(previousChild, this.child.stdin, process.stderr);
                previousChild = this.child;
            }
            this.child.stdout.on('data', this.onStdOut);
            this.child.stderr.on('data', this.onStdErr);
            this.child.on('close', (function(_this) {
                return function(code) {
                    firstChild.kill();
                    return _this.onExit(code);
                };
            })(this));
        } else {
            this.child = childp.exec(this.cmd, {
                shell: true,
                env: process.env
            });
            this.child.stdout.on('data', this.onStdOut);
            this.child.stderr.on('data', this.onStdErr);
            this.child.on('close', this.onExit);
        }
        return true;
    };

    Shell.prototype.handleCancel = function() {
        this.queue = [];
        this.inputQueue = [];
        if (!this.child) {
            return 'unhandled';
        }
        psTree(this.child.pid, (function(_this) {
            return function(err, children) {
                var arg, j, len, results;
                args = children.map(function(p) {
                    return p.PID;
                });
                args.unshift(_this.child.pid);
                args.reverse();
                _this.child.kill();
                results = [];
                for (j = 0, len = args.length; j < len; j++) {
                    arg = args[j];
                    results.push(klog(arg, wxw('terminate', arg)));
                }
                return results;
            };
        })(this));
        return true;
    };

    Shell.prototype.onExit = function(code) {
        var killed;
        killed = this.child.killed;
        delete this.child;
        if (code === 0 || killed) {
            return setImmediate(this.onDone);
        } else if (this.fallback()) {
            return this.dequeue();
        } else {
            this.term.failMeta(this.last.meta);
            if (!/is not recognized/.test(this.errorText)) {
                this.editor.appendOutput('\n' + this.errorText);
            }
            return this.dequeue('fail');
        }
    };

    Shell.prototype.fallback = function() {
        if (this.last.fallback) {
            klog('fallback', this.last.fallback);
            this.enqueue({
                cmd: this.last.fallback,
                update: true
            });
            delete this.last.fallback;
            return true;
        }
    };

    Shell.prototype.onDone = function(lastCode) {
        var info, ref1;
        if (lastCode !== 'fail') {
            if (((ref1 = this.last) != null ? ref1.meta : void 0) != null) {
                info = _.clone(this.last);
                delete info.meta;
                post.emit('cmd', info);
                this.term.succMeta(this.last.meta);
            }
        }
        if (empty(this.queue) && empty(this.inputQueue)) {
            return this.term.pwd();
        } else {
            return this.dequeue();
        }
    };

    Shell.prototype.enqueue = function(arg1) {
        var alias, cmd, front, ref1, ref2, ref3, ref4, update;
        cmd = (ref1 = arg1.cmd) != null ? ref1 : '', front = (ref2 = arg1.front) != null ? ref2 : false, update = (ref3 = arg1.update) != null ? ref3 : false, alias = (ref4 = arg1.alias) != null ? ref4 : false;
        if (update) {
            this.last.orig = this.last.cmd;
            this.last.cmd = cmd;
            if (this.last.meta) {
                this.editor.replaceTextInLine(this.last.meta[0], cmd);
                this.editor.meta.update(this.last.meta);
            }
        }
        if (alias) {
            this.last.alias = cmd;
        }
        cmd = cmd.replace(/\~/g, slash.home());
        if (front) {
            this.queue.unshift(cmd);
        } else {
            this.queue.push(cmd);
        }
        return cmd;
    };

    Shell.prototype.dequeue = function(lastCode) {
        var cmd;
        if (this.queue.length) {
            return this.executeCmd(this.queue.shift());
        } else if (this.inputQueue.length) {
            cmd = this.inputQueue.shift();
            this.editor.setInputText(cmd);
            return this.execute(cmd);
        } else {
            return this.onDone(lastCode);
        }
    };

    Shell.prototype.onStdOut = function(data) {
        if (data.replace == null) {
            data = 'utf' + data.toString('utf8');
        }
        if (data.slice(-1)[0] === '\n') {
            data = data.slice(0, +(data.length - 2) + 1 || 9e9);
        }
        this.editor.appendOutput(data);
        return this.editor.singleCursorAtEnd();
    };

    Shell.prototype.onStdErr = function(data) {
        return this.errorText += data;
    };

    return Shell;

})();

module.exports = Shell;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2hlbGwuanMiLCJzb3VyY2VSb290IjoiLiIsInNvdXJjZXMiOlsiIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUE7Ozs7Ozs7QUFBQSxJQUFBLDZHQUFBO0lBQUE7OztBQVFBLE1BQW9FLE9BQUEsQ0FBUSxLQUFSLENBQXBFLEVBQUUsZUFBRixFQUFRLHFCQUFSLEVBQWlCLG1CQUFqQixFQUF5QixpQkFBekIsRUFBZ0MsaUJBQWhDLEVBQXVDLGlCQUF2QyxFQUE4QyxlQUE5QyxFQUFvRCxXQUFwRCxFQUF3RCxlQUF4RCxFQUE4RDs7QUFFOUQsT0FBQSxHQUFVLE9BQUEsQ0FBUSxXQUFSOztBQUNWLEtBQUEsR0FBVSxPQUFBLENBQVEsU0FBUjs7QUFDVixLQUFBLEdBQVUsT0FBQSxDQUFRLFNBQVI7O0FBQ1YsTUFBQSxHQUFVLE9BQUEsQ0FBUSxTQUFSOztBQUVWLEdBQUEsR0FBVSxPQUFBLENBQVEsS0FBUjs7QUFFSjtJQUVDLGVBQUMsSUFBRDtRQUFDLElBQUMsQ0FBQSxPQUFEOzs7Ozs7Ozs7O1FBRUEsSUFBQyxDQUFBLE1BQUQsR0FBVSxJQUFDLENBQUEsSUFBSSxDQUFDO1FBQ2hCLElBQUMsQ0FBQSxLQUFELEdBQVMsSUFBSSxLQUFKLENBQVUsSUFBVjtRQUNULElBQUMsQ0FBQSxLQUFELEdBQVMsSUFBSSxLQUFKLENBQVUsSUFBVjtRQUNULElBQUMsQ0FBQSxLQUFELEdBQVM7UUFDVCxJQUFDLENBQUEsVUFBRCxHQUFjO1FBRWQsSUFBQyxDQUFBLFFBQUQsQ0FBQTtJQVJEOztvQkFnQkgsUUFBQSxHQUFVLFNBQUE7QUFFTixZQUFBO1FBQUEsR0FBQSxHQUFNO1FBRU4sSUFBQSxDQUFLLE9BQUwsRUFBYSxPQUFPLENBQUMsR0FBRyxDQUFDLEtBQXpCO1FBRUEsSUFBRyxFQUFFLENBQUMsUUFBSCxDQUFBLENBQUEsS0FBaUIsT0FBcEI7WUFDSSxHQUFBLEdBQU0sSUFEVjs7UUFHQSxHQUFBLEdBQU0sT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENB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O0lBRlI7Ozs7OztBQUlkLE1BQU0sQ0FBQyxPQUFQLEdBQWlCIiwic291cmNlc0NvbnRlbnQiOlsiIyMjXG4gMDAwMDAwMCAgMDAwICAgMDAwICAwMDAwMDAwMCAgMDAwICAgICAgMDAwICAgIFxuMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgICAgIDAwMCAgICBcbjAwMDAwMDAgICAwMDAwMDAwMDAgIDAwMDAwMDAgICAwMDAgICAgICAwMDAgICAgXG4gICAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAgICAgMDAwICAgICAgMDAwICAgIFxuMDAwMDAwMCAgIDAwMCAgIDAwMCAgMDAwMDAwMDAgIDAwMDAwMDAgIDAwMDAwMDBcbiMjI1xuXG57IHBvc3QsIGhpc3RvcnksIGNoaWxkcCwgc2xhc2gsIHZhbGlkLCBlbXB0eSwgYXJncywgb3MsIGtsb2csIF8gfSA9IHJlcXVpcmUgJ2t4aydcblxuSGlzdG9yeSA9IHJlcXVpcmUgJy4vaGlzdG9yeSdcbkFsaWFzICAgPSByZXF1aXJlICcuL2FsaWFzJ1xuQ2hkaXIgICA9IHJlcXVpcmUgJy4vY2hkaXInXG5wc1RyZWUgID0gcmVxdWlyZSAncHMtdHJlZSdcbiMgcHR5ICAgICA9IHJlcXVpcmUgJ25vZGUtcHR5J1xud3h3ICAgICA9IHJlcXVpcmUgJ3d4dydcblxuY2xhc3MgU2hlbGxcblxuICAgIEA6IChAdGVybSkgLT5cbiAgICAgICAgXG4gICAgICAgIEBlZGl0b3IgPSBAdGVybS5lZGl0b3JcbiAgICAgICAgQGFsaWFzID0gbmV3IEFsaWFzIEBcbiAgICAgICAgQGNoZGlyID0gbmV3IENoZGlyIEBcbiAgICAgICAgQHF1ZXVlID0gW11cbiAgICAgICAgQGlucHV0UXVldWUgPSBbXVxuICAgIFxuICAgICAgICBAaW5pdFBhdGgoKVxuICAgIFxuICAgICMgMDAwMDAwMDAgICAgMDAwMDAwMCAgIDAwMDAwMDAwMCAgMDAwICAgMDAwICBcbiAgICAjIDAwMCAgIDAwMCAgMDAwICAgMDAwICAgICAwMDAgICAgIDAwMCAgIDAwMCAgXG4gICAgIyAwMDAwMDAwMCAgIDAwMDAwMDAwMCAgICAgMDAwICAgICAwMDAwMDAwMDAgIFxuICAgICMgMDAwICAgICAgICAwMDAgICAwMDAgICAgIDAwMCAgICAgMDAwICAgMDAwICBcbiAgICAjIDAwMCAgICAgICAgMDAwICAgMDAwICAgICAwMDAgICAgIDAwMCAgIDAwMCAgXG4gICAgXG4gICAgaW5pdFBhdGg6IC0+XG4gICAgICAgIFxuICAgICAgICBzZXAgPSAnOydcbiAgICAgICAgXG4gICAgICAgIGtsb2cgJ1NIRUxMJyBwcm9jZXNzLmVudi5TSEVMTFxuICAgICAgICBcbiAgICAgICAgaWYgb3MucGxhdGZvcm0oKSAhPSAnd2luMzInICNvciBwcm9jZXNzLmVudi5TSEVMTFxuICAgICAgICAgICAgc2VwID0gJzonICAgICAgICBcbiAgICAgICAgICAgIFxuICAgICAgICBwdGggPSBwcm9jZXNzLmVudi5QQVRILnNwbGl0KHNlcCkubWFwIChzKSAtPiBzbGFzaC5wYXRoIHNcblxuICAgICAgICBmb3IgYSBpbiBbJ25vZGVfbW9kdWxlcy8uYmluJyAnYmluJyAnLiddXG4gICAgICAgICAgICBpZiBhIG5vdCBpbiBwdGhcbiAgICAgICAgICAgICAgICAjIGtsb2cgXCJhZGQgdG8gUEFUSCAje2F9XCJcbiAgICAgICAgICAgICAgICBwdGgudW5zaGlmdCBhXG4gICAgICAgICAgICAgICAgXG4gICAgICAgIGlmIHNsYXNoLmlzRGlyICd+L3MnXG4gICAgICAgICAgICBmb3IgZiBpbiBzbGFzaC5saXN0ICd+L3MnXG4gICAgICAgICAgICAgICAgaWYgZi50eXBlID09ICdkaXInXG4gICAgICAgICAgICAgICAgICAgIGV4ZURpciA9IHNsYXNoLmpvaW4gZi5maWxlLCBcIiN7Zi5uYW1lfS0je3Byb2Nlc3MucGxhdGZvcm19LSN7cHJvY2Vzcy5hcmNofVwiXG4gICAgICAgICAgICAgICAgICAgIGlmIHNsYXNoLmlzRGlyIGV4ZURpclxuICAgICAgICAgICAgICAgICAgICAgICAgIyBrbG9nIFwiYWRkIGV4ZSBkaXJcIiBleGVEaXJcbiAgICAgICAgICAgICAgICAgICAgICAgIHB0aC51bnNoaWZ0IGV4ZURpclxuICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWVcbiAgICAgICAgICAgICAgICAgICAgYmluRGlyID0gc2xhc2guam9pbiBmLmZpbGUsIFwiYmluXCJcbiAgICAgICAgICAgICAgICAgICAgaWYgc2xhc2guaXNEaXIgYmluRGlyXG4gICAgICAgICAgICAgICAgICAgICAgICAjIGtsb2cgXCJhZGQgYmluIGRpclwiIGJpbkRpclxuICAgICAgICAgICAgICAgICAgICAgICAgcHRoLnVuc2hpZnQgYmluRGlyXG4gICAgICAgICAgICAgICAgXG4gICAgICAgIHByb2Nlc3MuZW52LlBBVEggPSBwdGgubWFwKChzKSAtPiBzbGFzaC51bnNsYXNoIHMpLmpvaW4gc2VwXG4gICAgICAgIFxuICAgICAgICBrbG9nICdQQVRIJyBwcm9jZXNzLmVudi5QQVRIXG4gICAgICAgIFxuICAgIGNkOiAoZGlyKSA9PlxuICAgICAgICBcbiAgICAgICAgaWYgbm90IHNsYXNoLnNhbWVQYXRoIGRpciwgcHJvY2Vzcy5jd2QoKVxuICAgICAgICAgICAgQGV4ZWN1dGVDbWQgJ2NkICcgKyBkaXJcbiAgICAgICAgICAgIEBlZGl0b3IuZm9jdXMoKVxuICAgICAgICBcbiAgICBzdWJzdGl0dXRlOiAoY21kKSAtPlxuICAgICAgICBcbiAgICAgICAgY21kID0gQGFsaWFzLnN1YnN0aXR1dGUgY21kXG4gICAgICAgIGNtZCA9IGNtZC5yZXBsYWNlIC9cXH4vZywgc2xhc2guaG9tZSgpXG4gICAgICAgIGNtZFxuICAgICAgICAgICAgXG4gICAgIyAwMDAwMDAwMCAgMDAwICAgMDAwICAwMDAwMDAwMCAgIDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwMDAwMDAwICAwMDAwMDAwMCAgXG4gICAgIyAwMDAgICAgICAgIDAwMCAwMDAgICAwMDAgICAgICAgMDAwICAgICAgIDAwMCAgIDAwMCAgICAgMDAwICAgICAwMDAgICAgICAgXG4gICAgIyAwMDAwMDAwICAgICAwMDAwMCAgICAwMDAwMDAwICAgMDAwICAgICAgIDAwMCAgIDAwMCAgICAgMDAwICAgICAwMDAwMDAwICAgXG4gICAgIyAwMDAgICAgICAgIDAwMCAwMDAgICAwMDAgICAgICAgMDAwICAgICAgIDAwMCAgIDAwMCAgICAgMDAwICAgICAwMDAgICAgICAgXG4gICAgIyAwMDAwMDAwMCAgMDAwICAgMDAwICAwMDAwMDAwMCAgIDAwMDAwMDAgICAwMDAwMDAwICAgICAgMDAwICAgICAwMDAwMDAwMCAgXG4gICAgXG4gICAgZXhlY3V0ZTogKEBjbWQ6LCBmYWxsYmFjazopID0+XG4gICAgXG4gICAgICAgIEBjbWQgPz0gQGVkaXRvci5sYXN0TGluZSgpXG4gICAgICAgIEBjbWQgPSBAY21kLnRyaW0oKVxuICAgIFxuICAgICAgICBpZiBAY21kID09ICcuJyBhbmQgdmFsaWQgZmFsbGJhY2tcbiAgICAgICAgICAgIEBjbWQgPSBmYWxsYmFja1xuICAgICAgICBcbiAgICAgICAgaWYgQGNoaWxkXG4gICAgICAgICAgICBAaW5wdXRRdWV1ZS5wdXNoIEBjbWRcbiAgICAgICAgICAgIEBlZGl0b3Iuc2V0SW5wdXRUZXh0ICcnXG4gICAgICAgICAgICByZXR1cm5cbiAgICAgICAgXG4gICAgICAgIEBlcnJvclRleHQgPSAnJ1xuICAgICAgICBcbiAgICAgICAgaWYgQGNtZCAhPSBoc3ViID0gSGlzdG9yeS5zdWJzdGl0dXRlIEBjbWRcbiAgICAgICAgICAgIEBjbWQgPSBoc3ViXG4gICAgICAgICAgICBAZWRpdG9yLnNldElucHV0VGV4dCBAY21kXG4gICAgICAgIFxuICAgICAgICBAZWRpdG9yLmFwcGVuZFRleHQgJydcbiAgICAgICAgQGVkaXRvci5zaW5nbGVDdXJzb3JBdEVuZCgpXG4gICAgICAgICAgICBcbiAgICAgICAgaWYgZW1wdHkgQGNtZCBcbiAgICAgICAgICAgIEB0ZXJtLm1vdmVJbnB1dE1ldGEoKVxuICAgICAgICAgICAgcmV0dXJuXG4gICAgICAgIFxuICAgICAgICBAdGVybS5oaXN0b3J5LnNoZWxsQ21kIEBjbWQgIyByZXNldCBoaXN0b3J5IHBvaW50ZXIgdG8gbGFzdFxuXG4gICAgICAgIEBsYXN0ID1cbiAgICAgICAgICAgIGNtZDogICAgICBAY21kXG4gICAgICAgICAgICBjd2Q6ICAgICAgc2xhc2gudGlsZGUgcHJvY2Vzcy5jd2QoKVxuICAgICAgICAgICAgbWV0YTogICAgIEB0ZXJtLmluc2VydENtZE1ldGEgQGVkaXRvci5udW1MaW5lcygpLTIgQGNtZFxuICAgICAgICAgICAgXG4gICAgICAgIEBsYXN0LmZhbGxiYWNrID0gZmFsbGJhY2sgaWYgZmFsbGJhY2tcbiAgICAgICAgXG4gICAgICAgIEBleGVjdXRlQ21kIEBzdWJzdGl0dXRlIEBjbWRcbiAgICAgICAgICAgICAgICBcbiAgICAjIDAwMDAwMDAwICAwMDAgICAwMDAgIDAwMDAwMDAwICAgMDAwMDAwMCAgICAgICAgMDAwMDAwMCAgMDAgICAgIDAwICAwMDAwMDAwICAgIFxuICAgICMgMDAwICAgICAgICAwMDAgMDAwICAgMDAwICAgICAgIDAwMCAgICAgICAgICAgIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgXG4gICAgIyAwMDAwMDAwICAgICAwMDAwMCAgICAwMDAwMDAwICAgMDAwICAgICAgICAgICAgMDAwICAgICAgIDAwMDAwMDAwMCAgMDAwICAgMDAwICBcbiAgICAjIDAwMCAgICAgICAgMDAwIDAwMCAgIDAwMCAgICAgICAwMDAgICAgICAgICAgICAwMDAgICAgICAgMDAwIDAgMDAwICAwMDAgICAwMDAgIFxuICAgICMgMDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwMDAwMDAgICAwMDAwMDAwICAgICAgICAwMDAwMDAwICAwMDAgICAwMDAgIDAwMDAwMDAgICAgXG4gICAgXG4gICAgZXhlY3V0ZUNtZDogKEBjbWQpID0+XG5cbiAgICAgICAgc3BsaXQgPSBAY21kLnNwbGl0ICcmJidcbiAgICAgICAgaWYgc3BsaXQubGVuZ3RoID4gMVxuICAgICAgICAgICAgQGNtZCA9IHNwbGl0WzBdLnRyaW0oKVxuICAgICAgICAgICAgQHF1ZXVlID0gQHF1ZXVlLmNvbmNhdCBzcGxpdFsxLi5dXG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIEBjbWQgPSBAY21kLnRyaW0oKVxuICAgICAgICBcbiAgICAgICAgaWYgZW1wdHkgQGNtZFxuICAgICAgICAgICAgQGRlcXVldWUoKVxuICAgICAgICAgICAgcmV0dXJuIHRydWVcbiAgICAgICAgXG4gICAgICAgIGlmIEBhbGlhcy5vbkNvbW1hbmQgQGNtZFxuICAgICAgICAgICAgQGRlcXVldWUoKVxuICAgICAgICAgICAgcmV0dXJuIHRydWVcblxuICAgICAgICBpZiBAY2hkaXIub25Db21tYW5kIEBjbWRcbiAgICAgICAgICAgIEBkZXF1ZXVlKClcbiAgICAgICAgICAgIHJldHVybiB0cnVlXG4gICAgICAgICAgICBcbiAgICAgICAgIyBrbG9nICdzaGVsbENtZCcgQGNtZFxuICAgICAgICBAc2hlbGxDbWQgQGNtZFxuICAgICAgICAgICAgICAgICAgICBcbiAgICAjICAwMDAwMDAwICAwMDAgICAwMDAgIDAwMDAwMDAwICAwMDAgICAgICAwMDAgICAgICAgICAgIDAwMDAwMDAgIDAwICAgICAwMCAgMDAwMDAwMCAgICBcbiAgICAjIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAgICAwMDAgICAgICAgICAgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICBcbiAgICAjIDAwMDAwMDAgICAwMDAwMDAwMDAgIDAwMDAwMDAgICAwMDAgICAgICAwMDAgICAgICAgICAgMDAwICAgICAgIDAwMDAwMDAwMCAgMDAwICAgMDAwICBcbiAgICAjICAgICAgMDAwICAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAgICAwMDAgICAgICAgICAgMDAwICAgICAgIDAwMCAwIDAwMCAgMDAwICAgMDAwICBcbiAgICAjIDAwMDAwMDAgICAwMDAgICAwMDAgIDAwMDAwMDAwICAwMDAwMDAwICAwMDAwMDAwICAgICAgIDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwMDAwMCAgICBcbiAgICBcbiAgICBzaGVsbENtZDogKEBjbWQpID0+XG4gICAgICAgICAgICBcbiAgICAgICAgc3BsaXQgPSBAY21kLnNwbGl0ICd8J1xuICAgICAgICBcbiAgICAgICAgaWYgc3BsaXQubGVuZ3RoID4gMVxuICAgICAgICAgICAgXG4gICAgICAgICAgICAjIDAwMDAwMDAwICAgMDAwICAwMDAwMDAwMCAgIDAwMDAwMDAwICBcbiAgICAgICAgICAgICMgMDAwICAgMDAwICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgICAgIFxuICAgICAgICAgICAgIyAwMDAwMDAwMCAgIDAwMCAgMDAwMDAwMDAgICAwMDAwMDAwICAgXG4gICAgICAgICAgICAjIDAwMCAgICAgICAgMDAwICAwMDAgICAgICAgIDAwMCAgICAgICBcbiAgICAgICAgICAgICMgMDAwICAgICAgICAwMDAgIDAwMCAgICAgICAgMDAwMDAwMDAgIFxuICAgICAgICAgICAgXG4gICAgICAgICAgICBwaXBlID0gKGNoaWxkLCBzdGRvdXQsIHN0ZGVycikgLT5cbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBjaGlsZC5zdGRpbi5vbiAnZXJyb3InIChlcnIpIC0+IHN0ZGVyci53cml0ZSAnc3RkaW4gZXJyb3InICsgZXJyICsgJ1xcbidcbiAgICAgICAgICAgICAgICBjaGlsZC5zdGRlcnIub24gJ2RhdGEnIChkYXRhKSAtPiBpZiBub3QgL15leGVjdnBcXChcXCkvLnRlc3QgZGF0YSB0aGVuIHN0ZGVyci53cml0ZSBkYXRhXG4gICAgICAgICAgICAgICAgY2hpbGQuc3Rkb3V0LnBpcGUgc3Rkb3V0XG4gICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBjaGlsZC5vbiAnZXJyb3InIChlcnIpIC0+XG4gICAgICAgICAgICAgICAgICAgIHByb2Nlc3Muc3RkZXJyLndyaXRlICdGYWlsZWQgdG8gZXhlY3V0ZSAnICsgZXJyICsgJ1xcbidcbiAgICAgICAgICAgICAgICAgICAgZmlyc3RDaGlsZC5raWxsKClcblxuICAgICAgICAgICAgY3VycmVudENvbW1hbmQgPSBzcGxpdFswXVxuICAgICAgICAgICAgYXJncyA9IGN1cnJlbnRDb21tYW5kLnNwbGl0ICcgJ1xuICAgICAgICAgICAgY21kID0gYXJncy5zaGlmdCgpXG4gICAgICAgICAgICBvcHQgPSBlbmNvZGluZzondXRmOCcgc2hlbGw6dHJ1ZVxuICAgICAgICAgICAgZmlyc3RDaGlsZCA9IHByZXZpb3VzQ2hpbGQgPSBAY2hpbGQgPSBjaGlsZHAuc3Bhd24gY21kLCBhcmdzLCBvcHRcbiAgICAgICAgXG4gICAgICAgICAgICBmb3IgaSBpbiBbMS4uLnNwbGl0Lmxlbmd0aF1cbiAgICAgICAgICAgICAgICBjdXJyZW50Q29tbWFuZCA9IHNwbGl0W2ldLnRyaW0oKVxuICAgICAgICAgICAgICAgIGFyZ3MgPSBjdXJyZW50Q29tbWFuZC5zcGxpdCAnICdcbiAgICAgICAgICAgICAgICBjbWQgPSBhcmdzLnNoaWZ0KClcbiAgICAgICAgICAgICAgICBAY2hpbGQgPSBjaGlsZHAuc3Bhd24gY21kLCBhcmdzLCBvcHRcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBwaXBlIHByZXZpb3VzQ2hpbGQsIEBjaGlsZC5zdGRpbiwgcHJvY2Vzcy5zdGRlcnJcbiAgICAgICAgXG4gICAgICAgICAgICAgICAgcHJldmlvdXNDaGlsZCA9IEBjaGlsZFxuICAgICAgICBcbiAgICAgICAgICAgIEBjaGlsZC5zdGRvdXQub24gJ2RhdGEnIEBvblN0ZE91dFxuICAgICAgICAgICAgQGNoaWxkLnN0ZGVyci5vbiAnZGF0YScgQG9uU3RkRXJyXG4gICAgICAgIFxuICAgICAgICAgICAgQGNoaWxkLm9uICdjbG9zZScgKGNvZGUpID0+XG4gICAgICAgICAgICAgICAgZmlyc3RDaGlsZC5raWxsKClcbiAgICAgICAgICAgICAgICBAb25FeGl0IGNvZGVcbiAgICAgICAgZWxzZVxuICAgICAgICBcbiAgICAgICAgICAgICMgMDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwMDAwMDAgICAwMDAwMDAwICBcbiAgICAgICAgICAgICMgMDAwICAgICAgICAwMDAgMDAwICAgMDAwICAgICAgIDAwMCAgICAgICBcbiAgICAgICAgICAgICMgMDAwMDAwMCAgICAgMDAwMDAgICAgMDAwMDAwMCAgIDAwMCAgICAgICBcbiAgICAgICAgICAgICMgMDAwICAgICAgICAwMDAgMDAwICAgMDAwICAgICAgIDAwMCAgICAgICBcbiAgICAgICAgICAgICMgMDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwMDAwMDAgICAwMDAwMDAwICBcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgIyBzaGVsbCA9IG9zLnBsYXRmb3JtKCkgPT0gJ3dpbjMyJyBhbmQgJ2NtZCcgb3IgJ2Jhc2gnXG4gICAgICAgICAgICAjIEBjaGlsZCA9IHB0eS5zcGF3biBzaGVsbCwgW10sXG4gICAgICAgICAgICAgICAgIyB1c2VDb25wdHk6IHRydWUgXG4gICAgICAgICAgICAgICAgIyBuYW1lOiAneHRlcm0tY29sb3InXG4gICAgICAgICAgICAgICAgIyBjb2xzOiA4MFxuICAgICAgICAgICAgICAgICMgcm93czogMzBcbiAgICAgICAgICAgICAgICAjIGN3ZDogcHJvY2Vzcy5jd2QoKVxuICAgICAgICAgICAgICAgICMgZW52OiBwcm9jZXNzLmVudlxuIyAgICAgICAgICAgICBcbiAgICAgICAgICAgICMgQGNoaWxkLm9uRGF0YSBAb25TdGRPdXRcbiAgICAgICAgICAgICMgQGNoaWxkLndyaXRlIFwiI3tjbWR9XFxyXCJcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgIEBjaGlsZCA9IGNoaWxkcC5leGVjIEBjbWQsIHNoZWxsOnRydWUsIGVudjpwcm9jZXNzLmVudiAgICAgICAgICBcbiAgICAgICAgICAgIEBjaGlsZC5zdGRvdXQub24gJ2RhdGEnICBAb25TdGRPdXRcbiAgICAgICAgICAgIEBjaGlsZC5zdGRlcnIub24gJ2RhdGEnICBAb25TdGRFcnJcbiAgICAgICAgICAgIEBjaGlsZC5vbiAgICAgICAgJ2Nsb3NlJyBAb25FeGl0XG4gICAgICAgICAgICBcbiAgICAgICAgdHJ1ZVxuICAgICAgICBcbiAgICAjICAwMDAwMDAwICAgMDAwMDAwMCAgIDAwMCAgIDAwMCAgIDAwMDAwMDAgIDAwMDAwMDAwICAwMDAgICAgICBcbiAgICAjIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMDAgIDAwMCAgMDAwICAgICAgIDAwMCAgICAgICAwMDAgICAgICBcbiAgICAjIDAwMCAgICAgICAwMDAwMDAwMDAgIDAwMCAwIDAwMCAgMDAwICAgICAgIDAwMDAwMDAgICAwMDAgICAgICBcbiAgICAjIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgMDAwMCAgMDAwICAgICAgIDAwMCAgICAgICAwMDAgICAgICBcbiAgICAjICAwMDAwMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgIDAwMDAwMDAgIDAwMDAwMDAwICAwMDAwMDAwICBcbiAgICBcbiAgICBoYW5kbGVDYW5jZWw6IC0+XG4gICAgICAgIFxuICAgICAgICBAcXVldWUgPSBbXVxuICAgICAgICBAaW5wdXRRdWV1ZSA9IFtdXG4gICAgICAgIFxuICAgICAgICByZXR1cm4gJ3VuaGFuZGxlZCcgaWYgbm90IEBjaGlsZFxuICAgICAgICBcbiAgICAgICAgcHNUcmVlIEBjaGlsZC5waWQsIChlcnIsIGNoaWxkcmVuKSA9PlxuICAgICAgICAgICAgXG4gICAgICAgICAgICBhcmdzID0gY2hpbGRyZW4ubWFwIChwKSAtPiBwLlBJRFxuICAgICAgICAgICAgYXJncy51bnNoaWZ0IEBjaGlsZC5waWRcbiAgICAgICAgICAgIGFyZ3MucmV2ZXJzZSgpXG4gICAgICAgICAgICBAY2hpbGQua2lsbCgpXG4gICAgICAgICAgICBmb3IgYXJnIGluIGFyZ3NcbiAgICAgICAgICAgICAgICBrbG9nIGFyZywgd3h3ICd0ZXJtaW5hdGUnIGFyZ1xuICAgICAgICB0cnVlXG4gICAgICAgIFxuICAgICMgMDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwICAwMDAwMDAwMDAgIFxuICAgICMgMDAwICAgICAgICAwMDAgMDAwICAgMDAwICAgICAwMDAgICAgIFxuICAgICMgMDAwMDAwMCAgICAgMDAwMDAgICAgMDAwICAgICAwMDAgICAgIFxuICAgICMgMDAwICAgICAgICAwMDAgMDAwICAgMDAwICAgICAwMDAgICAgIFxuICAgICMgMDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwICAgICAwMDAgICAgIFxuICAgICAgICBcbiAgICBvbkV4aXQ6IChjb2RlKSA9PlxuXG4gICAgICAgIGtpbGxlZCA9IEBjaGlsZC5raWxsZWRcbiAgICAgICAgZGVsZXRlIEBjaGlsZFxuICAgICAgICBcbiAgICAgICAgaWYgY29kZSA9PSAwIG9yIGtpbGxlZCBcbiAgICAgICAgICAgIHNldEltbWVkaWF0ZSBAb25Eb25lXG4gICAgICAgIGVsc2UgaWYgQGZhbGxiYWNrKClcbiAgICAgICAgICAgIEBkZXF1ZXVlKClcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgQHRlcm0uZmFpbE1ldGEgQGxhc3QubWV0YVxuICAgICAgICAgICAgaWYgbm90IC9pcyBub3QgcmVjb2duaXplZC8udGVzdCBAZXJyb3JUZXh0XG4gICAgICAgICAgICAgICAgQGVkaXRvci5hcHBlbmRPdXRwdXQgJ1xcbicrQGVycm9yVGV4dFxuICAgICAgICAgICAgQGRlcXVldWUgJ2ZhaWwnXG4gICAgICAgICAgXG4gICAgIyAwMDAwMDAwMCAgIDAwMDAwMDAgICAwMDAgICAgICAwMDAgICAgICAwMDAwMDAwICAgICAwMDAwMDAwICAgIDAwMDAwMDAgIDAwMCAgIDAwMCAgXG4gICAgIyAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAgICAwMDAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgMDAwICAgXG4gICAgIyAwMDAwMDAgICAgMDAwMDAwMDAwICAwMDAgICAgICAwMDAgICAgICAwMDAwMDAwICAgIDAwMDAwMDAwMCAgMDAwICAgICAgIDAwMDAwMDAgICAgXG4gICAgIyAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAgICAwMDAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgMDAwICAgXG4gICAgIyAwMDAgICAgICAgMDAwICAgMDAwICAwMDAwMDAwICAwMDAwMDAwICAwMDAwMDAwICAgIDAwMCAgIDAwMCAgIDAwMDAwMDAgIDAwMCAgIDAwMCAgXG4gICAgXG4gICAgZmFsbGJhY2s6IC0+XG4gICAgICAgIFxuICAgICAgICBpZiBAbGFzdC5mYWxsYmFja1xuICAgICAgICAgICAga2xvZyAnZmFsbGJhY2snIEBsYXN0LmZhbGxiYWNrXG4gICAgICAgICAgICBAZW5xdWV1ZSBjbWQ6QGxhc3QuZmFsbGJhY2ssIHVwZGF0ZTp0cnVlXG4gICAgICAgICAgICBkZWxldGUgQGxhc3QuZmFsbGJhY2tcbiAgICAgICAgICAgIHJldHVybiB0cnVlXG4gICAgICAgIFxuICAgICMgMDAwMDAwMCAgICAgMDAwMDAwMCAgIDAwMCAgIDAwMCAgMDAwMDAwMDAgIFxuICAgICMgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMDAgIDAwMCAgMDAwICAgICAgIFxuICAgICMgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAwIDAwMCAgMDAwMDAwMCAgIFxuICAgICMgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgMDAwMCAgMDAwICAgICAgIFxuICAgICMgMDAwMDAwMCAgICAgMDAwMDAwMCAgIDAwMCAgIDAwMCAgMDAwMDAwMDAgIFxuICAgIFxuICAgIG9uRG9uZTogKGxhc3RDb2RlKSA9PlxuXG4gICAgICAgIGlmIGxhc3RDb2RlICE9ICdmYWlsJyBcbiAgICAgICAgICAgIGlmIEBsYXN0Py5tZXRhP1xuICAgICAgICAgICAgICAgIGluZm8gPSBfLmNsb25lIEBsYXN0XG4gICAgICAgICAgICAgICAgZGVsZXRlIGluZm8ubWV0YVxuICAgICAgICAgICAgICAgIHBvc3QuZW1pdCAnY21kJyBpbmZvICMgaW5zZXJ0IGludG8gZ2xvYmFsIGhpc3RvcnkgYW5kIGJyYWluXG4gICAgICAgICAgICAgICAgQHRlcm0uc3VjY01ldGEgQGxhc3QubWV0YVxuICAgICAgICBpZiBlbXB0eShAcXVldWUpIGFuZCBlbXB0eShAaW5wdXRRdWV1ZSlcbiAgICAgICAgICAgIEB0ZXJtLnB3ZCgpXG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIEBkZXF1ZXVlKClcbiAgICAgICAgICAgXG4gICAgIyAwMDAwMDAwMCAgMDAwICAgMDAwICAgMDAwMDAwMCAgIDAwMCAgIDAwMCAgMDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwMDAwMDAgIFxuICAgICMgMDAwICAgICAgIDAwMDAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgICAgICBcbiAgICAjIDAwMDAwMDAgICAwMDAgMCAwMDAgIDAwMCAwMCAwMCAgMDAwICAgMDAwICAwMDAwMDAwICAgMDAwICAgMDAwICAwMDAwMDAwICAgXG4gICAgIyAwMDAgICAgICAgMDAwICAwMDAwICAwMDAgMDAwMCAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgICAgIFxuICAgICMgMDAwMDAwMDAgIDAwMCAgIDAwMCAgIDAwMDAwIDAwICAgMDAwMDAwMCAgIDAwMDAwMDAwICAgMDAwMDAwMCAgIDAwMDAwMDAwICBcbiAgICBcbiAgICBlbnF1ZXVlOiAoY21kOicnIGZyb250OmZhbHNlIHVwZGF0ZTpmYWxzZSBhbGlhczpmYWxzZSkgLT4gXG4gICAgXG4gICAgICAgIGlmIHVwZGF0ZVxuICAgICAgICAgICAgQGxhc3Qub3JpZyA9IEBsYXN0LmNtZFxuICAgICAgICAgICAgQGxhc3QuY21kID0gY21kXG4gICAgICAgICAgICBpZiBAbGFzdC5tZXRhXG4gICAgICAgICAgICAgICAgQGVkaXRvci5yZXBsYWNlVGV4dEluTGluZSBAbGFzdC5tZXRhWzBdLCBjbWRcbiAgICAgICAgICAgICAgICBAZWRpdG9yLm1ldGEudXBkYXRlIEBsYXN0Lm1ldGFcbiAgICAgICAgICAgIFxuICAgICAgICBpZiBhbGlhc1xuICAgICAgICAgICAgQGxhc3QuYWxpYXMgPSBjbWRcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgY21kID0gY21kLnJlcGxhY2UgL1xcfi9nLCBzbGFzaC5ob21lKClcbiAgICAgICAgXG4gICAgICAgIGlmIGZyb250XG4gICAgICAgICAgICBAcXVldWUudW5zaGlmdCBjbWRcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgQHF1ZXVlLnB1c2ggY21kXG4gICAgICAgIGNtZFxuICAgICAgICAgICAgICAgICAgICBcbiAgICAjIDAwMDAwMDAgICAgMDAwMDAwMDAgICAwMDAwMDAwICAgMDAwICAgMDAwICAwMDAwMDAwMCAgMDAwICAgMDAwICAwMDAwMDAwMCAgXG4gICAgIyAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgICAgIFxuICAgICMgMDAwICAgMDAwICAwMDAwMDAwICAgMDAwIDAwIDAwICAwMDAgICAwMDAgIDAwMDAwMDAgICAwMDAgICAwMDAgIDAwMDAwMDAgICBcbiAgICAjIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAwMDAwICAgMDAwICAgMDAwICAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAgICAgXG4gICAgIyAwMDAwMDAwICAgIDAwMDAwMDAwICAgMDAwMDAgMDAgICAwMDAwMDAwICAgMDAwMDAwMDAgICAwMDAwMDAwICAgMDAwMDAwMDAgIFxuICAgIFxuICAgIGRlcXVldWU6IChsYXN0Q29kZSkgPT5cbiBcbiAgICAgICAgaWYgQHF1ZXVlLmxlbmd0aFxuICAgICAgICAgICAgQGV4ZWN1dGVDbWQgQHF1ZXVlLnNoaWZ0KClcbiAgICAgICAgZWxzZSBpZiBAaW5wdXRRdWV1ZS5sZW5ndGhcbiAgICAgICAgICAgIGNtZCA9IEBpbnB1dFF1ZXVlLnNoaWZ0KClcbiAgICAgICAgICAgIEBlZGl0b3Iuc2V0SW5wdXRUZXh0IGNtZFxuICAgICAgICAgICAgQGV4ZWN1dGUgY21kXG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIEBvbkRvbmUgbGFzdENvZGVcbiAgICAgICAgXG4gICAgIyAgMDAwMDAwMCAgMDAwMDAwMDAwICAwMDAwMDAwICAgIFxuICAgICMgMDAwICAgICAgICAgIDAwMCAgICAgMDAwICAgMDAwICBcbiAgICAjIDAwMDAwMDAgICAgICAwMDAgICAgIDAwMCAgIDAwMCAgXG4gICAgIyAgICAgIDAwMCAgICAgMDAwICAgICAwMDAgICAwMDAgIFxuICAgICMgMDAwMDAwMCAgICAgIDAwMCAgICAgMDAwMDAwMCAgICBcbiAgICBcbiAgICBvblN0ZE91dDogKGRhdGEpID0+XG4gICAgICAgIFxuICAgICAgICBpZiBub3QgZGF0YS5yZXBsYWNlP1xuICAgICAgICAgICAgZGF0YSA9ICd1dGYnICsgZGF0YS50b1N0cmluZyAndXRmOCdcbiAgICAgICAgaWYgZGF0YVstMV0gPT0gJ1xcbidcbiAgICAgICAgICAgIGRhdGEgPSBkYXRhWzAuLmRhdGEubGVuZ3RoLTJdXG5cbiAgICAgICAgIyBkYXRhID0gZGF0YS5yZXBsYWNlIC8oXFx4MUJcXFtcXD8yNVtobF0pfChcXHgwYSkvZywgJydcbiAgICAgICAgICAgIFxuICAgICAgICAjIGJ1ZiA9IEJ1ZmZlci5mcm9tIGRhdGEsICd1dGY4J1xuICAgICAgICAjIGZvciBjIGluIGJ1ZlxuICAgICAgICAgICAgIyBrbG9nIFwiI3tjfSAjI3tjLnRvU3RyaW5nKDE2KX0gJyN7U3RyaW5nLmZyb21DaGFyQ29kZShjKX0nXCJcbiAgICAgICAgICAgIFxuICAgICAgICBAZWRpdG9yLmFwcGVuZE91dHB1dCBkYXRhXG4gICAgICAgICMgQGVkaXRvci5zZXRJbnB1dFRleHQgQGVkaXRvci5sYXN0TGluZSgpK2RhdGFcbiAgICAgICAgQGVkaXRvci5zaW5nbGVDdXJzb3JBdEVuZCgpXG5cbiAgICBvblN0ZEVycjogKGRhdGEpID0+XG5cbiAgICAgICAgQGVycm9yVGV4dCArPSBkYXRhXG4gICAgICAgIFxubW9kdWxlLmV4cG9ydHMgPSBTaGVsbFxuIl19
//# sourceURL=../coffee/shell.coffee