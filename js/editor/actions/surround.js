// koffee 1.4.0
var _, ref, reversed;

ref = require('kxk'), reversed = ref.reversed, _ = ref._;

module.exports = {
    initSurround: function() {
        this.surroundStack = [];
        this.surroundPairs = {
            '#': ['#{', '}'],
            '{': ['{', '}'],
            '}': ['{', '}'],
            '[': ['[', ']'],
            ']': ['[', ']'],
            '(': ['(', ')'],
            ')': ['(', ')'],
            '<': ['<', '>'],
            '>': ['<', '>'],
            "'": ["'", "'"],
            '"': ['"', '"'],
            '*': ['*', '*']
        };
        return this.surroundCharacters = "{}[]()\"'".split('');
    },
    isUnbalancedSurroundCharacter: function(ch) {
        var c, cl, count, cr, cursor, i, j, len, len1, ref1, ref2, ref3;
        if (ch === "#") {
            return false;
        }
        ref1 = this.surroundPairs[ch], cl = ref1[0], cr = ref1[1];
        if (cl.length > 1) {
            return false;
        }
        ref2 = this.cursors();
        for (i = 0, len = ref2.length; i < len; i++) {
            cursor = ref2[i];
            count = 0;
            ref3 = this.line(cursor[1]);
            for (j = 0, len1 = ref3.length; j < len1; j++) {
                c = ref3[j];
                if (c === cl) {
                    count += 1;
                } else if (c === cr) {
                    count -= 1;
                }
            }
            if (((cl === cr) && (count % 2)) || ((cl !== cr) && count)) {
                return true;
            }
        }
        return false;
    },
    selectionContainsOnlyQuotes: function() {
        var c, i, len, ref1;
        ref1 = this.textOfSelection();
        for (i = 0, len = ref1.length; i < len; i++) {
            c = ref1[i];
            if (c === '\n') {
                continue;
            }
            if (c !== '"' && c !== "'") {
                return false;
            }
        }
        return true;
    },
    insertTripleQuotes: function() {
        var after, before, p, ref1;
        if (this.numCursors() > 1) {
            return false;
        }
        if (this.numSelections()) {
            return false;
        }
        p = this.cursorPos();
        ref1 = this.splitStateLineAtPos(this.state, p), before = ref1[0], after = ref1[1];
        if (!before.endsWith('""')) {
            return false;
        }
        if (before.length > 2 && before[before.length - 3] === '"') {
            return false;
        }
        if (after.startsWith('"')) {
            return false;
        }
        this["do"].start();
        this["do"].change(p[1], before + '""""' + after);
        this["do"].setCursors([[p[0] + 1, p[1]]]);
        this["do"].end();
        return true;
    },
    insertSurroundCharacter: function(ch) {
        var c, cl, cr, found, i, j, k, l, len, len1, len2, len3, len4, len5, len6, len7, m, n, newCursors, newSelections, ns, o, os, q, ref1, ref2, ref3, ref4, ref5, ref6, sr;
        if (this.isUnbalancedSurroundCharacter(ch)) {
            return false;
        }
        if (this.numSelections() && (ch === '"' || ch === "'") && this.selectionContainsOnlyQuotes()) {
            return false;
        }
        newCursors = this["do"].cursors();
        if (this.surroundStack.length) {
            if (_.last(this.surroundStack)[1] === ch) {
                for (i = 0, len = newCursors.length; i < len; i++) {
                    c = newCursors[i];
                    if (this["do"].line(c[1])[c[0]] !== ch) {
                        this.surroundStack = [];
                        break;
                    }
                }
                if (this.surroundStack.length && _.last(this.surroundStack)[1] === ch) {
                    this["do"].start();
                    this.selectNone();
                    this.deleteForward();
                    this["do"].end();
                    this.surroundStack.pop();
                    return false;
                }
            }
            if (!found) {
                for (j = 0, len1 = newCursors.length; j < len1; j++) {
                    c = newCursors[j];
                    if (this.isRangeInString(rangeForPos(c))) {
                        found = true;
                        break;
                    }
                }
            }
            if (!found) {
                return false;
            }
        }
        if (ch === "'" && !this.numSelections()) {
            for (k = 0, len2 = newCursors.length; k < len2; k++) {
                c = newCursors[k];
                if (c[0] > 0 && /[A-Za-z]/.test(this["do"].line(c[1])[c[0] - 1])) {
                    return false;
                }
            }
        }
        this["do"].start();
        if (this["do"].numSelections() === 0) {
            newSelections = rangesFromPositions(newCursors);
        } else {
            newSelections = this["do"].selections();
        }
        ref1 = this.surroundPairs[ch], cl = ref1[0], cr = ref1[1];
        this.surroundStack.push([cl, cr]);
        ref2 = reversed(newSelections);
        for (l = 0, len3 = ref2.length; l < len3; l++) {
            ns = ref2[l];
            if (cl === '#{') {
                if (sr = this.rangeOfStringSurroundingRange(ns)) {
                    if (this["do"].line(sr[0])[sr[1][0]] === "'") {
                        this["do"].change(ns[0], this["do"].line(ns[0]).splice(sr[1][0], 1, '"'));
                    }
                    if (this["do"].line(sr[0])[sr[1][1] - 1] === "'") {
                        this["do"].change(ns[0], this["do"].line(ns[0]).splice(sr[1][1] - 1, 1, '"'));
                    }
                }
            }
            this["do"].change(ns[0], this["do"].line(ns[0]).splice(ns[1][1], 0, cr));
            this["do"].change(ns[0], this["do"].line(ns[0]).splice(ns[1][0], 0, cl));
            ref3 = positionsAfterLineColInPositions(ns[0], ns[1][0] - 1, newCursors);
            for (m = 0, len4 = ref3.length; m < len4; m++) {
                c = ref3[m];
                c[0] += cl.length;
            }
            ref4 = rangesAfterLineColInRanges(ns[0], ns[1][1] - 1, newSelections);
            for (n = 0, len5 = ref4.length; n < len5; n++) {
                os = ref4[n];
                os[1][0] += cr.length;
                os[1][1] += cr.length;
            }
            ref5 = rangesAfterLineColInRanges(ns[0], ns[1][0] - 1, newSelections);
            for (o = 0, len6 = ref5.length; o < len6; o++) {
                os = ref5[o];
                os[1][0] += cl.length;
                os[1][1] += cl.length;
            }
            ref6 = positionsAfterLineColInPositions(ns[0], ns[1][1], newCursors);
            for (q = 0, len7 = ref6.length; q < len7; q++) {
                c = ref6[q];
                c[0] += cr.length;
            }
        }
        this["do"].select(rangesNotEmptyInRanges(newSelections));
        this["do"].setCursors(newCursors);
        this["do"].end();
        return true;
    },
    deleteEmptySurrounds: function() {
        var after, before, c, cs, i, j, k, l, len, len1, len2, len3, nc, numPairs, openClosePairs, pairs, ref1, ref2, ref3, sc, so, uniquePairs;
        cs = this["do"].cursors();
        pairs = _.uniqWith(_.values(this.surroundPairs), _.isEqual);
        openClosePairs = [];
        for (i = 0, len = cs.length; i < len; i++) {
            c = cs[i];
            numPairs = openClosePairs.length;
            for (j = 0, len1 = pairs.length; j < len1; j++) {
                ref1 = pairs[j], so = ref1[0], sc = ref1[1];
                before = this["do"].line(c[1]).slice(c[0] - so.length, c[0]);
                after = this["do"].line(c[1]).slice(c[0], c[0] + sc.length);
                if (so === before && sc === after) {
                    openClosePairs.push([so, sc]);
                    break;
                }
            }
            if (numPairs === openClosePairs.length) {
                return false;
            }
        }
        if (cs.length !== openClosePairs.length) {
            return false;
        }
        uniquePairs = _.uniqWith(openClosePairs, _.isEqual);
        for (k = 0, len2 = cs.length; k < len2; k++) {
            c = cs[k];
            ref2 = openClosePairs.shift(), so = ref2[0], sc = ref2[1];
            this["do"].change(c[1], this["do"].line(c[1]).splice(c[0] - so.length, so.length + sc.length));
            ref3 = positionsAfterLineColInPositions(c[1], c[0], cs);
            for (l = 0, len3 = ref3.length; l < len3; l++) {
                nc = ref3[l];
                nc[0] -= sc.length + so.length;
            }
            c[0] -= so.length;
        }
        if (this.surroundStack.length) {
            if (uniquePairs.length === 1 && _.isEqual(uniquePairs[0], _.last(this.surroundStack))) {
                this.surroundStack.pop();
            } else {
                this.surroundStack = [];
            }
        }
        this["do"].setCursors(cs);
        return true;
    },
    highlightsSurroundingCursor: function() {
        var hs;
        if (this.numHighlights() % 2 === 0) {
            hs = this.highlights();
            sortRanges(hs);
            if (this.numHighlights() === 2) {
                return hs;
            } else if (this.numHighlights() === 4) {
                if (areSameRanges([hs[1], hs[2]], this.selections())) {
                    return [hs[0], hs[3]];
                } else {
                    return [hs[1], hs[2]];
                }
            }
        }
    }
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3Vycm91bmQuanMiLCJzb3VyY2VSb290IjoiLiIsInNvdXJjZXMiOlsiIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFPQSxJQUFBOztBQUFBLE1BQWtCLE9BQUEsQ0FBUSxLQUFSLENBQWxCLEVBQUUsdUJBQUYsRUFBWTs7QUFFWixNQUFNLENBQUMsT0FBUCxHQUVJO0lBQUEsWUFBQSxFQUFjLFNBQUE7UUFFVixJQUFDLENBQUEsYUFBRCxHQUFpQjtRQUVqQixJQUFDLENBQUEsYUFBRCxHQUNJO1lBQUEsR0FBQSxFQUFLLENBQUMsSUFBRCxFQUFNLEdBQU4sQ0FBTDtZQUNBLEdBQUEsRUFBSyxDQUFDLEdBQUQsRUFBSyxHQUFMLENBREw7WUFFQSxHQUFBLEVBQUssQ0FBQyxHQUFELEVBQUssR0FBTCxDQUZMO1lBR0EsR0FBQSxFQUFLLENBQUMsR0FBRCxFQUFLLEdBQUwsQ0FITDtZQUlBLEdBQUEsRUFBSyxDQUFDLEdBQUQsRUFBSyxHQUFMLENBSkw7WUFLQSxHQUFBLEVBQUssQ0FBQyxHQUFELEVBQUssR0FBTCxDQUxMO1lBTUEsR0FBQSxFQUFLLENBQUMsR0FBRCxFQUFLLEdBQUwsQ0FOTDtZQU9BLEdBQUEsRUFBSyxDQUFDLEdBQUQsRUFBSyxHQUFMLENBUEw7WUFRQSxHQUFBLEVBQUssQ0FBQyxHQUFELEVBQUssR0FBTCxDQVJMO1lBU0EsR0FBQSxFQUFLLENBQUMsR0FBRCxFQUFLLEdBQUwsQ0FUTDtZQVVBLEdBQUEsRUFBSyxDQUFDLEdBQUQsRUFBSyxHQUFMLENBVkw7WUFXQSxHQUFBLEVBQUssQ0FBQyxHQUFELEVBQUssR0FBTCxDQVhMOztlQWFKLElBQUMsQ0FBQSxrQkFBRCxHQUFzQixXQUFXLENBQUMsS0FBWixDQUFrQixFQUFsQjtJQWxCWixDQUFkO0lBb0JBLDZCQUFBLEVBQStCLFNBQUMsRUFBRDtBQUUzQixZQUFBO1FBQUEsSUFBZ0IsRUFBQSxLQUFPLEdBQXZCO0FBQUEsbUJBQU8sTUFBUDs7UUFDQSxPQUFVLElBQUMsQ0FBQSxhQUFj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QUFHLFdBQVcsQ0FBQyxNQUFaLEtBQXNCLENBQXRCLElBQTRCLENBQUMsQ0FBQyxPQUFGLENBQVUsV0FBWSxDQUFBLENBQUEsQ0FBdEIsRUFBMEIsQ0FBQyxDQUFDLElBQUYsQ0FBTyxJQUFDLENBQUEsYUFBUixDQUExQixDQUEvQjtnQkFDSSxJQUFDLENBQUEsYUFBYSxDQUFDLEdBQWYsQ0FBQSxFQURKO2FBQUEsTUFBQTtnQkFHSSxJQUFDLENBQUEsYUFBRCxHQUFpQixHQUhyQjthQURKOztRQU1BLElBQUMsRUFBQSxFQUFBLEVBQUUsQ0FBQyxVQUFKLENBQWUsRUFBZjtlQUVBO0lBMUNrQixDQXBKdEI7SUFzTUEsMkJBQUEsRUFBNkIsU0FBQTtBQUV6QixZQUFBO1FBQUEsSUFBRyxJQUFDLENBQUEsYUFBRCxDQUFBLENBQUEsR0FBbUIsQ0FBbkIsS0FBd0IsQ0FBM0I7WUFDSSxFQUFBLEdBQUssSUFBQyxDQUFBLFVBQUQsQ0FBQTtZQUNMLFVBQUEsQ0FBVyxFQUFYO1lBQ0EsSUFBRyxJQUFDLENBQUEsYUFBRCxDQUFBLENBQUEsS0FBb0IsQ0FBdkI7QUFDSSx1QkFBTyxHQURYO2FBQUEsTUFFSyxJQUFHLElBQUMsQ0FBQSxhQUFELENBQUEsQ0FBQSxLQUFvQixDQUF2QjtnQkFDRCxJQUFHLGFBQUEsQ0FBYyxDQUFDLEVBQUcsQ0FBQSxDQUFBLENBQUosRUFBUSxFQUFHLENBQUEsQ0FBQSxDQUFYLENBQWQsRUFBOEIsSUFBQyxDQUFBLFVBQUQsQ0FBQSxDQUE5QixDQUFIO0FBQ0ksMkJBQU8sQ0FBQyxFQUFHLENBQUEsQ0FBQSxDQUFKLEVBQVEsRUFBRyxDQUFBLENBQUEsQ0FBWCxFQURYO2lCQUFBLE1BQUE7QUFHSSwyQkFBTyxDQUFDLEVBQUcsQ0FBQSxDQUFBLENBQUosRUFBUSxFQUFHLENBQUEsQ0FBQSxDQUFYLEVBSFg7aUJBREM7YUFMVDs7SUFGeUIsQ0F0TTdCIiwic291cmNlc0NvbnRlbnQiOlsiXG4jICAwMDAwMDAwICAwMDAgICAwMDAgIDAwMDAwMDAwICAgMDAwMDAwMDAgICAgMDAwMDAwMCAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAwMDAwICBcbiMgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAwICAwMDAgIDAwMCAgIDAwMFxuIyAwMDAwMDAwICAgMDAwICAgMDAwICAwMDAwMDAwICAgIDAwMDAwMDAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAwIDAwMCAgMDAwICAgMDAwXG4jICAgICAgMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAwMDAwICAwMDAgICAwMDBcbiMgMDAwMDAwMCAgICAwMDAwMDAwICAgMDAwICAgMDAwICAwMDAgICAwMDAgICAwMDAwMDAwICAgIDAwMDAwMDAgICAwMDAgICAwMDAgIDAwMDAwMDAgIFxuXG57IHJldmVyc2VkLCBfIH0gPSByZXF1aXJlICdreGsnXG5cbm1vZHVsZS5leHBvcnRzID1cblxuICAgIGluaXRTdXJyb3VuZDogLT5cbiAgICAgICAgXG4gICAgICAgIEBzdXJyb3VuZFN0YWNrID0gW11cblxuICAgICAgICBAc3Vycm91bmRQYWlycyA9IFxuICAgICAgICAgICAgJyMnOiBbJyN7JyAnfSddICMgPC0gdGhpcyBoYXMgdG8gY29tZVxuICAgICAgICAgICAgJ3snOiBbJ3snICd9J10gICMgPC0gYmVmb3JlIHRoYXRcbiAgICAgICAgICAgICd9JzogWyd7JyAnfSddXG4gICAgICAgICAgICAnWyc6IFsnWycgJ10nXVxuICAgICAgICAgICAgJ10nOiBbJ1snICddJ11cbiAgICAgICAgICAgICcoJzogWycoJyAnKSddXG4gICAgICAgICAgICAnKSc6IFsnKCcgJyknXVxuICAgICAgICAgICAgJzwnOiBbJzwnICc+J11cbiAgICAgICAgICAgICc+JzogWyc8JyAnPiddXG4gICAgICAgICAgICBcIidcIjogW1wiJ1wiIFwiJ1wiXVxuICAgICAgICAgICAgJ1wiJzogWydcIicgJ1wiJ11cbiAgICAgICAgICAgICcqJzogWycqJyAnKiddICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgXG4gICAgICAgIEBzdXJyb3VuZENoYXJhY3RlcnMgPSBcInt9W10oKVxcXCInXCIuc3BsaXQgJydcbiAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgIGlzVW5iYWxhbmNlZFN1cnJvdW5kQ2hhcmFjdGVyOiAoY2gpIC0+XG4gICAgICAgIFxuICAgICAgICByZXR1cm4gZmFsc2UgaWYgY2ggaW4gW1wiI1wiXVxuICAgICAgICBbY2wsY3JdID0gQHN1cnJvdW5kUGFpcnNbY2hdXG4gICAgICAgIHJldHVybiBmYWxzZSBpZiBjbC5sZW5ndGggPiAxXG4gICAgICAgIGZvciBjdXJzb3IgaW4gQGN1cnNvcnMoKVxuICAgICAgICAgICAgY291bnQgPSAwXG4gICAgICAgICAgICBmb3IgYyBpbiBAbGluZShjdXJzb3JbMV0pXG4gICAgICAgICAgICAgICAgaWYgYyA9PSBjbFxuICAgICAgICAgICAgICAgICAgICBjb3VudCArPSAxXG4gICAgICAgICAgICAgICAgZWxzZSBpZiBjID09IGNyXG4gICAgICAgICAgICAgICAgICAgIGNvdW50IC09IDFcbiAgICAgICAgICAgIGlmICgoY2wgPT0gY3IpIGFuZCAoY291bnQgJSAyKSkgb3IgKChjbCAhPSBjcikgYW5kIGNvdW50KVxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlXG4gICAgICAgIHJldHVybiBmYWxzZVxuICAgIFxuICAgIHNlbGVjdGlvbkNvbnRhaW5zT25seVF1b3RlczogLT5cbiAgICAgICAgXG4gICAgICAgIGZvciBjIGluIEB0ZXh0T2ZTZWxlY3Rpb24oKVxuICAgICAgICAgICAgY29udGludWUgaWYgYyA9PSAnXFxuJ1xuICAgICAgICAgICAgaWYgYyBub3QgaW4gWydcIicgXCInXCJdXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlXG4gICAgICAgIHRydWVcbiAgICBcbiAgICBpbnNlcnRUcmlwbGVRdW90ZXM6IC0+XG4gICAgICAgIFxuICAgICAgICByZXR1cm4gZmFsc2UgaWYgQG51bUN1cnNvcnMoKSA+IDFcbiAgICAgICAgcmV0dXJuIGZhbHNlIGlmIEBudW1TZWxlY3Rpb25zKClcbiAgICAgICAgcCA9IEBjdXJzb3JQb3MoKVxuICAgICAgICBbYmVmb3JlLCBhZnRlcl0gPSBAc3BsaXRTdGF0ZUxpbmVBdFBvcyBAc3RhdGUsIHBcbiAgICAgICAgcmV0dXJuIGZhbHNlIGlmIG5vdCBiZWZvcmUuZW5kc1dpdGggJ1wiXCInXG4gICAgICAgIHJldHVybiBmYWxzZSBpZiBiZWZvcmUubGVuZ3RoID4gMiBhbmQgYmVmb3JlW2JlZm9yZS5sZW5ndGgtM10gPT0gJ1wiJ1xuICAgICAgICByZXR1cm4gZmFsc2UgaWYgYWZ0ZXIuc3RhcnRzV2l0aCAnXCInXG4gICAgICAgIEBkby5zdGFydCgpXG4gICAgICAgIEBkby5jaGFuZ2UgcFsxXSwgYmVmb3JlICsgJ1wiXCJcIlwiJyArIGFmdGVyXG4gICAgICAgIEBkby5zZXRDdXJzb3JzIFtbcFswXSsxLCBwWzFdXV1cbiAgICAgICAgQGRvLmVuZCgpXG4gICAgICAgIHRydWVcbiAgICBcbiAgICAjIDAwMCAgMDAwICAgMDAwICAgMDAwMDAwMCAgMDAwMDAwMDAgIDAwMDAwMDAwICAgMDAwMDAwMDAwICBcbiAgICAjIDAwMCAgMDAwMCAgMDAwICAwMDAgICAgICAgMDAwICAgICAgIDAwMCAgIDAwMCAgICAgMDAwICAgICBcbiAgICAjIDAwMCAgMDAwIDAgMDAwICAwMDAwMDAwICAgMDAwMDAwMCAgIDAwMDAwMDAgICAgICAgMDAwICAgICBcbiAgICAjIDAwMCAgMDAwICAwMDAwICAgICAgIDAwMCAgMDAwICAgICAgIDAwMCAgIDAwMCAgICAgMDAwICAgICBcbiAgICAjIDAwMCAgMDAwICAgMDAwICAwMDAwMDAwICAgMDAwMDAwMDAgIDAwMCAgIDAwMCAgICAgMDAwICAgICBcbiAgICBcbiAgICBpbnNlcnRTdXJyb3VuZENoYXJhY3RlcjogKGNoKSAtPlxuXG4gICAgICAgIGlmIEBpc1VuYmFsYW5jZWRTdXJyb3VuZENoYXJhY3RlciBjaFxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlIFxuICAgICAgICBcbiAgICAgICAgaWYgQG51bVNlbGVjdGlvbnMoKSBhbmQgY2ggaW4gWydcIicgXCInXCJdIGFuZCBAc2VsZWN0aW9uQ29udGFpbnNPbmx5UXVvdGVzKClcbiAgICAgICAgICAgIHJldHVybiBmYWxzZVxuICAgICAgICBcbiAgICAgICAgbmV3Q3Vyc29ycyA9IEBkby5jdXJzb3JzKClcbiAgICAgICAgXG4gICAgICAgIGlmIEBzdXJyb3VuZFN0YWNrLmxlbmd0aFxuICAgICAgICAgICAgaWYgXy5sYXN0KEBzdXJyb3VuZFN0YWNrKVsxXSA9PSBjaFxuICAgICAgICAgICAgICAgIGZvciBjIGluIG5ld0N1cnNvcnNcbiAgICAgICAgICAgICAgICAgICAgaWYgQGRvLmxpbmUoY1sxXSlbY1swXV0gIT0gY2hcbiAgICAgICAgICAgICAgICAgICAgICAgIEBzdXJyb3VuZFN0YWNrID0gW11cbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrXG4gICAgICAgICAgICAgICAgaWYgQHN1cnJvdW5kU3RhY2subGVuZ3RoIGFuZCBfLmxhc3QoQHN1cnJvdW5kU3RhY2spWzFdID09IGNoXG4gICAgICAgICAgICAgICAgICAgIEBkby5zdGFydCgpXG4gICAgICAgICAgICAgICAgICAgIEBzZWxlY3ROb25lKClcbiAgICAgICAgICAgICAgICAgICAgQGRlbGV0ZUZvcndhcmQoKVxuICAgICAgICAgICAgICAgICAgICBAZG8uZW5kKClcbiAgICAgICAgICAgICAgICAgICAgQHN1cnJvdW5kU3RhY2sucG9wKClcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYgbm90IGZvdW5kXG4gICAgICAgICAgICAgICAgZm9yIGMgaW4gbmV3Q3Vyc29yc1xuICAgICAgICAgICAgICAgICAgICBpZiBAaXNSYW5nZUluU3RyaW5nIHJhbmdlRm9yUG9zIGNcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvdW5kID0gdHJ1ZVxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZSBpZiBub3QgZm91bmRcbiAgICAgICAgICAgIFxuICAgICAgICBpZiBjaCA9PSBcIidcIiBhbmQgbm90IEBudW1TZWxlY3Rpb25zKCkgIyBjaGVjayBpZiBhbnkgYWxwYWJldGljYWwgY2hhcmFjdGVyIGlzIGJlZm9yZSBhbnkgY3Vyc29yXG4gICAgICAgICAgICBmb3IgYyBpbiBuZXdDdXJzb3JzXG4gICAgICAgICAgICAgICAgaWYgY1swXSA+IDAgYW5kIC9bQS1aYS16XS8udGVzdCBAZG8ubGluZShjWzFdKVtjWzBdLTFdIFxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2VcbiAgICAgICAgXG4gICAgICAgIEBkby5zdGFydCgpXG4gICAgICAgIGlmIEBkby5udW1TZWxlY3Rpb25zKCkgPT0gMFxuICAgICAgICAgICAgbmV3U2VsZWN0aW9ucyA9IHJhbmdlc0Zyb21Qb3NpdGlvbnMgbmV3Q3Vyc29yc1xuICAgICAgICBlbHNlXG4gICAgICAgICAgICBuZXdTZWxlY3Rpb25zID0gQGRvLnNlbGVjdGlvbnMoKVxuICAgICAgICAgICAgXG4gICAgICAgIFtjbCxjcl0gPSBAc3Vycm91bmRQYWlyc1tjaF1cbiAgICAgICAgICAgIFxuICAgICAgICBAc3Vycm91bmRTdGFjay5wdXNoIFtjbCxjcl1cblxuICAgICAgICBmb3IgbnMgaW4gcmV2ZXJzZWQgbmV3U2VsZWN0aW9uc1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICBpZiBjbCA9PSAnI3snICMgY29udmVydCBzaW5nbGUgc3RyaW5nIHRvIGRvdWJsZSBzdHJpbmdcbiAgICAgICAgICAgICAgICBpZiBzciA9IEByYW5nZU9mU3RyaW5nU3Vycm91bmRpbmdSYW5nZSBuc1xuICAgICAgICAgICAgICAgICAgICBpZiBAZG8ubGluZShzclswXSlbc3JbMV1bMF1dID09IFwiJ1wiXG4gICAgICAgICAgICAgICAgICAgICAgICBAZG8uY2hhbmdlIG5zWzBdLCBAZG8ubGluZShuc1swXSkuc3BsaWNlIHNyWzFdWzBdLCAxLCAnXCInXG4gICAgICAgICAgICAgICAgICAgIGlmIEBkby5saW5lKHNyWzBdKVtzclsxXVsxXS0xXSA9PSBcIidcIlxuICAgICAgICAgICAgICAgICAgICAgICAgQGRvLmNoYW5nZSBuc1swXSwgQGRvLmxpbmUobnNbMF0pLnNwbGljZSBzclsxXVsxXS0xLCAxLCAnXCInXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgQGRvLmNoYW5nZSBuc1swXSwgQGRvLmxpbmUobnNbMF0pLnNwbGljZSBuc1sxXVsxXSwgMCwgY3JcbiAgICAgICAgICAgIEBkby5jaGFuZ2UgbnNbMF0sIEBkby5saW5lKG5zWzBdKS5zcGxpY2UgbnNbMV1bMF0sIDAsIGNsXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGZvciBjIGluIHBvc2l0aW9uc0FmdGVyTGluZUNvbEluUG9zaXRpb25zIG5zWzBdLCBuc1sxXVswXS0xLCBuZXdDdXJzb3JzXG4gICAgICAgICAgICAgICAgY1swXSArPSBjbC5sZW5ndGhcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgIGZvciBvcyBpbiByYW5nZXNBZnRlckxpbmVDb2xJblJhbmdlcyBuc1swXSwgbnNbMV1bMV0tMSwgbmV3U2VsZWN0aW9uc1xuICAgICAgICAgICAgICAgIG9zWzFdWzBdICs9IGNyLmxlbmd0aFxuICAgICAgICAgICAgICAgIG9zWzFdWzFdICs9IGNyLmxlbmd0aFxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgZm9yIG9zIGluIHJhbmdlc0FmdGVyTGluZUNvbEluUmFuZ2VzIG5zWzBdLCBuc1sxXVswXS0xLCBuZXdTZWxlY3Rpb25zXG4gICAgICAgICAgICAgICAgb3NbMV1bMF0gKz0gY2wubGVuZ3RoXG4gICAgICAgICAgICAgICAgb3NbMV1bMV0gKz0gY2wubGVuZ3RoXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGZvciBjIGluIHBvc2l0aW9uc0FmdGVyTGluZUNvbEluUG9zaXRpb25zIG5zWzBdLCBuc1sxXVsxXSwgbmV3Q3Vyc29yc1xuICAgICAgICAgICAgICAgIGNbMF0gKz0gY3IubGVuZ3RoXG4gICAgICAgICAgICAgICAgXG4gICAgICAgIEBkby5zZWxlY3QgcmFuZ2VzTm90RW1wdHlJblJhbmdlcyBuZXdTZWxlY3Rpb25zXG4gICAgICAgIEBkby5zZXRDdXJzb3JzIG5ld0N1cnNvcnNcbiAgICAgICAgQGRvLmVuZCgpXG4gICAgICAgIHJldHVybiB0cnVlXG5cbiAgICAjIDAwMDAwMDAgICAgMDAwMDAwMDAgIDAwMCAgICAgIDAwMDAwMDAwICAwMDAwMDAwMDAgIDAwMDAwMDAwICBcbiAgICAjIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgICAgIDAwMCAgICAgICAgICAwMDAgICAgIDAwMCAgICAgICBcbiAgICAjIDAwMCAgIDAwMCAgMDAwMDAwMCAgIDAwMCAgICAgIDAwMDAwMDAgICAgICAwMDAgICAgIDAwMDAwMDAgICBcbiAgICAjIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgICAgIDAwMCAgICAgICAgICAwMDAgICAgIDAwMCAgICAgICBcbiAgICAjIDAwMDAwMDAgICAgMDAwMDAwMDAgIDAwMDAwMDAgIDAwMDAwMDAwICAgICAwMDAgICAgIDAwMDAwMDAwICBcbiAgICBcbiAgICBkZWxldGVFbXB0eVN1cnJvdW5kczogLT5cbiAgICAgICAgICAgIFxuICAgICAgICBjcyA9IEBkby5jdXJzb3JzKClcblxuICAgICAgICBwYWlycyA9IF8udW5pcVdpdGggXy52YWx1ZXMoQHN1cnJvdW5kUGFpcnMpLCBfLmlzRXF1YWxcblxuICAgICAgICBvcGVuQ2xvc2VQYWlycyA9IFtdXG4gICAgICAgIFxuICAgICAgICBmb3IgYyBpbiBjc1xuICAgICAgICAgICAgbnVtUGFpcnMgPSBvcGVuQ2xvc2VQYWlycy5sZW5ndGhcbiAgICAgICAgICAgICMgY2hlY2sgaWYgYWxsIGN1cnNvcnMgYXJlIGluc2lkZSBvZiBlbXB0eSBzdXJyb3VuZCBwYWlyc1xuICAgICAgICAgICAgZm9yIFtzbywgc2NdIGluIHBhaXJzXG4gICAgICAgICAgICAgICAgYmVmb3JlID0gQGRvLmxpbmUoY1sxXSkuc2xpY2UgY1swXS1zby5sZW5ndGgsIGNbMF1cbiAgICAgICAgICAgICAgICBhZnRlciAgPSBAZG8ubGluZShjWzFdKS5zbGljZSBjWzBdLCBjWzBdK3NjLmxlbmd0aFxuICAgICAgICAgICAgICAgIGlmIHNvID09IGJlZm9yZSBhbmQgc2MgPT0gYWZ0ZXJcbiAgICAgICAgICAgICAgICAgICAgb3BlbkNsb3NlUGFpcnMucHVzaCBbc28sc2NdXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrXG4gICAgICAgICAgICBpZiBudW1QYWlycyA9PSBvcGVuQ2xvc2VQYWlycy5sZW5ndGhcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2UgXG5cbiAgICAgICAgaWYgY3MubGVuZ3RoICE9IG9wZW5DbG9zZVBhaXJzLmxlbmd0aFxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlIFxuICAgICAgICAgICAgXG4gICAgICAgICMgYWxsIGN1cnNvcnMgaW4gZW1wdHkgc3Vycm91bmQgLT4gcmVtb3ZlIGJvdGggc3Vycm91bmRzXG4gICAgICAgIFxuICAgICAgICB1bmlxdWVQYWlycyA9IF8udW5pcVdpdGggb3BlbkNsb3NlUGFpcnMsIF8uaXNFcXVhbFxuICAgICAgICBmb3IgYyBpbiBjc1xuICAgICAgICAgICAgW3NvLHNjXSA9IG9wZW5DbG9zZVBhaXJzLnNoaWZ0KClcbiAgXG4gICAgICAgICAgICBAZG8uY2hhbmdlIGNbMV0sIEBkby5saW5lKGNbMV0pLnNwbGljZSBjWzBdLXNvLmxlbmd0aCwgc28ubGVuZ3RoK3NjLmxlbmd0aFxuICAgICAgICAgICAgZm9yIG5jIGluIHBvc2l0aW9uc0FmdGVyTGluZUNvbEluUG9zaXRpb25zIGNbMV0sIGNbMF0sIGNzXG4gICAgICAgICAgICAgICAgbmNbMF0gLT0gc2MubGVuZ3RoICsgc28ubGVuZ3RoIFxuICAgICAgICAgICAgY1swXSAtPSBzby5sZW5ndGhcbiAgICAgICAgXG4gICAgICAgIGlmIEBzdXJyb3VuZFN0YWNrLmxlbmd0aCAjIHBvcCBvciBjbGVhbiBzdXJyb3VuZCBzdGFja1xuICAgICAgICAgICAgaWYgdW5pcXVlUGFpcnMubGVuZ3RoID09IDEgYW5kIF8uaXNFcXVhbCB1bmlxdWVQYWlyc1swXSwgXy5sYXN0IEBzdXJyb3VuZFN0YWNrIFxuICAgICAgICAgICAgICAgIEBzdXJyb3VuZFN0YWNrLnBvcCgpXG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgQHN1cnJvdW5kU3RhY2sgPSBbXVxuICAgICAgICAgICAgICAgIFxuICAgICAgICBAZG8uc2V0Q3Vyc29ycyBjc1xuICAgICAgICBcbiAgICAgICAgdHJ1ZSAgICBcbiAgICAgICAgXG4gICAgIyAwMDAgICAwMDAgIDAwMCAgIDAwMDAwMDAgICAwMDAgICAwMDAgIDAwMCAgICAgIDAwMCAgIDAwMDAwMDAgICAwMDAgICAwMDAgIDAwMDAwMDAwMCAgIDAwMDAwMDAgIFxuICAgICMgMDAwICAgMDAwICAwMDAgIDAwMCAgICAgICAgMDAwICAgMDAwICAwMDAgICAgICAwMDAgIDAwMCAgICAgICAgMDAwICAgMDAwICAgICAwMDAgICAgIDAwMCAgICAgICBcbiAgICAjIDAwMDAwMDAwMCAgMDAwICAwMDAgIDAwMDAgIDAwMDAwMDAwMCAgMDAwICAgICAgMDAwICAwMDAgIDAwMDAgIDAwMDAwMDAwMCAgICAgMDAwICAgICAwMDAwMDAwICAgXG4gICAgIyAwMDAgICAwMDAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgICAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAwMDAgICAgIDAwMCAgICAgICAgICAwMDAgIFxuICAgICMgMDAwICAgMDAwICAwMDAgICAwMDAwMDAwICAgMDAwICAgMDAwICAwMDAwMDAwICAwMDAgICAwMDAwMDAwICAgMDAwICAgMDAwICAgICAwMDAgICAgIDAwMDAwMDAgICBcbiAgICBcbiAgICBoaWdobGlnaHRzU3Vycm91bmRpbmdDdXJzb3I6IC0+XG4gICAgICAgIFxuICAgICAgICBpZiBAbnVtSGlnaGxpZ2h0cygpICUgMiA9PSAwXG4gICAgICAgICAgICBocyA9IEBoaWdobGlnaHRzKClcbiAgICAgICAgICAgIHNvcnRSYW5nZXMgaHNcbiAgICAgICAgICAgIGlmIEBudW1IaWdobGlnaHRzKCkgPT0gMlxuICAgICAgICAgICAgICAgIHJldHVybiBoc1xuICAgICAgICAgICAgZWxzZSBpZiBAbnVtSGlnaGxpZ2h0cygpID09IDRcbiAgICAgICAgICAgICAgICBpZiBhcmVTYW1lUmFuZ2VzIFtoc1sxXSwgaHNbMl1dLCBAc2VsZWN0aW9ucygpXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBbaHNbMF0sIGhzWzNdXVxuICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFtoc1sxXSwgaHNbMl1dXG5cbiJdfQ==
//# sourceURL=../../../coffee/editor/actions/surround.coffee