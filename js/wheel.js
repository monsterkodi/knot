
/*
000   000  000   000  00000000  00000000  000    
000 0 000  000   000  000       000       000    
000000000  000000000  0000000   0000000   000    
000   000  000   000  000       000       000    
00     00  000   000  00000000  00000000  0000000
 */
var Wheel, absMax, clamp, keyinfo, log, post, ref,
  bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

ref = require('kxk'), keyinfo = ref.keyinfo, post = ref.post, absMax = ref.absMax, clamp = ref.clamp;

log = console.log;

Wheel = (function() {
  function Wheel(scroll) {
    this.scroll = scroll;
    this.onAnimation = bind(this.onAnimation, this);
    this.onMouseDown = bind(this.onMouseDown, this);
    this.onWheel = bind(this.onWheel, this);
    this.accum = 0;
    document.addEventListener('mousedown', this.onMouseDown, true);
  }

  Wheel.prototype.onWheel = function(event) {
    var combo, delta, key, mod, ref1, scrollFactor;
    ref1 = keyinfo.forEvent(event), mod = ref1.mod, key = ref1.key, combo = ref1.combo;
    scrollFactor = function() {
      var f;
      f = 1;
      f *= 1 + 1 * event.shiftKey;
      f *= 1 + 3 * event.ctrlKey;
      return f *= 1 + 7 * event.altKey;
    };
    delta = event.deltaY * scrollFactor();
    if ((this.accum < 0 && delta > 0) || (this.accum > 0 && delta < 0)) {
      return this.accum = 0;
    } else {
      post.emit('scrollBy', Math.sign(delta) * this.scroll.lineHeight);
      if (this.accum === 0) {
        window.requestAnimationFrame(this.onAnimation);
      }
      return this.accum += delta;
    }
  };

  Wheel.prototype.onMouseDown = function(event) {
    return this.accum = 0;
  };

  Wheel.prototype.onAnimation = function(now) {
    var delta, ref1;
    this.accum = clamp(-100000, 100000, this.accum * 0.991);
    delta = this.accum / 100;
    post.emit('scrollBy', delta);
    if (Math.abs(this.accum) < 10 || !((0 < (ref1 = this.scroll.scroll) && ref1 < this.scroll.scrollMax))) {
      return this.accum = 0;
    } else {
      return window.requestAnimationFrame(this.onAnimation);
    }
  };

  return Wheel;

})();

module.exports = Wheel;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2hlZWwuanMiLCJzb3VyY2VSb290IjoiLiIsInNvdXJjZXMiOlsiIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7OztBQUFBLElBQUEsNkNBQUE7RUFBQTs7QUFRQSxNQUFtQyxPQUFBLENBQVEsS0FBUixDQUFuQyxFQUFFLHFCQUFGLEVBQVcsZUFBWCxFQUFpQixtQkFBakIsRUFBeUI7O0FBRXpCLEdBQUEsR0FBTSxPQUFPLENBQUM7O0FBRVI7RUFFVyxlQUFDLE1BQUQ7SUFBQyxJQUFDLENBQUEsU0FBRDs7OztJQUVWLElBQUMsQ0FBQSxLQUFELEdBQVM7SUFFVCxRQUFRLENBQUMsZ0JBQVQsQ0FBMEIsV0FBMUIsRUFBdUMsSUFBQyxDQUFBLFdBQXhDLEVBQXFELElBQXJEO0VBSlM7O2tCQU1iLE9BQUEsR0FBUyxTQUFDLEtBQUQ7QUFFTCxRQUFBO0lBQUEsT0FBc0IsT0FBTyxDQUFDLFFBQVIsQ0FBaUIsS0FBakIsQ0FBdEIsRUFBRSxjQUFGLEVBQU8sY0FBUCxFQUFZO0lBRVosWUFBQSxHQUFlLFNBQUE7QUFDWCxVQUFBO01BQUEsQ0FBQSxHQUFLO01BQ0wsQ0FBQSxJQUFLLENBQUEsR0FBSSxDQUFBLEdBQUksS0FBSyxDQUFDO01BQ25CLENBQUEsSUFBSyxDQUFBLEdBQUksQ0FBQSxHQUFJLEtBQUssQ0FBQzthQUNuQixDQUFBLElBQUssQ0FBQSxHQUFJLENBQUEsR0FBSSxLQUFLLENBQUM7SUFKUjtJQU1mLEtBQUEsR0FBUSxLQUFLLENBQUMsTUFBTixHQUFlLFlBQUEsQ0FBQTtJQUV2QixJQUFHLENBQUMsSUFBQyxDQUFBLEtBQUQsR0FBUyxDQUFULElBQWUsS0FBQSxHQUFRLENBQXhCLENBQUEsSUFBOEIsQ0FBQyxJQUFDLENBQUEsS0FBRCxHQUFTLENBQVQsSUFBZSxLQUFBLEdBQVEsQ0FBeEIsQ0FBakM7YUFDSSxJQUFDLENBQUEsS0FBRCxHQUFTLEVBRGI7S0FBQSxNQUFBO01BR0ksSUFBSSxDQUFDLElBQUwsQ0FBVSxVQUFWLEVBQXNCLElBQUksQ0FBQyxJQUFMLENBQVUsS0FBVixDQUFBLEdBQW1CLElBQUMsQ0FBQSxNQUFNLENBQUMsVUFBakQ7TUFDQSxJQUFHLElBQUMsQ0FBQSxLQUFELEtBQVUsQ0FBYjtRQUNJLE1BQU0sQ0FBQyxxQkFBUCxDQUE2QixJQUFDLENBQUEsV0FBOUIsRUFESjs7YUFFQSxJQUFDLENBQUEsS0FBRCxJQUFVLE1BTmQ7O0VBWks7O2tCQW9CVCxXQUFBLEdBQWEsU0FBQyxLQUFEO1dBRVQsSUFBQyxDQUFBLEtBQUQsR0FBUztFQUZBOztrQkFJYixXQUFBLEdBQWEsU0FBQyxHQUFEO0FBR1QsUUFBQTtJQUFBLElBQUMsQ0FBQSxLQUFELEdBQVMsS0FBQSxDQUFNLENBQUMsTUFBUCxFQUFlLE1BQWYsRUFBdUIsSUFBQyxDQUFBLEtBQUQsR0FBUyxLQUFoQztJQUVULEtBQUEsR0FBUSxJQUFDLENBQUEsS0FBRCxHQUFPO0lBQ2YsSUFBSSxDQUFDLElBQUwsQ0FBVSxVQUFWLEVBQXNCLEtBQXRCO0lBRUEsSUFBRyxJQUFJLENBQUMsR0FBTCxDQUFTLElBQUMsQ0FBQSxLQUFWLENBQUEsR0FBbUIsRUFBbkIsSUFBeUIsQ0FBSSxDQUFDLENBQUEsQ0FBQSxXQUFJLElBQUMsQ0FBQSxNQUFNLENBQUMsT0FBWixRQUFBLEdBQXFCLElBQUMsQ0FBQSxNQUFNLENBQUMsU0FBN0IsQ0FBRCxDQUFoQzthQUNJLElBQUMsQ0FBQSxLQUFELEdBQVMsRUFEYjtLQUFBLE1BQUE7YUFHSSxNQUFNLENBQUMscUJBQVAsQ0FBNkIsSUFBQyxDQUFBLFdBQTlCLEVBSEo7O0VBUlM7Ozs7OztBQWFqQixNQUFNLENBQUMsT0FBUCxHQUFpQiIsInNvdXJjZXNDb250ZW50IjpbIiMjI1xuMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMDAwMDAwICAwMDAwMDAwMCAgMDAwICAgIFxuMDAwIDAgMDAwICAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAgICAgMDAwICAgIFxuMDAwMDAwMDAwICAwMDAwMDAwMDAgIDAwMDAwMDAgICAwMDAwMDAwICAgMDAwICAgIFxuMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgICAgICAwMDAgICAgICAgMDAwICAgIFxuMDAgICAgIDAwICAwMDAgICAwMDAgIDAwMDAwMDAwICAwMDAwMDAwMCAgMDAwMDAwMFxuIyMjXG5cbnsga2V5aW5mbywgcG9zdCwgYWJzTWF4LCBjbGFtcCB9ID0gcmVxdWlyZSAna3hrJ1xuXG5sb2cgPSBjb25zb2xlLmxvZ1xuXG5jbGFzcyBXaGVlbFxuXG4gICAgY29uc3RydWN0b3I6IChAc2Nyb2xsKSAtPlxuICAgICAgICBcbiAgICAgICAgQGFjY3VtID0gMFxuICAgICAgICBcbiAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lciAnbW91c2Vkb3duJywgQG9uTW91c2VEb3duLCB0cnVlXG4gICAgICAgIFxuICAgIG9uV2hlZWw6IChldmVudCkgPT5cbiAgICAgICAgXG4gICAgICAgIHsgbW9kLCBrZXksIGNvbWJvIH0gPSBrZXlpbmZvLmZvckV2ZW50IGV2ZW50XG4gICAgXG4gICAgICAgIHNjcm9sbEZhY3RvciA9IC0+XG4gICAgICAgICAgICBmICA9IDFcbiAgICAgICAgICAgIGYgKj0gMSArIDEgKiBldmVudC5zaGlmdEtleVxuICAgICAgICAgICAgZiAqPSAxICsgMyAqIGV2ZW50LmN0cmxLZXlcbiAgICAgICAgICAgIGYgKj0gMSArIDcgKiBldmVudC5hbHRLZXlcbiAgICAgICAgXG4gICAgICAgIGRlbHRhID0gZXZlbnQuZGVsdGFZICogc2Nyb2xsRmFjdG9yKClcbiAgICAgICAgXG4gICAgICAgIGlmIChAYWNjdW0gPCAwIGFuZCBkZWx0YSA+IDApIG9yIChAYWNjdW0gPiAwIGFuZCBkZWx0YSA8IDApXG4gICAgICAgICAgICBAYWNjdW0gPSAwXG4gICAgICAgIGVsc2VcbiAgICAgICAgICAgIHBvc3QuZW1pdCAnc2Nyb2xsQnknLCBNYXRoLnNpZ24oZGVsdGEpICogQHNjcm9sbC5saW5lSGVpZ2h0XG4gICAgICAgICAgICBpZiBAYWNjdW0gPT0gMFxuICAgICAgICAgICAgICAgIHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUgQG9uQW5pbWF0aW9uXG4gICAgICAgICAgICBAYWNjdW0gKz0gZGVsdGFcbiAgICAgIFxuICAgIG9uTW91c2VEb3duOiAoZXZlbnQpID0+XG4gICAgICAgIFxuICAgICAgICBAYWNjdW0gPSAwXG4gICAgICAgICAgICBcbiAgICBvbkFuaW1hdGlvbjogKG5vdykgPT5cbiAgICAgICAgXG4gICAgICAgIFxuICAgICAgICBAYWNjdW0gPSBjbGFtcCAtMTAwMDAwLCAxMDAwMDAsIEBhY2N1bSAqIDAuOTkxXG4gICAgICAgICAgICBcbiAgICAgICAgZGVsdGEgPSBAYWNjdW0vMTAwXG4gICAgICAgIHBvc3QuZW1pdCAnc2Nyb2xsQnknLCBkZWx0YSBcblxuICAgICAgICBpZiBNYXRoLmFicyhAYWNjdW0pIDwgMTAgb3Igbm90ICgwIDwgQHNjcm9sbC5zY3JvbGwgPCBAc2Nyb2xsLnNjcm9sbE1heClcbiAgICAgICAgICAgIEBhY2N1bSA9IDBcbiAgICAgICAgZWxzZVxuICAgICAgICAgICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSBAb25BbmltYXRpb25cbiAgICAgICAgICAgIFxubW9kdWxlLmV4cG9ydHMgPSBXaGVlbFxuIl19
//# sourceURL=../coffee/wheel.coffee