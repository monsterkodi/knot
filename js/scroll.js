// koffee 1.3.0

/*
 0000000   0000000  00000000    0000000   000      000      
000       000       000   000  000   000  000      000      
0000000   000       0000000    000   000  000      000      
     000  000       000   000  000   000  000      000      
0000000    0000000  000   000   0000000   0000000  0000000
 */
var Scroll, Wheel, clamp, post, ref,
    bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

ref = require('kxk'), post = ref.post, clamp = ref.clamp;

Wheel = require('./wheel');

Scroll = (function() {
    function Scroll(view) {
        this.view = view;
        this.setLineHeight = bind(this.setLineHeight, this);
        this.setViewHeight = bind(this.setViewHeight, this);
        this.setNumLines = bind(this.setNumLines, this);
        this.by = bind(this.by, this);
        this.to = bind(this.to, this);
        this.onScrollBy = bind(this.onScrollBy, this);
        this.onCombo = bind(this.onCombo, this);
        this.reset = bind(this.reset, this);
        post.on('combo', this.onCombo);
        post.on('scrollBy', this.onScrollBy);
        this.resetSize();
        this.resetLines();
        this.wheel = new Wheel(this);
    }

    Scroll.prototype.resetSize = function() {
        this.lineHeight = 0;
        this.viewHeight = -1;
        this.fullLines = -1;
        this.viewLines = -1;
        return this.scrollMax = -1;
    };

    Scroll.prototype.resetLines = function() {
        this.top = -1;
        this.bot = -1;
        this.fullHeight = 0;
        this.scroll = 0;
        this.offsetTop = 0;
        return this.numLines = 0;
    };

    Scroll.prototype.data = function() {
        return {
            lineHeight: this.lineHeight,
            viewHeight: this.viewHeight,
            fullHeight: this.fullHeight,
            scrollMax: this.scrollMax,
            fullLines: this.fullLines,
            viewLines: this.viewLines,
            scroll: this.scroll,
            offsetTop: this.offsetTop,
            numLines: this.numLines,
            top: this.top,
            bot: this.bot
        };
    };

    Scroll.prototype.restore = function(data) {
        if (!data) {
            this.resetSize();
            this.resetLines();
            return;
        }
        this.lineHeight = data.lineHeight;
        this.viewHeight = data.viewHeight;
        this.fullHeight = data.fullHeight;
        this.scrollMax = data.scrollMax;
        this.fullLines = data.fullLines;
        this.viewLines = data.viewLines;
        this.scroll = data.scroll;
        this.offsetTop = data.offsetTop;
        this.numLines = data.numLines;
        this.top = data.top;
        this.bot = data.bot;
        return post.emit('scroll', this.scroll, this);
    };

    Scroll.prototype.reset = function() {
        this.resetLines();
        post.emit('clearLines');
        return this.updateOffset();
    };

    Scroll.prototype.info = function() {
        return {
            topbot: this.top + " .. " + this.bot + " = " + (this.bot - this.top) + " / " + this.numLines + " lines",
            scroll: this.scroll + " offsetTop " + this.offsetTop + " viewHeight " + this.viewHeight + " lineHeight " + this.lineHeight + " scrollMax " + this.scrollMax + " fullLines " + this.fullLines + " viewLines " + this.viewLines
        };
    };

    Scroll.prototype.calc = function() {
        if (this.viewHeight <= 0) {
            return;
        }
        this.scrollMax = Math.max(0, this.fullHeight - this.viewHeight);
        this.fullLines = Math.floor(this.viewHeight / this.lineHeight);
        this.viewLines = Math.ceil(this.viewHeight / this.lineHeight) + 1;
        this.by(0);
        return post.emit('scroll', this.scroll, this);
    };

    Scroll.prototype.onCombo = function(combo) {
        switch (combo) {
            case 'page up':
                return this.by(-this.lineHeight * this.viewLines);
            case 'page down':
                return this.by(this.lineHeight * this.viewLines);
            case 'up':
                return this.by(-this.lineHeight);
            case 'down':
                return this.by(this.lineHeight);
            case 'home':
                return this.to(0);
            case 'end':
                return this.to(this.scrollMax);
        }
    };

    Scroll.prototype.onScrollBy = function(delta) {
        return this.by(delta);
    };

    Scroll.prototype.to = function(p) {
        return this.by(p - this.scroll);
    };

    Scroll.prototype.by = function(delta, x) {
        var offset, oldBot, oldTop, scroll, top;
        if (this.viewLines < 0) {
            return;
        }
        oldTop = this.top;
        oldBot = this.bot;
        scroll = this.scroll;
        if (Number.isNaN(delta)) {
            delta = 0;
        }
        this.scroll = parseInt(clamp(0, this.scrollMax, this.scroll + delta));
        top = parseInt(this.scroll / this.lineHeight);
        this.top = Math.max(0, top);
        this.bot = Math.min(this.top + this.viewLines - 1);
        offset = this.scroll - this.top * this.lineHeight;
        if (offset !== this.offsetTop || scroll !== this.scroll) {
            this.offsetTop = offset;
            this.updateOffset();
            return post.emit('scroll', this.scroll, this);
        }
    };

    Scroll.prototype.updateOffset = function() {};

    Scroll.prototype.toBottom = function() {
        console.log("toBottom " + this.scroll + " " + this.scrollMax);
        this.to(this.scrollMax);
        console.log("toBottom emit " + this.scroll);
        return post.emit('scroll', this.scroll, this);
    };

    Scroll.prototype.setNumLines = function(n) {
        if (this.numLines !== n) {
            this.fullHeight = n * this.lineHeight;
            if (n) {
                this.numLines = n;
                return this.calc();
            } else {
                return this.reset();
            }
        }
    };

    Scroll.prototype.setViewHeight = function(h) {
        if (this.viewHeight !== h) {
            this.viewHeight = h;
            return this.calc();
        }
    };

    Scroll.prototype.setLineHeight = function(h) {
        if (this.lineHeight !== h) {
            this.lineHeight = h;
            this.fullHeight = this.numLines * this.lineHeight;
            this.calc();
            post.emit('clearLines');
            return post.emit('showLines', this.top, this.bot, this.bot - this.top + 1);
        }
    };

    return Scroll;

})();

module.exports = Scroll;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2Nyb2xsLmpzIiwic291cmNlUm9vdCI6Ii4iLCJzb3VyY2VzIjpbIiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBOzs7Ozs7O0FBQUEsSUFBQSwrQkFBQTtJQUFBOztBQVFBLE1BQWtCLE9BQUEsQ0FBUSxLQUFSLENBQWxCLEVBQUUsZUFBRixFQUFROztBQUVSLEtBQUEsR0FBUSxPQUFBLENBQVEsU0FBUjs7QUFFRjtJQUVXLGdCQUFDLElBQUQ7UUFBQyxJQUFDLENBQUEsT0FBRDs7Ozs7Ozs7O1FBRVYsSUFBSSxDQUFDLEVBQUwsQ0FBUSxPQUFSLEVBQW9CLElBQUMsQ0FBQSxPQUFyQjtRQUNBLElBQUksQ0FBQyxFQUFMLENBQVEsVUFBUixFQUFvQixJQUFDLENBQUEsVUFBckI7UUFFQSxJQUFDLENBQUEsU0FBRCxDQUFBO1FBQ0EsSUFBQyxDQUFBLFVBQUQsQ0FBQTtRQUVBLElBQUMsQ0FBQSxLQUFELEdBQVMsSUFBSSxLQUFKLENBQVUsSUFBVjtJQVJBOztxQkFVYixTQUFBLEdBQVcsU0FBQTtRQUVQLElBQUMsQ0FBQSxVQUFELEdBQWlCO1FBQ2pCLElBQUMsQ0FBQSxVQUFELEdBQWdCLENBQUM7UUFDakIsSUFBQyxDQUFBLFNBQUQsR0FBZ0IsQ0FBQztRQUNqQixJQUFDLENBQUEsU0FBRCxHQUFnQixDQUFDO2VBQ2pCLElBQUMsQ0FBQSxTQUFELEdBQWdCLENBQUM7SUFOVjs7cUJBUVgsVUFBQSxHQUFZLFNBQUE7UUFFUixJQUFDLENBQUEsR0FBRCxHQUFnQixDQUFDO1FBQ2pCLElBQUMsQ0FBQSxHQUFELEdBQWdCLENBQUM7UUFDakIsSUFBQyxDQUFBLFVBQUQsR0FBaUI7UUFDakIsSUFBQyxDQUFBLE1BQUQsR0FBaUI7UUFDakIsSUFBQyxDQUFBLFNBQUQsR0FBaUI7ZUFDakIsSUFBQyxDQUFBLFFBQUQsR0FBaUI7SUFQVDs7cUJBU1osSUFBQSxHQUFNLFNBQUE7ZUFFRjtZQUFBLFVBQUEsRUFBWSxJQUFDLENBQUEsVUFBYjtZQUNBLFVBQUEs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S0FBYSxDQUFoQjtZQUNJLElBQUMsQ0FBQSxVQUFELEdBQWMsQ0FBQSxHQUFJLElBQUMsQ0FBQTtZQUNuQixJQUFHLENBQUg7Z0JBQ0ksSUFBQyxDQUFBLFFBQUQsR0FBWTt1QkFDWixJQUFDLENBQUEsSUFBRCxDQUFBLEVBRko7YUFBQSxNQUFBO3VCQUlJLElBQUMsQ0FBQSxLQUFELENBQUEsRUFKSjthQUZKOztJQUZTOztxQkFnQmIsYUFBQSxHQUFlLFNBQUMsQ0FBRDtRQUVYLElBQUcsSUFBQyxDQUFBLFVBQUQsS0FBZSxDQUFsQjtZQUVJLElBQUMsQ0FBQSxVQUFELEdBQWM7bUJBQ2QsSUFBQyxDQUFBLElBQUQsQ0FBQSxFQUhKOztJQUZXOztxQkFhZixhQUFBLEdBQWUsU0FBQyxDQUFEO1FBRVgsSUFBRyxJQUFDLENBQUEsVUFBRCxLQUFlLENBQWxCO1lBQ0ksSUFBQyxDQUFBLFVBQUQsR0FBYztZQUNkLElBQUMsQ0FBQSxVQUFELEdBQWMsSUFBQyxDQUFBLFFBQUQsR0FBWSxJQUFDLENBQUE7WUFDM0IsSUFBQyxDQUFBLElBQUQsQ0FBQTtZQUNBLElBQUksQ0FBQyxJQUFMLENBQVUsWUFBVjttQkFDQSxJQUFJLENBQUMsSUFBTCxDQUFVLFdBQVYsRUFBdUIsSUFBQyxDQUFBLEdBQXhCLEVBQTZCLElBQUMsQ0FBQSxHQUE5QixFQUFtQyxJQUFDLENBQUEsR0FBRCxHQUFPLElBQUMsQ0FBQSxHQUFSLEdBQWMsQ0FBakQsRUFMSjs7SUFGVzs7Ozs7O0FBU25CLE1BQU0sQ0FBQyxPQUFQLEdBQWlCIiwic291cmNlc0NvbnRlbnQiOlsiIyMjXG4gMDAwMDAwMCAgIDAwMDAwMDAgIDAwMDAwMDAwICAgIDAwMDAwMDAgICAwMDAgICAgICAwMDAgICAgICBcbjAwMCAgICAgICAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgICAgIDAwMCAgICAgIFxuMDAwMDAwMCAgIDAwMCAgICAgICAwMDAwMDAwICAgIDAwMCAgIDAwMCAgMDAwICAgICAgMDAwICAgICAgXG4gICAgIDAwMCAgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAgICAwMDAgICAgICBcbjAwMDAwMDAgICAgMDAwMDAwMCAgMDAwICAgMDAwICAgMDAwMDAwMCAgIDAwMDAwMDAgIDAwMDAwMDAgIFxuIyMjXG5cbnsgcG9zdCwgY2xhbXAgfSA9IHJlcXVpcmUgJ2t4aydcblxuV2hlZWwgPSByZXF1aXJlICcuL3doZWVsJ1xuXG5jbGFzcyBTY3JvbGxcblxuICAgIGNvbnN0cnVjdG9yOiAoQHZpZXcpIC0+XG5cbiAgICAgICAgcG9zdC5vbiAnY29tYm8nLCAgICBAb25Db21ib1xuICAgICAgICBwb3N0Lm9uICdzY3JvbGxCeScsIEBvblNjcm9sbEJ5XG4gICAgICAgICAgICAgICAgXG4gICAgICAgIEByZXNldFNpemUoKVxuICAgICAgICBAcmVzZXRMaW5lcygpXG4gICAgICAgIFxuICAgICAgICBAd2hlZWwgPSBuZXcgV2hlZWwgQFxuICAgICAgICBcbiAgICByZXNldFNpemU6IC0+XG4gICAgICAgIFxuICAgICAgICBAbGluZUhlaWdodCAgID0gIDAgIyBoZWlnaHQgb2Ygc2luZ2xlIGxpbmUgKHBpeGVscylcbiAgICAgICAgQHZpZXdIZWlnaHQgICA9IC0xICMgaGVpZ2h0IG9mIHNjcm9sbCB2aWV3IChwaXhlbHMpXG4gICAgICAgIEBmdWxsTGluZXMgICAgPSAtMSAjIG51bWJlciBvZiBmdWxsIGxpbmVzIGZpdHRpbmcgaW4gdmlldyAoZXhjbHVkaW5nIHBhcnRpYWxzKVxuICAgICAgICBAdmlld0xpbmVzICAgID0gLTEgIyBudW1iZXIgb2YgbGluZXMgZml0dGluZyBpbiB2aWV3IChpbmNsdWRpbmcgcGFydGlhbHMpXG4gICAgICAgIEBzY3JvbGxNYXggICAgPSAtMSAjIG1heGltdW0gc2Nyb2xsIG9mZnNldCAocGl4ZWxzKVxuICAgICAgICBcbiAgICByZXNldExpbmVzOiAtPlxuICAgICAgICBcbiAgICAgICAgQHRvcCAgICAgICAgICA9IC0xICMgaW5kZXggb2YgZmlyc3QgdmlzaWJsZSBsaW5lIGluIHZpZXdcbiAgICAgICAgQGJvdCAgICAgICAgICA9IC0xICMgaW5kZXggb2YgbGFzdCAgdmlzaWJsZSBsaW5lIGluIHZpZXdcbiAgICAgICAgQGZ1bGxIZWlnaHQgICA9ICAwICMgdG90YWwgaGVpZ2h0IG9mIGFsbCBsaW5lcyAocGl4ZWxzKVxuICAgICAgICBAc2Nyb2xsICAgICAgID0gIDAgIyBjdXJyZW50IHNjcm9sbCB2YWx1ZSBmcm9tIGRvY3VtZW50IHN0YXJ0IChwaXhlbHMpXG4gICAgICAgIEBvZmZzZXRUb3AgICAgPSAgMCAjIGhlaWdodCBvZiB2aWV3IGFib3ZlIGZpcnN0IHZpc2libGUgbGluZSAocGl4ZWxzKVxuICAgICAgICBAbnVtTGluZXMgICAgID0gIDAgIyB0b3RhbCBudW1iZXIgb2YgbGluZXMgaW4gYnVmZmVyXG4gICAgICAgIFxuICAgIGRhdGE6IC0+XG4gICAgICAgIFxuICAgICAgICBsaW5lSGVpZ2h0OiBAbGluZUhlaWdodCBcbiAgICAgICAgdmlld0hlaWdodDogQHZpZXdIZWlnaHQgXG4gICAgICAgIGZ1bGxIZWlnaHQ6IEBmdWxsSGVpZ2h0IFxuICAgICAgICBzY3JvbGxNYXg6ICBAc2Nyb2xsTWF4ICBcbiAgICAgICAgZnVsbExpbmVzOiAgQGZ1bGxMaW5lcyAgXG4gICAgICAgIHZpZXdMaW5lczogIEB2aWV3TGluZXMgIFxuICAgICAgICBzY3JvbGw6ICAgICBAc2Nyb2xsICAgICBcbiAgICAgICAgb2Zmc2V0VG9wOiAgQG9mZnNldFRvcCAgXG4gICAgICAgIG51bUxpbmVzOiAgIEBudW1MaW5lcyAgIFxuICAgICAgICB0b3A6ICAgICAgICBAdG9wICAgICAgICBcbiAgICAgICAgYm90OiAgICAgICAgQGJvdCAgICAgICAgXG4gICAgICAgIFxuICAgIHJlc3RvcmU6IChkYXRhKSAtPlxuICAgICAgICBcbiAgICAgICAgaWYgbm90IGRhdGFcbiAgICAgICAgICAgIEByZXNldFNpemUoKVxuICAgICAgICAgICAgQHJlc2V0TGluZXMoKVxuICAgICAgICAgICAgcmV0dXJuXG4gICAgICAgICAgICBcbiAgICAgICAgQGxpbmVIZWlnaHQgPSBkYXRhLmxpbmVIZWlnaHRcbiAgICAgICAgQHZpZXdIZWlnaHQgPSBkYXRhLnZpZXdIZWlnaHRcbiAgICAgICAgQGZ1bGxIZWlnaHQgPSBkYXRhLmZ1bGxIZWlnaHRcbiAgICAgICAgQHNjcm9sbE1heCAgPSBkYXRhLnNjcm9sbE1heFxuICAgICAgICBAZnVsbExpbmVzICA9IGRhdGEuZnVsbExpbmVzXG4gICAgICAgIEB2aWV3TGluZXMgID0gZGF0YS52aWV3TGluZXNcbiAgICAgICAgQHNjcm9sbCAgICAgPSBkYXRhLnNjcm9sbFxuICAgICAgICBAb2Zmc2V0VG9wICA9IGRhdGEub2Zmc2V0VG9wXG4gICAgICAgIEBudW1MaW5lcyAgID0gZGF0YS5udW1MaW5lc1xuICAgICAgICBAdG9wICAgICAgICA9IGRhdGEudG9wXG4gICAgICAgIEBib3QgICAgICAgID0gZGF0YS5ib3RcbiAgICAgICAgcG9zdC5lbWl0ICdzY3JvbGwnLCBAc2Nyb2xsLCBAXG4gICAgICAgIFxuICAgICMgMDAwMDAwMDAgICAwMDAwMDAwMCAgIDAwMDAwMDAgIDAwMDAwMDAwICAwMDAwMDAwMDBcbiAgICAjIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgICAgICAwMDAgICAgICAgICAgMDAwICAgXG4gICAgIyAwMDAwMDAwICAgIDAwMDAwMDAgICAwMDAwMDAwICAgMDAwMDAwMCAgICAgIDAwMCAgIFxuICAgICMgMDAwICAgMDAwICAwMDAgICAgICAgICAgICAwMDAgIDAwMCAgICAgICAgICAwMDAgICBcbiAgICAjIDAwMCAgIDAwMCAgMDAwMDAwMDAgIDAwMDAwMDAgICAwMDAwMDAwMCAgICAgMDAwICAgXG4gICAgXG4gICAgcmVzZXQ6ID0+XG4gICAgICAgIFxuICAgICAgICBAcmVzZXRMaW5lcygpXG4gICAgICAgIFxuICAgICAgICBwb3N0LmVtaXQgJ2NsZWFyTGluZXMnXG4gICAgICAgIFxuICAgICAgICBAdXBkYXRlT2Zmc2V0KClcbiAgICAgICAgXG4gICAgIyAwMDAgIDAwMCAgIDAwMCAgMDAwMDAwMDAgICAwMDAwMDAwIFxuICAgICMgMDAwICAwMDAwICAwMDAgIDAwMCAgICAgICAwMDAgICAwMDBcbiAgICAjIDAwMCAgMDAwIDAgMDAwICAwMDAwMDAgICAgMDAwICAgMDAwXG4gICAgIyAwMDAgIDAwMCAgMDAwMCAgMDAwICAgICAgIDAwMCAgIDAwMFxuICAgICMgMDAwICAwMDAgICAwMDAgIDAwMCAgICAgICAgMDAwMDAwMCBcbiAgICBcbiAgICBpbmZvOiAtPlxuICAgICAgICBcbiAgICAgICAgdG9wYm90OiBcIiN7QHRvcH0gLi4gI3tAYm90fSA9ICN7QGJvdC1AdG9wfSAvICN7QG51bUxpbmVzfSBsaW5lc1wiXG4gICAgICAgIHNjcm9sbDogXCIje0BzY3JvbGx9IG9mZnNldFRvcCAje0BvZmZzZXRUb3B9IHZpZXdIZWlnaHQgI3tAdmlld0hlaWdodH0gbGluZUhlaWdodCAje0BsaW5lSGVpZ2h0fSBzY3JvbGxNYXggI3tAc2Nyb2xsTWF4fSBmdWxsTGluZXMgI3tAZnVsbExpbmVzfSB2aWV3TGluZXMgI3tAdmlld0xpbmVzfVwiXG4gICAgICAgIFxuICAgICMgIDAwMDAwMDAgICAwMDAwMDAwICAgMDAwICAgICAgIDAwMDAwMDAgIFxuICAgICMgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgICAgMDAwICAgICAgIFxuICAgICMgMDAwICAgICAgIDAwMDAwMDAwMCAgMDAwICAgICAgMDAwICAgICAgIFxuICAgICMgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgICAgMDAwICAgICAgIFxuICAgICMgIDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwMDAwMCAgIDAwMDAwMDAgIFxuICAgIFxuICAgIGNhbGM6IC0+XG4gICAgICAgIFxuICAgICAgICBpZiBAdmlld0hlaWdodCA8PSAwXG4gICAgICAgICAgICByZXR1cm5cbiAgICAgICAgICAgIFxuICAgICAgICBAc2Nyb2xsTWF4ID0gTWF0aC5tYXgoMCxAZnVsbEhlaWdodCAtIEB2aWV3SGVpZ2h0KSAgICMgbWF4aW11bSBzY3JvbGwgb2Zmc2V0IChwaXhlbHMpXG4gICAgICAgIEBmdWxsTGluZXMgPSBNYXRoLmZsb29yKEB2aWV3SGVpZ2h0IC8gQGxpbmVIZWlnaHQpICAgIyBudW1iZXIgb2YgbGluZXMgaW4gdmlldyAoZXhjbHVkaW5nIHBhcnRpYWxzKVxuICAgICAgICBAdmlld0xpbmVzID0gTWF0aC5jZWlsKEB2aWV3SGVpZ2h0IC8gQGxpbmVIZWlnaHQpKzEgICMgbnVtYmVyIG9mIGxpbmVzIGluIHZpZXcgKGluY2x1ZGluZyBwYXJ0aWFscylcbiAgICAgICAgXG4gICAgICAgIEBieSAwXG4gICAgICAgIHBvc3QuZW1pdCAnc2Nyb2xsJywgQHNjcm9sbCwgQFxuICAgICAgICAgICAgICAgIFxuICAgICMgIDAwMDAwMDAgICAwMDAwMDAwICAgMDAgICAgIDAwICAwMDAwMDAwICAgICAwMDAwMDAwICAgXG4gICAgIyAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICBcbiAgICAjIDAwMCAgICAgICAwMDAgICAwMDAgIDAwMDAwMDAwMCAgMDAwMDAwMCAgICAwMDAgICAwMDAgIFxuICAgICMgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwIDAgMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgXG4gICAgIyAgMDAwMDAwMCAgIDAwMDAwMDAgICAwMDAgICAwMDAgIDAwMDAwMDAgICAgIDAwMDAwMDAgICBcbiAgICBcbiAgICBvbkNvbWJvOiAoY29tYm8pID0+XG4gICAgICAgIFxuICAgICAgICBzd2l0Y2ggY29tYm9cbiAgICAgICAgICAgIHdoZW4gJ3BhZ2UgdXAnICAgdGhlbiBAYnkgLUBsaW5lSGVpZ2h0KkB2aWV3TGluZXNcbiAgICAgICAgICAgIHdoZW4gJ3BhZ2UgZG93bicgdGhlbiBAYnkgQGxpbmVIZWlnaHQqQHZpZXdMaW5lc1xuICAgICAgICAgICAgd2hlbiAndXAnICAgICAgICB0aGVuIEBieSAtQGxpbmVIZWlnaHRcbiAgICAgICAgICAgIHdoZW4gJ2Rvd24nICAgICAgdGhlbiBAYnkgQGxpbmVIZWlnaHRcbiAgICAgICAgICAgIHdoZW4gJ2hvbWUnICAgICAgdGhlbiBAdG8gMFxuICAgICAgICAgICAgd2hlbiAnZW5kJyAgICAgICB0aGVuIEB0byBAc2Nyb2xsTWF4XG4gICAgXG4gICAgb25TY3JvbGxCeTogKGRlbHRhKSA9PiAjIGVtaXR0ZWQgYnkgd2hlZWxcbiAgICBcbiAgICAgICAgQGJ5IGRlbHRhXG4gICAgICAgICAgICBcbiAgICAjIDAwMDAwMDAgICAgMDAwICAgMDAwXG4gICAgIyAwMDAgICAwMDAgICAwMDAgMDAwIFxuICAgICMgMDAwMDAwMCAgICAgIDAwMDAwICBcbiAgICAjIDAwMCAgIDAwMCAgICAgMDAwICAgXG4gICAgIyAwMDAwMDAwICAgICAgIDAwMCAgIFxuICAgICAgICBcbiAgICB0bzogKHApID0+IEBieSBwLUBzY3JvbGxcbiAgICBcbiAgICBieTogKGRlbHRhLCB4KSA9PlxuICAgICAgICBcbiAgICAgICAgcmV0dXJuIGlmIEB2aWV3TGluZXMgPCAwXG4gICAgICAgICAgICAgICAgXG4gICAgICAgIG9sZFRvcCA9IEB0b3BcbiAgICAgICAgb2xkQm90ID0gQGJvdFxuICAgICAgICBcbiAgICAgICAgc2Nyb2xsID0gQHNjcm9sbFxuICAgICAgICBkZWx0YSAgPSAwIGlmIE51bWJlci5pc05hTiBkZWx0YVxuICAgICAgICBcbiAgICAgICAgQHNjcm9sbCA9IHBhcnNlSW50IGNsYW1wIDAsIEBzY3JvbGxNYXgsIEBzY3JvbGwrZGVsdGFcbiAgICAgICAgXG4gICAgICAgIHRvcCAgPSBwYXJzZUludCBAc2Nyb2xsIC8gQGxpbmVIZWlnaHRcbiAgICAgICAgXG4gICAgICAgIEB0b3AgPSBNYXRoLm1heCAwLCB0b3BcbiAgICAgICAgQGJvdCA9IE1hdGgubWluIEB0b3ArQHZpZXdMaW5lcy0xXG4gICAgICAgIFxuICAgICAgICBvZmZzZXQgPSBAc2Nyb2xsIC0gQHRvcCAqIEBsaW5lSGVpZ2h0XG4gICAgICAgIFxuICAgICAgICBpZiBvZmZzZXQgIT0gQG9mZnNldFRvcCBvciBzY3JvbGwgIT0gQHNjcm9sbFxuICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICBAb2Zmc2V0VG9wID0gb2Zmc2V0XG4gICAgICAgICAgICBAdXBkYXRlT2Zmc2V0KClcbiAgICAgICAgICAgICMgbG9nIFwiZW1pdCBzY3JvbGwgI3tAc2Nyb2xsfVwiXG4gICAgICAgICAgICBwb3N0LmVtaXQgJ3Njcm9sbCcsIEBzY3JvbGwsIEAgICAgICBcbiAgICAgICAgICAgIFxuICAgICMgIDAwMDAwMDAgICAwMDAwMDAwMCAgMDAwMDAwMDAgICAwMDAwMDAwICAwMDAwMDAwMCAgMDAwMDAwMDAwICBcbiAgICAjIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgICAgICAwMDAgICAgICAgMDAwICAgICAgICAgIDAwMCAgICAgXG4gICAgIyAwMDAgICAwMDAgIDAwMDAwMCAgICAwMDAwMDAgICAgMDAwMDAwMCAgIDAwMDAwMDAgICAgICAwMDAgICAgIFxuICAgICMgMDAwICAgMDAwICAwMDAgICAgICAgMDAwICAgICAgICAgICAgMDAwICAwMDAgICAgICAgICAgMDAwICAgICBcbiAgICAjICAwMDAwMDAwICAgMDAwICAgICAgIDAwMCAgICAgICAwMDAwMDAwICAgMDAwMDAwMDAgICAgIDAwMCAgICAgXG4gICAgXG4gICAgdXBkYXRlT2Zmc2V0OiAtPlxuICAgICAgICBcbiAgICB0b0JvdHRvbTogLT5cbiAgICAgICAgbG9nIFwidG9Cb3R0b20gI3tAc2Nyb2xsfSAje0BzY3JvbGxNYXh9XCJcbiAgICAgICAgQHRvIEBzY3JvbGxNYXhcbiAgICAgICAgbG9nIFwidG9Cb3R0b20gZW1pdCAje0BzY3JvbGx9XCJcbiAgICAgICAgcG9zdC5lbWl0ICdzY3JvbGwnLCBAc2Nyb2xsLCBAXG4gICAgICAgIFxuICAgICMgMDAwICAgMDAwICAwMDAgICAwMDAgIDAwICAgICAwMCAgMDAwICAgICAgMDAwICAwMDAgICAwMDAgIDAwMDAwMDAwICAgMDAwMDAwMFxuICAgICMgMDAwMCAgMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgMDAwICAgICAgMDAwICAwMDAwICAwMDAgIDAwMCAgICAgICAwMDAgICAgIFxuICAgICMgMDAwIDAgMDAwICAwMDAgICAwMDAgIDAwMDAwMDAwMCAgMDAwICAgICAgMDAwICAwMDAgMCAwMDAgIDAwMDAwMDAgICAwMDAwMDAwIFxuICAgICMgMDAwICAwMDAwICAwMDAgICAwMDAgIDAwMCAwIDAwMCAgMDAwICAgICAgMDAwICAwMDAgIDAwMDAgIDAwMCAgICAgICAgICAgIDAwMFxuICAgICMgMDAwICAgMDAwICAgMDAwMDAwMCAgIDAwMCAgIDAwMCAgMDAwMDAwMCAgMDAwICAwMDAgICAwMDAgIDAwMDAwMDAwICAwMDAwMDAwIFxuICAgICAgICBcbiAgICBzZXROdW1MaW5lczogKG4pID0+XG4gICAgICAgIFxuICAgICAgICBpZiBAbnVtTGluZXMgIT0gblxuICAgICAgICAgICAgQGZ1bGxIZWlnaHQgPSBuICogQGxpbmVIZWlnaHRcbiAgICAgICAgICAgIGlmIG5cbiAgICAgICAgICAgICAgICBAbnVtTGluZXMgPSBuXG4gICAgICAgICAgICAgICAgQGNhbGMoKVxuICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgIEByZXNldCgpIFxuXG4gICAgIyAwMDAgICAwMDAgIDAwMCAgMDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAwMDAwMCAgMDAwICAgMDAwMDAwMCAgIDAwMCAgIDAwMCAgMDAwMDAwMDAwXG4gICAgIyAwMDAgICAwMDAgIDAwMCAgMDAwICAgICAgIDAwMCAwIDAwMCAgMDAwICAgMDAwICAwMDAgICAgICAgMDAwICAwMDAgICAgICAgIDAwMCAgIDAwMCAgICAgMDAwICAgXG4gICAgIyAgMDAwIDAwMCAgIDAwMCAgMDAwMDAwMCAgIDAwMDAwMDAwMCAgMDAwMDAwMDAwICAwMDAwMDAwICAgMDAwICAwMDAgIDAwMDAgIDAwMDAwMDAwMCAgICAgMDAwICAgXG4gICAgIyAgICAwMDAgICAgIDAwMCAgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgMDAwICAwMDAgICAgICAgMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgICAgMDAwICAgXG4gICAgIyAgICAgMCAgICAgIDAwMCAgMDAwMDAwMDAgIDAwICAgICAwMCAgMDAwICAgMDAwICAwMDAwMDAwMCAgMDAwICAgMDAwMDAwMCAgIDAwMCAgIDAwMCAgICAgMDAwICAgXG5cbiAgICBzZXRWaWV3SGVpZ2h0OiAoaCkgPT5cbiAgICAgICAgXG4gICAgICAgIGlmIEB2aWV3SGVpZ2h0ICE9IGhcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgQHZpZXdIZWlnaHQgPSBoXG4gICAgICAgICAgICBAY2FsYygpXG4gICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAjIDAwMCAgICAgIDAwMCAgMDAwICAgMDAwICAwMDAwMDAwMCAgMDAwICAgMDAwICAwMDAwMDAwMCAgMDAwICAgMDAwMDAwMCAgIDAwMCAgIDAwMCAgMDAwMDAwMDAwXG4gICAgIyAwMDAgICAgICAwMDAgIDAwMDAgIDAwMCAgMDAwICAgICAgIDAwMCAgIDAwMCAgMDAwICAgICAgIDAwMCAgMDAwICAgICAgICAwMDAgICAwMDAgICAgIDAwMCAgIFxuICAgICMgMDAwICAgICAgMDAwICAwMDAgMCAwMDAgIDAwMDAwMDAgICAwMDAwMDAwMDAgIDAwMDAwMDAgICAwMDAgIDAwMCAgMDAwMCAgMDAwMDAwMDAwICAgICAwMDAgICBcbiAgICAjIDAwMCAgICAgIDAwMCAgMDAwICAwMDAwICAwMDAgICAgICAgMDAwICAgMDAwICAwMDAgICAgICAgMDAwICAwMDAgICAwMDAgIDAwMCAgIDAwMCAgICAgMDAwICAgXG4gICAgIyAwMDAwMDAwICAwMDAgIDAwMCAgIDAwMCAgMDAwMDAwMDAgIDAwMCAgIDAwMCAgMDAwMDAwMDAgIDAwMCAgIDAwMDAwMDAgICAwMDAgICAwMDAgICAgIDAwMCAgIFxuXG4gICAgc2V0TGluZUhlaWdodDogKGgpID0+XG4gICAgICAgICAgICBcbiAgICAgICAgaWYgQGxpbmVIZWlnaHQgIT0gaFxuICAgICAgICAgICAgQGxpbmVIZWlnaHQgPSBoXG4gICAgICAgICAgICBAZnVsbEhlaWdodCA9IEBudW1MaW5lcyAqIEBsaW5lSGVpZ2h0ICAgICAgICAgICAgXG4gICAgICAgICAgICBAY2FsYygpXG4gICAgICAgICAgICBwb3N0LmVtaXQgJ2NsZWFyTGluZXMnXG4gICAgICAgICAgICBwb3N0LmVtaXQgJ3Nob3dMaW5lcycsIEB0b3AsIEBib3QsIEBib3QgLSBAdG9wICsgMVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXG5tb2R1bGUuZXhwb3J0cyA9IFNjcm9sbFxuIl19
//# sourceURL=../coffee/scroll.coffee